{% extends "layouts/finchat_dark_layout.html" %}

{% set active_page = 'strategy_hub' %}

{% block header_title %}
<i class="fas fa-magic me-2"></i> Create Strategy Story
{% endblock %}

{% block additional_styles %}
<style>
    /* Enhanced Story Generator Styles */
    .story-generator-container {
        padding: 1.5rem;
    }
    
    .generator-section {
        margin-bottom: 2rem;
    }
    
    .generator-card {
        background: rgba(30, 32, 40, 0.6);
        border-radius: 0.75rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
        overflow: hidden;
        transition: all 0.2s ease;
    }
    
    .generator-card-header {
        padding: 1.25rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .generator-card-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
    }
    
    .generator-card-title i {
        margin-right: 0.5rem;
        color: var(--bs-primary);
    }
    
    .generator-card-body {
        padding: 1.25rem;
    }
    
    .template-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .template-option {
        padding: 1.25rem;
        background: rgba(30, 32, 40, 0.3);
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .template-option:hover {
        background: rgba(var(--bs-primary-rgb), 0.1);
        border-color: rgba(var(--bs-primary-rgb), 0.2);
    }
    
    .template-option.selected {
        background: rgba(var(--bs-primary-rgb), 0.15);
        border-color: rgba(var(--bs-primary-rgb), 0.3);
    }
    
    .template-option-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }
    
    .template-option-title i {
        margin-right: 0.5rem;
        color: var(--bs-primary);
    }
    
    .template-option-description {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .form-floating>label {
        color: rgba(255, 255, 255, 0.6);
    }
    
    .form-control, .form-select {
        background-color: rgba(30, 32, 40, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
    }
    
    .form-control:focus, .form-select:focus {
        background-color: rgba(30, 32, 40, 0.5);
        border-color: rgba(var(--bs-primary-rgb), 0.5);
        color: rgba(255, 255, 255, 1);
    }
    
    .input-section {
        margin-bottom: 1.5rem;
    }
    
    .input-row {
        margin-bottom: 1rem;
    }
    
    .ai-suggestion {
        padding: 0.75rem;
        margin-top: 0.5rem;
        background: rgba(var(--bs-primary-rgb), 0.1);
        border: 1px solid rgba(var(--bs-primary-rgb), 0.2);
        border-radius: 0.5rem;
        font-size: 0.85rem;
        display: flex;
        align-items: flex-start;
    }
    
    .ai-suggestion-icon {
        color: var(--bs-primary);
        font-size: 1rem;
        margin-right: 0.5rem;
        margin-top: 0.1rem;
    }
    
    .ai-suggestion-content {
        flex: 1;
    }
    
    .ai-suggestion-apply {
        margin-top: 0.5rem;
        font-size: 0.75rem;
        padding: 0.2rem 0.5rem;
        background: rgba(var(--bs-primary-rgb), 0.3);
        border: 1px solid rgba(var(--bs-primary-rgb), 0.4);
        color: var(--bs-primary);
        border-radius: 0.25rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .ai-suggestion-apply:hover {
        background: rgba(var(--bs-primary-rgb), 0.4);
    }
    
    .metric-card {
        padding: 0.75rem;
        background: rgba(30, 32, 40, 0.3);
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .metric-card-name {
        font-weight: 500;
    }
    
    .metric-card-details {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
    }
    
    .metric-card-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .metric-card-action {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.25rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .metric-card-action:hover {
        background: rgba(var(--bs-primary-rgb), 0.2);
        color: var(--bs-primary);
    }
    
    .visual-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem;
        background: rgba(30, 32, 40, 0.3);
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .visual-option:hover {
        background: rgba(var(--bs-primary-rgb), 0.1);
        border-color: rgba(var(--bs-primary-rgb), 0.2);
    }
    
    .visual-option.selected {
        background: rgba(var(--bs-primary-rgb), 0.15);
        border-color: rgba(var(--bs-primary-rgb), 0.3);
    }
    
    .visual-option-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        color: var(--bs-primary);
    }
    
    .visual-option-title {
        font-size: 0.85rem;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    
    .progress-indicator {
        display: flex;
        margin-bottom: 2rem;
    }
    
    .progress-step {
        flex: 1;
        position: relative;
        padding-bottom: 1.5rem;
        text-align: center;
    }
    
    .progress-step:not(:last-child):after {
        content: '';
        position: absolute;
        top: 1rem;
        right: 0;
        width: calc(100% - 2rem);
        height: 2px;
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(1rem);
    }
    
    .progress-step.completed:not(:last-child):after {
        background: var(--bs-primary);
    }
    
    .progress-step-number {
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.5rem;
        font-weight: 600;
        font-size: 0.85rem;
    }
    
    .progress-step.active .progress-step-number {
        background: rgba(var(--bs-primary-rgb), 0.2);
        border-color: var(--bs-primary);
        color: var(--bs-primary);
    }
    
    .progress-step.completed .progress-step-number {
        background: var(--bs-primary);
        border-color: var(--bs-primary);
        color: #fff;
    }
    
    .progress-step-label {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
    }
    
    .progress-step.active .progress-step-label {
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
    }
    
    .preview-container {
        margin-top: 2rem;
        padding: 1.25rem;
        background: rgba(30, 32, 40, 0.3);
        border-radius: 0.75rem;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .preview-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
    }
    
    .preview-toggle {
        font-size: 0.85rem;
        color: var(--bs-primary);
        cursor: pointer;
        display: flex;
        align-items: center;
    }
    
    .preview-toggle i {
        margin-right: 0.35rem;
    }
    
    .preview-content {
        display: none;
    }
    
    .preview-content.visible {
        display: block;
    }
    
    .chart-placeholder {
        height: 200px;
        background: rgba(30, 32, 40, 0.5);
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 1rem;
    }
    
    .narrative-placeholder {
        height: 100px;
        background: rgba(30, 32, 40, 0.5);
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 1rem;
    }
    
    .form-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
    }
</style>
{% endblock %}

{% block main_content %}
<div class="story-generator-container">
    <!-- Progress Indicator -->
    <div class="progress-indicator">
        <div class="progress-step completed" id="step1">
            <div class="progress-step-number">1</div>
            <div class="progress-step-label">Choose Template</div>
        </div>
        <div class="progress-step active" id="step2">
            <div class="progress-step-number">2</div>
            <div class="progress-step-label">Enter Details</div>
        </div>
        <div class="progress-step" id="step3">
            <div class="progress-step-number">3</div>
            <div class="progress-step-label">Select Metrics</div>
        </div>
        <div class="progress-step" id="step4">
            <div class="progress-step-number">4</div>
            <div class="progress-step-label">Visual Style</div>
        </div>
        <div class="progress-step" id="step5">
            <div class="progress-step-number">5</div>
            <div class="progress-step-label">Generate</div>
        </div>
    </div>
    
    <form id="storyGeneratorForm">
        <!-- Step 1: Template Selection (visible by default) -->
        <div class="generator-section" id="templateSection">
            <div class="generator-card">
                <div class="generator-card-header">
                    <h5 class="generator-card-title">
                        <i class="fas fa-copy"></i> Choose a Template
                    </h5>
                </div>
                <div class="generator-card-body">
                    <p class="text-muted mb-4">Select a template as the foundation for your sustainability story.</p>
                    
                    <div class="template-options">
                        <div class="template-option selected" data-template="esg_report">
                            <div class="template-option-title">
                                <i class="fas fa-file-alt"></i> ESG Performance Report
                            </div>
                            <div class="template-option-description">
                                Comprehensive overview of environmental, social, and governance performance with key metrics.
                            </div>
                        </div>
                        
                        <div class="template-option" data-template="impact_story">
                            <div class="template-option-title">
                                <i class="fas fa-impact"></i> Impact Narrative
                            </div>
                            <div class="template-option-description">
                                Compelling story about specific sustainability impacts with stakeholder perspectives.
                            </div>
                        </div>
                        
                        <div class="template-option" data-template="net_zero">
                            <div class="template-option-title">
                                <i class="fas fa-leaf"></i> Net Zero Journey
                            </div>
                            <div class="template-option-description">
                                Strategic decarbonization roadmap with science-based targets and milestone tracking.
                            </div>
                        </div>
                        
                        <div class="template-option" data-template="circular">
                            <div class="template-option-title">
                                <i class="fas fa-recycle"></i> Circular Economy
                            </div>
                            <div class="template-option-description">
                                Material flow analysis with waste reduction strategies and circularity metrics.
                            </div>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion" id="templateSuggestion">
                        <div class="ai-suggestion-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="ai-suggestion-content">
                            <div class="mb-1"><strong>AI Suggestion:</strong> Based on your industry, an ESG Performance Report would be most appropriate for comprehensive stakeholder communication.</div>
                            <button class="ai-suggestion-apply" id="applyTemplateSuggestion">Apply This Suggestion</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Enter Basic Details -->
        <div class="generator-section" id="detailsSection">
            <div class="generator-card">
                <div class="generator-card-header">
                    <h5 class="generator-card-title">
                        <i class="fas fa-info-circle"></i> Basic Information
                    </h5>
                </div>
                <div class="generator-card-body">
                    <div class="input-section">
                        <div class="row input-row">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="storyTitle" placeholder="Enter a title" required>
                                    <label for="storyTitle">Story Title</label>
                                </div>
                                
                                <div class="ai-suggestion mt-2" id="titleSuggestion">
                                    <div class="ai-suggestion-icon">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="ai-suggestion-content">
                                        <div class="mb-1"><strong>Title Suggestion:</strong> "Accelerating Our Net Zero Journey: 2025 Sustainability Performance"</div>
                                        <button class="ai-suggestion-apply" data-target="storyTitle">Use This Title</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select" id="storyCategory" required>
                                        <option value="" selected disabled>Select a category</option>
                                        <option value="emissions">Emissions & Climate</option>
                                        <option value="water">Water Management</option>
                                        <option value="waste">Waste & Circularity</option>
                                        <option value="social">Social Impact</option>
                                        <option value="governance">Governance</option>
                                        <option value="biodiversity">Biodiversity</option>
                                    </select>
                                    <label for="storyCategory">Primary Category</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row input-row">
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="companyName" placeholder="Enter company name" required>
                                    <label for="companyName">Company Name</label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <select class="form-select" id="industry" required>
                                        <option value="" selected disabled>Select an industry</option>
                                        <option value="technology">Technology</option>
                                        <option value="finance">Financial Services</option>
                                        <option value="manufacturing">Manufacturing</option>
                                        <option value="energy">Energy</option>
                                        <option value="retail">Retail</option>
                                        <option value="healthcare">Healthcare</option>
                                        <option value="agriculture">Agriculture & Food</option>
                                        <option value="transportation">Transportation & Logistics</option>
                                    </select>
                                    <label for="industry">Industry</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row input-row">
                            <div class="col-12">
                                <div class="form-floating">
                                    <textarea class="form-control" id="storyContext" style="height: 100px" placeholder="Enter story context"></textarea>
                                    <label for="storyContext">Context & Background (Optional)</label>
                                </div>
                                
                                <div class="ai-suggestion mt-2" id="contextSuggestion">
                                    <div class="ai-suggestion-icon">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="ai-suggestion-content">
                                        <div class="mb-1"><strong>Context Suggestion:</strong> "As part of our company-wide commitment to sustainability, we've set ambitious targets to reduce our environmental footprint while enhancing our social impact. This report highlights our progress, challenges, and future initiatives."</div>
                                        <button class="ai-suggestion-apply" data-target="storyContext">Use This Context</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Select Metrics -->
        <div class="generator-section" id="metricsSection" style="display: none;">
            <div class="generator-card">
                <div class="generator-card-header">
                    <h5 class="generator-card-title">
                        <i class="fas fa-chart-bar"></i> Key Metrics
                    </h5>
                </div>
                <div class="generator-card-body">
                    <p class="text-muted mb-3">Select metrics to include in your sustainability story.</p>
                    
                    <div class="row mb-3">
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" id="metricSearch" placeholder="Search for metrics...">
                                <button class="btn btn-outline-secondary" type="button" id="addMetricBtn">Add Metric</button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="metricCategoryFilter">
                                <option value="all" selected>All Categories</option>
                                <option value="emissions">Emissions</option>
                                <option value="water">Water</option>
                                <option value="waste">Waste</option>
                                <option value="energy">Energy</option>
                                <option value="social">Social</option>
                                <option value="governance">Governance</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="ai-suggestion mb-3" id="metricsSuggestion">
                        <div class="ai-suggestion-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="ai-suggestion-content">
                            <div class="mb-1"><strong>AI Suggestion:</strong> Based on your industry and template, I recommend including these metrics:</div>
                            <div class="mb-2">
                                <span class="badge bg-primary bg-opacity-10 text-primary me-2">Scope 1 & 2 Emissions</span>
                                <span class="badge bg-primary bg-opacity-10 text-primary me-2">Energy Intensity</span>
                                <span class="badge bg-primary bg-opacity-10 text-primary">Water Withdrawal</span>
                            </div>
                            <button class="ai-suggestion-apply" id="applyMetricSuggestion">Add These Metrics</button>
                        </div>
                    </div>
                    
                    <div id="selectedMetrics">
                        <div class="metric-card" data-metric-id="1">
                            <div>
                                <div class="metric-card-name">Scope 1 & 2 Emissions</div>
                                <div class="metric-card-details">Category: Emissions | Unit: tCO₂e</div>
                            </div>
                            <div class="metric-card-actions">
                                <div class="metric-card-action" data-action="edit">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="metric-card-action" data-action="delete">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card" data-metric-id="2">
                            <div>
                                <div class="metric-card-name">Renewable Energy Percentage</div>
                                <div class="metric-card-details">Category: Energy | Unit: %</div>
                            </div>
                            <div class="metric-card-actions">
                                <div class="metric-card-action" data-action="edit">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="metric-card-action" data-action="delete">
                                    <i class="fas fa-trash"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 4: Visual Style -->
        <div class="generator-section" id="visualSection" style="display: none;">
            <div class="generator-card">
                <div class="generator-card-header">
                    <h5 class="generator-card-title">
                        <i class="fas fa-paint-brush"></i> Visual Style
                    </h5>
                </div>
                <div class="generator-card-body">
                    <p class="text-muted mb-3">Choose visualization styles for your story.</p>
                    
                    <div class="mb-4">
                        <label class="form-label">Primary Chart Type</label>
                        <div class="row">
                            <div class="col-md-2 col-sm-4 col-6 mb-3">
                                <div class="visual-option selected" data-chart-type="bar">
                                    <div class="visual-option-icon">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                    <div class="visual-option-title">Bar Chart</div>
                                </div>
                            </div>
                            
                            <div class="col-md-2 col-sm-4 col-6 mb-3">
                                <div class="visual-option" data-chart-type="line">
                                    <div class="visual-option-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="visual-option-title">Line Chart</div>
                                </div>
                            </div>
                            
                            <div class="col-md-2 col-sm-4 col-6 mb-3">
                                <div class="visual-option" data-chart-type="pie">
                                    <div class="visual-option-icon">
                                        <i class="fas fa-chart-pie"></i>
                                    </div>
                                    <div class="visual-option-title">Pie Chart</div>
                                </div>
                            </div>
                            
                            <div class="col-md-2 col-sm-4 col-6 mb-3">
                                <div class="visual-option" data-chart-type="area">
                                    <div class="visual-option-icon">
                                        <i class="fas fa-mountain"></i>
                                    </div>
                                    <div class="visual-option-title">Area Chart</div>
                                </div>
                            </div>
                            
                            <div class="col-md-2 col-sm-4 col-6 mb-3">
                                <div class="visual-option" data-chart-type="radar">
                                    <div class="visual-option-icon">
                                        <i class="fas fa-spider"></i>
                                    </div>
                                    <div class="visual-option-title">Radar Chart</div>
                                </div>
                            </div>
                            
                            <div class="col-md-2 col-sm-4 col-6 mb-3">
                                <div class="visual-option" data-chart-type="scatter">
                                    <div class="visual-option-icon">
                                        <i class="fas fa-braille"></i>
                                    </div>
                                    <div class="visual-option-title">Scatter Plot</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="colorScheme" class="form-label">Color Scheme</label>
                            <select class="form-select" id="colorScheme">
                                <option value="sustainable" selected>Sustainable Earth (Greens/Blues)</option>
                                <option value="corporate">Corporate Professional (Blues)</option>
                                <option value="vibrant">Vibrant (Multicolor)</option>
                                <option value="monochrome">Monochrome (Grays)</option>
                                <option value="accessible">Accessible (High Contrast)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="visualDensity" class="form-label">Visual Density</label>
                            <select class="form-select" id="visualDensity">
                                <option value="minimal" selected>Minimal (Clean, focused)</option>
                                <option value="moderate">Moderate (Balanced)</option>
                                <option value="detailed">Detailed (Data-rich)</option>
                            </select>
                            
                            <div class="ai-suggestion mt-2" id="visualSuggestion">
                                <div class="ai-suggestion-icon">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="ai-suggestion-content">
                                    <div><strong>Suggestion:</strong> For ESG reports, a minimal style with the Sustainable Earth palette creates the most professional impression.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 5: Generate and Preview -->
        <div class="generator-section" id="generateSection" style="display: none;">
            <div class="generator-card">
                <div class="generator-card-header">
                    <h5 class="generator-card-title">
                        <i class="fas fa-magic"></i> Generate Story
                    </h5>
                </div>
                <div class="generator-card-body">
                    <p class="text-muted mb-4">Review your settings and generate your sustainability story.</p>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="mb-3">Story Configuration</h6>
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-light">
                                    Template
                                    <span class="badge bg-primary" id="summaryTemplate">ESG Performance Report</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-light">
                                    Category
                                    <span class="badge bg-primary" id="summaryCategory">Emissions & Climate</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-light">
                                    Metrics
                                    <span class="badge bg-primary" id="summaryMetrics">2 selected</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent border-light">
                                    Visualization
                                    <span class="badge bg-primary" id="summaryVisualization">Bar Chart</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="col-md-6">
                            <h6 class="mb-3">Story Output Options</h6>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="" id="includeRecommendations" checked>
                                <label class="form-check-label" for="includeRecommendations">
                                    Include AI-generated recommendations
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="" id="includeCompetitors" checked>
                                <label class="form-check-label" for="includeCompetitors">
                                    Include industry benchmark data
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="" id="includeForecasts">
                                <label class="form-check-label" for="includeForecasts">
                                    Include predictive forecasts
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" value="" id="includeInvestmentScenarios">
                                <label class="form-check-label" for="includeInvestmentScenarios">
                                    Include investment scenarios
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="button" class="btn btn-primary btn-lg" id="generateStoryBtn">
                            <i class="fas fa-magic me-2"></i> Generate Sustainability Story
                        </button>
                    </div>
                    
                    <!-- Preview container (hidden initially) -->
                    <div class="preview-container" id="previewContainer" style="display: none;">
                        <div class="preview-header">
                            <h5 class="preview-title">Preview</h5>
                            <div class="preview-toggle" id="previewToggle">
                                <i class="fas fa-eye"></i> Show Preview
                            </div>
                        </div>
                        
                        <div class="preview-content" id="previewContent">
                            <div class="chart-placeholder" id="previewChart">
                                <div class="text-center">
                                    <i class="fas fa-chart-bar mb-2" style="font-size: 2rem;"></i>
                                    <div>Chart visualization will appear here</div>
                                </div>
                            </div>
                            
                            <div class="narrative-placeholder" id="previewNarrative">
                                <div class="text-center">
                                    <i class="fas fa-align-left mb-2" style="font-size: 2rem;"></i>
                                    <div>Story narrative will appear here</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Form Navigation -->
        <div class="form-navigation">
            <button type="button" class="btn btn-outline-secondary" id="prevStepBtn" style="visibility: hidden;">
                <i class="fas fa-arrow-left me-2"></i> Previous Step
            </button>
            
            <button type="button" class="btn btn-primary" id="nextStepBtn">
                Next Step <i class="fas fa-arrow-right ms-2"></i>
            </button>
        </div>
    </form>
</div>
{% endblock main_content %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentStep = 1;
    const totalSteps = 5;
    
    // Navigation buttons
    const prevStepBtn = document.getElementById('prevStepBtn');
    const nextStepBtn = document.getElementById('nextStepBtn');
    
    // Step sections
    const sections = [
        document.getElementById('templateSection'),
        document.getElementById('detailsSection'),
        document.getElementById('metricsSection'),
        document.getElementById('visualSection'),
        document.getElementById('generateSection')
    ];
    
    // AI suggestion functionality
    document.querySelectorAll('.ai-suggestion-apply').forEach(button => {
        button.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            if (targetId) {
                const targetInput = document.getElementById(targetId);
                if (targetInput) {
                    // Get suggested text content and set as input value
                    const suggestionText = this.parentElement.querySelector('div').innerText.split(':')[1].trim();
                    targetInput.value = suggestionText;
                }
            }
        });
    });
    
    // Template selection
    document.querySelectorAll('.template-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.template-option').forEach(o => {
                o.classList.remove('selected');
            });
            this.classList.add('selected');
        });
    });
    
    // Visual options selection
    document.querySelectorAll('.visual-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.visual-option').forEach(o => {
                o.classList.remove('selected');
            });
            this.classList.add('selected');
            
            // Update summary
            document.getElementById('summaryVisualization').innerText = this.querySelector('.visual-option-title').innerText;
        });
    });
    
    // Apply template suggestion
    document.getElementById('applyTemplateSuggestion').addEventListener('click', function() {
        document.querySelectorAll('.template-option').forEach(option => {
            option.classList.remove('selected');
            if (option.getAttribute('data-template') === 'esg_report') {
                option.classList.add('selected');
            }
        });
    });
    
    // Apply metrics suggestion
    document.getElementById('applyMetricSuggestion').addEventListener('click', function() {
        // In a real implementation, this would add the suggested metrics to the selected metrics list
        // For now, we'll just acknowledge it
        alert('Suggested metrics would be added here');
    });
    
    // Add metric button
    document.getElementById('addMetricBtn').addEventListener('click', function() {
        const metricInput = document.getElementById('metricSearch');
        const metricName = metricInput.value.trim();
        
        if (metricName) {
            const metricId = Date.now(); // Use timestamp as a simple unique ID
            const metricCard = document.createElement('div');
            metricCard.className = 'metric-card';
            metricCard.setAttribute('data-metric-id', metricId);
            
            metricCard.innerHTML = `
                <div>
                    <div class="metric-card-name">${metricName}</div>
                    <div class="metric-card-details">Category: Custom | Unit: -</div>
                </div>
                <div class="metric-card-actions">
                    <div class="metric-card-action" data-action="edit">
                        <i class="fas fa-edit"></i>
                    </div>
                    <div class="metric-card-action" data-action="delete">
                        <i class="fas fa-trash"></i>
                    </div>
                </div>
            `;
            
            document.getElementById('selectedMetrics').appendChild(metricCard);
            
            // Add event listeners to the new actions
            metricCard.querySelector('[data-action="delete"]').addEventListener('click', function() {
                metricCard.remove();
                updateMetricCount();
            });
            
            metricCard.querySelector('[data-action="edit"]').addEventListener('click', function() {
                const newName = prompt('Edit metric name:', metricName);
                if (newName && newName.trim()) {
                    metricCard.querySelector('.metric-card-name').innerText = newName.trim();
                }
            });
            
            // Clear input
            metricInput.value = '';
            
            // Update summary count
            updateMetricCount();
        }
    });
    
    // Handle existing metric actions
    document.querySelectorAll('.metric-card-action[data-action="delete"]').forEach(button => {
        button.addEventListener('click', function() {
            this.closest('.metric-card').remove();
            updateMetricCount();
        });
    });
    
    document.querySelectorAll('.metric-card-action[data-action="edit"]').forEach(button => {
        button.addEventListener('click', function() {
            const metricCard = this.closest('.metric-card');
            const metricName = metricCard.querySelector('.metric-card-name').innerText;
            const newName = prompt('Edit metric name:', metricName);
            if (newName && newName.trim()) {
                metricCard.querySelector('.metric-card-name').innerText = newName.trim();
            }
        });
    });
    
    // Update metric count in summary
    function updateMetricCount() {
        const count = document.querySelectorAll('.metric-card').length;
        document.getElementById('summaryMetrics').innerText = `${count} selected`;
    }
    
    // Generate story button
    document.getElementById('generateStoryBtn').addEventListener('click', function() {
        this.disabled = true;
        this.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Generating...';
        
        // Show preview container
        document.getElementById('previewContainer').style.display = 'block';
        
        // In a real implementation, this would make an API call to generate the story
        // For now, we'll simulate a delay and then show a success message
        setTimeout(() => {
            this.innerHTML = '<i class="fas fa-check me-2"></i> Story Generated Successfully';
            
            // Show preview
            document.getElementById('previewToggle').innerHTML = '<i class="fas fa-eye-slash"></i> Hide Preview';
            document.getElementById('previewContent').classList.add('visible');
            
            // In a real implementation, the preview would be populated with the generated content
            const previewChart = document.getElementById('previewChart');
            const previewNarrative = document.getElementById('previewNarrative');
            
            // For demo purposes, we'll just show some placeholder content
            previewChart.innerHTML = '<canvas id="previewChartCanvas" width="100%" height="200"></canvas>';
            previewNarrative.innerHTML = `
                <div class="p-3">
                    <h5>Our Sustainability Journey</h5>
                    <p>Our organization has made significant progress in reducing our environmental footprint while enhancing our social impact. The data reveals a 15% reduction in carbon emissions compared to the previous year, putting us on track to meet our 2030 net zero commitment.</p>
                    <p>Key recommendations include accelerating renewable energy adoption across all facilities and implementing a supply chain emissions monitoring program.</p>
                </div>
            `;
            
            // Create a simple chart
            const ctx = document.getElementById('previewChartCanvas').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024'],
                    datasets: [{
                        label: 'Carbon Emissions (tCO₂e)',
                        data: [100, 95, 87, 82, 70],
                        backgroundColor: '#10B981',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });
        }, 2000);
    });
    
    // Preview toggle
    document.getElementById('previewToggle').addEventListener('click', function() {
        const previewContent = document.getElementById('previewContent');
        const isVisible = previewContent.classList.contains('visible');
        
        if (isVisible) {
            previewContent.classList.remove('visible');
            this.innerHTML = '<i class="fas fa-eye"></i> Show Preview';
        } else {
            previewContent.classList.add('visible');
            this.innerHTML = '<i class="fas fa-eye-slash"></i> Hide Preview';
        }
    });
    
    // Update navigation state
    function updateNavigationState() {
        // Update progress steps
        for (let i = 1; i <= totalSteps; i++) {
            const stepElement = document.getElementById(`step${i}`);
            stepElement.classList.remove('active', 'completed');
            
            if (i < currentStep) {
                stepElement.classList.add('completed');
            } else if (i === currentStep) {
                stepElement.classList.add('active');
            }
        }
        
        // Update navigation buttons
        if (currentStep === 1) {
            prevStepBtn.style.visibility = 'hidden';
        } else {
            prevStepBtn.style.visibility = 'visible';
        }
        
        if (currentStep === totalSteps) {
            nextStepBtn.style.visibility = 'hidden';
        } else {
            nextStepBtn.style.visibility = 'visible';
            
            if (currentStep === totalSteps - 1) {
                nextStepBtn.innerHTML = 'Generate <i class="fas fa-magic ms-2"></i>';
            } else {
                nextStepBtn.innerHTML = 'Next Step <i class="fas fa-arrow-right ms-2"></i>';
            }
        }
        
        // Update section visibility
        sections.forEach((section, index) => {
            if (index === currentStep - 1) {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        });
    }
    
    // Next button handler
    nextStepBtn.addEventListener('click', function() {
        if (currentStep < totalSteps) {
            // Validate current step if needed
            // Here you would add validation logic
            
            // Move to next step
            currentStep++;
            updateNavigationState();
            
            // If moving to summary step, update summary info
            if (currentStep === 5) {
                const selectedTemplate = document.querySelector('.template-option.selected');
                if (selectedTemplate) {
                    const templateName = selectedTemplate.querySelector('.template-option-title').innerText;
                    document.getElementById('summaryTemplate').innerText = templateName;
                }
                
                const categorySelect = document.getElementById('storyCategory');
                if (categorySelect.value) {
                    document.getElementById('summaryCategory').innerText = categorySelect.options[categorySelect.selectedIndex].text;
                }
                
                updateMetricCount();
            }
        }
    });
    
    // Previous button handler
    prevStepBtn.addEventListener('click', function() {
        if (currentStep > 1) {
            currentStep--;
            updateNavigationState();
        }
    });
    
    // Initialize the first step
    updateNavigationState();
});
</script>
{% endblock extra_js %}