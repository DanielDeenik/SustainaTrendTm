{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}AI Storytelling Engine - SustainaTrendâ„¢{% endblock %}

{% block header_title %}AI Storytelling Engine{% endblock %}

{% block header_actions %}
<span class="finchat-badge finchat-badge-primary">Augmented Analytics</span>
{% endblock %}

{% block additional_styles %}
<style>
    .storytelling-section {
        margin-bottom: var(--fc-spacing-xl);
    }
    
    .story-container {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-lg);
        margin-bottom: var(--fc-spacing-lg);
    }
    
    .story-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--fc-spacing-md);
    }
    
    .story-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .story-meta {
        display: flex;
        gap: var(--fc-spacing-sm);
        margin-bottom: var(--fc-spacing-md);
        color: var(--fc-text-secondary);
        font-size: 0.85rem;
    }
    
    .story-meta-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .story-badges {
        display: flex;
        gap: var(--fc-spacing-xs);
        margin-bottom: var(--fc-spacing-md);
    }
    
    .story-badge {
        background-color: var(--fc-bg-hover);
        color: var(--fc-text-secondary);
        font-size: 0.7rem;
        font-weight: 500;
        padding: 2px 8px;
        border-radius: 20px;
    }
    
    .story-highlight {
        background-color: rgba(var(--primary-rgb), 0.1);
        color: var(--fc-primary);
        border-left: 3px solid var(--fc-primary);
        padding: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-md);
        font-style: italic;
    }
    
    .story-content {
        color: var(--fc-text-primary);
        line-height: 1.6;
        margin-bottom: var(--fc-spacing-md);
    }
    
    .story-content p {
        margin-bottom: var(--fc-spacing-md);
    }
    
    .story-charts {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: var(--fc-spacing-md);
        margin: var(--fc-spacing-md) 0;
    }
    
    .story-chart {
        background-color: var(--fc-bg-tertiary);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        height: 250px;
    }
    
    .story-chart-title {
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: var(--fc-spacing-sm);
        text-align: center;
    }
    
    .story-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: var(--fc-spacing-md);
        padding-top: var(--fc-spacing-md);
        border-top: 1px solid var(--fc-border);
    }
    
    .story-actions {
        display: flex;
        gap: var(--fc-spacing-sm);
    }
    
    .story-impact {
        display: flex;
        flex-wrap: wrap;
        gap: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-md);
    }
    
    .story-impact-item {
        background-color: var(--fc-bg-tertiary);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        flex: 1;
        min-width: 200px;
    }
    
    .story-impact-title {
        font-size: 0.85rem;
        font-weight: 500;
        margin-bottom: var(--fc-spacing-xs);
        color: var(--fc-text-secondary);
    }
    
    .story-impact-value {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: var(--fc-spacing-xs);
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-xs);
    }
    
    .story-impact-value.positive {
        color: var(--fc-positive);
    }
    
    .story-impact-value.negative {
        color: var(--fc-negative);
    }
    
    .story-impact-value.neutral {
        color: var(--fc-info);
    }
    
    .story-impact-description {
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
    }
    
    .story-insights {
        margin-bottom: var(--fc-spacing-md);
    }
    
    .story-insight {
        display: flex;
        gap: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-sm);
        padding: var(--fc-spacing-sm) 0;
        border-bottom: 1px solid var(--fc-border);
    }
    
    .story-insight:last-child {
        border-bottom: none;
    }
    
    .story-insight-icon {
        width: 32px;
        height: 32px;
        background-color: rgba(var(--primary-rgb), 0.1);
        color: var(--fc-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .story-insight-content {
        flex: 1;
    }
    
    .story-insight-title {
        font-weight: 500;
        margin-bottom: 4px;
    }
    
    .story-insight-description {
        color: var(--fc-text-secondary);
        font-size: 0.9rem;
    }
    
    .story-recommendations {
        background-color: var(--fc-bg-tertiary);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-md);
    }
    
    .story-recommendations-title {
        font-weight: 500;
        margin-bottom: var(--fc-spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-xs);
    }
    
    .story-recommendations-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }
    
    .story-recommendations-item {
        display: flex;
        align-items: flex-start;
        gap: var(--fc-spacing-sm);
        margin-bottom: var(--fc-spacing-sm);
        padding-bottom: var(--fc-spacing-sm);
        border-bottom: 1px dashed var(--fc-border);
    }
    
    .story-recommendations-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }
    
    .story-recommendations-icon {
        color: var(--fc-primary);
        margin-top: 3px;
    }
    
    .storytelling-controls {
        margin-bottom: var(--fc-spacing-lg);
        display: flex;
        gap: var(--fc-spacing-md);
        align-items: center;
        flex-wrap: wrap;
    }
    
    .storytelling-filters {
        display: flex;
        gap: var(--fc-spacing-sm);
        flex-wrap: wrap;
        flex: 1;
    }
    
    .storytelling-actions {
        display: flex;
        gap: var(--fc-spacing-sm);
    }
    
    .storytelling-generator {
        margin-bottom: var(--fc-spacing-xl);
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-lg);
    }
    
    .storytelling-generator-header {
        margin-bottom: var(--fc-spacing-lg);
    }
    
    .storytelling-generator-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: var(--fc-spacing-xs);
    }
    
    .storytelling-generator-description {
        color: var(--fc-text-secondary);
    }
    
    .storytelling-generator-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--fc-spacing-md);
    }
    
    .storytelling-generator-field {
        margin-bottom: var(--fc-spacing-md);
    }
    
    .storytelling-generator-label {
        font-weight: 500;
        margin-bottom: var(--fc-spacing-xs);
        display: block;
    }
    
    .storytelling-generator-input,
    .storytelling-generator-select,
    .storytelling-generator-textarea {
        width: 100%;
        background-color: var(--fc-bg-tertiary);
        border: 1px solid var(--fc-border);
        color: var(--fc-text-primary);
        padding: 8px 12px;
        border-radius: var(--fc-radius);
    }
    
    .storytelling-generator-textarea {
        min-height: 120px;
        resize: vertical;
    }
    
    .storytelling-generator-actions {
        grid-column: span 2;
        display: flex;
        justify-content: flex-end;
        gap: var(--fc-spacing-sm);
        margin-top: var(--fc-spacing-md);
    }
    
    .ai-prompt-box {
        background-color: rgba(var(--primary-rgb), 0.05);
        border: 1px dashed rgba(var(--primary-rgb), 0.3);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-md);
    }
    
    .ai-prompt-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .ai-prompt-title {
        font-weight: 500;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-xs);
        color: var(--fc-primary);
    }
    
    .ai-prompt-content {
        font-family: monospace;
        color: var(--fc-text-primary);
        padding: var(--fc-spacing-sm);
        background-color: var(--fc-bg-tertiary);
        border-radius: var(--fc-radius);
    }
    
    .gartner-inspired {
        position: relative;
        padding-left: 20px;
    }
    
    .gartner-inspired::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background-color: var(--fc-positive);
    }
    
    @media (max-width: 768px) {
        .storytelling-generator-form {
            grid-template-columns: 1fr;
        }
        
        .storytelling-generator-actions {
            grid-column: 1;
        }
    }
</style>
{% endblock %}

{% block main_content %}
<div class="finchat-section">
    <div class="storytelling-controls">
        <div class="storytelling-filters">
            <select class="finchat-select">
                <option>All Categories</option>
                <option>Emissions</option>
                <option>Energy</option>
                <option>Water</option>
                <option>Waste</option>
                <option>Social</option>
            </select>
            <select class="finchat-select">
                <option>All Time</option>
                <option>Last Quarter</option>
                <option>Last Month</option>
                <option>Last Week</option>
            </select>
            <select class="finchat-select">
                <option>Any Impact</option>
                <option>Positive Impact</option>
                <option>Negative Impact</option>
                <option>Neutral Impact</option>
            </select>
        </div>
        <div class="storytelling-actions">
            <button class="finchat-button">
                <i class="fas fa-filter"></i> Filter
            </button>
            <button class="finchat-button finchat-button-primary">
                <i class="fas fa-plus"></i> Generate New Story
            </button>
        </div>
    </div>
    
    <div class="storytelling-generator">
        <div class="storytelling-generator-header">
            <h3 class="storytelling-generator-title">
                <i class="fas fa-robot"></i> AI-Powered Storytelling Engine
            </h3>
            <p class="storytelling-generator-description">
                Generate compelling, data-driven sustainability stories for stakeholders using our AI-powered engine.
            </p>
        </div>
        
        <div class="ai-prompt-box">
            <div class="ai-prompt-header">
                <div class="ai-prompt-title">
                    <i class="fas fa-lightbulb"></i> Augmented Analytics - AI Prompt Example
                </div>
                <span class="finchat-badge finchat-badge-primary">Gartner Inspired</span>
            </div>
            <div class="ai-prompt-content">
                "Explain this emissions spike in plain English, including root cause, business risk, and CSRD relevance."
            </div>
        </div>
        
        <div class="storytelling-generator-form">
            <div class="storytelling-generator-field">
                <label class="storytelling-generator-label">Sustainability Metric</label>
                <select class="storytelling-generator-select">
                    <option>Carbon Emissions</option>
                    <option>Energy Consumption</option>
                    <option>Water Usage</option>
                    <option>Waste Generation</option>
                    <option>ESG Score</option>
                </select>
            </div>
            <div class="storytelling-generator-field">
                <label class="storytelling-generator-label">Time Period</label>
                <select class="storytelling-generator-select">
                    <option>Last Quarter</option>
                    <option>Last Year</option>
                    <option>Year-over-Year Comparison</option>
                    <option>5-Year Trend</option>
                </select>
            </div>
            <div class="storytelling-generator-field">
                <label class="storytelling-generator-label">Narrative Focus</label>
                <select class="storytelling-generator-select">
                    <option>Performance Analysis</option>
                    <option>Risk Assessment</option>
                    <option>CSRD/ESG Compliance</option>
                    <option>Stakeholder Communication</option>
                    <option>Board Presentation</option>
                </select>
            </div>
            <div class="storytelling-generator-field">
                <label class="storytelling-generator-label">Audience</label>
                <select class="storytelling-generator-select">
                    <option>Executive Leadership</option>
                    <option>Investors</option>
                    <option>Regulatory Bodies</option>
                    <option>Sustainability Team</option>
                    <option>General Public</option>
                </select>
            </div>
            <div class="storytelling-generator-field" style="grid-column: span 2;">
                <label class="storytelling-generator-label">Additional Context (Optional)</label>
                <textarea class="storytelling-generator-textarea" placeholder="Add any specific context or questions you'd like the AI to address in the story..."></textarea>
            </div>
            <div class="storytelling-generator-actions">
                <button class="finchat-button">
                    <i class="fas fa-cog"></i> Advanced Options
                </button>
                <button class="finchat-button finchat-button-primary">
                    <i class="fas fa-magic"></i> Generate Story
                </button>
            </div>
        </div>
    </div>
    
    <div class="storytelling-section">
        <h3 class="finchat-section-title">
            <i class="fas fa-newspaper"></i> AI-Generated Sustainability Stories
        </h3>
        
        <!-- Audience and Category Filters -->
        <div class="finchat-card mb-4">
            <div class="finchat-card-header">
                <h4 class="finchat-card-title">
                    <i class="fas fa-filter"></i> Story Filters
                </h4>
            </div>
            <div class="finchat-card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="finchat-label">Audience</label>
                        <div class="finchat-button-group">
                            <a href="{{ url_for('story_cards', category=category, audience='all') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if audience == 'all' else '' }}">
                                All Audiences
                            </a>
                            <a href="{{ url_for('story_cards', category=category, audience='board') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if audience == 'board' else '' }}">
                                Board
                            </a>
                            <a href="{{ url_for('story_cards', category=category, audience='sustainability_team') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if audience == 'sustainability_team' else '' }}">
                                Sustainability Team
                            </a>
                            <a href="{{ url_for('story_cards', category=category, audience='investors') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if audience == 'investors' else '' }}">
                                Investors
                            </a>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="finchat-label">Category</label>
                        <div class="finchat-button-group">
                            <a href="{{ url_for('story_cards', audience=audience, category='all') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if category == 'all' else '' }}">
                                All Categories
                            </a>
                            <a href="{{ url_for('story_cards', audience=audience, category='emissions') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if category == 'emissions' else '' }}">
                                Emissions
                            </a>
                            <a href="{{ url_for('story_cards', audience=audience, category='water') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if category == 'water' else '' }}">
                                Water
                            </a>
                            <a href="{{ url_for('story_cards', audience=audience, category='energy') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if category == 'energy' else '' }}">
                                Energy
                            </a>
                            <a href="{{ url_for('story_cards', audience=audience, category='waste') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if category == 'waste' else '' }}">
                                Waste
                            </a>
                            <a href="{{ url_for('story_cards', audience=audience, category='social') }}" 
                               class="finchat-button {{ 'finchat-button-primary' if category == 'social' else '' }}">
                                Social
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Storytelling Explanation (if first visit) -->
        <div class="finchat-card mb-4">
            <div class="finchat-card-header">
                <h4 class="finchat-card-title">
                    <i class="fas fa-info-circle"></i> Data Storytelling: The Three Core Elements
                </h4>
            </div>
            <div class="finchat-card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center mb-3">
                            <div class="story-insight-icon mx-auto">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <h5 class="mt-2">Context</h5>
                            <p>Why this matters now</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center mb-3">
                            <div class="story-insight-icon mx-auto">
                                <i class="fas fa-align-left"></i>
                            </div>
                            <h5 class="mt-2">Narrative</h5>
                            <p>What is happening</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center mb-3">
                            <div class="story-insight-icon mx-auto">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h5 class="mt-2">Visual</h5>
                            <p>How it looks in data</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="story-container gartner-inspired">
            <div class="story-header">
                <div>
                    <h4 class="story-title">Carbon Reduction Success Story: A Data-Driven Narrative</h4>
                    <div class="story-meta">
                        <div class="story-meta-item">
                            <i class="fas fa-calendar"></i> Generated on March 13, 2025
                        </div>
                        <div class="story-meta-item">
                            <i class="fas fa-chart-line"></i> Based on Q1 2025 data
                        </div>
                    </div>
                </div>
                <div class="story-badges">
                    <span class="story-badge">Emissions</span>
                    <span class="story-badge">CSRD Report</span>
                    <span class="story-badge">Board Ready</span>
                </div>
            </div>
            
            <div class="story-highlight">
                Our organization achieved a 30% reduction in carbon emissions during Q1 2025, exceeding our quarterly target by 12%. This success demonstrates our commitment to sustainability and positions us well for CSRD compliance.
            </div>
            
            <div class="story-impact">
                <div class="story-impact-item">
                    <div class="story-impact-title">Carbon Reduction</div>
                    <div class="story-impact-value positive">
                        <i class="fas fa-arrow-down"></i> 30%
                    </div>
                    <div class="story-impact-description">
                        Compared to Q1 2024
                    </div>
                </div>
                <div class="story-impact-item">
                    <div class="story-impact-title">Target Achievement</div>
                    <div class="story-impact-value positive">
                        112%
                    </div>
                    <div class="story-impact-description">
                        Of quarterly reduction target
                    </div>
                </div>
                <div class="story-impact-item">
                    <div class="story-impact-title">Financial Impact</div>
                    <div class="story-impact-value positive">
                        â‚¬245,000
                    </div>
                    <div class="story-impact-description">
                        Estimated cost savings
                    </div>
                </div>
            </div>
            
            <div class="story-content">
                <p>This quarter's remarkable 30% reduction in carbon emissions represents a significant milestone in our sustainability journey. The data reveals that this achievement was not a one-time event but part of a consistent downward trend that began in Q3 2024.</p>
                
                <p>Our analysis shows three key factors contributed to this success:</p>
            </div>
            
            <div class="story-insights">
                <div class="story-insight">
                    <div class="story-insight-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="story-insight-content">
                        <div class="story-insight-title">Energy Efficiency Improvements</div>
                        <div class="story-insight-description">
                            The implementation of our new building management system reduced energy consumption by 22%, accounting for approximately 45% of our total emissions reduction.
                        </div>
                    </div>
                </div>
                <div class="story-insight">
                    <div class="story-insight-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="story-insight-content">
                        <div class="story-insight-title">Renewable Energy Integration</div>
                        <div class="story-insight-description">
                            The new solar panel installation at our main facility came online in January, now providing 35% of our energy needs and contributing to 30% of our emissions reduction.
                        </div>
                    </div>
                </div>
                <div class="story-insight">
                    <div class="story-insight-icon">
                        <i class="fas fa-recycle"></i>
                    </div>
                    <div class="story-insight-content">
                        <div class="story-insight-title">Supply Chain Optimization</div>
                        <div class="story-insight-description">
                            Our logistics optimization initiative reduced transportation emissions by 25%, accounting for the remaining 25% of our total reduction.
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="story-charts">
                <div class="story-chart">
                    <div class="story-chart-title">Quarterly Emissions Trend (2024-2025)</div>
                    <canvas id="emissionsTrendChart"></canvas>
                </div>
                <div class="story-chart">
                    <div class="story-chart-title">Emission Reduction by Source</div>
                    <canvas id="emissionSourcesChart"></canvas>
                </div>
            </div>
            
            <div class="story-content">
                <p>This achievement has significant implications for our CSRD compliance. The data demonstrates our organization's commitment to measurable sustainability goals and provides clear evidence of progress for regulatory reporting.</p>
            </div>
            
            <div class="story-recommendations">
                <div class="story-recommendations-title">
                    <i class="fas fa-lightbulb"></i> Strategic Recommendations
                </div>
                <ul class="story-recommendations-list">
                    <li class="story-recommendations-item">
                        <div class="story-recommendations-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>Highlight this success in our upcoming CSRD disclosure, emphasizing the data-driven approach to emissions reduction.</div>
                    </li>
                    <li class="story-recommendations-item">
                        <div class="story-recommendations-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>Scale the building management system implementation to our secondary facilities to achieve similar efficiency gains.</div>
                    </li>
                    <li class="story-recommendations-item">
                        <div class="story-recommendations-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>Conduct a detailed ROI analysis on the renewable energy investment to support the case for additional solar installations.</div>
                    </li>
                    <li class="story-recommendations-item">
                        <div class="story-recommendations-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>Share transportation optimization methodology with key suppliers to extend emissions reductions throughout the value chain.</div>
                    </li>
                </ul>
            </div>
            
            <div class="story-footer">
                <div>
                    <span class="finchat-text-muted">Generated by SustainaTrendâ„¢ AI Storytelling Engine</span>
                </div>
                <div class="story-actions">
                    <button class="finchat-button">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="finchat-button">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="finchat-button finchat-button-primary">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        </div>
        
        <div class="story-container gartner-inspired">
            <div class="story-header">
                <div>
                    <h4 class="story-title">Water Conservation Excellence: A Stakeholder Narrative</h4>
                    <div class="story-meta">
                        <div class="story-meta-item">
                            <i class="fas fa-calendar"></i> Generated on March 10, 2025
                        </div>
                        <div class="story-meta-item">
                            <i class="fas fa-chart-line"></i> Based on Q4 2024 data
                        </div>
                    </div>
                </div>
                <div class="story-badges">
                    <span class="story-badge">Water</span>
                    <span class="story-badge">Stakeholder Communication</span>
                    <span class="story-badge">Best Practice</span>
                </div>
            </div>
            
            <div class="story-highlight">
                Our comprehensive water conservation initiatives reduced consumption by 25% year-over-year, setting new industry standards and strengthening our position as a sustainability leader in the region.
            </div>
            
            <div class="story-impact">
                <div class="story-impact-item">
                    <div class="story-impact-title">Water Reduction</div>
                    <div class="story-impact-value positive">
                        <i class="fas fa-arrow-down"></i> 25%
                    </div>
                    <div class="story-impact-description">
                        Year-over-year reduction
                    </div>
                </div>
                <div class="story-impact-item">
                    <div class="story-impact-title">Industry Standing</div>
                    <div class="story-impact-value positive">
                        Top 10%
                    </div>
                    <div class="story-impact-description">
                        Industry water efficiency
                    </div>
                </div>
                <div class="story-impact-item">
                    <div class="story-impact-title">Community Impact</div>
                    <div class="story-impact-value neutral">
                        120M liters
                    </div>
                    <div class="story-impact-description">
                        Water saved annually
                    </div>
                </div>
            </div>
            
            <div class="story-charts">
                <div class="story-chart">
                    <div class="story-chart-title">Water Usage Trend (2020-2024)</div>
                    <canvas id="waterTrendChart"></canvas>
                </div>
                <div class="story-chart">
                    <div class="story-chart-title">Water Conservation by Initiative</div>
                    <canvas id="waterInitiativesChart"></canvas>
                </div>
            </div>
            
            <div class="story-footer">
                <div>
                    <span class="finchat-text-muted">Generated by SustainaTrendâ„¢ AI Storytelling Engine</span>
                </div>
                <div class="story-actions">
                    <button class="finchat-button">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="finchat-button">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="finchat-button finchat-button-primary">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Emissions Trend Chart
        if (document.getElementById('emissionsTrendChart')) {
            const ctx = document.getElementById('emissionsTrendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024', 'Q1 2025'],
                    datasets: [{
                        label: 'Carbon Emissions (tons CO2e)',
                        data: [850, 820, 780, 720, 595],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a0a0a0'
                            }
                        }
                    }
                }
            });
        }
        
        // Emission Sources Chart
        if (document.getElementById('emissionSourcesChart')) {
            const ctx = document.getElementById('emissionSourcesChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Energy Efficiency', 'Renewable Energy', 'Supply Chain'],
                    datasets: [{
                        data: [45, 30, 25],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 205, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 205, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#a0a0a0'
                            }
                        }
                    }
                }
            });
        }
        
        // Water Trend Chart
        if (document.getElementById('waterTrendChart')) {
            const ctx = document.getElementById('waterTrendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024'],
                    datasets: [{
                        label: 'Water Usage (Million Liters)',
                        data: [480, 460, 420, 385, 290],
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#a0a0a0'
                            }
                        }
                    }
                }
            });
        }
        
        // Water Initiatives Chart
        if (document.getElementById('waterInitiativesChart')) {
            const ctx = document.getElementById('waterInitiativesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Rainwater Harvesting', 'Process Optimization', 'Greywater Recycling', 'Smart Irrigation'],
                    datasets: [{
                        label: 'Water Saved (Million Liters)',
                        data: [36, 48, 24, 12],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)',
                            'rgba(255, 159, 64, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    });
</script>
{% endblock %}