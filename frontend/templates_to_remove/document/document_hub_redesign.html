{% extends "base.html" %}

{% block title %}Document Hub | Regulatory AI{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/document-hub-redesign.css') }}">
{% endblock %}

{% block content %}
<div class="document-hub">
  <!-- Navigation tabs -->
  <div class="document-hub-tabs">
    <div class="tab active" data-tab="upload">Upload</div>
    <div class="tab" data-tab="analyze">Analyze</div>
    <div class="tab" data-tab="insights">View Insights</div>
  </div>

  <!-- Main content area -->
  <div class="document-hub-content">
    <!-- Upload tab content -->
    <div class="tab-content active" id="upload-tab">
      <div class="upload-container">
        <div class="upload-header">
          <h2>Upload Sustainability Document</h2>
          <p>Upload your CSRD, ESG, or sustainability report for AI-powered analysis</p>
        </div>
        
        <div class="upload-area" id="drop-area">
          <div class="upload-icon">
            <i class="fas fa-file-upload"></i>
          </div>
          <p class="upload-text">Drag and drop your file here</p>
          <p class="upload-text-small">or</p>
          <button type="button" class="upload-button" id="browse-btn">Choose File</button>
          <input type="file" id="file-input" name="document" accept=".pdf,.docx,.txt" hidden>
          <p class="file-info">Supported formats: PDF, DOCX, TXT (max 20MB)</p>
        </div>
        
        <div class="file-preview" id="file-preview">
          <div class="file-preview-content">
            <i class="fas fa-file-pdf file-icon"></i>
            <div class="file-details">
              <p class="file-name" id="selected-file-name">No file selected</p>
              <p class="file-size" id="selected-file-size"></p>
            </div>
            <button class="remove-file" id="remove-file">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="upload-actions">
            <button class="upload-submit" id="upload-submit">Upload Document</button>
            <div class="upload-options">
              <button class="text-paste-btn" id="text-paste-btn">
                <i class="fas fa-paste"></i> Paste Text
              </button>
            </div>
          </div>
        </div>

        <!-- Upload progress -->
        <div class="upload-progress" id="upload-progress">
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <p class="progress-text">Uploading... <span id="progress-percentage">0%</span></p>
        </div>

        <!-- Upload success state -->
        <div class="upload-success" id="upload-success">
          <div class="success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <h3>Upload Complete!</h3>
          <p>Your document has been successfully uploaded.</p>
          <button class="next-button" id="to-analyze-btn">Continue to Analysis</button>
        </div>

        <!-- Upload error state -->
        <div class="upload-error" id="upload-error">
          <div class="error-icon">
            <i class="fas fa-exclamation-circle"></i>
          </div>
          <h3>Upload Failed</h3>
          <p id="error-message">An error occurred while uploading your document.</p>
          <button class="retry-button" id="retry-upload">Try Again</button>
        </div>

        <!-- Framework support info -->
        <div class="supported-frameworks">
          <h4>Supported Frameworks</h4>
          <div class="framework-badges">
            <div class="framework-badge">
              <span class="badge badge-csrd">CSRD</span>
              <span class="badge-tooltip">Corporate Sustainability Reporting Directive</span>
            </div>
            <div class="framework-badge">
              <span class="badge badge-esrs">ESRS</span>
              <span class="badge-tooltip">European Sustainability Reporting Standards</span>
            </div>
            <div class="framework-badge">
              <span class="badge badge-sfdr">SFDR</span>
              <span class="badge-tooltip">Sustainable Finance Disclosure Regulation</span>
            </div>
            <div class="framework-badge">
              <span class="badge badge-tcfd">TCFD</span>
              <span class="badge-tooltip">Task Force on Climate-related Financial Disclosures</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Analyze tab content -->
    <div class="tab-content" id="analyze-tab">
      <div class="analyze-container">
        <div class="analyze-header">
          <h2>Document Analysis</h2>
          <p id="analyzing-document-name">Analyzing your document using Regulatory AI</p>
        </div>

        <div class="analysis-progress-container">
          <div class="analysis-steps">
            <div class="analysis-step" id="step-extraction">
              <div class="step-icon">
                <i class="fas fa-file-alt"></i>
              </div>
              <div class="step-details">
                <h4>Text Extraction</h4>
                <p>Extracting content from document</p>
              </div>
              <div class="step-status pending">
                <span class="status-dot"></span>
              </div>
            </div>

            <div class="analysis-step" id="step-processing">
              <div class="step-icon">
                <i class="fas fa-cogs"></i>
              </div>
              <div class="step-details">
                <h4>Content Processing</h4>
                <p>Processing textual content</p>
              </div>
              <div class="step-status">
                <span class="status-dot"></span>
              </div>
            </div>

            <div class="analysis-step" id="step-assessment">
              <div class="step-icon">
                <i class="fas fa-tasks"></i>
              </div>
              <div class="step-details">
                <h4>Framework Assessment</h4>
                <p>Evaluating against sustainability frameworks</p>
              </div>
              <div class="step-status">
                <span class="status-dot"></span>
              </div>
            </div>

            <div class="analysis-step" id="step-insights">
              <div class="step-icon">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="step-details">
                <h4>Generating Insights</h4>
                <p>Creating actionable sustainability insights</p>
              </div>
              <div class="step-status">
                <span class="status-dot"></span>
              </div>
            </div>
          </div>

          <div class="progress-messages" id="progress-messages">
            <div class="message-container">
              <div class="message">Starting document analysis...</div>
            </div>
          </div>

          <!-- Analysis progress bar -->
          <div class="analysis-progress-bar">
            <div class="analysis-progress-fill" id="analysis-progress-fill"></div>
          </div>
          <p class="analysis-progress-text">Analysis in progress... <span id="analysis-percentage">0%</span></p>

          <button class="cancel-button" id="cancel-analysis">Cancel Analysis</button>
        </div>

        <!-- Analysis complete -->
        <div class="analysis-complete" id="analysis-complete">
          <div class="success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <h3>Analysis Complete</h3>
          <p>Your document has been successfully analyzed.</p>
          <button class="next-button" id="to-insights-btn">View Insights</button>
        </div>
      </div>
    </div>

    <!-- Insights tab content -->
    <div class="tab-content" id="insights-tab">
      <div class="insights-container">
        <div class="insights-header">
          <h2>Sustainability Insights</h2>
          <p id="document-insights-name">Insights from your document</p>
        </div>

        <div class="insights-dashboard">
          <!-- Main content and sidebar layout -->
          <div class="insights-layout">
            <!-- Main content area -->
            <div class="insights-main">
              <div class="insights-summary-card">
                <h3>Executive Summary</h3>
                <div class="summary-content" id="executive-summary">
                  <p>This document demonstrates strong alignment with CSRD requirements, with comprehensive coverage of environmental metrics and governance disclosures. There are opportunities to strengthen social impact reporting and improve quantitative target setting for biodiversity impacts.</p>
                </div>
              </div>

              <div class="compliance-overview">
                <h3>Framework Compliance</h3>
                <div class="compliance-cards">
                  <div class="compliance-card">
                    <div class="compliance-header">
                      <span class="framework-name">CSRD</span>
                      <span class="compliance-score high">85%</span>
                    </div>
                    <div class="compliance-bar">
                      <div class="compliance-fill" style="width: 85%; background-color: #4CAF50;"></div>
                    </div>
                  </div>

                  <div class="compliance-card">
                    <div class="compliance-header">
                      <span class="framework-name">ESRS</span>
                      <span class="compliance-score medium">72%</span>
                    </div>
                    <div class="compliance-bar">
                      <div class="compliance-fill" style="width: 72%; background-color: #FFC107;"></div>
                    </div>
                  </div>

                  <div class="compliance-card">
                    <div class="compliance-header">
                      <span class="framework-name">TCFD</span>
                      <span class="compliance-score high">88%</span>
                    </div>
                    <div class="compliance-bar">
                      <div class="compliance-fill" style="width: 88%; background-color: #4CAF50;"></div>
                    </div>
                  </div>

                  <div class="compliance-card">
                    <div class="compliance-header">
                      <span class="framework-name">SFDR</span>
                      <span class="compliance-score low">58%</span>
                    </div>
                    <div class="compliance-bar">
                      <div class="compliance-fill" style="width: 58%; background-color: #F44336;"></div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="key-metrics">
                <h3>Key Sustainability Metrics</h3>
                <div class="metrics-grid">
                  <div class="metric-card">
                    <div class="metric-icon">
                      <i class="fas fa-cloud"></i>
                    </div>
                    <div class="metric-details">
                      <h4>Carbon Emissions</h4>
                      <div class="metric-value">245,000 tCO2e</div>
                      <div class="metric-trend decreasing">
                        <i class="fas fa-arrow-down"></i> 12% vs previous year
                      </div>
                    </div>
                  </div>

                  <div class="metric-card">
                    <div class="metric-icon">
                      <i class="fas fa-tint"></i>
                    </div>
                    <div class="metric-details">
                      <h4>Water Usage</h4>
                      <div class="metric-value">1.8M cubic meters</div>
                      <div class="metric-trend decreasing">
                        <i class="fas fa-arrow-down"></i> 5% vs previous year
                      </div>
                    </div>
                  </div>

                  <div class="metric-card">
                    <div class="metric-icon">
                      <i class="fas fa-recycle"></i>
                    </div>
                    <div class="metric-details">
                      <h4>Waste Recycled</h4>
                      <div class="metric-value">78%</div>
                      <div class="metric-trend increasing">
                        <i class="fas fa-arrow-up"></i> 8% vs previous year
                      </div>
                    </div>
                  </div>

                  <div class="metric-card">
                    <div class="metric-icon">
                      <i class="fas fa-bolt"></i>
                    </div>
                    <div class="metric-details">
                      <h4>Renewable Energy</h4>
                      <div class="metric-value">42%</div>
                      <div class="metric-trend increasing">
                        <i class="fas fa-arrow-up"></i> 15% vs previous year
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="improvement-opportunities">
                <h3>Improvement Opportunities</h3>
                <div class="opportunities-list">
                  <div class="opportunity-item">
                    <div class="opportunity-icon">
                      <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="opportunity-details">
                      <h4>Biodiversity Impact Metrics</h4>
                      <p>The document lacks comprehensive biodiversity impact metrics as required by ESRS E4. Consider adding quantitative assessments of land use change and habitat impact.</p>
                    </div>
                  </div>

                  <div class="opportunity-item">
                    <div class="opportunity-icon">
                      <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="opportunity-details">
                      <h4>Supply Chain Due Diligence</h4>
                      <p>Supply chain human rights due diligence reporting is limited. Expand on supplier assessment methodology and results to meet CSRD Article 4 requirements.</p>
                    </div>
                  </div>

                  <div class="opportunity-item">
                    <div class="opportunity-icon">
                      <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="opportunity-details">
                      <h4>Climate Transition Plan</h4>
                      <p>The climate transition plan lacks specific interim targets. Consider adding clear milestones for 2025 and 2030 to strengthen TCFD compliance.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Sidebar with framework assessment -->
            <div class="insights-sidebar">
              <div class="sidebar-section">
                <h3>Framework Assessment</h3>
                
                <div class="assessment-tabs">
                  <div class="assessment-tab active" data-assessment="csrd">CSRD</div>
                  <div class="assessment-tab" data-assessment="esrs">ESRS</div>
                  <div class="assessment-tab" data-assessment="tcfd">TCFD</div>
                  <div class="assessment-tab" data-assessment="sfdr">SFDR</div>
                </div>

                <div class="assessment-content active" id="csrd-assessment">
                  <div class="assessment-category">
                    <div class="category-header">
                      <h4>Environmental Reporting</h4>
                      <span class="category-score green">Strong</span>
                    </div>
                    <ul class="category-details">
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Climate change mitigation measures</span>
                      </li>
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Scope 1, 2, 3 emissions data</span>
                      </li>
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Resource use optimization</span>
                      </li>
                      <li class="non-compliant">
                        <i class="fas fa-times-circle"></i>
                        <span>Biodiversity impact assessment</span>
                      </li>
                    </ul>
                  </div>

                  <div class="assessment-category">
                    <div class="category-header">
                      <h4>Social Reporting</h4>
                      <span class="category-score amber">Moderate</span>
                    </div>
                    <ul class="category-details">
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Equal opportunities policies</span>
                      </li>
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Working conditions</span>
                      </li>
                      <li class="non-compliant">
                        <i class="fas fa-times-circle"></i>
                        <span>Human rights due diligence</span>
                      </li>
                      <li class="non-compliant">
                        <i class="fas fa-times-circle"></i>
                        <span>Community engagement metrics</span>
                      </li>
                    </ul>
                  </div>

                  <div class="assessment-category">
                    <div class="category-header">
                      <h4>Governance Reporting</h4>
                      <span class="category-score green">Strong</span>
                    </div>
                    <ul class="category-details">
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Board diversity & composition</span>
                      </li>
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Business ethics framework</span>
                      </li>
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Anti-corruption measures</span>
                      </li>
                      <li class="compliant">
                        <i class="fas fa-check-circle"></i>
                        <span>Sustainability governance</span>
                      </li>
                    </ul>
                  </div>
                </div>

                <div class="assessment-content" id="esrs-assessment">
                  <!-- ESRS assessment content -->
                  <p class="placeholder-text">ESRS assessment details will be shown here</p>
                </div>

                <div class="assessment-content" id="tcfd-assessment">
                  <!-- TCFD assessment content -->
                  <p class="placeholder-text">TCFD assessment details will be shown here</p>
                </div>

                <div class="assessment-content" id="sfdr-assessment">
                  <!-- SFDR assessment content -->
                  <p class="placeholder-text">SFDR assessment details will be shown here</p>
                </div>
              </div>

              <div class="sidebar-section">
                <h3>Document Details</h3>
                <div class="document-details">
                  <div class="detail-item">
                    <div class="detail-label">File Name:</div>
                    <div class="detail-value" id="insight-filename">sustainability_report_2025.pdf</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Document Type:</div>
                    <div class="detail-value">Sustainability Report</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Uploaded:</div>
                    <div class="detail-value" id="insight-upload-date">March 28, 2025</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Pages:</div>
                    <div class="detail-value" id="insight-page-count">86</div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-label">Word Count:</div>
                    <div class="detail-value" id="insight-word-count">32,450</div>
                  </div>
                </div>
              </div>

              <div class="sidebar-section">
                <h3>Actions</h3>
                <div class="action-buttons">
                  <button class="action-button" id="download-report">
                    <i class="fas fa-download"></i> Download Report
                  </button>
                  <button class="action-button" id="export-insights">
                    <i class="fas fa-file-export"></i> Export Insights
                  </button>
                  <button class="action-button" id="query-document">
                    <i class="fas fa-search"></i> Query Document
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Text Paste Modal -->
<div class="modal" id="text-paste-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Paste Document Text</h3>
      <button class="close-modal" id="close-text-modal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p class="modal-description">Paste text from your sustainability report below:</p>
      <textarea id="pasted-text" placeholder="Paste your document text here..."></textarea>
      <div class="text-details">
        <div class="word-count">Word count: <span id="word-count">0</span></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="cancel-btn" id="cancel-text-paste">Cancel</button>
      <button class="submit-btn" id="submit-text-paste">Upload Text</button>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/document-hub-redesign.js') }}"></script>
{% endblock %}