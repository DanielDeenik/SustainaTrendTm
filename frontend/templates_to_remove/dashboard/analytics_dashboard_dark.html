{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}
{% if template_type == "stories" %}
Story Cards | SustainaTrend™
{% elif template_type == "documents" %}
PDF Analyzer | SustainaTrend™
{% elif template_type == "terminal" %}
Data Terminal | SustainaTrend™
{% elif template_type == "monetization" %}
Monetization Opportunities | SustainaTrend™
{% elif template_type == "copilot" %}
Sustainability Co-Pilot | SustainaTrend™
{% elif template_type == "risk_tracker" %}
Risk Tracker | SustainaTrend™
{% elif template_type == "debug" %}
Debug | SustainaTrend™
{% elif template_type == "trends" %}
Trend Analysis | SustainaTrend™
{% elif template_type == "virality" %}
Virality Metrics | SustainaTrend™
{% else %}
Analytics Dashboard | SustainaTrend™
{% endif %}
{% endblock %}

{% block header_title %}
{% if template_type == "stories" %}
Story Cards Generator
{% elif template_type == "documents" %}
PDF Document Analyzer
{% elif template_type == "terminal" %}
Data Terminal
{% elif template_type == "monetization" %}
Monetization Opportunities
{% elif template_type == "copilot" %}
Sustainability Co-Pilot
{% elif template_type == "risk_tracker" %}
Risk Tracker
{% elif template_type == "debug" %}
Debug Information
{% elif template_type == "trends" %}
AI Trend Analysis
{% elif template_type == "virality" %}
Virality Metrics Dashboard
{% else %}
Analytics Dashboard
{% endif %}
{% endblock %}

{% block header_actions %}
{% if template_type != "home" %}
<a href="/" class="finchat-btn finchat-btn-outline">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
    </svg>
    Back to Dashboard
</a>
{% endif %}
<span class="finchat-badge finchat-badge-primary">AI-Powered</span>
{% endblock %}

{% block additional_head %}
<script src="https://cdn.plot.ly/plotly-2.29.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{% endblock %}

{% block additional_styles %}
<style>
    .analytics-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-xl);
    }
    
    .analytics-metric {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        display: flex;
        flex-direction: column;
    }
    
    .analytics-metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .analytics-metric-title {
        font-size: 0.9rem;
        color: var(--fc-text-secondary);
    }
    
    .analytics-metric-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: var(--fc-radius);
        background-color: var(--fc-primary-light);
        color: var(--fc-primary);
    }
    
    .analytics-metric-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin: var(--fc-spacing-xs) 0;
    }
    
    .analytics-metric-change {
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-xs);
        font-size: 0.8rem;
        margin-top: auto;
    }
    
    .analytics-metric-change.positive {
        color: var(--fc-positive);
    }
    
    .analytics-metric-change.negative {
        color: var(--fc-negative);
    }
    
    .analytics-chart-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-xl);
    }
    
    .analytics-chart-card {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
    }
    
    .analytics-chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--fc-spacing-md);
    }
    
    .analytics-chart-title {
        font-size: 1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-xs);
    }
    
    .analytics-chart-actions {
        display: flex;
        gap: var(--fc-spacing-xs);
    }
    
    .analytics-chart-container {
        height: 300px;
        width: 100%;
    }
    
    .analytics-insights {
        display: flex;
        flex-direction: column;
        gap: var(--fc-spacing-md);
    }
    
    .analytics-insight {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        display: flex;
        gap: var(--fc-spacing-md);
        align-items: flex-start;
    }
    
    .analytics-insight-icon {
        width: 36px;
        height: 36px;
        border-radius: var(--fc-radius);
        background-color: var(--fc-primary-light);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--fc-primary);
        flex-shrink: 0;
    }
    
    .analytics-insight-content h4 {
        font-size: 0.95rem;
        font-weight: 600;
        margin: 0 0 var(--fc-spacing-xs) 0;
    }
    
    .analytics-insight-content p {
        font-size: 0.85rem;
        margin: 0;
        color: var(--fc-text-secondary);
    }
    
    .analytics-category-breakdown {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-xl);
    }
    
    .analytics-performance-metrics {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-xl);
    }
    
    .analytics-performance-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--fc-spacing-md);
    }
    
    .analytics-performance-title {
        font-size: 1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-xs);
    }
    
    .analytics-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .analytics-table th {
        text-align: left;
        padding: var(--fc-spacing-sm);
        font-weight: 500;
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
        border-bottom: 1px solid var(--fc-border);
    }
    
    .analytics-table td {
        padding: var(--fc-spacing-sm);
        border-bottom: 1px solid var(--fc-border);
        font-size: 0.9rem;
    }
    
    .analytics-table tr:last-child td {
        border-bottom: none;
    }
    
    .analytics-table .progress-bar {
        height: 6px;
        background-color: var(--fc-bg-tertiary);
        border-radius: 3px;
        overflow: hidden;
        width: 100%;
    }
    
    .analytics-table .progress-fill {
        height: 100%;
        border-radius: 3px;
    }
    
    .analytics-table .progress-fill.high {
        background-color: var(--fc-positive);
    }
    
    .analytics-table .progress-fill.medium {
        background-color: var(--fc-warning);
    }
    
    .analytics-table .progress-fill.low {
        background-color: var(--fc-info);
    }
    
    .analytics-table .status {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .analytics-table .status.good {
        background-color: rgba(61, 213, 152, 0.15);
        color: var(--fc-positive);
    }
    
    .analytics-table .status.warning {
        background-color: rgba(255, 173, 99, 0.15);
        color: var(--fc-warning);
    }
    
    .analytics-table .status.critical {
        background-color: rgba(255, 107, 129, 0.15);
        color: var(--fc-negative);
    }
    
    .analytics-recommendations {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
    }
    
    .analytics-recommendations-header {
        margin-bottom: var(--fc-spacing-md);
    }
    
    .analytics-recommendations-title {
        font-size: 1rem;
        font-weight: 600;
        margin: 0 0 var(--fc-spacing-xs) 0;
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-xs);
    }
    
    .analytics-recommendations-subtitle {
        font-size: 0.85rem;
        color: var(--fc-text-secondary);
        margin: 0;
    }
    
    .analytics-recommendations-list {
        display: flex;
        flex-direction: column;
        gap: var(--fc-spacing-md);
    }
    
    .analytics-recommendation {
        display: flex;
        gap: var(--fc-spacing-md);
        padding-bottom: var(--fc-spacing-md);
        border-bottom: 1px solid var(--fc-border);
    }
    
    .analytics-recommendation:last-child {
        border-bottom: none;
        padding-bottom: 0;
    }
    
    .analytics-recommendation-icon {
        width: 36px;
        height: 36px;
        border-radius: var(--fc-radius);
        background-color: var(--fc-primary-light);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--fc-primary);
        flex-shrink: 0;
    }
    
    .analytics-recommendation-content h4 {
        font-size: 0.95rem;
        font-weight: 600;
        margin: 0 0 var(--fc-spacing-xs) 0;
    }
    
    .analytics-recommendation-content p {
        font-size: 0.85rem;
        margin: 0 0 var(--fc-spacing-sm) 0;
        color: var(--fc-text-secondary);
    }
    
    .analytics-recommendation-tags {
        display: flex;
        flex-wrap: wrap;
        gap: var(--fc-spacing-xs);
        margin-top: var(--fc-spacing-xs);
    }
    
    .analytics-recommendation-tag {
        background-color: var(--fc-bg-hover);
        color: var(--fc-text-secondary);
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 12px;
    }
    
    /* Terminal styles */
    .finchat-terminal {
        background-color: var(--fc-bg-tertiary);
        border-radius: var(--fc-radius);
        overflow: hidden;
        font-family: 'Courier New', monospace;
    }
    
    .finchat-terminal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: var(--fc-bg-secondary);
        padding: 8px 12px;
        border-bottom: 1px solid var(--fc-border);
    }
    
    .finchat-terminal-title {
        font-size: 0.85rem;
        color: var(--fc-text-secondary);
    }
    
    .finchat-terminal-controls {
        display: flex;
        gap: 6px;
    }
    
    .finchat-terminal-control {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: var(--fc-border);
    }
    
    .finchat-terminal-content {
        padding: 12px;
        max-height: 350px;
        overflow-y: auto;
    }
    
    .finchat-terminal-line {
        font-size: 0.85rem;
        margin-bottom: 6px;
        color: var(--fc-text-primary);
        line-height: 1.5;
        word-break: break-word;
    }
    
    .finchat-terminal-command {
        display: flex;
        align-items: center;
        margin-top: 12px;
    }
    
    .finchat-terminal-prompt {
        color: var(--fc-primary);
        margin-right: 8px;
        font-weight: bold;
    }
    
    .finchat-terminal-input {
        background: transparent;
        border: none;
        outline: none;
        color: var(--fc-text-primary);
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        width: 100%;
    }
    
    /* Chat styles */
    .finchat-chat {
        display: flex;
        flex-direction: column;
        height: 400px;
        border-radius: var(--fc-radius);
        overflow: hidden;
    }
    
    .finchat-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        background-color: var(--fc-bg-tertiary);
    }
    
    .finchat-chat-message {
        display: flex;
        flex-direction: column;
        max-width: 80%;
    }
    
    .finchat-chat-message.user {
        align-self: flex-end;
    }
    
    .finchat-chat-message.system {
        align-self: flex-start;
    }
    
    .finchat-chat-message-content {
        background-color: var(--fc-bg-card);
        border-radius: var(--fc-radius);
        padding: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .finchat-chat-message.user .finchat-chat-message-content {
        background-color: var(--fc-primary);
        color: white;
    }
    
    .finchat-chat-message-content p {
        margin: 0;
        line-height: 1.5;
    }
    
    .finchat-chat-message-typing {
        display: flex;
        gap: 4px;
        margin-top: 8px;
    }
    
    .finchat-chat-message-typing span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: var(--fc-text-secondary);
        animation: typing 1.4s infinite both;
    }
    
    .finchat-chat-message-typing span:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .finchat-chat-message-typing span:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes typing {
        0% { opacity: 0.3; transform: translateY(0); }
        50% { opacity: 1; transform: translateY(-4px); }
        100% { opacity: 0.3; transform: translateY(0); }
    }
    
    .finchat-chat-input {
        display: flex;
        gap: 8px;
        padding: 12px;
        background-color: var(--fc-bg-secondary);
        border-top: 1px solid var(--fc-border);
    }
    
    .finchat-form-control {
        flex: 1;
        padding: 10px 12px;
        border-radius: var(--fc-radius);
        border: 1px solid var(--fc-border);
        background-color: var(--fc-bg-input);
        color: var(--fc-text-primary);
        font-size: 0.9rem;
    }
    
    .finchat-button {
        padding: 6px 12px;
        border-radius: var(--fc-radius);
        border: 1px solid var(--fc-border);
        background-color: var(--fc-bg-secondary);
        color: var(--fc-text-primary);
        cursor: pointer;
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }
    
    .finchat-button:hover {
        background-color: var(--fc-bg-hover);
    }
    
    .finchat-button-primary {
        background-color: var(--fc-primary);
        border-color: var(--fc-primary);
        color: white;
    }
    
    .finchat-button-primary:hover {
        background-color: var(--fc-primary-hover);
        border-color: var(--fc-primary-hover);
    }
    
    .finchat-form {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }
    
    .finchat-form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    
    .finchat-form-group label {
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .finchat-form-check {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .finchat-form-check-input {
        width: 16px;
        height: 16px;
    }
    
    .finchat-input-group {
        display: flex;
        gap: 8px;
    }
    
    .finchat-form-text {
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
    }
    
    .finchat-suggestions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 16px;
    }
    
    .finchat-suggestion {
        background-color: var(--fc-bg-tertiary);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: 8px 12px;
        font-size: 0.8rem;
        color: var(--fc-text-primary);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }
    
    .finchat-suggestion:hover {
        background-color: var(--fc-bg-hover);
    }
    
    .finchat-code {
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        line-height: 1.5;
        white-space: pre-wrap;
        color: var(--fc-text-primary);
        background-color: var(--fc-bg-tertiary);
        padding: 16px;
        border-radius: var(--fc-radius);
        overflow: auto;
        max-height: 400px;
    }
    
    @media (max-width: 768px) {
        .analytics-chart-row {
            grid-template-columns: 1fr;
        }
    }
    
    /* Document Analysis Styles */
    .document-analysis-summary {
        background: rgba(30, 41, 59, 0.6);
        border-radius: 8px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .document-analysis-header {
        margin-bottom: 15px;
    }
    
    .document-analysis-header h5 {
        margin: 0 0 5px 0;
        color: #e2e8f0;
    }
    
    .document-meta {
        color: #94a3b8;
        font-size: 0.85rem;
        margin: 0;
    }
    
    .document-frameworks {
        margin-bottom: 20px;
    }
    
    .framework-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }
    
    .framework-tag {
        background: rgba(51, 65, 85, 0.7);
        color: #cbd5e1;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
    }
    
    .primary-framework {
        background: rgba(20, 184, 166, 0.2);
        border: 1px solid rgba(20, 184, 166, 0.5);
        color: #4ade80;
    }
    
    .document-metrics {
        margin-bottom: 20px;
    }
    
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    
    .metric-category {
        background: rgba(30, 41, 59, 0.5);
        border-radius: 6px;
        padding: 15px;
    }
    
    .metric-category h7 {
        color: #e2e8f0;
        font-weight: 600;
        display: block;
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 5px;
    }
    
    .metric-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .metric-list li {
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
    }
    
    .metric-list li:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }
    
    .metric-keyword {
        color: #3b82f6;
        font-weight: 500;
        font-size: 0.9rem;
        margin-bottom: 3px;
    }
    
    .metric-context {
        color: #94a3b8;
        font-size: 0.85rem;
        line-height: 1.4;
    }
    
    .more-metrics {
        color: #94a3b8;
        font-size: 0.85rem;
        font-style: italic;
        text-align: center;
    }
    
    .document-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        justify-content: flex-end;
    }
</style>
{% endblock %}

{% block main_content %}
{% if template_type == "trends" %}
<!-- Trend Analysis Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-chart-line"></i> AI Trend Analysis
    </h3>
    
    <div class="analytics-overview">
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Active Trends</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-bolt"></i>
                </div>
            </div>
            <div class="analytics-metric-value">{{ trends|length }}</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 12% from last month
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Avg. Virality Score</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
            </div>
            <div class="analytics-metric-value">78.3</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 5.2% from baseline
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">LinkedIn Mentions</div>
                <div class="analytics-metric-icon">
                    <i class="fab fa-linkedin"></i>
                </div>
            </div>
            <div class="analytics-metric-value">845</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 7.3% weekly growth
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">X Mentions</div>
                <div class="analytics-metric-icon">
                    <i class="fab fa-twitter"></i>
                </div>
            </div>
            <div class="analytics-metric-value">1,240</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 14.8% weekly growth
            </div>
        </div>
    </div>
    
    <div class="analytics-chart-card">
        <div class="analytics-chart-header">
            <h4 class="analytics-chart-title">
                <i class="fas fa-project-diagram"></i> Sustainability Trend Sankey Diagram
            </h4>
            <div class="analytics-chart-actions">
                <button class="finchat-btn finchat-btn-sm finchat-btn-outline">
                    <i class="fas fa-calendar"></i> This Month
                </button>
                <button class="finchat-btn finchat-btn-sm finchat-btn-outline">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
        <div class="analytics-chart-container">
            <div id="sankeyDiagram"></div>
        </div>
    </div>
    
    <div class="analytics-category-breakdown">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-hashtag"></i> Top Trending Topics
                </h4>
                <div class="analytics-chart-actions">
                    <button class="finchat-btn finchat-btn-sm finchat-btn-outline" id="refreshTopicsBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="analytics-chart-container" style="height: auto; padding: 20px;">
                <div class="trending-topics">
                    <div class="trending-topic">
                        <div class="trending-topic-rank">1</div>
                        <div class="trending-topic-content">
                            <h5>Corporate Net Zero Targets</h5>
                            <div class="trending-topic-stats">
                                <span class="trending-topic-stat">
                                    <i class="fab fa-linkedin"></i> 132 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fab fa-twitter"></i> 245 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fas fa-fire"></i> 89 virality score
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="trending-topic">
                        <div class="trending-topic-rank">2</div>
                        <div class="trending-topic-content">
                            <h5>ESRS Implementation Challenges</h5>
                            <div class="trending-topic-stats">
                                <span class="trending-topic-stat">
                                    <i class="fab fa-linkedin"></i> 118 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fab fa-twitter"></i> 156 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fas fa-fire"></i> 82 virality score
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="trending-topic">
                        <div class="trending-topic-rank">3</div>
                        <div class="trending-topic-content">
                            <h5>AI for ESG Reporting</h5>
                            <div class="trending-topic-stats">
                                <span class="trending-topic-stat">
                                    <i class="fab fa-linkedin"></i> 98 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fab fa-twitter"></i> 187 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fas fa-fire"></i> 76 virality score
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="trending-topic">
                        <div class="trending-topic-rank">4</div>
                        <div class="trending-topic-content">
                            <h5>Sustainable Supply Chain Verification</h5>
                            <div class="trending-topic-stats">
                                <span class="trending-topic-stat">
                                    <i class="fab fa-linkedin"></i> 87 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fab fa-twitter"></i> 124 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fas fa-fire"></i> 70 virality score
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="trending-topic">
                        <div class="trending-topic-rank">5</div>
                        <div class="trending-topic-content">
                            <h5>Carbon Credit Market Developments</h5>
                            <div class="trending-topic-stats">
                                <span class="trending-topic-stat">
                                    <i class="fab fa-linkedin"></i> 76 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fab fa-twitter"></i> 142 mentions
                                </span>
                                <span class="trending-topic-stat">
                                    <i class="fas fa-fire"></i> 68 virality score
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-globe"></i> Social Media Impact
                </h4>
            </div>
            <div class="analytics-chart-container">
                <div id="socialImpactChart"></div>
            </div>
        </div>
    </div>
    
    <div class="analytics-recommendations">
        <div class="analytics-recommendations-header">
            <h4 class="analytics-recommendations-title">
                <i class="fas fa-lightbulb"></i> AI-Generated Trend Insights
            </h4>
            <p class="analytics-recommendations-subtitle">Actionable insights based on trending sustainability topics</p>
        </div>
        
        <div class="analytics-recommendations-list">
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Net Zero Targets Gaining Momentum</h4>
                    <p>Corporate net zero commitments are increasing in visibility and scrutiny. Companies should prioritize transparent methodology and consider third-party verification to establish credibility.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Carbon</span>
                        <span class="analytics-recommendation-tag">Leadership</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>ESRS Adoption Challenges</h4>
                    <p>European Sustainability Reporting Standards implementation is creating significant operational challenges. Consider developing a centralized data collection system to meet the expanding disclosure requirements.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Reporting</span>
                        <span class="analytics-recommendation-tag">Compliance</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>AI for ESG Reporting</h4>
                    <p>AI tools for sustainability reporting are gaining traction as companies seek efficiency and accuracy. Early adopters are seeing 40% reduction in reporting preparation time.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">AI</span>
                        <span class="analytics-recommendation-tag">Technology</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.trending-topics {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.trending-topic {
    display: flex;
    align-items: center;
    gap: 15px;
    background-color: var(--fc-bg-tertiary);
    border-radius: var(--fc-radius);
    padding: 15px;
}

.trending-topic-rank {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: var(--fc-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    flex-shrink: 0;
}

.trending-topic-content {
    flex: 1;
}

.trending-topic-content h5 {
    margin: 0 0 8px 0;
    font-size: 1rem;
}

.trending-topic-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
}

.trending-topic-stat {
    font-size: 0.8rem;
    color: var(--fc-text-secondary);
    display: flex;
    align-items: center;
    gap: 5px;
}
</style>

{% elif template_type == "virality" %}
<!-- Virality Metrics Dashboard Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-network-wired"></i> Virality Metrics Dashboard
    </h3>
    
    <div class="analytics-overview">
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Viral Topics</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-fire"></i>
                </div>
            </div>
            <div class="analytics-metric-value">{{ trends|length }}</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 15% from last week
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Social Mentions</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-comments"></i>
                </div>
            </div>
            <div class="analytics-metric-value">8.7K</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 23% from last week
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Platform Reach</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-globe"></i>
                </div>
            </div>
            <div class="analytics-metric-value">42M</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 11% from last week
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Engagement Rate</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-thumbs-up"></i>
                </div>
            </div>
            <div class="analytics-metric-value">4.8%</div>
            <div class="analytics-metric-change negative">
                <i class="fas fa-arrow-down"></i> 2% from last week
            </div>
        </div>
    </div>
    
    <div class="analytics-chart-row">
        <div class="analytics-chart">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">Trending Sustainability Topics</h4>
                <div class="analytics-chart-actions">
                    <button id="refreshTopicsBtn" class="finchat-button finchat-button-outline">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="analytics-chart-content">
                <table class="analytics-table">
                    <thead>
                        <tr>
                            <th>Topic</th>
                            <th>Category</th>
                            <th>Virality Score</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for trend in trends[:8] %}
                        <tr>
                            <td>
                                <div class="topic-cell">
                                    <span class="topic-name">{{ trend.name }}</span>
                                    {% if trend.virality_score > 75 %}
                                    <span class="trending-tag">🔥 Trending</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td>{{ trend.category|capitalize }}</td>
                            <td>
                                <div class="virality-score">
                                    <div class="virality-bar" style="width: {{ trend.virality_score }}%;"></div>
                                    <span>{{ trend.virality_score }}</span>
                                </div>
                            </td>
                            <td>
                                {% if trend.get('change', 0) > 0 %}
                                <span class="trend-change positive">
                                    <i class="fas fa-arrow-up"></i> {{ trend.get('change', 5) }}%
                                </span>
                                {% else %}
                                <span class="trend-change negative">
                                    <i class="fas fa-arrow-down"></i> {{ -trend.get('change', 0) }}%
                                </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="analytics-chart">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">Social Platform Distribution</h4>
                <div class="analytics-chart-actions">
                    <select class="finchat-select">
                        <option>Last 7 days</option>
                        <option>Last 30 days</option>
                        <option>Last 90 days</option>
                    </select>
                </div>
            </div>
            <div class="analytics-chart-content">
                <canvas id="socialPlatformChart" height="250"></canvas>
            </div>
        </div>
    </div>
    
    <div class="analytics-chart-row">
        <div class="analytics-chart">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">Engagement Analysis</h4>
                <div class="analytics-chart-actions">
                    <select class="finchat-select">
                        <option>All Categories</option>
                        <option>Emissions</option>
                        <option>Energy</option>
                        <option>Water</option>
                        <option>Waste</option>
                    </select>
                </div>
            </div>
            <div class="analytics-chart-content">
                <canvas id="engagementChart" height="250"></canvas>
            </div>
        </div>
        
        <div class="analytics-chart">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">Impact Correlation</h4>
                <div class="analytics-chart-actions">
                    <button class="finchat-button finchat-button-outline">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
            <div class="analytics-chart-content">
                <canvas id="impactCorrelationChart" height="250"></canvas>
            </div>
        </div>
    </div>
    
    <div class="analytics-section">
        <div class="analytics-section-header">
            <h4 class="analytics-section-title">Audience Insights</h4>
            <div class="analytics-section-actions">
                <span class="finchat-text-muted">Last updated: Today at 8:45 AM</span>
            </div>
        </div>
        <div class="analytics-grid">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">Demographics</h5>
                    <div class="analytics-card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="analytics-card-content">
                    <div class="demographic-chart">
                        <div class="demographic-bar">
                            <span class="demographic-label">18-24</span>
                            <div class="demographic-value" style="width: 22%;">22%</div>
                        </div>
                        <div class="demographic-bar">
                            <span class="demographic-label">25-34</span>
                            <div class="demographic-value" style="width: 35%;">35%</div>
                        </div>
                        <div class="demographic-bar">
                            <span class="demographic-label">35-44</span>
                            <div class="demographic-value" style="width: 28%;">28%</div>
                        </div>
                        <div class="demographic-bar">
                            <span class="demographic-label">45-54</span>
                            <div class="demographic-value" style="width: 12%;">12%</div>
                        </div>
                        <div class="demographic-bar">
                            <span class="demographic-label">55+</span>
                            <div class="demographic-value" style="width: 3%;">3%</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">Geographic Distribution</h5>
                    <div class="analytics-card-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                </div>
                <div class="analytics-card-content">
                    <div class="geo-distribution">
                        <div class="geo-item">
                            <span class="geo-name">North America</span>
                            <span class="geo-value">42%</span>
                        </div>
                        <div class="geo-item">
                            <span class="geo-name">Europe</span>
                            <span class="geo-value">28%</span>
                        </div>
                        <div class="geo-item">
                            <span class="geo-name">Asia</span>
                            <span class="geo-value">18%</span>
                        </div>
                        <div class="geo-item">
                            <span class="geo-name">South America</span>
                            <span class="geo-value">7%</span>
                        </div>
                        <div class="geo-item">
                            <span class="geo-name">Other</span>
                            <span class="geo-value">5%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">Industry Sectors</h5>
                    <div class="analytics-card-icon">
                        <i class="fas fa-industry"></i>
                    </div>
                </div>
                <div class="analytics-card-content">
                    <div class="industry-sectors">
                        <div class="sector-item">
                            <span class="sector-name">Energy & Utilities</span>
                            <span class="sector-value">24%</span>
                        </div>
                        <div class="sector-item">
                            <span class="sector-name">Manufacturing</span>
                            <span class="sector-value">18%</span>
                        </div>
                        <div class="sector-item">
                            <span class="sector-name">Technology</span>
                            <span class="sector-value">16%</span>
                        </div>
                        <div class="sector-item">
                            <span class="sector-name">Finance</span>
                            <span class="sector-value">15%</span>
                        </div>
                        <div class="sector-item">
                            <span class="sector-name">Other</span>
                            <span class="sector-value">27%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.topic-cell {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.trending-tag {
    display: inline-block;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 10px;
    background-color: rgba(255, 59, 48, 0.15);
    color: var(--fc-positive);
}

.virality-score {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
}

.virality-bar {
    height: 8px;
    background: linear-gradient(90deg, var(--fc-positive) 0%, var(--fc-accent) 100%);
    border-radius: 4px;
}

.demographic-chart {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.demographic-bar {
    display: flex;
    align-items: center;
    gap: 10px;
}

.demographic-label {
    width: 60px;
    font-size: 0.85rem;
    color: var(--fc-text-secondary);
}

.demographic-value {
    height: 20px;
    background: linear-gradient(90deg, var(--fc-primary) 0%, var(--fc-accent) 100%);
    border-radius: 3px;
    color: white;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 8px;
    font-size: 0.8rem;
    font-weight: 500;
}

.geo-distribution, .industry-sectors {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.geo-item, .sector-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--fc-border);
}

.geo-item:last-child, .sector-item:last-child {
    border-bottom: none;
}

.geo-value, .sector-value {
    font-weight: 500;
    color: var(--fc-text-primary);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Social Platform Distribution Chart
    if (document.getElementById('socialPlatformChart')) {
        const ctx = document.getElementById('socialPlatformChart').getContext('2d');
        const data = {
            labels: ['Twitter/X', 'LinkedIn', 'Facebook', 'Instagram', 'YouTube', 'TikTok'],
            datasets: [{
                label: 'Mentions',
                data: [35, 28, 15, 12, 7, 3],
                backgroundColor: [
                    'rgba(29, 161, 242, 0.7)',  // Twitter/X blue
                    'rgba(0, 119, 181, 0.7)',   // LinkedIn blue
                    'rgba(59, 89, 152, 0.7)',   // Facebook blue
                    'rgba(193, 53, 132, 0.7)',  // Instagram purple
                    'rgba(255, 0, 0, 0.7)',     // YouTube red
                    'rgba(0, 242, 234, 0.7)'    // TikTok teal
                ],
                borderColor: [
                    'rgba(29, 161, 242, 1)',
                    'rgba(0, 119, 181, 1)',
                    'rgba(59, 89, 152, 1)',
                    'rgba(193, 53, 132, 1)',
                    'rgba(255, 0, 0, 1)',
                    'rgba(0, 242, 234, 1)'
                ],
                borderWidth: 1
            }]
        };
        
        const config = {
            type: 'doughnut',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#888'
                        }
                    }
                }
            }
        };
        
        new Chart(ctx, config);
    }
    
    // Engagement Analysis Chart
    if (document.getElementById('engagementChart')) {
        const ctx = document.getElementById('engagementChart').getContext('2d');
        const data = {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Likes',
                data: [4500, 5200, 4800, 5800, 6200, 5100, 4700],
                borderColor: 'rgba(29, 161, 242, 1)',
                backgroundColor: 'rgba(29, 161, 242, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Shares',
                data: [1200, 1400, 1300, 1700, 1900, 1500, 1300],
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Comments',
                data: [800, 950, 900, 1100, 1250, 1000, 850],
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };
        
        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#888'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#888'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#888'
                        }
                    }
                }
            }
        };
        
        new Chart(ctx, config);
    }
    
    // Impact Correlation Chart
    if (document.getElementById('impactCorrelationChart')) {
        const ctx = document.getElementById('impactCorrelationChart').getContext('2d');
        const data = {
            labels: ['Renewable Energy', 'Carbon Reduction', 'Water Conservation', 'Waste Management', 'Biodiversity'],
            datasets: [{
                label: 'Virality Score',
                data: [78, 82, 65, 59, 71],
                backgroundColor: 'rgba(75, 192, 192, 0.7)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }, {
                label: 'Impact Score',
                data: [65, 75, 70, 68, 62],
                backgroundColor: 'rgba(153, 102, 255, 0.7)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        };
        
        const config = {
            type: 'bar',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#888'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#888'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#888',
                            beginAtZero: true
                        }
                    }
                }
            }
        };
        
        new Chart(ctx, config);
    }
});
</script>

{% elif template_type == "stories" %}
<!-- Story Cards Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-newspaper"></i> AI-Generated Sustainability Stories
    </h3>
    
    <div class="analytics-story-builder">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-magic"></i> Data-Based Storytelling Builder
                </h4>
                <div class="analytics-chart-actions">
                    <button class="finchat-btn finchat-btn-sm finchat-btn-outline" id="buildNewStoryBtn">
                        <i class="fas fa-plus"></i> New Story
                    </button>
                </div>
            </div>
            <div class="analytics-story-builder-form">
                <div class="finchat-form-group">
                    <label for="storyDataSource">Data Source</label>
                    <select class="finchat-form-control" id="storyDataSource">
                        <option value="sustainability_metrics">Sustainability Metrics</option>
                        <option value="social_trends">Social Media Trends</option>
                        <option value="esg_ratings">ESG Ratings</option>
                        <option value="document_insights">Document Insights</option>
                    </select>
                </div>
                <div class="finchat-form-group">
                    <label for="storyFocus">Story Focus</label>
                    <select class="finchat-form-control" id="storyFocus">
                        <option value="impact">Impact & Achievements</option>
                        <option value="challenges">Challenges & Solutions</option>
                        <option value="trends">Trend Analysis</option>
                        <option value="predictions">Future Predictions</option>
                    </select>
                </div>
                <div class="finchat-form-group">
                    <label for="storyLength">Story Length</label>
                    <select class="finchat-form-control" id="storyLength">
                        <option value="short">Short (1-2 paragraphs)</option>
                        <option value="medium" selected>Medium (3-4 paragraphs)</option>
                        <option value="long">Long (5+ paragraphs)</option>
                    </select>
                </div>
                <div class="finchat-form-group">
                    <label for="storyAudience">Target Audience</label>
                    <select class="finchat-form-control" id="storyAudience">
                        <option value="investors">Investors</option>
                        <option value="customers">Customers</option>
                        <option value="employees">Employees</option>
                        <option value="regulators">Regulators</option>
                        <option value="general">General Public</option>
                    </select>
                </div>
                <button class="finchat-btn finchat-btn-primary" id="generateStoryBtn">
                    <i class="fas fa-bolt"></i> Generate Story
                </button>
            </div>
        </div>
    </div>
    
    <div class="analytics-recommendations">
        <div class="analytics-recommendations-header">
            <h4 class="analytics-recommendations-title">
                <i class="fas fa-lightbulb"></i> Data-Driven Narratives
            </h4>
            <p class="analytics-recommendations-subtitle">AI-generated stories based on your sustainability metrics and performance trends</p>
        </div>
        
        <div class="analytics-recommendations-list">
            {% if stories %}
                {% for story in stories %}
                <div class="analytics-recommendation">
                    <div class="analytics-recommendation-icon">
                        {% if story.category == 'carbon' %}
                            <i class="fas fa-smog"></i>
                        {% elif story.category == 'water' %}
                            <i class="fas fa-tint"></i>
                        {% elif story.category == 'waste' %}
                            <i class="fas fa-trash"></i>
                        {% elif story.category == 'social' %}
                            <i class="fas fa-users"></i>
                        {% else %}
                            <i class="fas fa-leaf"></i>
                        {% endif %}
                    </div>
                    <div class="analytics-recommendation-content">
                        <h4>{{ story.title }}</h4>
                        <p>{{ story.content }}</p>
                        <div class="analytics-recommendation-tags">
                            {% for tag in story.tags %}
                            <span class="analytics-recommendation-tag">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        <div class="story-social-sharing">
                            <button class="finchat-btn finchat-btn-sm finchat-btn-outline share-btn" data-platform="linkedin">
                                <i class="fab fa-linkedin"></i> Share
                            </button>
                            <button class="finchat-btn finchat-btn-sm finchat-btn-outline share-btn" data-platform="twitter">
                                <i class="fab fa-twitter"></i> Share
                            </button>
                            <button class="finchat-btn finchat-btn-sm finchat-btn-outline share-btn" data-platform="reddit">
                                <i class="fab fa-reddit"></i> Share
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="analytics-recommendation">
                    <div class="analytics-recommendation-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="analytics-recommendation-content">
                        <h4>No stories available</h4>
                        <p>We don't have any sustainability stories to display at the moment. Please check back later as our AI analyzes more of your sustainability data.</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% elif template_type == "documents" %}
<!-- PDF Analyzer Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-file-pdf"></i> Document Analysis & Data Import
    </h3>
    
    <div class="analytics-category-breakdown">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-upload"></i> Import Data from Any File Type
                </h4>
            </div>
            <div class="analytics-chart-container" style="height: auto; padding: 20px;">
                <form action="/data-moat/upload" method="post" enctype="multipart/form-data" class="finchat-form">
                    <div class="finchat-form-group">
                        <label for="file">Select Document File</label>
                        <input type="file" name="file" id="file" accept=".pdf,.docx,.xlsx,.csv,.txt" class="finchat-form-control" required>
                        <small class="finchat-form-text">Supported formats: PDF, DOCX, XLSX, CSV, TXT</small>
                    </div>
                    
                    <div class="finchat-form-group">
                        <label for="analysis_type">Analysis Type</label>
                        <select name="analysis_type" id="analysis_type" class="finchat-form-control">
                            <option value="sustainability">Sustainability Assessment</option>
                            <option value="esrs">ESRS Compliance</option>
                            <option value="metrics">Metrics Extraction</option>
                            <option value="summary">Executive Summary</option>
                            <option value="data_import">Data Import Only</option>
                        </select>
                    </div>
                    
                    <div class="finchat-form-check">
                        <input type="checkbox" name="use_ocr" id="use_ocr" class="finchat-form-check-input" value="true">
                        <label for="use_ocr">Use OCR for scanned documents</label>
                    </div>
                    
                    <div class="finchat-form-check">
                        <input type="checkbox" name="auto_detect_framework" id="auto_detect_framework" class="finchat-form-check-input" value="true" checked>
                        <label for="auto_detect_framework">Auto-detect regulatory frameworks</label>
                    </div>
                    
                    <button type="submit" class="finchat-button finchat-button-primary">
                        <i class="fas fa-upload"></i> Upload & Analyze
                    </button>
                </form>
            </div>
        </div>
    
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-magic"></i> AI Insight Generation
                </h4>
            </div>
            <div class="analytics-chart-container" style="height: auto; padding: 20px;">
                <div class="finchat-form-group">
                    <label for="insight_type">Insight Type</label>
                    <select id="insight_type" class="finchat-form-control">
                        <option value="summary">Executive Summary</option>
                        <option value="metrics">Key Metrics Identification</option>
                        <option value="trends">Trend Analysis</option>
                        <option value="recommendations">Recommendations</option>
                        <option value="compliance">Compliance Assessment</option>
                    </select>
                </div>
                
                <div class="finchat-form-group">
                    <label for="insight_depth">Analysis Depth</label>
                    <select id="insight_depth" class="finchat-form-control">
                        <option value="basic">Basic</option>
                        <option value="standard" selected>Standard</option>
                        <option value="comprehensive">Comprehensive</option>
                    </select>
                </div>
                
                <button id="generateInsightsBtn" class="finchat-button finchat-button-primary">
                    <i class="fas fa-bolt"></i> Generate Insights
                </button>
            </div>
        </div>
    </div>
    
    <div class="analytics-recommendations">
        <div class="analytics-recommendations-header">
            <h4 class="analytics-recommendations-title">
                <i class="fas fa-file-alt"></i> Document Summary & Insights
            </h4>
            <p class="analytics-recommendations-subtitle">AI-generated analysis from your uploaded documents</p>
        </div>
        
        <div id="documentInsights" class="analytics-chart-container" style="height: auto; padding: 20px;">
            {% if document %}
                <div class="document-analysis-summary">
                    <div class="document-analysis-header">
                        <h5><i class="fas fa-file-pdf"></i> {{ document.original_filename }}</h5>
                        <p class="document-meta">Uploaded: {{ document.timestamp }} | {{ document.text_length }} characters</p>
                    </div>

                    {% if document_frameworks %}
                    <div class="document-frameworks">
                        <h6><i class="fas fa-check-square"></i> Detected Frameworks</h6>
                        <div class="framework-tags">
                            {% for framework, confidence in document_frameworks.items() %}
                            <span class="framework-tag {% if framework == document.primary_framework %}primary-framework{% endif %}">
                                {{ framework.upper() }} ({{ (confidence * 100)|round|int }}%)
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if document_metrics %}
                    <div class="document-metrics">
                        <h6><i class="fas fa-chart-line"></i> Extracted Metrics</h6>
                        <div class="metrics-grid">
                            {% for category, metrics in document_metrics.items() %}
                            <div class="metric-category">
                                <h7>{{ category|title }}</h7>
                                <ul class="metric-list">
                                    {% for metric in metrics[:3] %}
                                    <li>
                                        <div class="metric-keyword">{{ metric.keyword }}</div>
                                        <div class="metric-context">{{ metric.context }}</div>
                                    </li>
                                    {% endfor %}
                                    {% if metrics|length > 3 %}
                                    <li class="more-metrics">+ {{ metrics|length - 3 }} more...</li>
                                    {% endif %}
                                </ul>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <div class="document-actions">
                        <button class="finchat-button finchat-button-primary" onclick="generateFullAnalysis('{{ document_id }}')">
                            <i class="fas fa-search-plus"></i> Generate Full Analysis
                        </button>
                        <button class="finchat-button finchat-button-secondary" onclick="exportAnalysisReport('{{ document_id }}')">
                            <i class="fas fa-file-export"></i> Export Report
                        </button>
                    </div>
                </div>
            {% else %}
                <div class="finchat-empty-state">
                    <i class="fas fa-cloud-upload-alt fa-3x"></i>
                    <p>Upload a document and generate insights to see results here</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% elif template_type == "terminal" %}
<!-- Data Terminal Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-terminal"></i> Data Terminal
    </h3>
    
    <div class="analytics-chart-card">
        <div class="analytics-chart-header">
            <h4 class="analytics-chart-title">
                <i class="fas fa-code"></i> API Access Point
            </h4>
        </div>
        <div class="analytics-chart-container" style="height: auto; padding: 20px;">
            <div class="finchat-terminal">
                <div class="finchat-terminal-header">
                    <div class="finchat-terminal-title">SustainaTrend™ API Terminal</div>
                    <div class="finchat-terminal-controls">
                        <span class="finchat-terminal-control"></span>
                        <span class="finchat-terminal-control"></span>
                        <span class="finchat-terminal-control"></span>
                    </div>
                </div>
                <div class="finchat-terminal-content">
                    <div class="finchat-terminal-line">Welcome to SustainaTrend™ API Terminal</div>
                    <div class="finchat-terminal-line">Available endpoints:</div>
                    <div class="finchat-terminal-line">- /api/metrics - Get sustainability metrics</div>
                    <div class="finchat-terminal-line">- /api/trends - Get sustainability trends</div>
                    <div class="finchat-terminal-line">- /api/storytelling - Generate AI stories</div>
                    <div class="finchat-terminal-line">- /api/search - Search sustainability data</div>
                    <div class="finchat-terminal-line">- /api/copilot - Interact with AI assistant</div>
                    <div class="finchat-terminal-line">- /api/summarize - Summarize sustainability text</div>
                    <div class="finchat-terminal-line">- /api/predictive-analytics - Get predictive insights</div>
                    <div class="finchat-terminal-command">
                        <span class="finchat-terminal-prompt">$</span>
                        <input type="text" class="finchat-terminal-input" placeholder="Enter API command...">
                    </div>
                </div>
            </div>
            
            <div class="finchat-section-title" style="margin-top: 30px;">
                <i class="fas fa-key"></i> API Authentication
            </div>
            <div class="finchat-form-group">
                <label for="api_key">API Key</label>
                <div class="finchat-input-group">
                    <input type="password" id="api_key" class="finchat-form-control" value="sk_test_*****************" readonly>
                    <button class="finchat-button finchat-button-secondary">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <small class="finchat-form-text">Use this key to authenticate API requests</small>
            </div>
        </div>
    </div>
</div>

{% elif template_type == "monetization" %}
<!-- Monetization Opportunities Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-money-bill-wave"></i> Monetization Opportunities & Strategies
    </h3>
    
    <!-- SWOT Analysis Section -->
    <div class="analytics-chart-card">
        <div class="analytics-chart-header">
            <h4 class="analytics-chart-title">
                <i class="fas fa-balance-scale"></i> SWOT Analysis
            </h4>
            <div class="analytics-chart-actions">
                <button class="finchat-btn finchat-btn-sm finchat-btn-outline" id="refreshSwotBtn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
        <div class="analytics-chart-container" style="height: auto; padding: 20px;">
            <div class="swot-grid">
                <div class="swot-cell swot-strengths">
                    <h5><i class="fas fa-check-circle"></i> Strengths</h5>
                    <ul>
                        <li>AI-powered sustainability intelligence with unique storytelling capabilities</li>
                        <li>Comprehensive data visualization and analytics dashboard</li>
                        <li>Advanced document analysis for ESG reporting</li>
                        <li>Multi-framework compliance monitoring (ESRS, GRI, TCFD)</li>
                    </ul>
                </div>
                <div class="swot-cell swot-weaknesses">
                    <h5><i class="fas fa-times-circle"></i> Weaknesses</h5>
                    <ul>
                        <li>Limited market presence and brand recognition</li>
                        <li>Dependency on third-party data sources</li>
                        <li>Need for continuous AI model training and maintenance</li>
                        <li>Integration complexity with legacy enterprise systems</li>
                    </ul>
                </div>
                <div class="swot-cell swot-opportunities">
                    <h5><i class="fas fa-lightbulb"></i> Opportunities</h5>
                    <ul>
                        <li>Growing regulatory landscape (CSRD, ESRS, ISSB) driving demand</li>
                        <li>Increased investor focus on ESG performance metrics</li>
                        <li>Sustainability reporting becoming standard business practice</li>
                        <li>Integration with carbon marketplaces and credit systems</li>
                    </ul>
                </div>
                <div class="swot-cell swot-threats">
                    <h5><i class="fas fa-exclamation-triangle"></i> Threats</h5>
                    <ul>
                        <li>Established ESG software providers expanding capabilities</li>
                        <li>Rapid evolution of reporting standards requiring continuous updates</li>
                        <li>Custom in-house solutions developed by large enterprises</li>
                        <li>Data privacy and security concerns with AI analysis</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="analytics-category-breakdown">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-chart-pie"></i> Revenue Potential by Category
                </h4>
            </div>
            <div class="analytics-chart-container">
                <canvas id="monetizationPieChart"></canvas>
            </div>
        </div>
        
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-bullseye"></i> ROI Projection
                </h4>
            </div>
            <div class="analytics-chart-container">
                <canvas id="roiChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Management Consulting Strategies -->
    <div class="analytics-recommendations">
        <div class="analytics-recommendations-header">
            <h4 class="analytics-recommendations-title">
                <i class="fas fa-briefcase"></i> Management Consulting Strategies
            </h4>
            <p class="analytics-recommendations-subtitle">AI-generated business opportunities with strategic frameworks</p>
        </div>
        
        <div class="analytics-tabs">
            <button class="analytics-tab active" data-tab="strategy-bcg">BCG Matrix</button>
            <button class="analytics-tab" data-tab="strategy-mckinsey">McKinsey 7S</button>
            <button class="analytics-tab" data-tab="strategy-porter">Porter's 5 Forces</button>
            <button class="analytics-tab" data-tab="strategy-blue">Blue Ocean</button>
        </div>
        
        <div class="analytics-tab-content active" id="strategy-bcg">
            <div class="analytics-chart-header">
                <h5 class="analytics-chart-title">BCG Growth-Share Matrix</h5>
                <p class="analytics-chart-subtitle">Portfolio analysis for sustainability products and services</p>
            </div>
            <div class="bcg-matrix">
                <div class="bcg-quadrant bcg-star">
                    <h6>Star</h6>
                    <p>ESG Data Analytics Platform</p>
                    <small>High growth, high market share</small>
                </div>
                <div class="bcg-quadrant bcg-question">
                    <h6>Question Mark</h6>
                    <p>Sustainability Certification</p>
                    <small>High growth, low market share</small>
                </div>
                <div class="bcg-quadrant bcg-cash">
                    <h6>Cash Cow</h6>
                    <p>Compliance Reporting Tools</p>
                    <small>Low growth, high market share</small>
                </div>
                <div class="bcg-quadrant bcg-dog">
                    <h6>Dog</h6>
                    <p>Basic Carbon Calculators</p>
                    <small>Low growth, low market share</small>
                </div>
            </div>
            <div class="analytics-strategy-actions">
                <button class="finchat-btn finchat-btn-primary" id="generateBcgReportBtn">
                    <i class="fas fa-file-alt"></i> Generate Strategic Report
                </button>
            </div>
        </div>
        
        <div class="analytics-tab-content" id="strategy-mckinsey" style="display: none;">
            <div class="analytics-chart-header">
                <h5 class="analytics-chart-title">McKinsey 7S Framework</h5>
                <p class="analytics-chart-subtitle">Organizational alignment for successful implementation</p>
            </div>
            <div class="mckinsey-framework">
                <div class="mckinsey-element">
                    <h6><i class="fas fa-chart-line"></i> Strategy</h6>
                    <p>Focus on AI-driven sustainability intelligence with premium pricing for enterprise clients.</p>
                </div>
                <div class="mckinsey-element">
                    <h6><i class="fas fa-sitemap"></i> Structure</h6>
                    <p>Agile product teams with dedicated customer success consultants.</p>
                </div>
                <div class="mckinsey-element">
                    <h6><i class="fas fa-cogs"></i> Systems</h6>
                    <p>Cloud-based platform with seamless integration capabilities and regular AI model updates.</p>
                </div>
                <div class="mckinsey-element">
                    <h6><i class="fas fa-users"></i> Shared Values</h6>
                    <p>Commitment to sustainability, data accuracy, and actionable intelligence.</p>
                </div>
                <div class="mckinsey-element">
                    <h6><i class="fas fa-user-tie"></i> Style</h6>
                    <p>Collaborative leadership with sustainability expertise and technical innovation.</p>
                </div>
                <div class="mckinsey-element">
                    <h6><i class="fas fa-id-badge"></i> Staff</h6>
                    <p>Sustainability experts, data scientists, and customer-focused implementation team.</p>
                </div>
                <div class="mckinsey-element">
                    <h6><i class="fas fa-tools"></i> Skills</h6>
                    <p>AI development, sustainability reporting expertise, and data storytelling.</p>
                </div>
            </div>
            <div class="analytics-strategy-actions">
                <button class="finchat-btn finchat-btn-primary" id="generate7SReportBtn">
                    <i class="fas fa-file-alt"></i> Generate Strategic Report
                </button>
            </div>
        </div>
        
        <div class="analytics-tab-content" id="strategy-porter" style="display: none;">
            <!-- Porter's 5 Forces content would go here -->
            <div class="analytics-chart-header">
                <h5 class="analytics-chart-title">Porter's Five Forces Analysis</h5>
                <p class="analytics-chart-subtitle">Competitive industry analysis for sustainability intelligence</p>
            </div>
            <div class="porters-forces">
                <div class="forces-element">
                    <h6>Competitive Rivalry</h6>
                    <div class="force-meter">
                        <div class="force-fill" style="width: 70%;"></div>
                    </div>
                    <p>High - ESG software market growing with established players</p>
                </div>
                <div class="forces-element">
                    <h6>Supplier Power</h6>
                    <div class="force-meter">
                        <div class="force-fill" style="width: 50%;"></div>
                    </div>
                    <p>Medium - Data providers and cloud services are important but substitutable</p>
                </div>
                <div class="forces-element">
                    <h6>Buyer Power</h6>
                    <div class="force-meter">
                        <div class="force-fill" style="width: 65%;"></div>
                    </div>
                    <p>Medium-High - Enterprises have many options but switching costs exist</p>
                </div>
                <div class="forces-element">
                    <h6>Threat of Substitution</h6>
                    <div class="force-meter">
                        <div class="force-fill" style="width: 40%;"></div>
                    </div>
                    <p>Medium-Low - AI-driven solutions offer unique value difficult to substitute</p>
                </div>
                <div class="forces-element">
                    <h6>Threat of New Entry</h6>
                    <div class="force-meter">
                        <div class="force-fill" style="width: 55%;"></div>
                    </div>
                    <p>Medium - AI expertise and regulatory knowledge create barriers to entry</p>
                </div>
            </div>
            <div class="analytics-strategy-actions">
                <button class="finchat-btn finchat-btn-primary" id="generatePorterReportBtn">
                    <i class="fas fa-file-alt"></i> Generate Strategic Report
                </button>
            </div>
        </div>
        
        <div class="analytics-tab-content" id="strategy-blue" style="display: none;">
            <!-- Blue Ocean Strategy content would go here -->
            <div class="analytics-chart-header">
                <h5 class="analytics-chart-title">Blue Ocean Strategy Canvas</h5>
                <p class="analytics-chart-subtitle">Creating uncontested market space in sustainability intelligence</p>
            </div>
            <div class="blue-ocean-canvas">
                <canvas id="blueOceanCanvas" height="300"></canvas>
            </div>
            <div class="blue-ocean-factors">
                <div class="blue-ocean-factor">
                    <h6>Eliminate</h6>
                    <ul>
                        <li>Complex manual data entry</li>
                        <li>Technical jargon in reporting</li>
                        <li>Isolated sustainability metrics</li>
                    </ul>
                </div>
                <div class="blue-ocean-factor">
                    <h6>Reduce</h6>
                    <ul>
                        <li>Implementation time</li>
                        <li>Learning curve</li>
                        <li>Integration complexity</li>
                    </ul>
                </div>
                <div class="blue-ocean-factor">
                    <h6>Raise</h6>
                    <ul>
                        <li>AI-driven insights</li>
                        <li>Storytelling capabilities</li>
                        <li>Real-time monitoring</li>
                    </ul>
                </div>
                <div class="blue-ocean-factor">
                    <h6>Create</h6>
                    <ul>
                        <li>Predictive ESG scenarios</li>
                        <li>Automated compliance checks</li>
                        <li>Impact visualization tools</li>
                    </ul>
                </div>
            </div>
            <div class="analytics-strategy-actions">
                <button class="finchat-btn finchat-btn-primary" id="generateBlueOceanReportBtn">
                    <i class="fas fa-file-alt"></i> Generate Strategic Report
                </button>
            </div>
        </div>
    </div>
    
    <!-- Product Recommendations -->
    <div class="analytics-recommendations">
        <div class="analytics-recommendations-header">
            <h4 class="analytics-recommendations-title">
                <i class="fas fa-lightbulb"></i> Monetization Products
            </h4>
            <p class="analytics-recommendations-subtitle">AI-generated product opportunities based on strategic analysis</p>
        </div>
        
        <div class="analytics-recommendations-list">
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Sustainability Data Marketplace</h4>
                    <p>Create a subscription-based marketplace for anonymized, aggregated sustainability data that companies can use for benchmarking.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Data Products</span>
                        <span class="analytics-recommendation-tag">High ROI</span>
                    </div>
                    <button class="finchat-btn finchat-btn-sm finchat-btn-outline mt-2">
                        <i class="fas fa-plus"></i> Create Business Plan
                    </button>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-handshake"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>ESG Advisory Services</h4>
                    <p>Leverage your sustainability intelligence platform to offer premium advisory services for companies looking to improve their ESG performance.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Services</span>
                        <span class="analytics-recommendation-tag">Medium ROI</span>
                    </div>
                    <button class="finchat-btn finchat-btn-sm finchat-btn-outline mt-2">
                        <i class="fas fa-plus"></i> Create Business Plan
                    </button>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-certificate"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Sustainability Certification Program</h4>
                    <p>Develop a certification program that validates companies' sustainability claims using your AI-powered verification technology.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Certification</span>
                        <span class="analytics-recommendation-tag">Long-term</span>
                    </div>
                    <button class="finchat-btn finchat-btn-sm finchat-btn-outline mt-2">
                        <i class="fas fa-plus"></i> Create Business Plan
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.swot-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: 15px;
}

.swot-cell {
    background-color: var(--fc-bg-card);
    border: 1px solid var(--fc-border);
    border-radius: var(--fc-radius);
    padding: 15px;
}

.swot-cell h5 {
    font-size: 1rem;
    margin-top: 0;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.swot-cell ul {
    padding-left: 20px;
    margin: 0;
}

.swot-cell li {
    margin-bottom: 5px;
    font-size: 0.9rem;
}

.swot-strengths h5 {
    color: var(--fc-positive);
}

.swot-weaknesses h5 {
    color: var(--fc-negative);
}

.swot-opportunities h5 {
    color: var(--fc-info);
}

.swot-threats h5 {
    color: var(--fc-warning);
}

.analytics-tabs {
    display: flex;
    gap: 10px;
    border-bottom: 1px solid var(--fc-border);
    margin-bottom: 20px;
    overflow-x: auto;
    padding-bottom: 10px;
}

.analytics-tab {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--fc-border);
    border-radius: var(--fc-radius);
    color: var(--fc-text-secondary);
    cursor: pointer;
    font-size: 0.9rem;
    white-space: nowrap;
}

.analytics-tab.active {
    background-color: var(--fc-primary);
    color: white;
    border-color: var(--fc-primary);
}

.analytics-tab-content {
    margin-bottom: 20px;
}

.bcg-matrix {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: 15px;
    margin-bottom: 20px;
}

.bcg-quadrant {
    background-color: var(--fc-bg-tertiary);
    border-radius: var(--fc-radius);
    padding: 15px;
    text-align: center;
}

.bcg-quadrant h6 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1rem;
}

.bcg-quadrant p {
    margin-bottom: 5px;
    font-weight: 500;
}

.bcg-quadrant small {
    font-size: 0.8rem;
    color: var(--fc-text-secondary);
}

.bcg-star {
    background-color: rgba(61, 213, 152, 0.1);
}

.bcg-star h6 {
    color: var(--fc-positive);
}

.bcg-question {
    background-color: rgba(52, 195, 255, 0.1);
}

.bcg-question h6 {
    color: var(--fc-info);
}

.bcg-cash {
    background-color: rgba(255, 185, 0, 0.1);
}

.bcg-cash h6 {
    color: var(--fc-warning);
}

.bcg-dog {
    background-color: rgba(255, 107, 129, 0.1);
}

.bcg-dog h6 {
    color: var(--fc-negative);
}

.analytics-strategy-actions {
    margin-top: 20px;
    text-align: center;
}

.mckinsey-framework {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    grid-gap: 15px;
    margin-bottom: 20px;
}

.mckinsey-element {
    background-color: var(--fc-bg-tertiary);
    border-radius: var(--fc-radius);
    padding: 15px;
}

.mckinsey-element h6 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 0.95rem;
    color: var(--fc-primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.mckinsey-element p {
    margin: 0;
    font-size: 0.9rem;
}

.porters-forces {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.forces-element {
    background-color: var(--fc-bg-tertiary);
    border-radius: var(--fc-radius);
    padding: 15px;
}

.forces-element h6 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 0.95rem;
}

.forces-element p {
    margin: 5px 0 0 0;
    font-size: 0.9rem;
}

.force-meter {
    height: 10px;
    background-color: var(--fc-bg-secondary);
    border-radius: 5px;
    overflow: hidden;
}

.force-fill {
    height: 100%;
    background-color: var(--fc-primary);
    border-radius: 5px;
}

.blue-ocean-canvas {
    margin-bottom: 20px;
}

.blue-ocean-factors {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-gap: 15px;
    margin-bottom: 20px;
}

.blue-ocean-factor {
    background-color: var(--fc-bg-tertiary);
    border-radius: var(--fc-radius);
    padding: 15px;
}

.blue-ocean-factor h6 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 0.95rem;
    color: var(--fc-primary);
}

.blue-ocean-factor ul {
    padding-left: 20px;
    margin: 0;
}

.blue-ocean-factor li {
    margin-bottom: 5px;
    font-size: 0.9rem;
}

.mt-2 {
    margin-top: 10px;
}
</style>

{% elif template_type == "copilot" %}
<!-- Sustainability Co-Pilot Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-robot"></i> Sustainability Co-Pilot
    </h3>
    
    <div class="analytics-chart-card">
        <div class="analytics-chart-header">
            <h4 class="analytics-chart-title">
                <i class="fas fa-comments"></i> Ask anything about sustainability
            </h4>
        </div>
        <div class="analytics-chart-container" style="height: auto; padding: 20px;">
            <div class="finchat-chat">
                <div class="finchat-chat-messages">
                    <div class="finchat-chat-message system">
                        <div class="finchat-chat-message-content">
                            <p>Hello! I'm your Sustainability Co-Pilot. I can help you with sustainability insights, ESG reporting, compliance questions, and more. What would you like to know?</p>
                        </div>
                    </div>
                    
                    {% if query %}
                    <div class="finchat-chat-message user">
                        <div class="finchat-chat-message-content">
                            <p>{{ query }}</p>
                        </div>
                    </div>
                    <div class="finchat-chat-message system">
                        <div class="finchat-chat-message-content">
                            <p>I'm processing your query about "{{ query }}"...</p>
                            <div class="finchat-chat-message-typing">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <form class="finchat-chat-input" id="copilotForm" action="/co-pilot" method="get">
                    <input type="text" name="query" placeholder="Ask a sustainability question..." value="{{ query }}" class="finchat-form-control">
                    <button type="submit" class="finchat-button finchat-button-primary">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="analytics-category-breakdown">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-lightbulb"></i> Suggested Questions
                </h4>
            </div>
            <div class="finchat-suggestions">
                <button class="finchat-suggestion" data-query="What are the main ESRS disclosure requirements?">
                    <i class="fas fa-file-alt"></i> What are the main ESRS disclosure requirements?
                </button>
                <button class="finchat-suggestion" data-query="How can we reduce our carbon footprint?">
                    <i class="fas fa-smog"></i> How can we reduce our carbon footprint?
                </button>
                <button class="finchat-suggestion" data-query="What ESG metrics should we track?">
                    <i class="fas fa-chart-line"></i> What ESG metrics should we track?
                </button>
                <button class="finchat-suggestion" data-query="Explain double materiality in simple terms">
                    <i class="fas fa-balance-scale"></i> Explain double materiality in simple terms
                </button>
            </div>
        </div>
    </div>
</div>

{% elif template_type == "risk_tracker" %}
<!-- Risk Tracker Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-exclamation-triangle"></i> Sustainability Risk Tracker
    </h3>
    
    <div class="analytics-overview">
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Overall Risk Score</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
            </div>
            <div class="analytics-metric-value">42.1</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-down"></i> 7.3% from last quarter
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Climate Risk</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-temperature-high"></i>
                </div>
            </div>
            <div class="analytics-metric-value">38.5</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-down"></i> 5.2% from last quarter
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Regulatory Risk</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-gavel"></i>
                </div>
            </div>
            <div class="analytics-metric-value">45.8</div>
            <div class="analytics-metric-change negative">
                <i class="fas fa-arrow-up"></i> 2.3% from last quarter
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Reputational Risk</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-comments"></i>
                </div>
            </div>
            <div class="analytics-metric-value">32.7</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-down"></i> 8.5% from last quarter
            </div>
        </div>
    </div>
    
    <div class="analytics-performance-metrics">
        <div class="analytics-performance-header">
            <h4 class="analytics-performance-title">
                <i class="fas fa-list-ul"></i> Risk Exposure Table
            </h4>
        </div>
        <table class="analytics-table">
            <thead>
                <tr>
                    <th>Risk Category</th>
                    <th>Risk Level</th>
                    <th>Exposure</th>
                    <th>Trend</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Water Scarcity</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill medium" style="width: 65%"></div>
                        </div>
                    </td>
                    <td>Medium</td>
                    <td><i class="fas fa-arrow-down" style="color: var(--fc-positive)"></i> Decreasing</td>
                    <td><span class="status warning">Monitor</span></td>
                </tr>
                <tr>
                    <td>Carbon Pricing</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill high" style="width: 85%"></div>
                        </div>
                    </td>
                    <td>High</td>
                    <td><i class="fas fa-arrow-up" style="color: var(--fc-negative)"></i> Increasing</td>
                    <td><span class="status critical">Action Needed</span></td>
                </tr>
                <tr>
                    <td>Biodiversity Loss</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill medium" style="width: 45%"></div>
                        </div>
                    </td>
                    <td>Medium</td>
                    <td><i class="fas fa-minus" style="color: var(--fc-text-secondary)"></i> Stable</td>
                    <td><span class="status warning">Monitor</span></td>
                </tr>
                <tr>
                    <td>Supply Chain</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill low" style="width: 35%"></div>
                        </div>
                    </td>
                    <td>Low</td>
                    <td><i class="fas fa-arrow-down" style="color: var(--fc-positive)"></i> Decreasing</td>
                    <td><span class="status good">Under Control</span></td>
                </tr>
                <tr>
                    <td>CSRD Compliance</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill high" style="width: 75%"></div>
                        </div>
                    </td>
                    <td>High</td>
                    <td><i class="fas fa-arrow-up" style="color: var(--fc-negative)"></i> Increasing</td>
                    <td><span class="status critical">Action Needed</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

{% elif template_type == "debug" %}
<!-- Debug Information Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-code"></i> Debug Information
    </h3>
    
    <div class="analytics-chart-card">
        <div class="analytics-chart-header">
            <h4 class="analytics-chart-title">
                <i class="fas fa-sitemap"></i> Registered Routes
            </h4>
        </div>
        <div class="analytics-chart-container" style="height: auto; padding: 20px;">
            <div class="finchat-terminal">
                <div class="finchat-terminal-header">
                    <div class="finchat-terminal-title">Routes Information</div>
                    <div class="finchat-terminal-controls">
                        <span class="finchat-terminal-control"></span>
                        <span class="finchat-terminal-control"></span>
                        <span class="finchat-terminal-control"></span>
                    </div>
                </div>
                <div class="finchat-terminal-content">
                    {% for route in routes %}
                        <div class="finchat-terminal-line">{{ route }}</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="analytics-chart-card" style="margin-top: 20px;">
        <div class="analytics-chart-header">
            <h4 class="analytics-chart-title">
                <i class="fas fa-project-diagram"></i> Navigation Structure
            </h4>
        </div>
        <div class="analytics-chart-container" style="height: auto; padding: 20px;">
            <pre class="finchat-code">{{ nav_structure | tojson(indent=2) }}</pre>
        </div>
    </div>
</div>

{% else %}
<!-- Default Analytics Dashboard Content -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-chart-pie"></i> Sustainability Performance Overview
    </h3>
    
    <div class="analytics-overview">
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Carbon Emissions</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-smog"></i>
                </div>
            </div>
            <div class="analytics-metric-value">78.5</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-down"></i> 12.3% from last quarter
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Water Usage</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-tint"></i>
                </div>
            </div>
            <div class="analytics-metric-value">62.4</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-down"></i> 8.7% from last quarter
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">Waste Generation</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-trash"></i>
                </div>
            </div>
            <div class="analytics-metric-value">45.2</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-down"></i> 5.3% from last quarter
            </div>
        </div>
        
        <div class="analytics-metric">
            <div class="analytics-metric-header">
                <div class="analytics-metric-title">ESG Score</div>
                <div class="analytics-metric-icon">
                    <i class="fas fa-star"></i>
                </div>
            </div>
            <div class="analytics-metric-value">82.7</div>
            <div class="analytics-metric-change positive">
                <i class="fas fa-arrow-up"></i> 3.5% from last quarter
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Performance Trends Chart + Insights -->
<div class="finchat-section">
    <div class="analytics-chart-row">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-chart-line"></i> Sustainability Performance Trends
                </h4>
                <div class="analytics-chart-actions">
                    <button class="finchat-button" data-timeframe="quarterly" id="quarterlyBtn">Quarterly</button>
                    <button class="finchat-button" data-timeframe="yearly" id="yearlyBtn">Yearly</button>
                </div>
            </div>
            <div class="analytics-chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
        
        <div class="analytics-insights">
            <div class="analytics-insight">
                <div class="analytics-insight-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div class="analytics-insight-content">
                    <h4>Water Efficiency Improving</h4>
                    <p>Water usage has decreased by 8.7% due to improved recycling systems and leak detection technologies.</p>
                </div>
            </div>
            
            <div class="analytics-insight">
                <div class="analytics-insight-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="analytics-insight-content">
                    <h4>Waste Management Alert</h4>
                    <p>Waste reduction progress is slowing. Consider implementing additional circular economy initiatives.</p>
                </div>
            </div>
            
            <div class="analytics-insight">
                <div class="analytics-insight-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="analytics-insight-content">
                    <h4>ESG Score Milestone</h4>
                    <p>Your ESG score has crossed into the top quartile of your industry peers. This places you in an advantageous position for sustainable finance opportunities.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Category Breakdown -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-sitemap"></i> Category Performance Breakdown
    </h3>
    
    <div class="analytics-category-breakdown">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-chart-pie"></i> Performance by Category
                </h4>
            </div>
            <div class="analytics-chart-container">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>
        
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-bullseye"></i> Target Achievement
                </h4>
            </div>
            <div class="analytics-chart-container">
                <canvas id="targetChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Performance Metrics Table -->
<div class="finchat-section">
    <div class="analytics-performance-metrics">
        <div class="analytics-performance-header">
            <h4 class="analytics-performance-title">
                <i class="fas fa-list-ul"></i> Key Performance Metrics
            </h4>
        </div>
        
        <table class="analytics-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Category</th>
                    <th>Current Value</th>
                    <th>Target</th>
                    <th>Progress</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Carbon Emissions</td>
                    <td>Environmental</td>
                    <td>78.5 tCO2e</td>
                    <td>50 tCO2e</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill medium" style="width: 65%;"></div>
                        </div>
                    </td>
                    <td><span class="status warning">In Progress</span></td>
                </tr>
                <tr>
                    <td>Water Usage</td>
                    <td>Environmental</td>
                    <td>62.4 kL</td>
                    <td>60 kL</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill high" style="width: 95%;"></div>
                        </div>
                    </td>
                    <td><span class="status good">On Track</span></td>
                </tr>
                <tr>
                    <td>Waste Generation</td>
                    <td>Environmental</td>
                    <td>45.2 tons</td>
                    <td>30 tons</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill medium" style="width: 60%;"></div>
                        </div>
                    </td>
                    <td><span class="status warning">In Progress</span></td>
                </tr>
                <tr>
                    <td>Renewable Energy</td>
                    <td>Environmental</td>
                    <td>42%</td>
                    <td>50%</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill high" style="width: 84%;"></div>
                        </div>
                    </td>
                    <td><span class="status good">On Track</span></td>
                </tr>
                <tr>
                    <td>Supply Chain ESG</td>
                    <td>Social</td>
                    <td>63%</td>
                    <td>80%</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill low" style="width: 48%;"></div>
                        </div>
                    </td>
                    <td><span class="status critical">At Risk</span></td>
                </tr>
                <tr>
                    <td>Diversity & Inclusion</td>
                    <td>Social</td>
                    <td>72%</td>
                    <td>75%</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill high" style="width: 96%;"></div>
                        </div>
                    </td>
                    <td><span class="status good">On Track</span></td>
                </tr>
                <tr>
                    <td>Board Diversity</td>
                    <td>Governance</td>
                    <td>35%</td>
                    <td>40%</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill high" style="width: 87%;"></div>
                        </div>
                    </td>
                    <td><span class="status good">On Track</span></td>
                </tr>
                <tr>
                    <td>ESG Disclosure</td>
                    <td>Governance</td>
                    <td>88%</td>
                    <td>90%</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill high" style="width: 97%;"></div>
                        </div>
                    </td>
                    <td><span class="status good">On Track</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- AI Recommendations -->
<div class="finchat-section">
    <div class="analytics-recommendations">
        <div class="analytics-recommendations-header">
            <h4 class="analytics-recommendations-title">
                <i class="fas fa-robot"></i> AI-Powered Recommendations
            </h4>
            <p class="analytics-recommendations-subtitle">
                Personalized recommendations based on your sustainability performance data
            </p>
        </div>
        
        <div class="analytics-recommendations-list">
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-industry"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Accelerate Supply Chain ESG Integration</h4>
                    <p>Your supply chain ESG performance is at risk of missing targets. Consider implementing a supplier scoring system with incentives for high ESG performance, and provide technical assistance to key suppliers in developing markets.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">High Priority</span>
                        <span class="analytics-recommendation-tag">Social</span>
                        <span class="analytics-recommendation-tag">Supply Chain</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-recycle"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Implement Circular Waste Management</h4>
                    <p>To improve waste reduction performance, consider a closed-loop material system for key waste streams and partner with specialized recycling services to handle difficult materials.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Medium Priority</span>
                        <span class="analytics-recommendation-tag">Environmental</span>
                        <span class="analytics-recommendation-tag">Waste</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-solar-panel"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Expand On-site Renewable Energy</h4>
                    <p>You're making good progress on renewable energy adoption. Consider additional on-site generation through rooftop solar PV systems to reduce grid dependency and increase resilience.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Medium Priority</span>
                        <span class="analytics-recommendation-tag">Environmental</span>
                        <span class="analytics-recommendation-tag">Energy</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set up Chart.js defaults
    Chart.defaults.color = '#a0a0a0';
    Chart.defaults.borderColor = '#333333';
    
    // Performance Trends Chart
    const performanceCtx = document.getElementById('performanceChart').getContext('2d');
    const performanceChart = new Chart(performanceCtx, {
        type: 'line',
        data: {
            labels: ['Q1', 'Q2', 'Q3', 'Q4'],
            datasets: [
                {
                    label: 'Carbon Emissions',
                    data: [95, 88, 82, 78.5],
                    borderColor: '#3dd598',
                    backgroundColor: 'rgba(61, 213, 152, 0.1)',
                    tension: 0.3,
                    borderWidth: 2,
                    fill: true
                },
                {
                    label: 'Water Usage',
                    data: [75, 72, 68, 62.4],
                    borderColor: '#34c3ff',
                    backgroundColor: 'rgba(52, 195, 255, 0.1)',
                    tension: 0.3,
                    borderWidth: 2,
                    fill: true
                },
                {
                    label: 'Waste Generation',
                    data: [52, 50, 48, 45.2],
                    borderColor: '#ffad63',
                    backgroundColor: 'rgba(255, 173, 99, 0.1)',
                    tension: 0.3,
                    borderWidth: 2,
                    fill: true
                },
                {
                    label: 'ESG Score',
                    data: [76, 78, 80, 82.7],
                    borderColor: '#ff6b81',
                    backgroundColor: 'rgba(255, 107, 129, 0.1)',
                    tension: 0.3,
                    borderWidth: 2,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: {
                        color: '#333333'
                    }
                },
                x: {
                    grid: {
                        color: '#333333'
                    }
                }
            }
        }
    });
    
    // Category Breakdown Chart
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    const categoryChart = new Chart(categoryCtx, {
        type: 'polarArea',
        data: {
            labels: ['Environmental', 'Social', 'Governance', 'Economic'],
            datasets: [{
                data: [78, 72, 85, 65],
                backgroundColor: [
                    'rgba(61, 213, 152, 0.7)',
                    'rgba(52, 195, 255, 0.7)',
                    'rgba(255, 173, 99, 0.7)',
                    'rgba(255, 107, 129, 0.7)'
                ],
                borderColor: [
                    'rgba(61, 213, 152, 1)',
                    'rgba(52, 195, 255, 1)',
                    'rgba(255, 173, 99, 1)',
                    'rgba(255, 107, 129, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    grid: {
                        color: '#333333'
                    },
                    ticks: {
                        backdropColor: 'rgba(0, 0, 0, 0)',
                        z: 1
                    }
                }
            }
        }
    });
    
    // Target Achievement Chart
    const targetCtx = document.getElementById('targetChart').getContext('2d');
    const targetChart = new Chart(targetCtx, {
        type: 'radar',
        data: {
            labels: ['Carbon', 'Water', 'Waste', 'Energy', 'Supply Chain', 'Diversity', 'Governance'],
            datasets: [
                {
                    label: 'Current Performance',
                    data: [65, 95, 60, 84, 48, 96, 92],
                    backgroundColor: 'rgba(61, 213, 152, 0.2)',
                    borderColor: 'rgba(61, 213, 152, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(61, 213, 152, 1)',
                    pointRadius: 4
                },
                {
                    label: 'Target',
                    data: [100, 100, 100, 100, 100, 100, 100],
                    backgroundColor: 'rgba(52, 195, 255, 0.0)',
                    borderColor: 'rgba(52, 195, 255, 0.5)',
                    borderWidth: 1,
                    borderDash: [5, 5],
                    pointBackgroundColor: 'rgba(52, 195, 255, 0)',
                    pointRadius: 0
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    max: 100,
                    min: 0,
                    ticks: {
                        backdropColor: 'rgba(0, 0, 0, 0)',
                        stepSize: 20
                    },
                    grid: {
                        color: '#333333'
                    },
                    angleLines: {
                        color: '#333333'
                    }
                }
            }
        }
    });
    
    // Timeframe selection for performance chart
    document.getElementById('quarterlyBtn').addEventListener('click', function() {
        performanceChart.data.labels = ['Q1', 'Q2', 'Q3', 'Q4'];
        performanceChart.data.datasets[0].data = [95, 88, 82, 78.5]; // Carbon
        performanceChart.data.datasets[1].data = [75, 72, 68, 62.4]; // Water
        performanceChart.data.datasets[2].data = [52, 50, 48, 45.2]; // Waste
        performanceChart.data.datasets[3].data = [76, 78, 80, 82.7]; // ESG
        
        this.classList.add('active');
        document.getElementById('yearlyBtn').classList.remove('active');
        
        performanceChart.update();
    });
    
    document.getElementById('yearlyBtn').addEventListener('click', function() {
        performanceChart.data.labels = ['2021', '2022', '2023', '2024'];
        performanceChart.data.datasets[0].data = [110, 100, 88, 78.5]; // Carbon
        performanceChart.data.datasets[1].data = [90, 82, 70, 62.4]; // Water
        performanceChart.data.datasets[2].data = [65, 58, 50, 45.2]; // Waste
        performanceChart.data.datasets[3].data = [70, 74, 78, 82.7]; // ESG
        
        this.classList.add('active');
        document.getElementById('quarterlyBtn').classList.remove('active');
        
        performanceChart.update();
    });
    
    // Initialize with quarterly data
    document.getElementById('quarterlyBtn').classList.add('active');
    
    // Monetization Charts - only initialize if elements exist
    // Chart initializations moved to additional_scripts block
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#a0a0a0'
                        }
                    }
                }
            }
        });
    }
    
    // ROI Chart initialization moved to additional_scripts block
    
    // Copilot Suggestion Buttons
    const suggestionButtons = document.querySelectorAll('.finchat-suggestion');
    suggestionButtons.forEach(button => {
        button.addEventListener('click', function() {
            const query = this.getAttribute('data-query');
            document.querySelector('input[name="query"]').value = query;
            document.getElementById('copilotForm').submit();
        });
    });
});
</script>
{% endblock %}

{% block additional_scripts %}
{% if template_type == "documents" %}
<script>
// Document analysis functions
function generateFullAnalysis(documentId) {
    if (!documentId) return;
    
    // Show loading indicator in the insights section
    const insightsContainer = document.getElementById('documentInsights');
    const originalContent = insightsContainer.innerHTML;
    insightsContainer.innerHTML = `
        <div class="finchat-loading-state">
            <div class="finchat-spinner"></div>
            <p>Generating comprehensive analysis...</p>
        </div>
    `;
    
    // Call the analysis API endpoint
    fetch(`/data-moat/api/document-compliance/${documentId}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                insightsContainer.innerHTML = `
                    <div class="finchat-error-state">
                        <i class="fas fa-exclamation-circle fa-3x"></i>
                        <p>Error generating analysis: ${data.error}</p>
                        <button class="finchat-button finchat-button-secondary" onclick="resetInsightsContainer('${originalContent}')">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                    </div>
                `;
                return;
            }
            
            // Build the analysis UI
            let html = `
                <div class="document-full-analysis">
                    <div class="analysis-header">
                        <h5><i class="fas fa-clipboard-check"></i> Compliance Assessment</h5>
                    </div>
                    <div class="analysis-content">
            `;
            
            // Add framework compliance sections
            if (data.frameworks && Object.keys(data.frameworks).length > 0) {
                Object.entries(data.frameworks).forEach(([frameworkId, frameworkData]) => {
                    html += `
                        <div class="framework-section">
                            <h6>${frameworkId.toUpperCase()} Compliance</h6>
                            <div class="compliance-score">
                                <div class="score-chart" style="--score: ${frameworkData.score || 0}%">
                                    <span>${frameworkData.score || 0}%</span>
                                </div>
                                <div class="score-details">
                                    <p class="score-label">${frameworkData.level || 'Not assessed'}</p>
                                    <p class="score-description">${frameworkData.summary || 'No summary available'}</p>
                                </div>
                            </div>
                    `;
                    
                    // Add categories if available
                    if (frameworkData.categories && Object.keys(frameworkData.categories).length > 0) {
                        html += `<div class="framework-categories">`;
                        Object.entries(frameworkData.categories).forEach(([categoryId, categoryData]) => {
                            const categoryScore = categoryData.score || 0;
                            const scoreClass = categoryScore > 70 ? 'high' : (categoryScore > 40 ? 'medium' : 'low');
                            
                            html += `
                                <div class="framework-category">
                                    <div class="category-name">${categoryData.name || categoryId}</div>
                                    <div class="category-progress-bar">
                                        <div class="category-progress ${scoreClass}" style="width: ${categoryScore}%"></div>
                                    </div>
                                    <div class="category-score">${categoryScore}%</div>
                                </div>
                            `;
                        });
                        html += `</div>`;
                    }
                    
                    html += `</div>`;
                });
            } else {
                html += `
                    <div class="no-frameworks">
                        <p>No framework compliance data available for this document.</p>
                    </div>
                `;
            }
            
            html += `
                    </div>
                    <div class="analysis-actions">
                        <button class="finchat-button finchat-button-secondary" onclick="resetInsightsContainer('${originalContent}')">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                    </div>
                </div>
            `;
            
            insightsContainer.innerHTML = html;
        })
        .catch(error => {
            console.error('Error generating analysis:', error);
            insightsContainer.innerHTML = `
                <div class="finchat-error-state">
                    <i class="fas fa-exclamation-circle fa-3x"></i>
                    <p>Error connecting to analysis service</p>
                    <button class="finchat-button finchat-button-secondary" onclick="resetInsightsContainer('${originalContent}')">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>
            `;
        });
}

function exportAnalysisReport(documentId) {
    if (!documentId) return;
    
    // Redirect to report generation endpoint
    window.location.href = `/data-moat/api/generate-report/${documentId}`;
}

function resetInsightsContainer(content) {
    const insightsContainer = document.getElementById('documentInsights');
    insightsContainer.innerHTML = content;
}

// Add these styles for the analysis UI
document.addEventListener('DOMContentLoaded', function() {
    const style = document.createElement('style');
    style.textContent = `
        .document-full-analysis {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .analysis-header {
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .analysis-header h5 {
            margin: 0;
            color: #e2e8f0;
        }
        
        .framework-section {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .framework-section h6 {
            margin: 0 0 15px 0;
            color: #e2e8f0;
            font-weight: 600;
        }
        
        .compliance-score {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .score-chart {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(
                #3b82f6 0% calc(var(--score)),
                rgba(255, 255, 255, 0.1) calc(var(--score)) 100%
            );
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
        }
        
        .score-chart::before {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(30, 41, 59, 0.8);
        }
        
        .score-chart span {
            position: relative;
            z-index: 1;
            color: #e2e8f0;
            font-weight: bold;
        }
        
        .score-details {
            flex: 1;
        }
        
        .score-label {
            font-weight: 600;
            color: #e2e8f0;
            margin: 0 0 5px 0;
        }
        
        .score-description {
            color: #94a3b8;
            font-size: 0.85rem;
            margin: 0;
        }
        
        .framework-categories {
            margin-top: 15px;
        }
        
        .framework-category {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .category-name {
            flex: 0 0 30%;
            color: #cbd5e1;
            font-size: 0.85rem;
        }
        
        .category-progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 10px;
        }
        
        .category-progress {
            height: 100%;
            border-radius: 4px;
        }
        
        .category-progress.high {
            background: #10b981;
        }
        
        .category-progress.medium {
            background: #f59e0b;
        }
        
        .category-progress.low {
            background: #ef4444;
        }
        
        .category-score {
            flex: 0 0 40px;
            text-align: right;
            color: #cbd5e1;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .no-frameworks {
            text-align: center;
            padding: 30px 0;
            color: #94a3b8;
        }
        
        .analysis-actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
        }
        
        .finchat-loading-state {
            text-align: center;
            padding: 40px 0;
            color: #94a3b8;
        }
        
        .finchat-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--fc-primary);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .finchat-error-state {
            text-align: center;
            padding: 40px 0;
            color: #ef4444;
        }
    `;
    document.head.appendChild(style);
});
</script>
{% elif template_type == "trends" %}
<script src="https://cdn.plot.ly/plotly-2.29.0.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Sankey Diagram if element exists
    if (document.getElementById('sankeyDiagram')) {
        // Sankey diagram data
        const sankeyData = {
            type: "sankey",
            orientation: "h",
            node: {
                pad: 15,
                thickness: 20,
                line: {
                    color: "black",
                    width: 0.5
                },
                label: [
                    "Social Media", "News Sources", "Industry Reports", 
                    "ESG Metrics", "Emissions", "Water", "Waste", "Energy", "Social",
                    "Regulatory Compliance", "Operational Efficiency", "Reputation Management",
                    "Carbon Reduction", "Sustainability Innovation", "Risk Mitigation"
                ],
                color: [
                    "#4CAF50", "#2196F3", "#9C27B0",
                    "#FF9800", "#F44336", "#00BCD4", "#8BC34A", "#FFC107", "#9E9E9E",
                    "#3F51B5", "#009688", "#E91E63",
                    "#673AB7", "#CDDC39", "#795548"
                ]
            },
            link: {
                source: [
                    // From Sources to Metrics
                    0, 0, 0, 1, 1, 1, 2, 2, 2,
                    // From Metrics to Categories
                    3, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8,
                    // From Categories to Outcomes
                    9, 9, 10, 10, 11, 11, 11
                ],
                target: [
                    // To Metrics
                    3, 4, 8, 3, 6, 7, 3, 5, 7,
                    // To Categories
                    9, 10, 11, 9, 12, 10, 13, 10, 13, 10, 12, 11, 14,
                    // To Outcomes
                    12, 14, 12, 13, 12, 13, 14
                ],
                value: [
                    // Source to Metrics values
                    20, 15, 5, 15, 10, 5, 25, 15, 10,
                    // Metrics to Categories values
                    15, 20, 25, 10, 5, 10, 5, 5, 5, 5, 5, 10, 5,
                    // Categories to Outcomes values
                    10, 5, 5, 10, 5, 10, 5
                ],
                color: [
                    // Colors can be customized or left default
                    "#4CAF5080", "#4CAF5080", "#4CAF5080", 
                    "#2196F380", "#2196F380", "#2196F380",
                    "#9C27B080", "#9C27B080", "#9C27B080",
                    
                    "#FF980080", "#FF980080", "#FF980080",
                    "#F4433680", "#F4433680", "#00BCD480", 
                    "#00BCD480", "#8BC34A80", "#8BC34A80",
                    "#FFC10780", "#FFC10780", "#9E9E9E80", "#9E9E9E80",
                    
                    "#3F51B580", "#3F51B580", "#00968880", 
                    "#00968880", "#E91E6380", "#E91E6380", "#E91E6380"
                ]
            }
        };

        const data = [sankeyData];

        const layout = {
            title: null,
            font: {
                size: 12,
                color: '#888'
            },
            plot_bgcolor: 'transparent',
            paper_bgcolor: 'transparent',
            margin: {
                l: 0,
                r: 0,
                b: 15,
                t: 15
            }
        };

        Plotly.newPlot('sankeyDiagram', data, layout, {responsive: true});
    }
    
    // Initialize Social Impact Chart if element exists
    if (document.getElementById('socialImpactChart')) {
        const data = {
            labels: ['LinkedIn', 'X (Twitter)', 'Reddit', 'Industry Forums', 'News Sites'],
            datasets: [{
                label: 'Mentions',
                data: [845, 1240, 512, 385, 678],
                backgroundColor: [
                    'rgba(10, 102, 194, 0.7)',  // LinkedIn blue
                    'rgba(29, 161, 242, 0.7)',  // Twitter blue
                    'rgba(255, 69, 0, 0.7)',    // Reddit orange
                    'rgba(75, 192, 192, 0.7)',  // Teal
                    'rgba(153, 102, 255, 0.7)'  // Purple
                ],
                borderColor: [
                    'rgba(10, 102, 194, 1)',
                    'rgba(29, 161, 242, 1)',
                    'rgba(255, 69, 0, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)'
                ],
                borderWidth: 1
            }]
        };
        
        const config = {
            type: 'bar',
            data: data,
            options: {
                indexAxis: 'y',
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Mentions: ${context.raw}`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#888'
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: '#888'
                        }
                    }
                },
                responsive: true,
                maintainAspectRatio: false
            }
        };
        
        new Chart(document.getElementById('socialImpactChart'), config);
    }
    
    // Handle refresh button for trending topics
    if (document.getElementById('refreshTopicsBtn')) {
        document.getElementById('refreshTopicsBtn').addEventListener('click', function() {
            this.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Updating...';
            
            // Simulate refreshing data (would be an API call in production)
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh';
                // Show a toast notification
                const toast = document.createElement('div');
                toast.className = 'finchat-toast finchat-toast-success';
                toast.innerHTML = `
                    <div class="finchat-toast-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="finchat-toast-content">
                        <h4>Updated Successfully</h4>
                        <p>Trending topics have been refreshed with the latest data.</p>
                    </div>
                    <button class="finchat-toast-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                document.body.appendChild(toast);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.classList.add('finchat-toast-hide');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 5000);
                
                // Close button
                toast.querySelector('.finchat-toast-close').addEventListener('click', function() {
                    toast.classList.add('finchat-toast-hide');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                });
            }, 1500);
        });
    }
});
</script>

<style>
.finchat-toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: var(--fc-bg-card);
    border-left: 4px solid var(--fc-primary);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-radius: var(--fc-radius);
    padding: 16px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
    z-index: 9999;
    max-width: 350px;
    animation: slide-in 0.3s ease;
}

.finchat-toast-success {
    border-left-color: var(--fc-positive);
}

.finchat-toast-icon {
    color: var(--fc-positive);
    font-size: 1.5rem;
}

.finchat-toast-content {
    flex: 1;
}

.finchat-toast-content h4 {
    margin: 0 0 4px 0;
    font-size: 1rem;
}

.finchat-toast-content p {
    margin: 0;
    font-size: 0.85rem;
    color: var(--fc-text-secondary);
}

.finchat-toast-close {
    background: none;
    border: none;
    color: var(--fc-text-secondary);
    cursor: pointer;
    padding: 0;
    font-size: 0.9rem;
}

.finchat-toast-hide {
    animation: slide-out 0.3s ease forwards;
}

@keyframes slide-in {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes slide-out {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
}
</style>
{% elif template_type == "monetization" %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Monetization Charts
    if (document.getElementById('monetizationPieChart')) {
        const monetizationPieCtx = document.getElementById('monetizationPieChart').getContext('2d');
        const monetizationPieChart = new Chart(monetizationPieCtx, {
            type: 'pie',
            data: {
                labels: ['Data Products', 'Advisory Services', 'Certification', 'Training', 'Analytics Tools'],
                datasets: [{
                    data: [35, 25, 15, 10, 15],
                    backgroundColor: [
                        'rgba(61, 213, 152, 0.8)',
                        'rgba(52, 195, 255, 0.8)',
                        'rgba(255, 107, 129, 0.8)',
                        'rgba(255, 173, 99, 0.8)',
                        'rgba(157, 78, 221, 0.8)'
                    ],
                    borderColor: 'rgba(18, 18, 18, 0.5)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#a0a0a0'
                        }
                    }
                }
            }
        });
    }
    
    // ROI Chart initialization
    if (document.getElementById('roiChart')) {
        const roiCtx = document.getElementById('roiChart').getContext('2d');
        const roiChart = new Chart(roiCtx, {
            type: 'line',
            data: {
                labels: ['Month 1', 'Month 3', 'Month 6', 'Month 9', 'Month 12', 'Month 18'],
                datasets: [{
                    label: 'Data Products',
                    data: [0, 5, 25, 45, 85, 180],
                    borderColor: 'rgba(61, 213, 152, 1)',
                    backgroundColor: 'rgba(61, 213, 152, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Advisory Services',
                    data: [0, 15, 35, 55, 80, 130],
                    borderColor: 'rgba(52, 195, 255, 1)',
                    backgroundColor: 'rgba(52, 195, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Certification',
                    data: [0, 2, 10, 25, 70, 160],
                    borderColor: 'rgba(255, 107, 129, 1)',
                    backgroundColor: 'rgba(255, 107, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#a0a0a0'
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#a0a0a0'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#a0a0a0'
                        }
                    }
                }
            }
        });
    }
});
</script>
{% endif %}
{% endblock %}