{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}Document Upload - SustainaTrend™{% endblock %}

{% block header_title %}Document Analysis{% endblock %}

{% block header_actions %}
<span class="finchat-badge finchat-badge-primary">PDF & Reports</span>
{% endblock %}

{% block additional_styles %}
<style>
    .upload-container {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-xl);
        text-align: center;
        margin-bottom: var(--fc-spacing-lg);
        position: relative;
    }
    
    .upload-container.drag-over {
        border-color: var(--fc-primary);
        background-color: rgba(var(--primary-rgb), 0.05);
    }
    
    .upload-icon {
        font-size: 3rem;
        color: var(--fc-text-secondary);
        margin-bottom: var(--fc-spacing-md);
    }
    
    .upload-container.drag-over .upload-icon {
        color: var(--fc-primary);
    }
    
    .upload-title {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .upload-description {
        color: var(--fc-text-secondary);
        margin-bottom: var(--fc-spacing-lg);
        max-width: 500px;
        margin: 0 auto var(--fc-spacing-lg) auto;
    }
    
    .upload-btn {
        background-color: var(--fc-primary);
        color: #000;
        border: none;
        padding: 10px 20px;
        border-radius: var(--fc-radius);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .upload-btn:hover {
        background-color: var(--fc-primary-hover);
    }
    
    .upload-input {
        display: none;
    }
    
    .file-info {
        margin-top: var(--fc-spacing-lg);
        text-align: left;
        padding: var(--fc-spacing-md);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        background-color: var(--fc-bg-tertiary);
        display: none;
    }
    
    .file-info.show {
        display: block;
    }
    
    .file-name {
        font-weight: 600;
        margin-bottom: var(--fc-spacing-sm);
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-sm);
    }
    
    .file-detail {
        font-size: 0.9rem;
        color: var(--fc-text-secondary);
        margin-bottom: var(--fc-spacing-xs);
    }
    
    .file-progress {
        height: 4px;
        background-color: var(--fc-bg-hover);
        border-radius: 2px;
        margin: var(--fc-spacing-sm) 0;
        overflow: hidden;
    }
    
    .file-progress-bar {
        height: 100%;
        background-color: var(--fc-primary);
        width: 0%;
        transition: width 0.3s;
    }
    
    .file-actions {
        display: flex;
        justify-content: space-between;
        margin-top: var(--fc-spacing-md);
    }
    
    .drag-message {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(var(--primary-rgb), 0.05);
        border: 2px dashed var(--fc-primary);
        border-radius: var(--fc-radius);
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--fc-primary);
    }
    
    .upload-container.drag-over .drag-message {
        display: flex;
    }
    
    .recent-documents {
        margin-top: var(--fc-spacing-xl);
    }
    
    .document-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: var(--fc-spacing-md);
        margin-top: var(--fc-spacing-md);
    }
    
    .document-card {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        transition: all 0.2s;
    }
    
    .document-card:hover {
        border-color: var(--fc-primary);
        box-shadow: var(--fc-shadow);
    }
    
    .document-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .document-type {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
    }
    
    .document-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--fc-primary-light);
        color: var(--fc-primary);
        border-radius: 4px;
    }
    
    .document-title {
        font-weight: 600;
        margin-bottom: var(--fc-spacing-xs);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .document-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .document-frameworks {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: var(--fc-spacing-sm);
    }
    
    .document-framework {
        background-color: var(--fc-bg-hover);
        color: var(--fc-text-secondary);
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 4px;
    }
    
    .document-actions {
        display: flex;
        justify-content: flex-end;
        gap: var(--fc-spacing-xs);
        margin-top: var(--fc-spacing-md);
    }
    
    .processing-steps {
        margin-top: var(--fc-spacing-lg);
        margin-bottom: var(--fc-spacing-xl);
    }
    
    .steps-container {
        display: flex;
        justify-content: space-between;
        margin-top: var(--fc-spacing-md);
        position: relative;
    }
    
    .step {
        flex: 1;
        text-align: center;
        position: relative;
        z-index: 2;
    }
    
    .step-connector {
        position: absolute;
        height: 2px;
        background-color: var(--fc-border);
        top: 16px;
        left: 10%;
        right: 10%;
        z-index: 1;
    }
    
    .step-progress {
        position: absolute;
        height: 2px;
        background-color: var(--fc-primary);
        top: 16px;
        left: 10%;
        width: 0%;
        z-index: 1;
        transition: width 0.5s;
    }
    
    .step-icon {
        width: 32px;
        height: 32px;
        background-color: var(--fc-bg-hover);
        border: 2px solid var(--fc-border);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--fc-spacing-sm) auto;
        transition: all 0.3s;
    }
    
    .step.active .step-icon {
        background-color: var(--fc-primary-light);
        border-color: var(--fc-primary);
        color: var(--fc-primary);
    }
    
    .step.completed .step-icon {
        background-color: var(--fc-primary);
        border-color: var(--fc-primary);
        color: #000;
    }
    
    .step-label {
        font-size: 0.85rem;
        font-weight: 500;
        margin-bottom: var(--fc-spacing-xs);
    }
    
    .step.active .step-label {
        color: var(--fc-primary);
    }
    
    .step-description {
        font-size: 0.75rem;
        color: var(--fc-text-secondary);
    }
    
    .compliance-summary {
        display: none;
        margin-top: var(--fc-spacing-xl);
    }
    
    .compliance-summary.show {
        display: block;
    }
    
    .compliance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: var(--fc-spacing-md);
        margin-top: var(--fc-spacing-md);
    }
    
    .compliance-card {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
    }
    
    .compliance-header {
        display: flex;
        align-items: center;
        gap: var(--fc-spacing-sm);
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .compliance-icon {
        width: 24px;
        height: 24px;
        background-color: var(--fc-primary-light);
        color: var(--fc-primary);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .compliance-title {
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    .compliance-score {
        font-size: 1.5rem;
        font-weight: 700;
        margin: var(--fc-spacing-sm) 0;
    }
    
    .compliance-level {
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
    }
    
    .compliance-chart {
        height: 4px;
        background-color: var(--fc-bg-hover);
        border-radius: 2px;
        margin-top: var(--fc-spacing-sm);
        overflow: hidden;
    }
    
    .compliance-chart-fill {
        height: 100%;
        background-color: var(--fc-primary);
    }
</style>
{% endblock %}

{% block main_content %}
<div class="finchat-section">
    <div class="upload-container" id="uploadContainer">
        <div class="upload-icon">
            <i class="fas fa-file-upload"></i>
        </div>
        <h2 class="upload-title">Upload Sustainability Documents</h2>
        <p class="upload-description">
            Upload your sustainability reports, ESG disclosures, or regulatory compliance documents for AI-powered analysis and insights.
        </p>
        <button class="upload-btn" id="uploadBtn">Choose File</button>
        <input type="file" class="upload-input" id="fileInput" accept=".pdf,.docx,.doc,.txt">
        <div class="drag-message">
            <div>Drop your file here</div>
        </div>
    </div>

    <div class="file-info" id="fileInfo">
        <div class="file-name">
            <i class="fas fa-file-pdf"></i>
            <span id="fileName">document.pdf</span>
        </div>
        <div class="file-detail">
            <span id="fileSize">4.2 MB</span> • <span id="filePages">32 pages</span>
        </div>
        <div class="file-progress">
            <div class="file-progress-bar" id="fileProgressBar"></div>
        </div>
        <div class="file-actions">
            <button class="finchat-button" id="cancelUploadBtn">
                <i class="fas fa-times"></i> Cancel
            </button>
            <button class="finchat-button-primary" id="startAnalysisBtn">
                <i class="fas fa-chart-bar"></i> Start Analysis
            </button>
        </div>
    </div>
    
    <div class="processing-steps" id="processingSteps" style="display: none;">
        <h3 class="finchat-section-title">
            <i class="fas fa-tasks"></i> Processing Document
        </h3>
        
        <div class="steps-container">
            <div class="step-connector"></div>
            <div class="step-progress" id="stepsProgress"></div>
            
            <div class="step active" data-step="1">
                <div class="step-icon">
                    <i class="fas fa-file-import"></i>
                </div>
                <div class="step-label">Extract Text</div>
                <div class="step-description">Extracting content from document</div>
            </div>
            
            <div class="step" data-step="2">
                <div class="step-icon">
                    <i class="fas fa-search"></i>
                </div>
                <div class="step-label">Analyze Content</div>
                <div class="step-description">Identifying key metrics and topics</div>
            </div>
            
            <div class="step" data-step="3">
                <div class="step-icon">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <div class="step-label">Assess Compliance</div>
                <div class="step-description">Evaluating framework alignment</div>
            </div>
            
            <div class="step" data-step="4">
                <div class="step-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div class="step-label">Generate Insights</div>
                <div class="step-description">Creating actionable recommendations</div>
            </div>
        </div>
    </div>
    
    <div class="compliance-summary" id="complianceSummary">
        <h3 class="finchat-section-title">
            <i class="fas fa-clipboard-check"></i> Compliance Assessment
        </h3>
        
        <div class="compliance-grid">
            <div class="compliance-card">
                <div class="compliance-header">
                    <div class="compliance-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div class="compliance-title">ESRS</div>
                </div>
                <div class="compliance-score">78%</div>
                <div class="compliance-level">Strong Compliance</div>
                <div class="compliance-chart">
                    <div class="compliance-chart-fill" style="width: 78%;"></div>
                </div>
            </div>
            
            <div class="compliance-card">
                <div class="compliance-header">
                    <div class="compliance-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div class="compliance-title">GRI</div>
                </div>
                <div class="compliance-score">85%</div>
                <div class="compliance-level">Excellent Compliance</div>
                <div class="compliance-chart">
                    <div class="compliance-chart-fill" style="width: 85%;"></div>
                </div>
            </div>
            
            <div class="compliance-card">
                <div class="compliance-header">
                    <div class="compliance-icon">
                        <i class="fas fa-temperature-high"></i>
                    </div>
                    <div class="compliance-title">TCFD</div>
                </div>
                <div class="compliance-score">63%</div>
                <div class="compliance-level">Moderate Compliance</div>
                <div class="compliance-chart">
                    <div class="compliance-chart-fill" style="width: 63%;"></div>
                </div>
            </div>
            
            <div class="compliance-card">
                <div class="compliance-header">
                    <div class="compliance-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="compliance-title">SFDR</div>
                </div>
                <div class="compliance-score">72%</div>
                <div class="compliance-level">Strong Compliance</div>
                <div class="compliance-chart">
                    <div class="compliance-chart-fill" style="width: 72%;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="recent-documents">
        <h3 class="finchat-section-title">
            <i class="fas fa-history"></i> Recent Documents
        </h3>
        
        <div class="document-grid">
            <div class="document-card">
                <div class="document-header">
                    <div class="document-type">
                        <div class="document-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <span>Sustainability Report</span>
                    </div>
                    <span class="finchat-badge finchat-badge-primary">New</span>
                </div>
                <div class="document-title">Annual Sustainability Report 2024</div>
                <div class="document-meta">
                    <div>32 pages</div>
                    <div>Uploaded: 2 days ago</div>
                </div>
                <div class="document-frameworks">
                    <div class="document-framework">ESRS</div>
                    <div class="document-framework">GRI</div>
                    <div class="document-framework">TCFD</div>
                </div>
                <div class="document-actions">
                    <button class="finchat-button-icon" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="finchat-button-icon" title="View Analysis">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="finchat-button-icon" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="document-card">
                <div class="document-header">
                    <div class="document-type">
                        <div class="document-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <span>ESG Disclosure</span>
                    </div>
                </div>
                <div class="document-title">Quarterly ESG Performance Report</div>
                <div class="document-meta">
                    <div>15 pages</div>
                    <div>Uploaded: 1 week ago</div>
                </div>
                <div class="document-frameworks">
                    <div class="document-framework">SFDR</div>
                    <div class="document-framework">ESRS</div>
                </div>
                <div class="document-actions">
                    <button class="finchat-button-icon" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="finchat-button-icon" title="View Analysis">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="finchat-button-icon" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="document-card">
                <div class="document-header">
                    <div class="document-type">
                        <div class="document-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <span>Climate Report</span>
                    </div>
                </div>
                <div class="document-title">Climate Risk Assessment 2024</div>
                <div class="document-meta">
                    <div>28 pages</div>
                    <div>Uploaded: 2 weeks ago</div>
                </div>
                <div class="document-frameworks">
                    <div class="document-framework">TCFD</div>
                    <div class="document-framework">CDP</div>
                </div>
                <div class="document-actions">
                    <button class="finchat-button-icon" title="Download">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="finchat-button-icon" title="View Analysis">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="finchat-button-icon" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block insights_panel %}
<div class="finchat-insights-header">
    <h3>Document Analysis Insights</h3>
</div>
<div class="finchat-insights-content">
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-lightbulb"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Most Recent Upload</h4>
            <p>Your Annual Sustainability Report 2024 has strong ESRS compliance (78%) but could be improved in the biodiversity disclosures section.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Carbon Metrics Trend</h4>
            <p>Your Scope 1 & 2 emissions have decreased by 15% since your last report, showing strong progress toward your 2030 targets.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>CSRD Readiness Alert</h4>
            <p>Your current reporting is missing key CSRD requirements in social metrics and governance disclosures needed for the 2025 deadline.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-medal"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Industry Benchmark</h4>
            <p>Your sustainability reporting is in the top 25% of your industry peers, with particularly strong climate-related financial disclosures.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Upload functionality
        const uploadContainer = document.getElementById('uploadContainer');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const filePages = document.getElementById('filePages');
        const fileProgressBar = document.getElementById('fileProgressBar');
        const cancelUploadBtn = document.getElementById('cancelUploadBtn');
        const startAnalysisBtn = document.getElementById('startAnalysisBtn');
        const processingSteps = document.getElementById('processingSteps');
        const stepsProgress = document.getElementById('stepsProgress');
        const complianceSummary = document.getElementById('complianceSummary');
        
        // File upload trigger
        uploadBtn.addEventListener('click', function() {
            fileInput.click();
        });
        
        // File selection handler
        fileInput.addEventListener('change', function(e) {
            if (fileInput.files.length > 0) {
                handleFile(fileInput.files[0]);
            }
        });
        
        // Drag and drop functionality
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadContainer.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadContainer.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadContainer.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            uploadContainer.classList.add('drag-over');
        }
        
        function unhighlight() {
            uploadContainer.classList.remove('drag-over');
        }
        
        uploadContainer.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }
        
        function handleFile(file) {
            // Display file information
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            
            // Simulate getting page count (would be done server-side)
            const estimatedPages = Math.floor(file.size / 50000) + 1;
            filePages.textContent = `${estimatedPages} pages (estimated)`;
            
            // Show file info panel
            fileInfo.classList.add('show');
            
            // Simulate upload progress
            let progress = 0;
            const interval = setInterval(function() {
                progress += 5;
                fileProgressBar.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Cancel upload
        cancelUploadBtn.addEventListener('click', function() {
            fileInfo.classList.remove('show');
            fileInput.value = '';
            fileProgressBar.style.width = '0%';
        });
        
        // Start analysis
        startAnalysisBtn.addEventListener('click', function() {
            // Hide file info and show processing steps
            fileInfo.classList.remove('show');
            processingSteps.style.display = 'block';
            
            // Simulate processing steps
            const steps = document.querySelectorAll('.step');
            let currentStep = 0;
            
            function processNextStep() {
                if (currentStep > 0) {
                    // Mark previous step as completed
                    steps[currentStep - 1].classList.remove('active');
                    steps[currentStep - 1].classList.add('completed');
                }
                
                if (currentStep < steps.length) {
                    // Set current step as active
                    steps[currentStep].classList.add('active');
                    
                    // Update progress bar
                    const progressPercentage = (currentStep / (steps.length - 1)) * 100;
                    stepsProgress.style.width = `${progressPercentage}%`;
                    
                    currentStep++;
                    
                    // Process next step after delay
                    setTimeout(processNextStep, 2000);
                } else {
                    // All steps completed
                    setTimeout(function() {
                        // Hide processing steps and show compliance summary
                        processingSteps.style.display = 'none';
                        complianceSummary.classList.add('show');
                    }, 1000);
                }
            }
            
            // Start processing
            processNextStep();
        });
    });
</script>
{% endblock %}