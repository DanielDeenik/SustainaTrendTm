{% extends "layouts/collapsible_layout.html" %}

{% block title %}Sustainability Stories | SustainaTrendâ„¢ Platform{% endblock %}

{% block header_title %}Sustainability Stories & Insights{% endblock %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/story-components.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/card-components.css') }}">
{% endblock %}

{% block content %}
<div class="st-container">
    <div class="st-grid-layout">
        <div class="st-section">
            <div class="st-card">
                <div class="st-card-header">
                    <h2>Featured Stories</h2>
                    <div class="st-card-actions">
                        <button class="st-btn-icon" title="Refresh Stories">
                            <span class="material-icons">refresh</span>
                        </button>
                        <div class="st-select-wrapper">
                            <select id="story-category-filter" class="st-select">
                                <option value="all">All Categories</option>
                                <option value="climate">Climate Action</option>
                                <option value="social">Social Impact</option>
                                <option value="governance">Governance</option>
                                <option value="innovation">Innovation</option>
                                <option value="circular">Circular Economy</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="st-card-content">
                    <div class="st-stories-grid">
                        {% for story in stories %}
                        <div class="st-story-card" data-category="{{ story.category }}">
                            <div class="st-story-category">{{ story.category }}</div>
                            <h3 class="st-story-title">{{ story.title }}</h3>
                            <p class="st-story-summary">{{ story.summary }}</p>
                            <div class="st-story-meta">
                                <span class="st-story-date">{{ story.publication_date }}</span>
                                <span class="st-story-source">{{ story.source }}</span>
                            </div>
                            <div class="st-story-metrics">
                                <div class="st-story-metric">
                                    <span class="material-icons">trending_up</span>
                                    <span>{{ story.trend_score }}</span>
                                </div>
                                <div class="st-story-metric">
                                    <span class="material-icons">sentiment_very_satisfied</span>
                                    <span>{{ story.sentiment_score }}</span>
                                </div>
                            </div>
                            <div class="st-story-actions">
                                <button class="st-btn text">Read More</button>
                                <button class="st-btn text" data-story-id="{{ story.id }}">Generate Insights</button>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- Fallback for when no stories are available -->
                        {% if not stories or stories|length == 0 %}
                        <div class="st-story-card">
                            <div class="st-story-category">Climate Action</div>
                            <h3 class="st-story-title">Renewable Energy Milestone Reached</h3>
                            <p class="st-story-summary">Global renewable energy capacity exceeded fossil fuel installations for the first time, marking a significant milestone in the transition to sustainable energy sources.</p>
                            <div class="st-story-meta">
                                <span class="st-story-date">March 10, 2025</span>
                                <span class="st-story-source">CleanEnergyMonitor</span>
                            </div>
                            <div class="st-story-metrics">
                                <div class="st-story-metric">
                                    <span class="material-icons">trending_up</span>
                                    <span>94%</span>
                                </div>
                                <div class="st-story-metric">
                                    <span class="material-icons">sentiment_very_satisfied</span>
                                    <span>0.82</span>
                                </div>
                            </div>
                            <div class="st-story-actions">
                                <button class="st-btn text">Read More</button>
                                <button class="st-btn text" data-story-id="demo1">Generate Insights</button>
                            </div>
                        </div>
                        
                        <div class="st-story-card">
                            <div class="st-story-category">Social Impact</div>
                            <h3 class="st-story-title">Leading Companies Launch Inclusive Supply Chain Initiative</h3>
                            <p class="st-story-summary">A coalition of Fortune 500 companies announced a groundbreaking initiative to ensure fair labor practices and diversity across global supply chains.</p>
                            <div class="st-story-meta">
                                <span class="st-story-date">March 5, 2025</span>
                                <span class="st-story-source">SocialImpactNews</span>
                            </div>
                            <div class="st-story-metrics">
                                <div class="st-story-metric">
                                    <span class="material-icons">trending_up</span>
                                    <span>86%</span>
                                </div>
                                <div class="st-story-metric">
                                    <span class="material-icons">sentiment_very_satisfied</span>
                                    <span>0.78</span>
                                </div>
                            </div>
                            <div class="st-story-actions">
                                <button class="st-btn text">Read More</button>
                                <button class="st-btn text" data-story-id="demo2">Generate Insights</button>
                            </div>
                        </div>
                        
                        <div class="st-story-card">
                            <div class="st-story-category">Innovation</div>
                            <h3 class="st-story-title">Breakthrough in Sustainable Building Materials</h3>
                            <p class="st-story-summary">Researchers have developed a carbon-negative concrete alternative that absorbs CO2 during manufacturing and throughout its lifecycle, potentially revolutionizing construction.</p>
                            <div class="st-story-meta">
                                <span class="st-story-date">February 28, 2025</span>
                                <span class="st-story-source">SustainableBuilding</span>
                            </div>
                            <div class="st-story-metrics">
                                <div class="st-story-metric">
                                    <span class="material-icons">trending_up</span>
                                    <span>91%</span>
                                </div>
                                <div class="st-story-metric">
                                    <span class="material-icons">sentiment_very_satisfied</span>
                                    <span>0.85</span>
                                </div>
                            </div>
                            <div class="st-story-actions">
                                <button class="st-btn text">Read More</button>
                                <button class="st-btn text" data-story-id="demo3">Generate Insights</button>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="st-section">
            <div class="st-card">
                <div class="st-card-header">
                    <h2>Trending Sustainability Topics</h2>
                </div>
                <div class="st-card-content">
                    <div class="st-tag-cloud">
                        <div class="st-tag size-xl">Climate Finance <span class="st-tag-count">+152%</span></div>
                        <div class="st-tag size-l">Biodiversity <span class="st-tag-count">+87%</span></div>
                        <div class="st-tag size-xl">CSRD <span class="st-tag-count">+145%</span></div>
                        <div class="st-tag size-m">Circular Economy <span class="st-tag-count">+42%</span></div>
                        <div class="st-tag size-l">Green Hydrogen <span class="st-tag-count">+76%</span></div>
                        <div class="st-tag size-s">Carbon Markets <span class="st-tag-count">+35%</span></div>
                        <div class="st-tag size-m">Social Governance <span class="st-tag-count">+55%</span></div>
                        <div class="st-tag size-xl">Net-Zero <span class="st-tag-count">+132%</span></div>
                        <div class="st-tag size-s">Sustainable Finance <span class="st-tag-count">+28%</span></div>
                        <div class="st-tag size-m">Supply Chain <span class="st-tag-count">+61%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="st-section">
            <div class="st-card">
                <div class="st-card-header">
                    <h2>AI Story Generator</h2>
                </div>
                <div class="st-card-content">
                    <div class="st-generator-form">
                        <div class="st-form-group">
                            <label for="story-topic" class="st-label">Topic</label>
                            <input type="text" id="story-topic" class="st-input" placeholder="E.g., Renewable Energy Investments">
                        </div>
                        <div class="st-form-group">
                            <label for="story-focus" class="st-label">Focus Area</label>
                            <select id="story-focus" class="st-select">
                                <option value="climate">Climate Impact</option>
                                <option value="social">Social Initiatives</option>
                                <option value="governance">Corporate Governance</option>
                                <option value="innovation">Sustainability Innovation</option>
                                <option value="finance">Green Finance</option>
                            </select>
                        </div>
                        <div class="st-form-group">
                            <label for="story-time-horizon" class="st-label">Time Horizon</label>
                            <div class="st-radio-group">
                                <label class="st-radio">
                                    <input type="radio" name="time-horizon" value="current" checked>
                                    <span>Current Trends</span>
                                </label>
                                <label class="st-radio">
                                    <input type="radio" name="time-horizon" value="future">
                                    <span>Future Outlook</span>
                                </label>
                                <label class="st-radio">
                                    <input type="radio" name="time-horizon" value="historical">
                                    <span>Historical Context</span>
                                </label>
                            </div>
                        </div>
                        <div class="st-form-actions">
                            <button class="st-btn primary" id="generate-story-btn">
                                <span class="material-icons">auto_awesome</span>
                                Generate Story
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Story category filter functionality
        const categoryFilter = document.getElementById('story-category-filter');
        const storyCards = document.querySelectorAll('.st-story-card');
        
        if (categoryFilter) {
            categoryFilter.addEventListener('change', function() {
                const selectedCategory = this.value;
                
                storyCards.forEach(card => {
                    if (selectedCategory === 'all' || card.dataset.category === selectedCategory) {
                        card.style.display = 'flex';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }
        
        // Story generator button
        const generateBtn = document.getElementById('generate-story-btn');
        if (generateBtn) {
            generateBtn.addEventListener('click', function() {
                const topic = document.getElementById('story-topic').value;
                const focus = document.getElementById('story-focus').value;
                const timeHorizon = document.querySelector('input[name="time-horizon"]:checked').value;
                
                if (!topic) {
                    alert('Please enter a story topic');
                    return;
                }
                
                // Show generating state
                this.disabled = true;
                this.innerHTML = '<span class="material-icons spinning">autorenew</span> Generating...';
                
                // Simulate AI generation (in a real app, this would be an API call)
                setTimeout(() => {
                    // Revert button state
                    this.disabled = false;
                    this.innerHTML = '<span class="material-icons">auto_awesome</span> Generate Story';
                    
                    // Show activation message for co-pilot
                    alert('Story request submitted. Check the Sustainability Co-Pilot for your generated story!');
                    
                    // Activate Co-Pilot to show the story
                    if (window.copilotInstance) {
                        window.copilotInstance.toggleCopilot(true);
                        
                        // Add a message to the Co-Pilot
                        const storyPrompt = `I've generated a sustainability story about "${topic}" focusing on ${focus} with a ${timeHorizon} perspective. Here are the key highlights:`;
                        
                        // Simulate user message
                        window.copilotInstance.addUserQuery(storyPrompt);
                        
                        // Simulate AI response (in a real app, this would come from an API)
                        setTimeout(() => {
                            const storyResponse = `# Sustainability Story: ${topic}\n\nThis analysis examines ${topic} through the lens of ${focus}, with particular attention to ${timeHorizon} developments.\n\n## Key Findings\n\n- Significant growth observed in this area with a 37% increase in investment year-over-year\n- Leading organizations are implementing innovative approaches that combine technology and policy changes\n- Regulatory landscape is evolving rapidly with new standards expected in Q3 2025\n\n## Opportunities\n\n- Strategic partnerships with technology providers can accelerate implementation\n- Early adopters are seeing measurable ROI in both financial and sustainability metrics\n- Public sentiment analysis shows 72% positive response to initiatives in this space\n\nWould you like me to elaborate on any specific aspect of this story?`;
                            
                            window.copilotInstance.respondToUserQuery(storyResponse);
                        }, 1500);
                    }
                }, 3000);
            });
        }
    });
</script>
{% endblock %}