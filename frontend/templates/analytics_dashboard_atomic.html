{% extends "layouts/atomic_layout.html" %}

{% block title %}AI-Powered Analytics | SustainaTrendâ„¢{% endblock %}

{% block meta_description %}Advanced AI-powered sustainability analytics dashboard with predictive insights, materiality assessment, and interactive visualizations.{% endblock %}

{% block head_extras %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/visualization-utils.js') }}"></script>
<style>
  .st-analytics-card {
    background-color: var(--st-surface);
    border-radius: 0.75rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    padding: 1.5rem;
    margin-bottom: 1.25rem;
    border: 1px solid var(--st-border-color);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  
  /* Material Topics Styles */
  .st-material-topics-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .st-material-topic-card {
    background-color: var(--st-surface);
    border-radius: 0.75rem;
    border: 1px solid var(--st-border-color);
    padding: 1.25rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }
  
  .st-material-topic-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    transform: translateY(-2px);
  }
  
  .st-material-topic-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }
  
  .st-material-topic-title {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--st-text-dark);
  }
  
  .st-material-topic-score {
    font-weight: 600;
    padding: 0.35rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.9rem;
  }
  
  .st-material-topic-score.high {
    background-color: rgba(220, 53, 69, 0.15);
    color: #dc3545;
  }
  
  .st-material-topic-score.medium {
    background-color: rgba(255, 193, 7, 0.15);
    color: #e6a100;
  }
  
  .st-material-topic-score.low {
    background-color: rgba(40, 167, 69, 0.15);
    color: #28a745;
  }
  
  .st-material-topic-description {
    color: var(--st-text);
    margin-bottom: 1rem;
    font-size: 0.95rem;
    line-height: 1.5;
  }
  
  .st-material-topic-metrics {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }
  
  .st-material-topic-metric {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .st-material-topic-metric-label {
    min-width: 140px;
    font-size: 0.9rem;
    color: var(--st-text-light);
  }
  
  .st-material-topic-metric-bar {
    flex-grow: 1;
    height: 8px;
    background-color: var(--st-bg-alt);
    border-radius: 4px;
    overflow: hidden;
  }
  
  .st-material-topic-metric-fill {
    height: 100%;
    background-color: var(--st-primary);
    border-radius: 4px;
  }
  
  .st-material-topic-metric-value {
    min-width: 40px;
    text-align: right;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--st-text);
  }
  
  .st-material-topic-priority {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
  }
  
  .st-material-topic-priority-label {
    font-size: 0.9rem;
    color: var(--st-text-light);
    margin-right: 0.5rem;
  }
  
  .st-material-topic-priority-value {
    font-weight: 600;
    font-size: 0.9rem;
  }
  
  .st-material-topic-priority-value.high {
    color: #dc3545;
  }
  
  .st-material-topic-priority-value.medium {
    color: #e6a100;
  }
  
  .st-material-topic-priority-value.low {
    color: #28a745;
  }
  
  .st-material-topic-action-btn {
    background-color: var(--st-primary);
    color: white;
    border: none;
    border-radius: 0.375rem;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
    width: 100%;
  }
  
  .st-material-topic-action-btn:hover {
    background-color: var(--st-primary-dark);
  }
  
  /* Enhanced Materiality Matrix */
  .st-materiality-point {
    position: absolute;
    width: 14px;
    height: 14px;
    background-color: var(--st-primary);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 5;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }
  
  .st-materiality-point.active {
    transform: translate(-50%, -50%) scale(1.2);
    box-shadow: 0 0 0 6px rgba(var(--st-primary-rgb), 0.2);
  }
  
  /* Matrix tooltip */
  .st-matrix-tooltip {
    position: absolute;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    padding: 1rem;
    width: 240px;
    z-index: 100;
    pointer-events: none;
  }
  
  .st-matrix-tooltip-header {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--st-text-dark);
    font-size: 1rem;
  }
  
  .st-matrix-tooltip-metrics {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .st-matrix-tooltip-metric {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
  }
  
  .st-matrix-tooltip-value {
    font-weight: 600;
  }
  
  .st-matrix-tooltip-arrow {
    position: absolute;
    bottom: -8px;
    left: 50%;
    margin-left: -8px;
    width: 16px;
    height: 8px;
    overflow: hidden;
  }
  
  .st-matrix-tooltip-arrow:after {
    content: "";
    position: absolute;
    top: -8px;
    left: 0;
    width: 16px;
    height: 16px;
    background-color: white;
    transform: rotate(45deg);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  /* Strategic actions modal */
  .st-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }
  
  .st-modal-content {
    background-color: white;
    border-radius: 8px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  }
  
  .st-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid var(--st-border-color);
  }
  
  .st-modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    color: var(--st-text-dark);
  }
  
  .st-modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--st-text-light);
    transition: color 0.2s;
  }
  
  .st-modal-close:hover {
    color: var(--st-text-dark);
  }
  
  .st-modal-body {
    padding: 1.5rem;
  }
  
  .st-strategic-actions-list {
    padding-left: 1.25rem;
    margin: 0;
  }
  
  .st-strategic-actions-list li {
    margin-bottom: 1rem;
    line-height: 1.5;
  }
  
  /* Highlight animation */
  .highlight-topic {
    animation: highlight-pulse 2s;
  }
  
  @keyframes highlight-pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(var(--st-primary-rgb), 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(var(--st-primary-rgb), 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(var(--st-primary-rgb), 0);
    }
  }
  
  .st-analytics-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }
  
  .st-form-group {
    margin-bottom: 1rem;
  }
  
  .st-form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--st-text);
  }
  
  .st-form-input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--st-border-color);
    border-radius: 0.375rem;
    background-color: var(--st-input-bg);
    color: var(--st-text);
    transition: border-color 0.2s;
  }
  
  .st-form-input:focus {
    border-color: var(--st-primary);
    outline: none;
    box-shadow: 0 0 0 2px rgba(var(--st-primary-rgb), 0.2);
  }
  
  .st-form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.25rem;
  }
  
  @media (max-width: 768px) {
    .st-form-row {
      grid-template-columns: 1fr;
    }
  }
  
  .st-loader {
    border: 4px solid var(--st-border-color);
    border-top: 4px solid var(--st-primary);
    border-radius: 50%;
    width: 2.5rem;
    height: 2.5rem;
    animation: st-spin 2s linear infinite;
    margin: 1.25rem auto;
    display: none;
  }
  
  @keyframes st-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .st-chart-container {
    height: 25rem;
    margin: 1.5rem 0;
    border-radius: 0.5rem;
    overflow: hidden;
    border: 1px solid var(--st-border-color);
    background-color: var(--st-surface-alt);
    padding: 1rem;
  }
  
  .st-tabs {
    display: flex;
    border-bottom: 1px solid var(--st-border-color);
    margin-bottom: 1.25rem;
  }
  
  .st-tab {
    padding: 0.75rem 1.5rem;
    cursor: pointer;
    border: 1px solid transparent;
    border-radius: 0.5rem 0.5rem 0 0;
    margin-right: 0.3125rem;
    color: var(--st-text);
    font-weight: 500;
    transition: all 0.2s;
  }
  
  .st-tab:hover {
    background-color: var(--st-hover);
    color: var(--st-primary);
  }
  
  .st-tab.active {
    border: 1px solid var(--st-border-color);
    border-bottom: 1px solid var(--st-surface);
    margin-bottom: -1px;
    background-color: var(--st-surface);
    color: var(--st-primary);
  }
  
  .st-tab-content {
    display: none;
  }
  
  .st-tab-content.active {
    display: block;
  }
  
  .st-insights-item {
    padding: 1rem;
    border-left: 3px solid var(--st-primary);
    background-color: var(--st-surface-alt);
    margin-bottom: 1rem;
    border-radius: 0 0.375rem 0.375rem 0;
  }
  
  .st-insights-item__title {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--st-primary);
  }
  
  .st-insights-item__content {
    color: var(--st-text);
    font-size: 0.9375rem;
    line-height: 1.5;
  }
  
  .st-materiality-matrix {
    border: 1px solid var(--st-border-color);
    border-radius: 0.75rem;
    padding: 1.25rem;
    margin-top: 1.25rem;
    position: relative;
    height: 28.125rem;
    background-color: var(--st-surface-alt);
  }
  
  .st-materiality-point {
    position: absolute;
    width: 0.875rem;
    height: 0.875rem;
    background-color: var(--st-primary);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .st-materiality-point:hover {
    width: 1.125rem;
    height: 1.125rem;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
  }
  
  .st-matrix-axis {
    position: absolute;
    font-size: 0.75rem;
    color: var(--st-text-secondary);
    font-weight: 500;
  }
  
  .st-x-axis {
    bottom: 0.625rem;
    width: 100%;
    text-align: center;
  }
  
  .st-y-axis {
    transform: rotate(-90deg);
    transform-origin: top left;
    top: 50%;
    left: 0.625rem;
  }
  
  .st-grid-lines {
    position: absolute;
    width: calc(100% - 2.5rem);
    height: calc(100% - 2.5rem);
    top: 1.25rem;
    left: 1.25rem;
    pointer-events: none;
  }
  
  .st-grid-line {
    position: absolute;
    background-color: rgba(var(--st-border-color-rgb), 0.3);
  }
  
  .st-grid-line-h {
    width: 100%;
    height: 1px;
  }
  
  .st-grid-line-v {
    height: 100%;
    width: 1px;
  }
  
  .st-matrix-quadrant {
    position: absolute;
    font-size: 0.6875rem;
    color: var(--st-text-secondary);
    font-weight: 500;
    pointer-events: none;
  }
  
  .st-topic-chip {
    display: inline-block;
    padding: 0.375rem 0.75rem;
    margin: 0.25rem;
    background-color: var(--st-primary-light);
    color: var(--st-primary);
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 500;
  }
  
  .st-ai-explanation {
    background-color: var(--st-surface-alt);
    border-radius: 0.5rem;
    padding: 1rem;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-size: 0.875rem;
    line-height: 1.5;
    border-left: 3px solid var(--st-info);
  }
</style>
{% endblock %}

{% block page_title %}AI-Powered Analytics{% endblock %}
{% block page_description %}Generate predictive sustainability analytics and materiality assessments with AI{% endblock %}
{% block breadcrumb_current %}Analytics Dashboard{% endblock %}

{% block page_actions %}
<button class="st-button st-button--secondary">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="12" y1="8" x2="12" y2="16"/></svg>
  <span>New Analysis</span>
</button>
<button class="st-button st-button--outline">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
  <span>Export Data</span>
</button>
{% endblock %}

{% block left_column %}
<div class="st-card">
  <div class="st-card__header">
    <h2 class="st-card__title">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      Recent Analyses
    </h2>
  </div>
  <div class="st-card__body">
    <ul class="st-list">
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m18.7 8-5.1 5.2-2.8-2.7L7 14.3"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">EcoTech Solutions</div>
            <div class="st-list-item__description">Technology sector</div>
          </div>
          <div class="st-list-item__meta">2 days ago</div>
        </a>
      </li>
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m18.7 8-5.1 5.2-2.8-2.7L7 14.3"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">GreenManufacturing Inc.</div>
            <div class="st-list-item__description">Manufacturing sector</div>
          </div>
          <div class="st-list-item__meta">1 week ago</div>
        </a>
      </li>
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m18.7 8-5.1 5.2-2.8-2.7L7 14.3"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">RenewEnergy Corp</div>
            <div class="st-list-item__description">Energy sector</div>
          </div>
          <div class="st-list-item__meta">2 weeks ago</div>
        </a>
      </li>
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m18.7 8-5.1 5.2-2.8-2.7L7 14.3"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">HealthPlus Group</div>
            <div class="st-list-item__description">Healthcare sector</div>
          </div>
          <div class="st-list-item__meta">3 weeks ago</div>
        </a>
      </li>
    </ul>
  </div>
</div>

<div class="st-card">
  <div class="st-card__header">
    <h2 class="st-card__title">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7H5v14h16v-5"/><path d="M16 17h-8"/><path d="M16 13h-8"/><path d="M9 9H8"/><line x1="12" y1="3" x2="12" y2="7"/></svg>
      Templates
    </h2>
  </div>
  <div class="st-card__body">
    <ul class="st-list">
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">ESRS Disclosure Analysis</div>
            <div class="st-list-item__description">European sustainability reporting standards</div>
          </div>
        </a>
      </li>
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">Carbon Footprint Analysis</div>
            <div class="st-list-item__description">Scope 1, 2, and 3 emissions</div>
          </div>
        </a>
      </li>
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">Water Stewardship Assessment</div>
            <div class="st-list-item__description">Water usage and conservation</div>
          </div>
        </a>
      </li>
      <li class="st-list-item">
        <a href="#" class="st-list-item__link">
          <div class="st-list-item__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </div>
          <div class="st-list-item__content">
            <div class="st-list-item__title">Biodiversity Impact</div>
            <div class="st-list-item__description">Ecological footprint analysis</div>
          </div>
        </a>
      </li>
    </ul>
  </div>
</div>
{% endblock %}

{% block center_column %}
<div class="st-card">
  <div class="st-card__header">
    <h2 class="st-card__title">Generate Sustainability Analytics</h2>
  </div>
  <div class="st-card__body">
    <form id="analytics-form" class="st-form">
      <div class="st-form-row">
        <div class="st-form-group">
          <label for="company-name" class="st-form-label">Company Name</label>
          <input type="text" id="company-name" name="company-name" required placeholder="e.g., EcoTech Solutions" class="st-form-input">
        </div>
        <div class="st-form-group">
          <label for="industry" class="st-form-label">Industry</label>
          <select id="industry" name="industry" required class="st-form-input">
            <option value="">Select Industry</option>
            <option value="Technology">Technology</option>
            <option value="Manufacturing">Manufacturing</option>
            <option value="Energy">Energy</option>
            <option value="Consumer Goods">Consumer Goods</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Finance">Finance</option>
            <option value="Transportation">Transportation</option>
            <option value="Retail">Retail</option>
            <option value="Agriculture">Agriculture</option>
            <option value="Construction">Construction</option>
          </select>
        </div>
      </div>
      
      <div class="st-form-row">
        <div class="st-form-group">
          <label for="forecast-periods" class="st-form-label">Forecast Periods</label>
          <input type="number" id="forecast-periods" name="forecast-periods" min="1" max="10" value="3" class="st-form-input">
        </div>
        <div class="st-form-group">
          <label for="include-metrics" class="st-form-label">Include Historical Metrics</label>
          <select id="include-metrics" name="include-metrics" class="st-form-input">
            <option value="yes">Yes - Use Sample Data</option>
            <option value="no">No - Generate Without Historical Data</option>
          </select>
        </div>
      </div>
      
      <div class="st-form-group">
        <label for="analysis-model" class="st-form-label">AI Model</label>
        <select id="analysis-model" name="analysis-model" class="st-form-input">
          <option value="standard">Standard (Faster)</option>
          <option value="advanced" selected>Advanced (More Accurate)</option>
          <option value="gemini">Gemini Pro (Most Advanced)</option>
        </select>
      </div>
      
      <div class="st-form-actions">
        <button type="submit" class="st-button" id="generate-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 19h-2a5 5 0 0 0-10 0H6a7 7 0 0 1 14 0Z"/><path d="M12 19V5"/><path d="m9 8 3-3 3 3"/></svg>
          Generate Analytics
        </button>
      </div>
    </form>
    <div class="st-loader" id="loader"></div>
  </div>
</div>

<div id="results-section" style="display: none;" class="st-mt-4">
  <div class="st-tabs">
    <div class="st-tab active" data-tab="predictive">Predictive Analytics</div>
    <div class="st-tab" data-tab="materiality">Materiality Assessment</div>
  </div>
  
  <div id="predictive-content" class="st-tab-content active">
    <div class="st-card">
      <div class="st-card__header">
        <h2 class="st-card__title">Predictive Analytics Results</h2>
      </div>
      <div class="st-card__body">
        <div id="predictive-summary">
          <p id="predictive-company" class="st-mb-1"></p>
          <p id="predictive-date" class="st-text-secondary st-mb-3"></p>
        </div>
        <div class="st-chart-container">
          <canvas id="predictions-chart"></canvas>
        </div>
        
        <h3 class="st-heading-3 st-mt-4">AI Insights</h3>
        <div id="ai-insights">
          <div class="st-ai-explanation">
            <p>Select a company and industry above to generate AI-driven predictive analytics and insights.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="materiality-content" class="st-tab-content">
    <div class="st-card">
      <div class="st-card__header">
        <h2 class="st-card__title">Materiality Assessment Results</h2>
      </div>
      <div class="st-card__body">
        <div id="materiality-summary">
          <p id="materiality-company" class="st-mb-1"></p>
          <p id="materiality-date" class="st-text-secondary st-mb-3"></p>
        </div>
        
        <div class="st-materiality-matrix">
          <div class="st-matrix-axis st-x-axis">Business Impact</div>
          <div class="st-matrix-axis st-y-axis">Stakeholder Concern</div>
          
          <div class="st-grid-lines">
            <div class="st-grid-line st-grid-line-h" style="top: 25%"></div>
            <div class="st-grid-line st-grid-line-h" style="top: 50%"></div>
            <div class="st-grid-line st-grid-line-h" style="top: 75%"></div>
            <div class="st-grid-line st-grid-line-v" style="left: 25%"></div>
            <div class="st-grid-line st-grid-line-v" style="left: 50%"></div>
            <div class="st-grid-line st-grid-line-v" style="left: 75%"></div>
          </div>
          
          <div class="st-matrix-quadrant" style="top: 15%; left: 15%;">Monitor</div>
          <div class="st-matrix-quadrant" style="top: 15%; left: 85%;">Manage</div>
          <div class="st-matrix-quadrant" style="top: 85%; left: 15%;">Maintain</div>
          <div class="st-matrix-quadrant" style="top: 85%; left: 85%;">Focus</div>
          
          <div id="matrix-points"></div>
        </div>
        
        <h3 class="st-heading-3 st-mt-4">Material Topics</h3>
        <div id="material-topics">
          <div class="st-ai-explanation">
            <p>Select a company and industry above to generate a materiality assessment.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block right_column %}
<div class="st-card">
  <div class="st-card__header">
    <h2 class="st-card__title">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
      About AI Analytics
    </h2>
  </div>
  <div class="st-card__body">
    <p>The SustainaTrendâ„¢ AI Analytics uses advanced algorithms to generate predictive sustainability metrics and materiality assessments.</p>
    
    <h3 class="st-heading-4 st-mt-3">Predictive Analytics</h3>
    <p class="st-text-sm">Our AI analyzes historical sustainability data and industry trends to predict future performance across key metrics including:</p>
    <ul class="st-list st-list--check st-text-sm st-mt-2">
      <li>Carbon emissions trajectory</li>
      <li>Water usage forecasts</li>
      <li>Waste reduction targets</li>
      <li>Energy efficiency improvements</li>
      <li>Social impact metrics</li>
    </ul>
    
    <h3 class="st-heading-4 st-mt-3">Materiality Assessment</h3>
    <p class="st-text-sm">Our AI evaluates the importance of various sustainability topics based on:</p>
    <ul class="st-list st-list--check st-text-sm st-mt-2">
      <li>Business impact analysis</li>
      <li>Stakeholder concern evaluation</li>
      <li>Regulatory requirement mapping</li>
      <li>Industry benchmark comparison</li>
      <li>Emerging trend identification</li>
    </ul>
  </div>
</div>

<div class="st-card">
  <div class="st-card__header">
    <h2 class="st-card__title">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/><circle cx="11" cy="11" r="3"/></svg>
      Industry Insights
    </h2>
  </div>
  <div class="st-card__body">
    <div class="st-insight-item">
      <h3 class="st-heading-4">Technology Sector</h3>
      <p class="st-text-sm">Key trends include data center energy efficiency, e-waste management, and supply chain transparency. Leading companies are focusing on renewable energy sourcing and circular economy principles.</p>
    </div>
    
    <div class="st-insight-item">
      <h3 class="st-heading-4">Manufacturing Sector</h3>
      <p class="st-text-sm">Material efficiency, clean production processes, and worker safety are top concerns. Carbon reduction in manufacturing processes and sustainable sourcing are emerging focus areas.</p>
    </div>
    
    <div class="st-insight-item">
      <h3 class="st-heading-4">Energy Sector</h3>
      <p class="st-text-sm">Transition to renewable sources, methane leakage reduction, and community impact are driving materiality assessments. Just transition planning is becoming increasingly important.</p>
    </div>
    
    <div class="st-insight-item">
      <h3 class="st-heading-4">Financial Sector</h3>
      <p class="st-text-sm">Climate risk assessment, sustainable finance products, and ESG integration in investment decisions are critical. TCFD alignment remains a key focus for reporting.</p>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabs = document.querySelectorAll('.st-tab');
    tabs.forEach(tab => {
      tab.addEventListener('click', function() {
        // Remove active class from all tabs and content
        tabs.forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.st-tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // Add active class to clicked tab and corresponding content
        const tabName = this.getAttribute('data-tab');
        this.classList.add('active');
        document.getElementById(tabName + '-content').classList.add('active');
      });
    });
    
    // Form submission
    const analyticsForm = document.getElementById('analytics-form');
    const loader = document.getElementById('loader');
    const resultsSection = document.getElementById('results-section');
    
    analyticsForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Show loader
      loader.style.display = 'block';
      
      // Get form data
      const companyName = document.getElementById('company-name').value;
      const industry = document.getElementById('industry').value;
      const forecastPeriods = document.getElementById('forecast-periods').value;
      const includeMetrics = document.getElementById('include-metrics').value;
      const analysisModel = document.getElementById('analysis-model').value;
      
      // Simulate API call with timeout
      setTimeout(function() {
        // Hide loader
        loader.style.display = 'none';
        
        // Show results section
        resultsSection.style.display = 'block';
        
        // Update predictive content
        document.getElementById('predictive-company').textContent = 'Company: ' + companyName;
        document.getElementById('predictive-date').textContent = 'Generated on: ' + new Date().toLocaleDateString();
        
        // Update materiality content
        document.getElementById('materiality-company').textContent = 'Company: ' + companyName;
        document.getElementById('materiality-date').textContent = 'Generated on: ' + new Date().toLocaleDateString();
        
        // Generate chart
        generatePredictionsChart(companyName, industry, forecastPeriods);
        
        // Generate materiality matrix
        generateMaterialityMatrix(industry);
        
        // Generate AI insights
        generateAIInsights(companyName, industry, forecastPeriods);
        
        // Generate material topics
        generateMaterialTopics(industry);
        
        // Scroll to results
        resultsSection.scrollIntoView({ behavior: 'smooth' });
      }, 2000);
    });
    
    // Chart generation function
    function generatePredictionsChart(company, industry, periods) {
      const ctx = document.getElementById('predictions-chart').getContext('2d');
      
      // Generate some random data based on industry
      const currentYear = new Date().getFullYear();
      const years = Array.from({length: parseInt(periods) + 3}, (_, i) => currentYear - 3 + i);
      
      // Different metrics based on industry
      let metrics = [];
      let datasets = [];
      
      switch(industry) {
        case 'Technology':
          metrics = ['Energy Usage (MWh)', 'E-waste Recycled (%)', 'Carbon Emissions (tCO2e)'];
          break;
        case 'Manufacturing':
          metrics = ['Material Efficiency (%)', 'Water Usage (kL)', 'Carbon Emissions (tCO2e)'];
          break;
        case 'Energy':
          metrics = ['Renewable Energy (%)', 'Carbon Emissions (tCO2e)', 'Methane Leakage (%)'];
          break;
        default:
          metrics = ['Carbon Emissions (tCO2e)', 'Water Usage (kL)', 'Waste Recycled (%)'];
      }
      
      const colors = [
        'rgba(75, 192, 192, 0.7)',
        'rgba(54, 162, 235, 0.7)',
        'rgba(255, 99, 132, 0.7)'
      ];
      
      metrics.forEach((metric, index) => {
        // Historical data (slightly random)
        const historicalData = years.slice(0, 3).map((year, i) => {
          // Base value depends on the metric
          let base = index === 0 ? 100 : (index === 1 ? 500 : 35);
          // Add some randomness
          return base + Math.floor(Math.random() * 20) - (index === 2 ? 5 * i : 0);
        });
        
        // Predicted data (trend improvement)
        const predictedData = years.slice(3).map((year, i) => {
          const lastValue = historicalData[historicalData.length - 1];
          // Different trends for different metrics
          let trend = index === 0 ? -5 : (index === 1 ? -15 : 5);
          return lastValue + trend * (i + 1) + Math.floor(Math.random() * 10);
        });
        
        // Combine historical and predicted data
        const allData = [...historicalData, ...predictedData];
        
        datasets.push({
          label: metric,
          data: allData,
          borderColor: colors[index],
          backgroundColor: colors[index].replace('0.7', '0.1'),
          borderWidth: 2,
          pointBackgroundColor: colors[index],
          tension: 0.3,
          segment: {
            borderDash: function(context) {
              return context.p0.parsed.x >= 2 ? [6, 6] : undefined;
            }
          }
        });
      });
      
      // Create the chart
      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: years,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'Year'
              },
              grid: {
                display: true,
                drawOnChartArea: true,
                drawTicks: true,
                color: 'rgba(200, 200, 200, 0.15)'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Value'
              },
              grid: {
                display: true,
                drawOnChartArea: true,
                drawTicks: true,
                color: 'rgba(200, 200, 200, 0.15)'
              }
            }
          }
        }
      });
    }
    
    // Materiality matrix generation
    function generateMaterialityMatrix(industry) {
      const matrixPoints = document.getElementById('matrix-points');
      matrixPoints.innerHTML = '';
      
      // Different material topics based on industry
      let topics = [];
      
      switch(industry) {
        case 'Technology':
          topics = [
            { name: 'Data Privacy & Security', x: 0.85, y: 0.85 },
            { name: 'Energy Efficiency', x: 0.75, y: 0.65 },
            { name: 'E-waste Management', x: 0.60, y: 0.70 },
            { name: 'Digital Inclusion', x: 0.40, y: 0.50 },
            { name: 'Ethical AI', x: 0.70, y: 0.60 },
            { name: 'Supply Chain Transparency', x: 0.55, y: 0.65 },
            { name: 'Carbon Emissions', x: 0.65, y: 0.75 },
            { name: 'Talent Diversity', x: 0.45, y: 0.55 },
            { name: 'Water Usage', x: 0.25, y: 0.15 },
            { name: 'Community Investment', x: 0.30, y: 0.40 }
          ];
          break;
        case 'Manufacturing':
          topics = [
            { name: 'Worker Safety', x: 0.90, y: 0.80 },
            { name: 'Carbon Emissions', x: 0.80, y: 0.75 },
            { name: 'Material Efficiency', x: 0.75, y: 0.70 },
            { name: 'Supply Chain', x: 0.65, y: 0.60 },
            { name: 'Water Management', x: 0.60, y: 0.55 },
            { name: 'Waste Reduction', x: 0.70, y: 0.65 },
            { name: 'Energy Usage', x: 0.75, y: 0.60 },
            { name: 'Product Lifecycle', x: 0.50, y: 0.45 },
            { name: 'Community Relations', x: 0.35, y: 0.55 },
            { name: 'Biodiversity Impact', x: 0.30, y: 0.25 }
          ];
          break;
        case 'Energy':
          topics = [
            { name: 'Carbon Emissions', x: 0.90, y: 0.90 },
            { name: 'Renewable Transition', x: 0.85, y: 0.80 },
            { name: 'Methane Leakage', x: 0.75, y: 0.80 },
            { name: 'Water Usage', x: 0.65, y: 0.60 },
            { name: 'Biodiversity', x: 0.55, y: 0.65 },
            { name: 'Community Impact', x: 0.60, y: 0.70 },
            { name: 'Just Transition', x: 0.70, y: 0.65 },
            { name: 'Safety Performance', x: 0.80, y: 0.60 },
            { name: 'Waste Management', x: 0.35, y: 0.30 },
            { name: 'Governance', x: 0.50, y: 0.55 }
          ];
          break;
        default:
          topics = [
            { name: 'Carbon Emissions', x: 0.80, y: 0.75 },
            { name: 'Energy Efficiency', x: 0.70, y: 0.65 },
            { name: 'Water Management', x: 0.65, y: 0.60 },
            { name: 'Waste Reduction', x: 0.60, y: 0.55 },
            { name: 'Employee Wellbeing', x: 0.55, y: 0.60 },
            { name: 'Diversity & Inclusion', x: 0.50, y: 0.55 },
            { name: 'Community Impact', x: 0.45, y: 0.40 },
            { name: 'Supply Chain', x: 0.75, y: 0.65 },
            { name: 'Product Sustainability', x: 0.65, y: 0.70 },
            { name: 'Governance', x: 0.60, y: 0.50 }
          ];
      }
      
      // Create the matrix points
      // Add a tooltip container
      const tooltipContainer = document.createElement('div');
      tooltipContainer.className = 'st-matrix-tooltip';
      tooltipContainer.style.display = 'none';
      document.querySelector('.st-materiality-matrix').appendChild(tooltipContainer);
      
      topics.forEach(topic => {
        const point = document.createElement('div');
        point.className = 'st-materiality-point';
        point.style.left = (topic.x * 100) + '%';
        point.style.top = (topic.y * 100) + '%';
        point.title = topic.name;
        point.setAttribute('data-name', topic.name);
        point.setAttribute('data-x', topic.x);
        point.setAttribute('data-y', topic.y);
        
        // Size variations based on importance (x+y score)
        const importance = topic.x + topic.y;
        const size = Math.max(12, Math.min(24, importance * 15)); // Size between 12-24px
        point.style.width = `${size}px`;
        point.style.height = `${size}px`;
        point.style.marginLeft = `-${size/2}px`;
        point.style.marginTop = `-${size/2}px`;
        
        // Add enhanced interactive behavior
        point.addEventListener('mouseenter', function(e) {
          // Highlight this point
          this.classList.add('active');
          
          // Show tooltip with details
          tooltipContainer.innerHTML = `
            <div class="st-matrix-tooltip-header">${topic.name}</div>
            <div class="st-matrix-tooltip-metrics">
              <div class="st-matrix-tooltip-metric">
                <span>Business Impact:</span>
                <span class="st-matrix-tooltip-value">${(topic.x * 100).toFixed(0)}%</span>
              </div>
              <div class="st-matrix-tooltip-metric">
                <span>Stakeholder Concern:</span>
                <span class="st-matrix-tooltip-value">${(topic.y * 100).toFixed(0)}%</span>
              </div>
              <div class="st-matrix-tooltip-metric">
                <span>Materiality Score:</span>
                <span class="st-matrix-tooltip-value">${((topic.x + topic.y) / 2 * 100).toFixed(0)}%</span>
              </div>
            </div>
            <div class="st-matrix-tooltip-arrow"></div>
          `;
          
          // Position tooltip
          const matrix = document.querySelector('.st-materiality-matrix');
          const matrixRect = matrix.getBoundingClientRect();
          const pointRect = this.getBoundingClientRect();
          
          // Default position above point
          let top = pointRect.top - matrixRect.top - tooltipContainer.offsetHeight - 10;
          let left = pointRect.left - matrixRect.left - (tooltipContainer.offsetWidth / 2) + (this.offsetWidth / 2);
          
          // If too close to top, position below
          if (top < 10) {
            top = pointRect.top - matrixRect.top + this.offsetHeight + 10;
            tooltipContainer.querySelector('.st-matrix-tooltip-arrow').style.top = '-8px';
          } else {
            tooltipContainer.querySelector('.st-matrix-tooltip-arrow').style.top = 'auto';
            tooltipContainer.querySelector('.st-matrix-tooltip-arrow').style.bottom = '-8px';
          }
          
          // Ensure not too far left or right
          left = Math.max(10, Math.min(matrixRect.width - tooltipContainer.offsetWidth - 10, left));
          
          tooltipContainer.style.top = `${top}px`;
          tooltipContainer.style.left = `${left}px`;
          tooltipContainer.style.display = 'block';
        });
        
        point.addEventListener('mouseleave', function() {
          this.classList.remove('active');
          tooltipContainer.style.display = 'none';
        });
        
        point.addEventListener('click', function() {
          // Show detail panel with topic details
          const materialTopics = document.getElementById('material-topics');
          materialTopics.scrollIntoView({ behavior: 'smooth' });
          
          // Highlight this topic in the material topics list if it exists
          setTimeout(() => {
            const topicCards = document.querySelectorAll('.st-material-topic-card');
            topicCards.forEach(card => {
              if (card.querySelector('.st-material-topic-title').textContent.includes(topic.name)) {
                card.classList.add('highlight-topic');
                setTimeout(() => card.classList.remove('highlight-topic'), 2000);
              }
            });
          }, 500);
        });
        
        matrixPoints.appendChild(point);
      });
      
      // Add material topics
      const materialTopics = document.getElementById('material-topics');
      materialTopics.innerHTML = '';
      
      // Sort topics by combined score (x + y) to get most material topics
      const sortedTopics = [...topics].sort((a, b) => (b.x + b.y) - (a.x + a.y));
      
      // Take top 5 material topics
      const topMaterialTopics = sortedTopics.slice(0, 5);
      
      // Create material topics section
      const topicsDiv = document.createElement('div');
      topicsDiv.className = 'st-topics-container';
      
      topMaterialTopics.forEach(topic => {
        const topicChip = document.createElement('div');
        topicChip.className = 'st-topic-chip';
        topicChip.textContent = topic.name;
        topicsDiv.appendChild(topicChip);
      });
      
      materialTopics.appendChild(topicsDiv);
      
      // Add AI explanation
      const explanation = document.createElement('div');
      explanation.className = 'st-ai-explanation st-mt-3';
      explanation.innerHTML = `
        <p>The materiality assessment identifies the most significant sustainability topics for 
        ${industry} companies based on business impact and stakeholder concern. 
        Top material topics should be prioritized in sustainability strategy and reporting.</p>
      `;
      materialTopics.appendChild(explanation);
    }
    
    // AI insights generation
    function generateMaterialTopics(industry) {
      const materialTopicsContainer = document.getElementById('material-topics');
      
      // Get the top 5 material topics from the matrix
      const matrixPoints = document.getElementById('matrix-points');
      const topicPoints = matrixPoints.querySelectorAll('.st-materiality-point');
      
      // Convert to array and sort by materiality score (x + y)
      const topicsArray = Array.from(topicPoints).map(point => {
        return {
          name: point.getAttribute('data-name'),
          x: parseFloat(point.getAttribute('data-x')),
          y: parseFloat(point.getAttribute('data-y')),
          score: parseFloat(point.getAttribute('data-x')) + parseFloat(point.getAttribute('data-y'))
        };
      }).sort((a, b) => b.score - a.score);
      
      // Take top 5
      const topTopics = topicsArray.slice(0, 5);
      
      // Create detailed topics section with interactive elements
      const topicsContainer = document.createElement('div');
      topicsContainer.className = 'st-material-topics-container';
      
      // Industry-specific topic descriptions
      const topicDescriptions = {
        'Technology': {
          'Data Privacy & Security': 'Protection of sensitive information from unauthorized access and ensuring compliance with privacy regulations.',
          'Energy Efficiency': 'Reducing energy consumption in data centers and operations to minimize environmental impact.',
          'E-waste Management': 'Responsible disposal and recycling of electronic waste to minimize environmental harm.',
          'Digital Inclusion': 'Ensuring technology products and services are accessible to all, including underserved populations.',
          'Ethical AI': 'Developing and deploying AI systems that are fair, transparent, and respect human rights.',
          'Supply Chain Transparency': 'Visibility into suppliers\' practices to ensure ethical and sustainable operations.',
          'Carbon Emissions': 'Reducing direct and indirect greenhouse gas emissions from operations and products.',
          'Talent Diversity': 'Creating an inclusive workplace with diverse representation across all levels.',
          'Water Usage': 'Minimizing water consumption in operations and manufacturing processes.',
          'Community Investment': 'Supporting local communities through programs, partnerships, and investments.'
        },
        'Manufacturing': {
          'Worker Safety': 'Ensuring safe working conditions and preventing workplace injuries and illnesses.',
          'Carbon Emissions': 'Reducing greenhouse gas emissions from manufacturing processes and transportation.',
          'Material Efficiency': 'Optimizing material use to reduce waste and improve resource productivity.',
          'Supply Chain': 'Managing environmental and social impacts throughout the supply chain.',
          'Water Management': 'Reducing water usage and ensuring responsible wastewater management.',
          'Waste Reduction': 'Minimizing waste generation and implementing recycling programs.',
          'Energy Usage': 'Improving energy efficiency and transitioning to renewable energy sources.',
          'Product Lifecycle': 'Considering environmental impacts across the entire product lifecycle.',
          'Community Relations': 'Building positive relationships with communities where facilities operate.',
          'Labor Practices': 'Ensuring fair labor practices, including wages, hours, and working conditions.'
        },
        'Retail': {
          'Sustainable Packaging': 'Reducing packaging waste and using recyclable or biodegradable materials.',
          'Ethical Sourcing': 'Ensuring products are produced under fair labor conditions and with respect for human rights.',
          'Carbon Footprint': 'Reducing emissions from stores, distribution centers, and transportation.',
          'Customer Privacy': 'Protecting customer data and maintaining transparent privacy policies.',
          'Waste Management': 'Reducing waste from operations and implementing recycling programs.',
          'Community Engagement': 'Supporting local communities through programs and partnerships.',
          'Energy Management': 'Improving energy efficiency in stores and distribution centers.',
          'Product Safety': 'Ensuring all products meet safety standards and regulations.',
          'Diversity & Inclusion': 'Creating an inclusive workplace and ensuring diversity across all levels.',
          'Responsible Marketing': 'Ensuring marketing practices are ethical and transparent.'
        },
        'Finance': {
          'Data Security': 'Protecting sensitive financial information from unauthorized access and breaches.',
          'Ethical Business Practices': 'Maintaining high standards of ethics and preventing corruption.',
          'Financial Inclusion': 'Expanding access to financial services for underserved populations.',
          'Responsible Investing': 'Incorporating ESG factors into investment decisions.',
          'Climate Risk Management': 'Assessing and managing climate-related financial risks.',
          'Regulatory Compliance': 'Ensuring compliance with all applicable laws and regulations.',
          'Diversity & Inclusion': 'Creating an inclusive workplace with diverse representation.',
          'Customer Privacy': 'Respecting and protecting customer data and privacy.',
          'Financial Literacy': 'Promoting education and awareness about financial concepts.',
          'Operational Footprint': 'Reducing environmental impact of operations and facilities.'
        },
        'Energy': {
          'Climate Change Mitigation': 'Reducing greenhouse gas emissions and transitioning to low-carbon energy.',
          'Environmental Compliance': 'Adherence to environmental regulations and standards.',
          'Water Management': 'Responsible management of water resources and wastewater.',
          'Community Relations': 'Building positive relationships with communities near operations.',
          'Worker Safety': 'Ensuring safe working conditions and preventing accidents.',
          'Biodiversity': 'Protecting ecosystems and wildlife in areas of operation.',
          'Air Quality': 'Reducing air pollutants from energy production processes.',
          'Waste Management': 'Responsible handling and disposal of waste materials.',
          'Energy Transition': 'Shifting to renewable energy sources and technologies.',
          'Supply Chain Management': 'Ensuring sustainable practices throughout the supply chain.'
        }
      };
      
      // Default descriptions if industry not found
      const defaultDescriptions = {
        'Carbon Emissions': 'Reducing greenhouse gas emissions from operations and value chain.',
        'Energy Efficiency': 'Optimizing energy use to reduce consumption and associated emissions.',
        'Waste Management': 'Minimizing waste generation and implementing recycling programs.',
        'Water Stewardship': 'Responsible management of water resources throughout operations.',
        'Diversity & Inclusion': 'Creating an inclusive workplace with diverse representation.',
        'Supply Chain Management': 'Ensuring sustainable and ethical practices throughout the supply chain.',
        'Community Relations': 'Building positive relationships with local communities.',
        'Product Lifecycle': 'Considering environmental impacts across the entire product lifecycle.',
        'Ethical Business Practices': 'Maintaining high standards of ethics and preventing corruption.',
        'Worker Welfare': 'Ensuring fair treatment, safety, and well-being of all workers.'
      };
      
      // Get appropriate descriptions
      const descriptions = topicDescriptions[industry] || defaultDescriptions;
      
      // Create interactive cards for each top material topic
      topTopics.forEach((topic, index) => {
        const topicCard = document.createElement('div');
        topicCard.className = 'st-material-topic-card';
        
        // Get description or default
        const description = descriptions[topic.name] || 
          'Key sustainability topic requiring management attention and strategic response.';
        
        // Calculate materiality score as percentage
        const materialityScore = Math.round((topic.score / 2) * 100);
        
        // Determine if this is a high/medium/low priority
        let priorityLevel, priorityClass;
        if (materialityScore > 75) {
          priorityLevel = 'High';
          priorityClass = 'high';
        } else if (materialityScore > 60) {
          priorityLevel = 'Medium';
          priorityClass = 'medium';
        } else {
          priorityLevel = 'Low';
          priorityClass = 'low';
        }
        
        topicCard.innerHTML = `
          <div class="st-material-topic-header">
            <h4 class="st-material-topic-title">${index + 1}. ${topic.name}</h4>
            <span class="st-material-topic-score ${priorityClass}">${materialityScore}%</span>
          </div>
          <div class="st-material-topic-description">${description}</div>
          <div class="st-material-topic-metrics">
            <div class="st-material-topic-metric">
              <span class="st-material-topic-metric-label">Business Impact:</span>
              <div class="st-material-topic-metric-bar">
                <div class="st-material-topic-metric-fill" style="width: ${Math.round(topic.x * 100)}%"></div>
              </div>
              <span class="st-material-topic-metric-value">${Math.round(topic.x * 100)}%</span>
            </div>
            <div class="st-material-topic-metric">
              <span class="st-material-topic-metric-label">Stakeholder Concern:</span>
              <div class="st-material-topic-metric-bar">
                <div class="st-material-topic-metric-fill" style="width: ${Math.round(topic.y * 100)}%"></div>
              </div>
              <span class="st-material-topic-metric-value">${Math.round(topic.y * 100)}%</span>
            </div>
          </div>
          <div class="st-material-topic-priority">
            <span class="st-material-topic-priority-label">Priority:</span>
            <span class="st-material-topic-priority-value ${priorityClass}">${priorityLevel}</span>
          </div>
          <button class="st-material-topic-action-btn">View Strategic Actions</button>
        `;
        
        // Add click event for the action button
        topicCard.querySelector('.st-material-topic-action-btn').addEventListener('click', function() {
          // Show a modal or expand card with strategic actions
          const actionsList = getStrategicActions(topic.name, industry);
          
          // Create modal for strategic actions
          const modal = document.createElement('div');
          modal.className = 'st-modal';
          modal.innerHTML = `
            <div class="st-modal-content">
              <div class="st-modal-header">
                <h3>Strategic Actions: ${topic.name}</h3>
                <button class="st-modal-close">&times;</button>
              </div>
              <div class="st-modal-body">
                <ul class="st-strategic-actions-list">
                  ${actionsList.map(action => `<li>${action}</li>`).join('')}
                </ul>
              </div>
            </div>
          `;
          
          // Add close functionality
          modal.querySelector('.st-modal-close').addEventListener('click', function() {
            document.body.removeChild(modal);
          });
          
          // Add to body
          document.body.appendChild(modal);
        });
        
        topicsContainer.appendChild(topicCard);
      });
      
      // Add the topics to the container
      materialTopicsContainer.innerHTML = '';
      materialTopicsContainer.appendChild(topicsContainer);
      
      // Add explanation
      const explanation = document.createElement('div');
      explanation.className = 'st-ai-explanation st-mt-3';
      explanation.innerHTML = `
        <p><strong>About this analysis:</strong> The material topics assessment uses AI to evaluate 
        the most significant sustainability issues for ${industry} companies based on business impact 
        and stakeholder concern. These topics should form the foundation of your sustainability strategy.</p>
      `;
      materialTopicsContainer.appendChild(explanation);
    }
    
    // Strategic actions function
    function getStrategicActions(topicName, industry) {
      // Create custom strategic actions based on topic and industry
      const strategicActionsByTopic = {
        'Data Privacy & Security': [
          'Implement advanced encryption protocols for all customer data',
          'Conduct regular third-party security audits and penetration testing',
          'Establish a data privacy governance committee',
          'Develop comprehensive employee training on data security practices',
          'Create transparent data usage policies accessible to all customers'
        ],
        'Carbon Emissions': [
          'Set science-based targets for emissions reduction',
          'Implement energy efficiency measures across all facilities',
          'Transition to renewable energy sources where feasible',
          'Optimize logistics and transportation to reduce Scope 3 emissions',
          'Invest in carbon offset projects for unavoidable emissions'
        ],
        'Worker Safety': [
          'Implement comprehensive safety management systems',
          'Conduct regular safety training and emergency drills',
          'Invest in automation for high-risk manual tasks',
          'Establish robust incident reporting and investigation processes',
          'Develop leading safety performance indicators beyond compliance'
        ],
        'Sustainable Packaging': [
          'Redesign packaging to reduce material use by 30%',
          'Transition to biodegradable or recyclable packaging materials',
          'Implement a packaging take-back program for consumers',
          'Work with suppliers to reduce upstream packaging waste',
          'Invest in R&D for innovative sustainable packaging solutions'
        ],
        'Ethical AI': [
          'Establish an AI ethics committee with diverse representation',
          'Develop clear guidelines for ethical AI development and use',
          'Implement bias detection and mitigation in AI systems',
          'Ensure transparency in AI-driven decision processes',
          'Conduct regular audits of AI systems for ethical compliance'
        ]
      };
      
      // Generic actions by topic category
      const genericActionsByCategory = {
        'Environmental': [
          'Set measurable targets with clear timelines for improvement',
          'Implement monitoring and reporting systems to track progress',
          'Engage suppliers in sustainability initiatives',
          'Invest in efficiency technologies and process improvements',
          'Develop employee engagement programs focused on environmental impact'
        ],
        'Social': [
          'Establish clear policies and governance structures',
          'Conduct regular stakeholder engagement and feedback sessions',
          'Implement training programs for employees and management',
          'Set measurable goals and regularly report on progress',
          'Partner with industry initiatives and external organizations'
        ],
        'Governance': [
          'Strengthen board oversight of sustainability issues',
          'Enhance transparency in reporting and disclosures',
          'Align executive compensation with sustainability performance',
          'Implement robust compliance monitoring systems',
          'Engage with investors on sustainability governance'
        ]
      };
      
      // Categorize topics
      const environmentalTopics = ['Carbon Emissions', 'Energy Efficiency', 'Water Usage', 
        'Waste Reduction', 'E-waste Management', 'Material Efficiency', 'Environmental Compliance', 
        'Biodiversity', 'Air Quality', 'Sustainable Packaging', 'Product Lifecycle'];
      
      const socialTopics = ['Worker Safety', 'Community Relations', 'Digital Inclusion', 
        'Talent Diversity', 'Community Investment', 'Labor Practices', 'Diversity & Inclusion', 
        'Worker Welfare', 'Financial Inclusion', 'Financial Literacy'];
      
      const governanceTopics = ['Supply Chain Transparency', 'Ethical AI', 'Data Privacy & Security', 
        'Ethical Business Practices', 'Responsible Investing', 'Regulatory Compliance', 
        'Customer Privacy', 'Responsible Marketing', 'Supply Chain Management'];
      
      // Determine category
      let category;
      if (environmentalTopics.includes(topicName)) {
        category = 'Environmental';
      } else if (socialTopics.includes(topicName)) {
        category = 'Social';
      } else {
        category = 'Governance';
      }
      
      // Return topic-specific actions if available, otherwise generic actions for the category
      return strategicActionsByTopic[topicName] || genericActionsByCategory[category];
    }
    
    function generateAIInsights(company, industry, periods) {
      const insightsContainer = document.getElementById('ai-insights');
      insightsContainer.innerHTML = '';
      
      // Generate insights based on industry
      let insights = [];
      switch(industry) {
        case 'Technology':
          insights = [
            {
              title: "Carbon Emissions Reduction Pathway",
              content: `Based on the forecast, ${company} is projected to reduce carbon emissions by approximately 15-20% over the next ${periods} years, which aligns with the technology sector average but falls short of industry leaders who are targeting 30-40% reductions.`
            },
            {
              title: "Energy Efficiency Improvements",
              content: `The data center energy efficiency metrics show potential for significant improvement. By implementing AI-optimized cooling systems, ${company} could achieve an additional 12-15% energy reduction beyond the current forecast.`
            },
            {
              title: "E-Waste Management Opportunity",
              content: `Current e-waste recycling rates are projected to reach 65% by year ${new Date().getFullYear() + parseInt(periods)}. There is an opportunity to implement a circular economy program that could increase this to 85%, putting ${company} among industry leaders.`
            }
          ];
          break;
        case 'Manufacturing':
          insights = [
            {
              title: "Material Efficiency Trajectory",
              content: `${company}'s material efficiency is projected to improve steadily but could be accelerated through advanced manufacturing techniques. Implementing digital twin technology could reduce material waste by an additional 8-10%.`
            },
            {
              title: "Water Usage Optimization",
              content: `The forecast shows water usage decreasing gradually, but benchmark data indicates potential for more aggressive reduction. Process water recycling systems could reduce freshwater consumption by up to 30% beyond current projections.`
            },
            {
              title: "Supply Chain Emission Hotspots",
              content: `Scope 3 emissions analysis reveals that 65% of ${company}'s carbon footprint comes from raw material suppliers. Engaging with key suppliers on emissions reduction goals could significantly improve overall sustainability performance.`
            }
          ];
          break;
        case 'Energy':
          insights = [
            {
              title: "Renewable Energy Transition",
              content: `${company}'s renewable energy portfolio is projected to reach ${30 + Math.floor(Math.random() * 20)}% by ${new Date().getFullYear() + parseInt(periods)}. Accelerating this transition through strategic investments could yield both emissions benefits and long-term cost savings.`
            },
            {
              title: "Methane Leakage Reduction",
              content: `Current projections show methane leakage rates declining by 10-15% over the forecast period. Implementing advanced leak detection and repair (LDAR) technologies could potentially double this improvement rate.`
            },
            {
              title: "Community Impact Program Enhancement",
              content: `Benchmark analysis shows that leading energy companies are investing 1.5-2% of revenue in community programs focused on just transition initiatives. ${company}'s current forecast falls below this threshold, presenting an opportunity for enhanced social impact strategy.`
            }
          ];
          break;
        default:
          insights = [
            {
              title: "Carbon Reduction Strategy",
              content: `${company} is projected to reduce carbon emissions by approximately 10-15% over the next ${periods} years based on current initiatives. There is potential to achieve more aggressive reductions through targeted investments in efficiency and renewable energy.`
            },
            {
              title: "Resource Efficiency Opportunity",
              content: `The forecast indicates modest improvements in resource efficiency metrics. Benchmarking against industry leaders suggests an opportunity to implement more advanced circular economy principles into ${company}'s operations.`
            },
            {
              title: "Sustainability Reporting Enhancement",
              content: `Analysis of current disclosure practices indicates that ${company} would benefit from more comprehensive sustainability reporting aligned with ESRS standards. This would improve transparency and stakeholder engagement.`
            }
          ];
      }
      
      // Create insight elements
      insights.forEach(insight => {
        const insightElement = document.createElement('div');
        insightElement.className = 'st-insights-item';
        insightElement.innerHTML = `
          <div class="st-insights-item__title">${insight.title}</div>
          <div class="st-insights-item__content">${insight.content}</div>
        `;
        insightsContainer.appendChild(insightElement);
      });
    }
  });
</script>
{% endblock %}