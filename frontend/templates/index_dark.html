{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}Home - SustainaTrendâ„¢ Intelligence Platform{% endblock %}

{% block header_title %}Sustainability Intelligence Feed{% endblock %}

{% block header_actions %}
<span class="finchat-badge finchat-badge-primary">AI-Powered</span>
{% endblock %}

{% block additional_head %}
<script src="https://cdn.plot.ly/plotly-2.29.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
{% endblock %}

{% block main_content %}
<!-- Trends Overview -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-chart-line"></i> Latest Sustainability Trends
    </h3>
    
    <div class="analytics-overview">
        {% if metrics and metrics.metrics %}
            {% for metric in metrics.metrics[:4] %}
                <div class="analytics-metric">
                    <div class="analytics-metric-header">
                        <div class="analytics-metric-title">{{ metric.name }}</div>
                        <div class="analytics-metric-icon">
                            {% if metric.category == 'emissions' %}
                                <i class="fas fa-smog"></i>
                            {% elif metric.category == 'water' %}
                                <i class="fas fa-tint"></i>
                            {% elif metric.category == 'waste' %}
                                <i class="fas fa-trash"></i>
                            {% elif metric.category == 'energy' %}
                                <i class="fas fa-bolt"></i>
                            {% elif metric.category == 'social' %}
                                <i class="fas fa-users"></i>
                            {% else %}
                                <i class="fas fa-leaf"></i>
                            {% endif %}
                        </div>
                    </div>
                    <div class="analytics-metric-value">{{ metric.value }}</div>
                    <div class="analytics-metric-change positive">
                        <i class="fas fa-arrow-down"></i> {{ (metric.value % 10) + 1 }}% from last period
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="analytics-metric">
                <div class="analytics-metric-header">
                    <div class="analytics-metric-title">No metrics available</div>
                </div>
                <div class="analytics-metric-value">-</div>
            </div>
        {% endif %}
    </div>
</div>

<!-- AI Generated Insights -->
<div class="finchat-section">
    <div class="analytics-chart-row">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-chart-bar"></i> Sustainability Performance
                </h4>
            </div>
            <div class="analytics-chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
        
        <div class="analytics-insights">
            <div class="analytics-insight">
                <div class="analytics-insight-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div class="analytics-insight-content">
                    <h4>Emissions Reduction Trend</h4>
                    <p>Carbon emissions showing a positive downward trend of 12% over the past quarter, exceeding industry benchmarks.</p>
                </div>
            </div>
            
            <div class="analytics-insight">
                <div class="analytics-insight-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="analytics-insight-content">
                    <h4>Water Management Alert</h4>
                    <p>Water usage has increased by 5% in the past month. Consider implementing conservation measures.</p>
                </div>
            </div>
            
            <div class="analytics-insight">
                <div class="analytics-insight-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="analytics-insight-content">
                    <h4>ESG Leadership Position</h4>
                    <p>Your organization is now in the top 15% of ESG performers in your industry sector based on the latest benchmarks.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Trending Topics -->
<div class="finchat-section">
    <h3 class="finchat-section-title">
        <i class="fas fa-fire"></i> Trending Sustainability Topics
    </h3>
    
    <div class="analytics-category-breakdown">
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-hashtag"></i> Topic Virality
                </h4>
            </div>
            <div class="analytics-chart-container">
                <canvas id="topicsChart"></canvas>
            </div>
        </div>
        
        <div class="analytics-chart-card">
            <div class="analytics-chart-header">
                <h4 class="analytics-chart-title">
                    <i class="fas fa-globe"></i> Global Sustainability Focus
                </h4>
            </div>
            <div class="analytics-chart-container">
                <canvas id="globalFocusChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Latest Stories -->
<div class="finchat-section">
    <div class="analytics-recommendations">
        <div class="analytics-recommendations-header">
            <h4 class="analytics-recommendations-title">
                <i class="fas fa-newspaper"></i> Sustainability Stories
            </h4>
            <p class="analytics-recommendations-subtitle">AI-generated narratives based on your sustainability data</p>
        </div>
        
        <div class="analytics-recommendations-list">
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Carbon Reduction Success Story</h4>
                    <p>Your organization has decreased carbon emissions by 12.3% this quarter, primarily through energy efficiency improvements and renewable energy adoption.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Carbon</span>
                        <span class="analytics-recommendation-tag">Success</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-recycle"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Waste Reduction Initiative Impact</h4>
                    <p>The recent waste reduction initiatives have resulted in a 15% decrease in landfill waste, moving your organization closer to zero-waste goals.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Waste</span>
                        <span class="analytics-recommendation-tag">Circular Economy</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-recommendation">
                <div class="analytics-recommendation-icon">
                    <i class="fas fa-hand-holding-water"></i>
                </div>
                <div class="analytics-recommendation-content">
                    <h4>Water Management Challenge</h4>
                    <p>Recent data shows a 5% increase in water usage, particularly in operations. Consider implementing water recycling systems and conducting a water efficiency audit.</p>
                    <div class="analytics-recommendation-tags">
                        <span class="analytics-recommendation-tag">Water</span>
                        <span class="analytics-recommendation-tag">Improvement Area</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Performance Chart
        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        const performanceChart = new Chart(performanceCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [
                    {
                        label: 'Carbon Emissions',
                        data: [95, 92, 85, 80, 72, 65],
                        borderColor: '#ff6b81',
                        backgroundColor: 'rgba(255, 107, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Water Usage',
                        data: [70, 65, 68, 72, 75, 71],
                        borderColor: '#34c3ff',
                        backgroundColor: 'rgba(52, 195, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Waste Generation',
                        data: [60, 58, 55, 50, 48, 45],
                        borderColor: '#ffad63',
                        backgroundColor: 'rgba(255, 173, 99, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'ESG Score',
                        data: [72, 75, 78, 80, 81, 83],
                        borderColor: '#3dd598',
                        backgroundColor: 'rgba(61, 213, 152, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#a0a0a0'
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#a0a0a0'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#a0a0a0'
                        }
                    }
                }
            }
        });
        
        // Topics Chart
        const topicsCtx = document.getElementById('topicsChart').getContext('2d');
        const topicsChart = new Chart(topicsCtx, {
            type: 'bar',
            data: {
                labels: ['Carbon Markets', 'ESG Reporting', 'CSRD', 'Water Scarcity', 'Circular Economy'],
                datasets: [{
                    label: 'Virality Score',
                    data: [85, 75, 92, 68, 78],
                    backgroundColor: [
                        'rgba(61, 213, 152, 0.8)',
                        'rgba(52, 195, 255, 0.8)',
                        'rgba(255, 107, 129, 0.8)',
                        'rgba(255, 173, 99, 0.8)',
                        'rgba(157, 78, 221, 0.8)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#a0a0a0'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)'
                        },
                        ticks: {
                            color: '#a0a0a0'
                        }
                    }
                }
            }
        });
        
        // Global Focus Chart
        const globalFocusCtx = document.getElementById('globalFocusChart').getContext('2d');
        const globalFocusChart = new Chart(globalFocusCtx, {
            type: 'radar',
            data: {
                labels: ['North America', 'Europe', 'Asia', 'South America', 'Africa', 'Oceania'],
                datasets: [{
                    label: 'Carbon Focus',
                    data: [85, 95, 75, 65, 55, 70],
                    backgroundColor: 'rgba(255, 107, 129, 0.2)',
                    borderColor: 'rgba(255, 107, 129, 0.8)',
                    pointBackgroundColor: 'rgba(255, 107, 129, 1)'
                }, {
                    label: 'Water Focus',
                    data: [65, 75, 85, 80, 90, 60],
                    backgroundColor: 'rgba(52, 195, 255, 0.2)',
                    borderColor: 'rgba(52, 195, 255, 0.8)',
                    pointBackgroundColor: 'rgba(52, 195, 255, 1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#a0a0a0'
                        }
                    }
                },
                scales: {
                    r: {
                        angleLines: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        pointLabels: {
                            color: '#a0a0a0'
                        },
                        ticks: {
                            color: '#a0a0a0',
                            backdropColor: 'transparent'
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}