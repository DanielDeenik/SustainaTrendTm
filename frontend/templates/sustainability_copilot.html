{% extends "layouts/unified_layout.html" %}

{% block title %}Sustainability Co-Pilot - SustainaTrend™{% endblock %}

{% block styles %}
<style>
  .copilot-container {
    height: calc(100vh - 200px);
    min-height: 500px;
    display: flex;
    flex-direction: column;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid var(--border-color);
    background-color: var(--bg-secondary);
  }
  
  .chat-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: var(--bg-primary);
  }
  
  .chat-header h2 {
    font-size: 1.2rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .chat-header h2 svg {
    width: 20px;
    height: 20px;
  }
  
  .chat-messages {
    flex-grow: 1;
    padding: 16px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .message {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 12px;
    position: relative;
    line-height: 1.5;
  }
  
  .message.ai {
    align-self: flex-start;
    background-color: var(--bg-primary);
    border: 1px solid var(--border-color);
  }
  
  .message.user {
    align-self: flex-end;
    background-color: var(--color-primary);
    color: white;
  }
  
  .message-time {
    font-size: 0.7rem;
    opacity: 0.7;
    margin-top: 4px;
    text-align: right;
  }
  
  .chat-footer {
    padding: 12px 16px;
    border-top: 1px solid var(--border-color);
    background-color: var(--bg-primary);
  }
  
  .chat-input-container {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .chat-input {
    flex-grow: 1;
    padding: 12px 16px;
    border-radius: 24px;
    border: 1px solid var(--border-color);
    background-color: var(--bg-secondary);
    outline: none;
    font-size: 0.9rem;
  }
  
  .chat-input:focus {
    border-color: var(--color-primary);
  }
  
  .btn-send {
    background-color: var(--color-primary);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .btn-send:hover {
    background-color: var(--color-primary-dark);
  }
  
  .btn-voice {
    background-color: transparent;
    color: var(--color-primary);
    border: 1px solid var(--border-color);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .btn-voice:hover {
    background-color: var(--bg-hover);
  }
  
  .visualization-card {
    background-color: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 16px;
    margin-top: 12px;
    max-width: 100%;
  }
  
  .visualization-title {
    font-weight: 600;
    margin-bottom: 12px;
    font-size: 0.9rem;
  }
  
  .visualization-chart {
    height: 200px;
    background-color: var(--bg-secondary);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 12px;
  }
  
  .action-buttons {
    display: flex;
    gap: 8px;
    margin-top: 12px;
  }
  
  .action-btn {
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .action-btn.primary {
    background-color: var(--color-primary);
    color: white;
    border: none;
  }
  
  .action-btn.secondary {
    background-color: transparent;
    color: var(--text-primary);
    border: 1px solid var(--border-color);
  }
  
  .action-btn:hover {
    opacity: 0.9;
  }
  
  .suggestions {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    flex-wrap: wrap;
  }
  
  .suggestion-chip {
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 0.8rem;
    background-color: var(--bg-primary);
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: background-color 0.2s;
    white-space: nowrap;
  }
  
  .suggestion-chip:hover {
    background-color: var(--bg-hover);
    border-color: var(--color-primary);
  }
  
  .context-panel {
    background-color: var(--bg-primary);
    border-left: 1px solid var(--border-color);
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    height: 100%;
    overflow-y: auto;
  }
  
  .context-section {
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 16px;
  }
  
  .context-section:last-child {
    border-bottom: none;
  }
  
  .context-title {
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .context-metric {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.85rem;
  }
  
  .metric-value {
    font-weight: 500;
  }
  
  .trend-indicator {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.8rem;
  }
  
  .trend-up {
    color: #10b981;
  }
  
  .trend-down {
    color: #ef4444;
  }
  
  .typing-indicator {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.85rem;
    opacity: 0.7;
    margin-top: 4px;
  }
  
  .typing-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: currentColor;
    animation: typing-animation 1.4s infinite ease-in-out both;
  }
  
  .typing-dot:nth-child(1) {
    animation-delay: 0s;
  }
  
  .typing-dot:nth-child(2) {
    animation-delay: 0.2s;
  }
  
  .typing-dot:nth-child(3) {
    animation-delay: 0.4s;
  }
  
  @keyframes typing-animation {
    0%, 80%, 100% { transform: scale(0.6); }
    40% { transform: scale(1); }
  }
  
  @media (max-width: 768px) {
    .message {
      max-width: 90%;
    }
    
    .copilot-sidebar {
      display: none;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-lg-9">
      <div class="copilot-container">
        <div class="chat-header">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 16v-4"></path>
              <path d="M12 8h.01"></path>
            </svg>
            Sustainability Co-Pilot
          </h2>
          <div>
            <button class="btn btn-sm btn-outline-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path>
                <path d="M3 12v5h16a2 2 0 0 1 0 4H3v-4"></path>
              </svg>
              New Chat
            </button>
          </div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
          <div class="message ai">
            <div>I see you're looking at housing emissions data. Would you like to understand what's driving the recent 3.2% reduction?</div>
            <div class="message-time">Today, 10:32 AM</div>
          </div>
          
          <div class="message user">
            <div>Yes, please explain and compare to other housing corporations in the Netherlands</div>
            <div class="message-time">Today, 10:33 AM</div>
          </div>
          
          <div class="message ai">
            <div>The 3.2% reduction in housing emissions is primarily driven by three key factors:</div>
            <ol>
              <li>Renovation Wave participation (+41% year-over-year)</li>
              <li>Heat pump adoption in social housing (+28% year-over-year)</li>
              <li>Improved insulation standards across residential buildings</li>
            </ol>
            <div>Dutch housing corporations are outperforming the EU average of 1.8% reduction, but still lag behind Danish corporations who achieved a 4.1% reduction in the same period.</div>
            
            <div class="visualization-card">
              <div class="visualization-title">Emissions Reduction by Housing Corporation Type (2025-Q1)</div>
              <div class="visualization-chart">
                <img src="https://via.placeholder.com/500x200?text=Housing+Emissions+Chart" alt="Housing Emissions Chart" style="max-width: 100%; max-height: 100%;">
              </div>
              <div>Dutch housing corporations lead in renovation rate (41%), while Danish corporations excel in renewable energy integration (68% vs. 52% in Netherlands).</div>
              <div class="action-buttons">
                <button class="action-btn primary">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17.2 20H6.8a2 2 0 0 1-2-2V8.5a2.5 2.5 0 0 1 5 0V10a3 3 0 0 0 6 0V8.5a2.5 2.5 0 0 1 5 0V18a2 2 0 0 1-2 2z"></path>
                  </svg>
                  Save as Story Card
                </button>
                <button class="action-btn secondary">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                    <polyline points="16 6 12 2 8 6"></polyline>
                    <line x1="12" y1="2" x2="12" y2="15"></line>
                  </svg>
                  Share Insight
                </button>
                <button class="action-btn secondary">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                  </svg>
                  See Full Data
                </button>
              </div>
            </div>
            <div class="message-time">Today, 10:33 AM</div>
          </div>
        </div>
        
        <div class="chat-footer">
          <div class="suggestions">
            <div class="suggestion-chip">Show me the top renovation projects</div>
            <div class="suggestion-chip">Compare to German corporations</div>
            <div class="suggestion-chip">Forecast 2025 annual emissions</div>
            <div class="suggestion-chip">Calculate ROI of heat pump adoption</div>
          </div>
          <div class="chat-input-container">
            <button class="btn-voice" id="voice-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="22"></line>
              </svg>
            </button>
            <input type="text" class="chat-input" id="chat-input" placeholder="Ask me about sustainability...">
            <button class="btn-send" id="send-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 copilot-sidebar">
      <div class="context-panel">
        <div class="context-section">
          <div class="context-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 12a9 9 0 1 0 18 0 9 9 0 0 0-18 0"></path>
              <path d="M12 8v4l2 2"></path>
            </svg>
            Current Context
          </div>
          <div class="context-metric">
            <span>Housing Emissions (Q1 2025)</span>
            <span class="metric-value">124.3 ton CO2e</span>
          </div>
          <div class="context-metric">
            <span>Quarterly Change</span>
            <span class="metric-value trend-indicator trend-down">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m7 7 10 10-5 5V2H2l5 5z"></path>
              </svg>
              -3.2%
            </span>
          </div>
          <div class="context-metric">
            <span>YoY Change</span>
            <span class="metric-value trend-indicator trend-down">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m7 7 10 10-5 5V2H2l5 5z"></path>
              </svg>
              -12.5%
            </span>
          </div>
        </div>
        
        <div class="context-section">
          <div class="context-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="2" x2="12" y2="22"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            Related Metrics
          </div>
          <div class="context-metric">
            <span>Renovation Rate</span>
            <span class="metric-value trend-indicator trend-up">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m7 7 10 10-5 5V2H2l5 5z"></path>
              </svg>
              +41%
            </span>
          </div>
          <div class="context-metric">
            <span>Heat Pump Adoption</span>
            <span class="metric-value trend-indicator trend-up">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m7 7 10 10-5 5V2H2l5 5z"></path>
              </svg>
              +28%
            </span>
          </div>
          <div class="context-metric">
            <span>Renewable Energy Share</span>
            <span class="metric-value">52%</span>
          </div>
        </div>
        
        <div class="context-section">
          <div class="context-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 12h5"></path>
              <path d="M17 12h5"></path>
              <path d="M12 2v5"></path>
              <path d="M12 17v5"></path>
              <path d="m4.93 4.93 3.54 3.53"></path>
              <path d="m15.54 15.54 3.53 3.53"></path>
              <path d="m15.54 8.46 3.53-3.53"></path>
              <path d="m4.93 19.07 3.54-3.53"></path>
            </svg>
            Benchmarks
          </div>
          <div class="context-metric">
            <span>EU Average</span>
            <span class="metric-value trend-indicator trend-down">-1.8%</span>
          </div>
          <div class="context-metric">
            <span>Danish Corporations</span>
            <span class="metric-value trend-indicator trend-down">-4.1%</span>
          </div>
          <div class="context-metric">
            <span>German Corporations</span>
            <span class="metric-value trend-indicator trend-down">-2.7%</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const voiceBtn = document.getElementById('voice-btn');
    const chatMessages = document.getElementById('chat-messages');
    const suggestionChips = document.querySelectorAll('.suggestion-chip');
    
    // Handle send button click
    sendBtn.addEventListener('click', function() {
      sendMessage();
    });
    
    // Handle enter key press
    chatInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
    
    // Handle voice button click
    voiceBtn.addEventListener('click', function() {
      // This would be where voice input is implemented
      // For now, just show a message
      alert('Voice input feature coming soon!');
    });
    
    // Handle suggestion chips
    suggestionChips.forEach(chip => {
      chip.addEventListener('click', function() {
        chatInput.value = chip.textContent;
        sendMessage();
      });
    });
    
    function sendMessage() {
      const message = chatInput.value.trim();
      if (message) {
        // Add user message to chat
        addMessage(message, 'user');
        
        // Clear input
        chatInput.value = '';
        
        // Show typing indicator
        showTypingIndicator();
        
        // Simulate response after a delay
        setTimeout(() => {
          // Remove typing indicator
          hideTypingIndicator();
          
          // Add AI response
          const responses = [
            "Based on current adoption rates, I forecast a 15.2% total emissions reduction for Dutch housing corporations by the end of 2025. This exceeds the national target of 12% and puts the sector on track for its 2030 goals.",
            "Looking at renovation projects, the most impactful have been: 1) Spijkenisse Neighborhood Renewal (+68% efficiency), 2) Utrecht Social Housing Retrofit (+52% efficiency), and 3) Rotterdam Harbor District (+46% efficiency).",
            "Comparing to German housing corporations, Dutch entities are 0.5% ahead in quarterly reduction rates, but German corporations lead in absolute emissions with 17% lower baseline intensity due to earlier adoption of district heating.",
            "The ROI analysis on heat pump adoption shows: Initial investment: €8,200/unit, Annual savings: €840/unit, Carbon reduction: 1.8 ton CO2e/unit/year, Payback period: 9.8 years without subsidies, 5.3 years with current subsidies."
          ];
          
          // Choose a response based on the message
          let responseIndex = Math.floor(Math.random() * responses.length);
          if (message.toLowerCase().includes("renovation")) responseIndex = 1;
          if (message.toLowerCase().includes("german")) responseIndex = 2;
          if (message.toLowerCase().includes("roi") || message.toLowerCase().includes("heat pump")) responseIndex = 3;
          if (message.toLowerCase().includes("forecast")) responseIndex = 0;
          
          addMessage(responses[responseIndex], 'ai');
        }, 1500);
      }
    }
    
    function addMessage(text, sender) {
      const now = new Date();
      const timeString = `Today, ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')} ${now.getHours() >= 12 ? 'PM' : 'AM'}`;
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      const messageContent = document.createElement('div');
      messageContent.textContent = text;
      
      const messageTime = document.createElement('div');
      messageTime.className = 'message-time';
      messageTime.textContent = timeString;
      
      messageDiv.appendChild(messageContent);
      messageDiv.appendChild(messageTime);
      
      chatMessages.appendChild(messageDiv);
      
      // Scroll to bottom
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message ai';
      typingDiv.id = 'typing-indicator';
      
      const typingIndicator = document.createElement('div');
      typingIndicator.className = 'typing-indicator';
      
      for (let i = 0; i < 3; i++) {
        const dot = document.createElement('div');
        dot.className = 'typing-dot';
        typingIndicator.appendChild(dot);
      }
      
      typingDiv.appendChild(typingIndicator);
      chatMessages.appendChild(typingDiv);
      
      // Scroll to bottom
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function hideTypingIndicator() {
      const typingIndicator = document.getElementById('typing-indicator');
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }
    
    // Focus input on page load
    chatInput.focus();
  });
</script>
{% endblock %}