<!-- Compliance Visualization Card - Finchat.io-inspired Design -->
<div class="p-3">
    <!-- Compliance Visualization Container -->
    <div id="compliance-visualization-container">
        <!-- Framework Selection & Analysis Form -->
        <div class="card bg-darker border-0 rounded-4 shadow-sm mb-4">
            <div class="card-body p-4">
                <h5 class="d-flex align-items-center mb-3 text-danger">
                    <i class="fas fa-balance-scale me-2"></i> Compliance Gap Analysis
                </h5>
                
                <div class="mb-3">
                    <label for="documentInput" class="form-label text-muted small">Select or upload a sustainability report</label>
                    <select class="form-select bg-darker border-0 rounded-pill" id="documentInput">
                        <option value="">Select a document...</option>
                        <option value="latest_report">Latest Sustainability Report</option>
                        <option value="annual_report">Annual Report 2024</option>
                        <option value="climate_disclosure">Climate Disclosure 2024</option>
                        <option value="upload_new">Upload a new document...</option>
                    </select>
                </div>
                
                <div id="uploadDocumentForm" style="display: none;" class="mb-3">
                    <div class="input-group">
                        <input type="file" class="form-control bg-darker border-0" id="complianceDocumentUpload" accept=".pdf,.docx,.txt">
                        <button class="btn btn-outline-danger" type="button" id="uploadComplianceDocBtn">
                            <i class="fas fa-upload me-1"></i> Upload
                        </button>
                    </div>
                </div>
                
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label for="frameworkSelect" class="form-label text-muted small">Regulatory framework</label>
                        <select class="form-select bg-darker border-0 rounded-pill" id="frameworkSelect">
                            <option value="CSRD">CSRD (Corporate Sustainability Reporting Directive)</option>
                            <option value="ESRS">ESRS (European Sustainability Reporting Standards)</option>
                            <option value="SFDR">SFDR (Sustainable Finance Disclosure Regulation)</option>
                            <option value="TCFD">TCFD (Task Force on Climate-related Financial Disclosures)</option>
                            <option value="GRI">GRI (Global Reporting Initiative)</option>
                            <option value="SASB">SASB (Sustainability Accounting Standards Board)</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="industryComplianceInput" class="form-label text-muted small">Industry sector</label>
                        <select class="form-select bg-darker border-0 rounded-pill" id="industryComplianceInput">
                            <option value="General">General</option>
                            <option value="Technology">Technology</option>
                            <option value="Manufacturing">Manufacturing</option>
                            <option value="Energy">Energy</option>
                            <option value="Financial Services">Financial Services</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Retail">Retail</option>
                            <option value="Transportation">Transportation</option>
                            <option value="Agriculture">Agriculture</option>
                            <option value="Construction">Construction</option>
                            <option value="Real Estate">Real Estate</option>
                        </select>
                    </div>
                </div>
                
                <form id="complianceAnalysisForm">
                    <div class="d-grid">
                        <button type="submit" class="btn btn-danger btn-lg rounded-pill" id="generateComplianceBtn">
                            <i class="fas fa-search me-2"></i> Analyze Compliance Gaps
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Loading Indicator -->
        <div id="complianceLoading" class="text-center my-5 py-5" style="display: none;">
            <div class="position-relative d-inline-block loading-container">
                <div class="spinner-grow text-danger" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Analyzing...</span>
                </div>
                <div class="spinner-grow text-danger position-absolute top-0 start-0" role="status" style="width: 3rem; height: 3rem; opacity: 0.3; animation-delay: 0.2s;">
                    <span class="visually-hidden">Analyzing...</span>
                </div>
                <div class="spinner-grow text-danger position-absolute top-0 start-0" role="status" style="width: 3rem; height: 3rem; opacity: 0.1; animation-delay: 0.4s;">
                    <span class="visually-hidden">Analyzing...</span>
                </div>
            </div>
            <p class="mt-4 text-danger fw-bold">Analyzing your document against regulatory requirements...</p>
            <div class="progress mt-2" style="height: 8px; max-width: 300px; margin: 0 auto;">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: 100%"></div>
            </div>
        </div>
        
        <!-- Compliance Results -->
        <div id="complianceResults" style="display: none;">
            <!-- Header with Framework Badge -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0 fw-bold" id="complianceFrameworkTitle">CSRD Compliance Analysis</h4>
                <div>
                    <span class="badge bg-danger rounded-pill px-3 py-2 me-2" id="complianceScoreBadge">72%</span>
                    <span class="badge bg-secondary rounded-pill px-3 py-2" id="complianceIndustryBadge">Technology</span>
                </div>
            </div>
            
            <!-- Compliance Overview Card -->
            <div class="card bg-darker border-0 rounded-4 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h5 class="mb-3 text-danger"><i class="fas fa-chart-pie me-2"></i>Compliance Overview</h5>
                    <div id="complianceSummaryDiv" class="mb-4">
                        <p id="complianceSummary" class="lead"></p>
                    </div>
                    
                    <!-- Compliance Score Card -->
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="card bg-darker border-0 shadow-sm rounded-4">
                                <div class="card-body p-3">
                                    <h6 class="text-muted mb-1 small">Overall Compliance</h6>
                                    <div class="d-flex align-items-center">
                                        <div class="compliance-score-chart flex-grow-1" style="height: 6px;">
                                            <div class="progress" style="height: 6px;">
                                                <div id="overallComplianceBar" class="progress-bar bg-danger" role="progressbar" style="width: 72%"></div>
                                            </div>
                                        </div>
                                        <span id="overallComplianceScore" class="ms-3 text-danger fw-bold h4 mb-0">72%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-darker border-0 shadow-sm rounded-4">
                                <div class="card-body p-3">
                                    <h6 class="text-muted mb-1 small">Industry Average</h6>
                                    <div class="d-flex align-items-center">
                                        <div class="compliance-score-chart flex-grow-1" style="height: 6px;">
                                            <div class="progress" style="height: 6px;">
                                                <div id="industryComplianceBar" class="progress-bar bg-secondary" role="progressbar" style="width: 65%"></div>
                                            </div>
                                        </div>
                                        <span id="industryComplianceScore" class="ms-3 text-secondary fw-bold h4 mb-0">65%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Compliance Heatmap -->
            <div class="card bg-darker border-0 rounded-4 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h5 class="mb-3 text-danger"><i class="fas fa-th me-2"></i>Compliance Heatmap</h5>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="small text-muted">Compliance level:</span>
                            <div class="d-flex gap-2 align-items-center">
                                <span class="small"><i class="fas fa-square text-danger"></i> Low</span>
                                <span class="small"><i class="fas fa-square text-warning"></i> Medium</span>
                                <span class="small"><i class="fas fa-square text-success"></i> High</span>
                            </div>
                        </div>
                        
                        <!-- Compliance Heatmap Container -->
                        <div id="complianceHeatmapContainer" class="py-2" style="min-height: 350px">
                            <!-- Will be generated by JS -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Compliance Gap Details -->
            <div class="card bg-darker border-0 rounded-4 shadow-sm mb-4">
                <div class="card-body p-4">
                    <h5 class="mb-3 text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Critical Gaps</h5>
                    
                    <div id="criticalGapsList" class="mb-4">
                        <!-- Generated by JavaScript -->
                    </div>
                    
                    <h5 class="mb-3 text-warning"><i class="fas fa-exclamation-circle me-2"></i>Improvement Areas</h5>
                    
                    <div id="improvementAreasList" class="mb-4">
                        <!-- Generated by JavaScript -->
                    </div>
                    
                    <h5 class="mb-3 text-success"><i class="fas fa-check-circle me-2"></i>Strengths</h5>
                    
                    <div id="strengthsList">
                        <!-- Generated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="d-flex justify-content-between">
                <button class="btn btn-outline-danger rounded-pill" id="backToComplianceForm">
                    <i class="fas fa-arrow-left me-2"></i> New Analysis
                </button>
                
                <div>
                    <button class="btn btn-outline-secondary rounded-pill me-2" id="exportComplianceBtn">
                        <i class="fas fa-file-export me-2"></i> Export
                    </button>
                    <button class="btn btn-danger rounded-pill" id="generateComplianceReportBtn">
                        <i class="fas fa-file-pdf me-2"></i> Full Compliance Report
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Compliance Visualization -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set up document selector
    const documentInput = document.getElementById('documentInput');
    const uploadDocumentForm = document.getElementById('uploadDocumentForm');
    
    if (documentInput) {
        documentInput.addEventListener('change', function() {
            if (this.value === 'upload_new') {
                uploadDocumentForm.style.display = 'block';
            } else {
                uploadDocumentForm.style.display = 'none';
            }
        });
    }
    
    // Set up compliance analysis form
    const complianceForm = document.getElementById('complianceAnalysisForm');
    if (complianceForm) {
        complianceForm.addEventListener('submit', function(e) {
            e.preventDefault();
            generateComplianceAnalysis();
        });
    }
    
    // Back to form button
    const backToFormBtn = document.getElementById('backToComplianceForm');
    if (backToFormBtn) {
        backToFormBtn.addEventListener('click', function() {
            document.getElementById('complianceResults').style.display = 'none';
            document.getElementById('compliance-visualization-container').querySelector('form').reset();
            document.getElementById('uploadDocumentForm').style.display = 'none';
            document.getElementById('complianceLoading').style.display = 'none';
        });
    }
    
    // Generate compliance report button
    const generateReportBtn = document.getElementById('generateComplianceReportBtn');
    if (generateReportBtn) {
        generateReportBtn.addEventListener('click', function() {
            alert('Generating full compliance report...');
            // In a real implementation, this would trigger a PDF generation
        });
    }
    
    // Export compliance data button
    const exportBtn = document.getElementById('exportComplianceBtn');
    if (exportBtn) {
        exportBtn.addEventListener('click', function() {
            alert('Exporting compliance data...');
            // In a real implementation, this would export JSON or CSV
        });
    }
});

/**
 * Generate compliance analysis based on form inputs
 */
function generateComplianceAnalysis() {
    const documentInput = document.getElementById('documentInput').value;
    const frameworkSelect = document.getElementById('frameworkSelect').value;
    const industryInput = document.getElementById('industryComplianceInput').value;
    
    // Basic validation
    if (!documentInput) {
        alert('Please select a document for analysis.');
        return;
    }
    
    // Show loading animation
    document.getElementById('complianceLoading').style.display = 'block';
    document.getElementById('complianceResults').style.display = 'none';
    
    // Simulate API call with timeout
    setTimeout(() => {
        // Hide loading and show results
        document.getElementById('complianceLoading').style.display = 'none';
        document.getElementById('complianceResults').style.display = 'block';
        
        // Update UI with selected framework and industry
        document.getElementById('complianceFrameworkTitle').textContent = frameworkSelect + ' Compliance Analysis';
        document.getElementById('complianceIndustryBadge').textContent = industryInput;
        
        // Generate compliance data
        const complianceData = generateComplianceData(frameworkSelect, industryInput);
        
        // Update compliance summary
        document.getElementById('complianceSummary').textContent = complianceData.summary;
        
        // Update compliance scores
        document.getElementById('overallComplianceScore').textContent = complianceData.overallScore + '%';
        document.getElementById('overallComplianceBar').style.width = complianceData.overallScore + '%';
        document.getElementById('complianceScoreBadge').textContent = complianceData.overallScore + '%';
        
        document.getElementById('industryComplianceScore').textContent = complianceData.industryAverage + '%';
        document.getElementById('industryComplianceBar').style.width = complianceData.industryAverage + '%';
        
        // Update color of compliance score based on value
        updateComplianceScoreColor('overallComplianceScore', 'overallComplianceBar', complianceData.overallScore);
        
        // Generate heatmap
        generateComplianceHeatmap(complianceData.categories);
        
        // Populate gap details
        populateComplianceGaps(complianceData);
        
    }, 2500); // Simulate delay
}

/**
 * Generate simulated compliance data based on framework and industry
 */
function generateComplianceData(framework, industry) {
    // This would typically come from an API call to the backend
    // For demo purposes, we'll generate mock data
    const randomScore = Math.floor(60 + Math.random() * 30); // 60-90%
    const industryScore = Math.max(40, randomScore - 5 - Math.floor(Math.random() * 10)); // Industry average usually lower
    
    // Generate category data based on framework
    const categories = [];
    let categoryNames = [];
    
    switch(framework) {
        case 'CSRD':
            categoryNames = [
                'Governance', 'Strategy', 'Implementation', 
                'Performance Measurement', 'Environmental', 'Social', 
                'Human Rights', 'Anti-corruption', 'Metrics'
            ];
            break;
        case 'ESRS':
            categoryNames = [
                'E1 Climate', 'E2 Pollution', 'E3 Water', 
                'E4 Biodiversity', 'E5 Resources', 'S1 Workers', 
                'S2 Communities', 'S3 Consumers', 'G1 Governance'
            ];
            break;
        case 'SFDR':
            categoryNames = [
                'ESG Integration', 'Adverse Impacts', 'Remuneration',
                'Sustainability Risk', 'Carbon Footprint', 'Due Diligence',
                'Engagement Policies', 'Sustainable Investments', 'Product Disclosure'
            ];
            break;
        case 'TCFD':
            categoryNames = [
                'Governance', 'Strategy', 'Risk Management',
                'Metrics & Targets', 'Transition Plans', 'Scenario Analysis',
                'Climate Opportunities', 'Physical Risks', 'Transition Risks'
            ];
            break;
        default:
            categoryNames = [
                'Governance', 'Environmental', 'Social', 
                'Economic', 'Strategy', 'Risk Management', 
                'Metrics', 'Disclosure', 'Industry-Specific'
            ];
    }
    
    // Create random scores for each category (with some consistency based on framework and industry)
    categoryNames.forEach(category => {
        // Base score on overall score with variation
        const scoreSeed = category.length + industry.charCodeAt(0) + framework.charCodeAt(0);
        const variation = (scoreSeed % 20) - 10; // -10 to +10 variation
        const score = Math.max(30, Math.min(95, randomScore + variation));
        
        categories.push({
            name: category,
            score: score,
            requirements: 4 + Math.floor(Math.random() * 4) // 4-7 requirements per category
        });
    });
    
    // Generate compliance summary
    const summary = `Your ${industry} organization is ${randomScore < 70 ? 'partially' : 'largely'} compliant with ${framework} requirements, with an overall score of ${randomScore}%. ${randomScore > industryScore ? 'This exceeds' : 'This is close to'} the industry average of ${industryScore}%. ${randomScore < 80 ? 'Several gaps were identified that require attention.' : 'Minor improvements could further enhance compliance.'}`
    
    return {
        framework: framework,
        industry: industry,
        overallScore: randomScore,
        industryAverage: industryScore,
        summary: summary,
        categories: categories
    };
}

/**
 * Update the color of compliance score based on value
 */
function updateComplianceScoreColor(scoreId, barId, score) {
    const scoreElement = document.getElementById(scoreId);
    const barElement = document.getElementById(barId);
    
    if (scoreElement && barElement) {
        if (score >= 80) {
            scoreElement.classList.remove('text-danger', 'text-warning');
            scoreElement.classList.add('text-success');
            barElement.classList.remove('bg-danger', 'bg-warning');
            barElement.classList.add('bg-success');
        } else if (score >= 60) {
            scoreElement.classList.remove('text-danger', 'text-success');
            scoreElement.classList.add('text-warning');
            barElement.classList.remove('bg-danger', 'bg-success');
            barElement.classList.add('bg-warning');
        } else {
            scoreElement.classList.remove('text-warning', 'text-success');
            scoreElement.classList.add('text-danger');
            barElement.classList.remove('bg-warning', 'bg-success');
            barElement.classList.add('bg-danger');
        }
    }
}

/**
 * Generate a compliance heatmap visualization
 */
function generateComplianceHeatmap(categories) {
    const container = document.getElementById('complianceHeatmapContainer');
    if (!container) return;
    
    // Clear existing content
    container.innerHTML = '';
    
    // Create heatmap table
    const table = document.createElement('table');
    table.className = 'table table-dark table-borderless mb-0';
    
    // Create header row with category names
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    
    // Add empty first cell for row headers
    const emptyCell = document.createElement('th');
    emptyCell.className = 'text-muted small';
    emptyCell.textContent = 'Requirements';
    headerRow.appendChild(emptyCell);
    
    // Add category headers
    categories.forEach(category => {
        const th = document.createElement('th');
        th.className = 'text-center';
        th.style.width = '10%';
        
        // Create rotated text for vertical headers
        const headerDiv = document.createElement('div');
        headerDiv.className = 'vertical-header';
        headerDiv.style.transformOrigin = 'bottom left';
        headerDiv.style.transform = 'translateX(50%) rotate(-45deg)';
        headerDiv.style.width = 'max-content';
        headerDiv.style.position = 'relative';
        headerDiv.style.bottom = '-15px';
        headerDiv.style.left = '50%';
        headerDiv.innerHTML = `<span class="small">${category.name}</span>`;
        
        th.appendChild(headerDiv);
        headerRow.appendChild(th);
    });
    
    thead.appendChild(headerRow);
    table.appendChild(thead);
    
    // Create body with cells
    const tbody = document.createElement('tbody');
    
    // Get maximum number of requirements
    const maxRequirements = Math.max(...categories.map(c => c.requirements));
    
    // Create rows for each requirement
    for (let i = 0; i < maxRequirements; i++) {
        const row = document.createElement('tr');
        
        // Row header
        const rowHeader = document.createElement('th');
        rowHeader.className = 'text-muted small';
        rowHeader.textContent = `Req. ${i + 1}`;
        row.appendChild(rowHeader);
        
        // Create cells for each category
        categories.forEach(category => {
            const cell = document.createElement('td');
            cell.className = 'text-center p-2';
            
            // Only generate a cell if this category has this many requirements
            if (i < category.requirements) {
                // Generate a random compliance score for this specific requirement
                const requirementScore = Math.floor(
                    Math.random() * 40 + // Random component
                    Math.min(60, category.score) // Base on category score
                );
                
                // Create the compliance cell with color based on score
                const cellInner = document.createElement('div');
                cellInner.className = 'compliance-cell rounded';
                cellInner.style.height = '30px';
                cellInner.style.width = '100%';
                
                // Set color based on score
                if (requirementScore >= 80) {
                    cellInner.className += ' bg-success bg-opacity-70';
                    cellInner.setAttribute('title', 'Compliant: ' + requirementScore + '%');
                } else if (requirementScore >= 60) {
                    cellInner.className += ' bg-warning bg-opacity-70';
                    cellInner.setAttribute('title', 'Partially Compliant: ' + requirementScore + '%');
                } else {
                    cellInner.className += ' bg-danger bg-opacity-70';
                    cellInner.setAttribute('title', 'Non-Compliant: ' + requirementScore + '%');
                }
                
                cell.appendChild(cellInner);
            }
            
            row.appendChild(cell);
        });
        
        tbody.appendChild(row);
    }
    
    table.appendChild(tbody);
    container.appendChild(table);
}

/**
 * Populate compliance gaps details
 */
function populateComplianceGaps(data) {
    // Get containers
    const criticalGapsList = document.getElementById('criticalGapsList');
    const improvementAreasList = document.getElementById('improvementAreasList');
    const strengthsList = document.getElementById('strengthsList');
    
    if (!criticalGapsList || !improvementAreasList || !strengthsList) return;
    
    // Clear existing content
    criticalGapsList.innerHTML = '';
    improvementAreasList.innerHTML = '';
    strengthsList.innerHTML = '';
    
    // Helper function to create gap item
    function createGapItem(text, icon, colorClass) {
        const item = document.createElement('div');
        item.className = 'mb-3';
        
        const card = document.createElement('div');
        card.className = `card bg-${colorClass} bg-opacity-10 border-0 rounded-4`;
        
        const cardBody = document.createElement('div');
        cardBody.className = 'card-body py-2 px-3';
        
        const content = document.createElement('div');
        content.className = 'd-flex align-items-start';
        
        const iconSpan = document.createElement('span');
        iconSpan.className = `me-2 text-${colorClass}`;
        iconSpan.innerHTML = `<i class="${icon}"></i>`;
        
        const textSpan = document.createElement('span');
        textSpan.textContent = text;
        
        content.appendChild(iconSpan);
        content.appendChild(textSpan);
        
        cardBody.appendChild(content);
        card.appendChild(cardBody);
        item.appendChild(card);
        
        return item;
    }
    
    // Sort categories by score
    const sortedCategories = [...data.categories].sort((a, b) => a.score - b.score);
    
    // Create critical gaps (from lowest scoring categories)
    const criticalCategories = sortedCategories.filter(c => c.score < 60);
    if (criticalCategories.length > 0) {
        criticalCategories.forEach(category => {
            const gapText = generateGapText(category.name, data.framework, 'critical');
            criticalGapsList.appendChild(createGapItem(gapText, 'fas fa-exclamation-triangle', 'danger'));
        });
    } else {
        criticalGapsList.innerHTML = '<p class="text-muted">No critical gaps identified.</p>';
    }
    
    // Create improvement areas (mid-range scores)
    const improvementCategories = sortedCategories.filter(c => c.score >= 60 && c.score < 80);
    if (improvementCategories.length > 0) {
        improvementCategories.slice(0, 3).forEach(category => {
            const gapText = generateGapText(category.name, data.framework, 'improvement');
            improvementAreasList.appendChild(createGapItem(gapText, 'fas fa-exclamation-circle', 'warning'));
        });
    } else {
        improvementAreasList.innerHTML = '<p class="text-muted">No improvement areas identified.</p>';
    }
    
    // Create strengths (highest scoring categories)
    const strengthCategories = sortedCategories.filter(c => c.score >= 80);
    if (strengthCategories.length > 0) {
        // Sort descending for strengths
        strengthCategories.sort((a, b) => b.score - a.score);
        
        strengthCategories.slice(0, 3).forEach(category => {
            const strengthText = generateGapText(category.name, data.framework, 'strength');
            strengthsList.appendChild(createGapItem(strengthText, 'fas fa-check-circle', 'success'));
        });
    } else {
        strengthsList.innerHTML = '<p class="text-muted">No significant strengths identified.</p>';
    }
}

/**
 * Generate text for compliance gaps and strengths
 */
function generateGapText(category, framework, type) {
    // This would typically be generated by an AI model based on actual analysis
    // Here we'll use template text based on category and framework
    
    const frameworkAbbr = framework;
    
    if (type === 'critical') {
        const criticalTexts = [
            `Insufficient ${category} disclosure does not meet ${frameworkAbbr} requirements.`,
            `${category} reporting lacks required quantitative metrics under ${frameworkAbbr}.`,
            `${category} section missing required forward-looking information.`,
            `No evidence of ${category} governance oversight as required by ${frameworkAbbr}.`,
            `${category} risk assessment is incomplete according to ${frameworkAbbr} standards.`
        ];
        return criticalTexts[Math.floor(Math.random() * criticalTexts.length)];
    } 
    else if (type === 'improvement') {
        const improvementTexts = [
            `${category} disclosures could be enhanced with more specific KPIs.`,
            `${category} section needs more detailed methodology explanations.`,
            `Improve alignment between ${category} disclosures and financial reporting.`,
            `${category} impacts could be better quantified with metrics.`,
            `Strengthen ${category} narrative with more industry benchmarking.`
        ];
        return improvementTexts[Math.floor(Math.random() * improvementTexts.length)];
    }
    else { // strength
        const strengthTexts = [
            `Strong ${category} disclosures exceed ${frameworkAbbr} requirements.`,
            `Comprehensive ${category} metrics with clear methodologies.`,
            `Excellent ${category} governance structure and oversight.`,
            `${category} reporting includes robust scenario analysis.`,
            `${category} strategy clearly linked to business model.`
        ];
        return strengthTexts[Math.floor(Math.random() * strengthTexts.length)];
    }
}
</script>

<!-- Add custom CSS for compliance heatmap -->
<style>
.vertical-header {
    white-space: nowrap;
}
.compliance-cell {
    transition: transform 0.2s;
}
.compliance-cell:hover {
    transform: scale(1.1);
    cursor: pointer;
}
</style>