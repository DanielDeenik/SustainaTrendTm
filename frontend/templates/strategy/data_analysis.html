{% extends "layouts/finchat_dark_layout.html" %}

{% set active_page = 'strategy_hub' %}

{% block header_title %}
<i class="fas fa-chart-bar me-2"></i> Data Analysis
{% endblock %}

{% block additional_styles %}
<style>
    .analysis-container {
        background-color: #1e1e2d;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .analysis-header {
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #2d2d3d;
        padding-bottom: 1rem;
    }
    
    .analysis-section {
        margin-bottom: 2rem;
    }
    
    .analysis-chart {
        background-color: #2a2a3a;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }
    
    .recommendation-card {
        background-color: #2a2a3a;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid #6078ea;
    }
    
    .insight-card {
        background-color: #2a2a3a;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        border-left: 4px solid #20c997;
    }
    
    .tab-content {
        padding: 1.5rem 0;
    }
    
    .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        padding: 0.75rem 1rem;
        border-bottom: 2px solid transparent;
    }
    
    .nav-tabs .nav-link.active {
        color: #6078ea;
        background-color: transparent;
        border-bottom: 2px solid #6078ea;
    }
    
    .nav-tabs .nav-link:hover {
        border-color: transparent;
        border-bottom: 2px solid #6078ea;
    }
    
    .metric-card {
        background-color: #2a2a3a;
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        margin-bottom: 1rem;
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .metric-title {
        font-size: 0.9rem;
        color: #6c757d;
    }
    
    .trend-positive {
        color: #20c997;
    }
    
    .trend-negative {
        color: #dc3545;
    }
    
    .trend-neutral {
        color: #ffc107;
    }
    
    .data-table {
        background-color: #2a2a3a;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }
    
    .table {
        color: #e0e0e0;
    }
    
    .table thead th {
        border-bottom: 1px solid #3a3a4a;
        color: #6c757d;
    }
    
    .table td, .table th {
        border-top: 1px solid #3a3a4a;
    }
</style>
{% endblock %}

{% block main_content %}
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('strategy.unified_strategy_hub') }}">Strategy Hub</a></li>
                <li class="breadcrumb-item active" aria-current="page">Data Analysis</li>
            </ol>
        </nav>
    </div>
</div>

<div class="analysis-container">
    <div class="analysis-header d-flex justify-content-between align-items-center">
        <div>
            <h2 class="mb-1">Data Analysis</h2>
            <p class="text-muted">File ID: {{ file_id }}</p>
        </div>
        <a href="{{ url_for('strategy.unified_strategy_hub') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i> Back to Strategy Hub
        </a>
    </div>
    
    <ul class="nav nav-tabs" id="analysisTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="emissions-tab" data-bs-toggle="tab" data-bs-target="#emissions" type="button" role="tab" aria-controls="emissions" aria-selected="false">Emissions</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="resources-tab" data-bs-toggle="tab" data-bs-target="#resources" type="button" role="tab" aria-controls="resources" aria-selected="false">Resources</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="recommendations-tab" data-bs-toggle="tab" data-bs-target="#recommendations" type="button" role="tab" aria-controls="recommendations" aria-selected="false">Recommendations</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="raw-data-tab" data-bs-toggle="tab" data-bs-target="#raw-data" type="button" role="tab" aria-controls="raw-data" aria-selected="false">Raw Data</button>
        </li>
    </ul>
    
    <div class="tab-content" id="analysisTabContent">
        <!-- Overview Tab -->
        <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i> This is a demo of the data analysis interface. In a production environment, this would display real analysis results for the uploaded file.
                    </div>
                </div>
                
                <!-- Key Metrics -->
                <div class="col-12 mb-4">
                    <h4>Key Metrics</h4>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value text-success">45.2%</div>
                                <div class="metric-title">Emission Reduction</div>
                                <div class="trend-positive">
                                    <i class="fas fa-arrow-up me-1"></i> 12.3%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value text-warning">72.8%</div>
                                <div class="metric-title">Resource Efficiency</div>
                                <div class="trend-neutral">
                                    <i class="fas fa-equals me-1"></i> 0.5%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value text-danger">62.4%</div>
                                <div class="metric-title">Waste Reduction</div>
                                <div class="trend-negative">
                                    <i class="fas fa-arrow-down me-1"></i> 8.7%
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value text-info">83.1%</div>
                                <div class="metric-title">ESG Score</div>
                                <div class="trend-positive">
                                    <i class="fas fa-arrow-up me-1"></i> 4.2%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Main Charts -->
                <div class="col-md-8 mb-4">
                    <div class="analysis-chart">
                        <h5>Sustainability Performance Over Time</h5>
                        <!-- In a real application, this would contain a chart -->
                        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            <p class="text-muted">Chart visualization would appear here</p>
                        </div>
                    </div>
                </div>
                
                <!-- Key Insights -->
                <div class="col-md-4 mb-4">
                    <h5>Key Insights</h5>
                    <div class="insight-card">
                        <h6><i class="fas fa-lightbulb me-2"></i> Emissions Trend</h6>
                        <p>Carbon emissions have decreased by 45.2% compared to baseline, exceeding the target of 30%.</p>
                    </div>
                    <div class="insight-card">
                        <h6><i class="fas fa-lightbulb me-2"></i> Resource Utilization</h6>
                        <p>Water usage efficiency has improved but energy consumption remains higher than industry average.</p>
                    </div>
                    <div class="insight-card">
                        <h6><i class="fas fa-lightbulb me-2"></i> Compliance</h6>
                        <p>Current performance meets 83% of ESG reporting requirements, with gaps in Scope 3 emissions reporting.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Emissions Tab -->
        <div class="tab-pane fade" id="emissions" role="tabpanel" aria-labelledby="emissions-tab">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="analysis-chart">
                        <h5>Emissions by Scope</h5>
                        <!-- In a real application, this would contain a chart -->
                        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            <p class="text-muted">Emissions chart would appear here</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="analysis-chart">
                        <h5>Emissions by Source</h5>
                        <!-- In a real application, this would contain a chart -->
                        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            <p class="text-muted">Emissions source chart would appear here</p>
                        </div>
                    </div>
                </div>
                <div class="col-12 mb-4">
                    <div class="data-table">
                        <h5>Emissions Data</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Emission Type</th>
                                        <th>Scope</th>
                                        <th>Value (tCO2e)</th>
                                        <th>Previous Period</th>
                                        <th>Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Direct Emissions</td>
                                        <td>Scope 1</td>
                                        <td>12,450</td>
                                        <td>14,200</td>
                                        <td class="text-success">-12.3%</td>
                                    </tr>
                                    <tr>
                                        <td>Electricity</td>
                                        <td>Scope 2</td>
                                        <td>8,320</td>
                                        <td>9,150</td>
                                        <td class="text-success">-9.1%</td>
                                    </tr>
                                    <tr>
                                        <td>Supply Chain</td>
                                        <td>Scope 3</td>
                                        <td>42,100</td>
                                        <td>46,800</td>
                                        <td class="text-success">-10.0%</td>
                                    </tr>
                                    <tr>
                                        <td>Business Travel</td>
                                        <td>Scope 3</td>
                                        <td>1,850</td>
                                        <td>4,200</td>
                                        <td class="text-success">-56.0%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resources Tab -->
        <div class="tab-pane fade" id="resources" role="tabpanel" aria-labelledby="resources-tab">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="analysis-chart">
                        <h5>Water Usage</h5>
                        <!-- In a real application, this would contain a chart -->
                        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            <p class="text-muted">Water usage chart would appear here</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="analysis-chart">
                        <h5>Energy Consumption</h5>
                        <!-- In a real application, this would contain a chart -->
                        <div style="height: 300px; display: flex; align-items: center; justify-content: center;">
                            <p class="text-muted">Energy consumption chart would appear here</p>
                        </div>
                    </div>
                </div>
                <div class="col-12 mb-4">
                    <div class="data-table">
                        <h5>Resource Usage Data</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Resource</th>
                                        <th>Unit</th>
                                        <th>Current Usage</th>
                                        <th>Previous Period</th>
                                        <th>Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Water</td>
                                        <td>m³</td>
                                        <td>125,450</td>
                                        <td>142,200</td>
                                        <td class="text-success">-11.8%</td>
                                    </tr>
                                    <tr>
                                        <td>Electricity</td>
                                        <td>kWh</td>
                                        <td>2,320,800</td>
                                        <td>2,415,000</td>
                                        <td class="text-success">-3.9%</td>
                                    </tr>
                                    <tr>
                                        <td>Natural Gas</td>
                                        <td>m³</td>
                                        <td>842,100</td>
                                        <td>868,000</td>
                                        <td class="text-success">-3.0%</td>
                                    </tr>
                                    <tr>
                                        <td>Paper</td>
                                        <td>tonnes</td>
                                        <td>12.5</td>
                                        <td>18.2</td>
                                        <td class="text-success">-31.3%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recommendations Tab -->
        <div class="tab-pane fade" id="recommendations" role="tabpanel" aria-labelledby="recommendations-tab">
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="alert alert-primary">
                        <i class="fas fa-robot me-2"></i> These AI-generated recommendations are based on your sustainability data and industry benchmarks.
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="recommendation-card">
                        <h5><i class="fas fa-leaf me-2"></i> Emissions Reduction</h5>
                        <p>Implement renewable energy sources at manufacturing facilities to reduce Scope 2 emissions. Virtual Power Purchase Agreements (VPPAs) could reduce emissions by an estimated 35% with ROI within 4 years.</p>
                        <div class="mt-3">
                            <span class="badge bg-success me-2">High Impact</span>
                            <span class="badge bg-warning me-2">Medium Cost</span>
                            <span class="badge bg-info">1-3 Year Implementation</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="recommendation-card">
                        <h5><i class="fas fa-tint me-2"></i> Water Conservation</h5>
                        <p>Implement water recycling systems at production facilities. Based on your current usage patterns, this could reduce water consumption by up to 40% and provide cost savings of $125,000 annually.</p>
                        <div class="mt-3">
                            <span class="badge bg-success me-2">High Impact</span>
                            <span class="badge bg-danger me-2">High Cost</span>
                            <span class="badge bg-info">1-2 Year Implementation</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="recommendation-card">
                        <h5><i class="fas fa-truck me-2"></i> Supply Chain Optimization</h5>
                        <p>Engage top 20 suppliers in emissions reduction targets and reporting. Data shows your Scope 3 emissions constitute 68% of total footprint, with significant reduction potential through supplier engagement.</p>
                        <div class="mt-3">
                            <span class="badge bg-warning me-2">Medium Impact</span>
                            <span class="badge bg-success me-2">Low Cost</span>
                            <span class="badge bg-info">6-12 Month Implementation</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="recommendation-card">
                        <h5><i class="fas fa-recycle me-2"></i> Waste Reduction</h5>
                        <p>Implement circular economy principles for packaging materials. Analysis shows potential to reduce packaging waste by 60% and achieve cost savings of approximately $280,000 annually.</p>
                        <div class="mt-3">
                            <span class="badge bg-success me-2">High Impact</span>
                            <span class="badge bg-warning me-2">Medium Cost</span>
                            <span class="badge bg-info">1-2 Year Implementation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Raw Data Tab -->
        <div class="tab-pane fade" id="raw-data" role="tabpanel" aria-labelledby="raw-data-tab">
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i> This is a demo view. In a production environment, this would display the actual data from your uploaded file.
                    </div>
                </div>
                
                <div class="col-12 mb-4">
                    <div class="data-table">
                        <h5>Raw Data Preview</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th>Metric</th>
                                        <th>Value</th>
                                        <th>Unit</th>
                                        <th>Location</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2024-01-01</td>
                                        <td>Emissions</td>
                                        <td>Scope 1</td>
                                        <td>1,245</td>
                                        <td>tCO2e</td>
                                        <td>Facility A</td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-01</td>
                                        <td>Emissions</td>
                                        <td>Scope 2</td>
                                        <td>832</td>
                                        <td>tCO2e</td>
                                        <td>Facility A</td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-01</td>
                                        <td>Resources</td>
                                        <td>Water</td>
                                        <td>12,545</td>
                                        <td>m³</td>
                                        <td>Facility A</td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-01</td>
                                        <td>Resources</td>
                                        <td>Electricity</td>
                                        <td>232,080</td>
                                        <td>kWh</td>
                                        <td>Facility A</td>
                                    </tr>
                                    <tr>
                                        <td>2024-02-01</td>
                                        <td>Emissions</td>
                                        <td>Scope 1</td>
                                        <td>1,180</td>
                                        <td>tCO2e</td>
                                        <td>Facility A</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="col-12 mb-4">
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-outline-primary">
                            <i class="fas fa-download me-2"></i> Download Raw Data
                        </button>
                        <button class="btn btn-outline-success">
                            <i class="fas fa-file-excel me-2"></i> Export to Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tabs
        var tabElements = document.querySelectorAll('#analysisTab button');
        tabElements.forEach(function(tab) {
            tab.addEventListener('click', function(event) {
                event.preventDefault();
                
                // Remove active class from all tabs
                tabElements.forEach(function(t) {
                    t.classList.remove('active');
                    t.setAttribute('aria-selected', 'false');
                });
                
                // Add active class to clicked tab
                this.classList.add('active');
                this.setAttribute('aria-selected', 'true');
                
                // Hide all tab panes
                document.querySelectorAll('.tab-pane').forEach(function(pane) {
                    pane.classList.remove('show', 'active');
                });
                
                // Show the target tab pane
                var target = this.getAttribute('data-bs-target');
                document.querySelector(target).classList.add('show', 'active');
            });
        });
    });
</script>
{% endblock %}