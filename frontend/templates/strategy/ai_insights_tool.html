<div class="card shadow-sm mb-4">
    <div class="card-header bg-dark">
        <h5 class="card-title mb-0 text-white">
            <i class="fas fa-robot me-2"></i> AI Strategy Insights
        </h5>
    </div>
    <div class="card-body bg-dark">
        <!-- AI Strategy Generator Form -->
        <form id="aiStrategyForm">
            <div class="mb-3">
                <label for="companyName" class="form-label">Company or Organization Name</label>
                <input type="text" class="form-control bg-dark text-light border-secondary" id="companyName" placeholder="e.g., Acme Corporation" required>
            </div>
            
            <div class="mb-3">
                <label for="industry" class="form-label">Industry</label>
                <select class="form-select bg-dark text-light border-secondary" id="industry" required>
                    <option value="" selected disabled>Select industry</option>
                    <option value="technology">Technology</option>
                    <option value="manufacturing">Manufacturing</option>
                    <option value="retail">Retail</option>
                    <option value="healthcare">Healthcare</option>
                    <option value="finance">Finance</option>
                    <option value="energy">Energy</option>
                    <option value="transportation">Transportation</option>
                    <option value="hospitality">Hospitality</option>
                    <option value="construction">Construction</option>
                    <option value="agriculture">Agriculture</option>
                    <option value="education">Education</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="companySize" class="form-label">Company Size</label>
                <select class="form-select bg-dark text-light border-secondary" id="companySize" required>
                    <option value="" selected disabled>Select company size</option>
                    <option value="startup">Startup (1-10 employees)</option>
                    <option value="small">Small Business (11-50 employees)</option>
                    <option value="medium">Medium Business (51-250 employees)</option>
                    <option value="large">Large Business (251-1000 employees)</option>
                    <option value="enterprise">Enterprise (1000+ employees)</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label for="currentChallenges" class="form-label">Current Sustainability Challenges</label>
                <textarea class="form-control bg-dark text-light border-secondary" id="currentChallenges" rows="3" placeholder="Describe your current sustainability challenges..."></textarea>
            </div>
            
            <div class="mb-3">
                <label for="strategicGoals" class="form-label">Strategic Goals</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="goalEmissions" checked>
                    <label class="form-check-label" for="goalEmissions">
                        Reduce carbon emissions
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="goalWaste">
                    <label class="form-check-label" for="goalWaste">
                        Minimize waste
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="goalWater">
                    <label class="form-check-label" for="goalWater">
                        Improve water efficiency
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="goalEnergy">
                    <label class="form-check-label" for="goalEnergy">
                        Enhance energy efficiency
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="goalSupply">
                    <label class="form-check-label" for="goalSupply">
                        Sustainable supply chain
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="goalReporting">
                    <label class="form-check-label" for="goalReporting">
                        Enhance ESG reporting
                    </label>
                </div>
            </div>

            <div class="mb-3">
                <label for="insightType" class="form-label">Insight Type</label>
                <select class="form-select bg-dark text-light border-secondary" id="insightType" required>
                    <option value="comprehensive" selected>Comprehensive Strategy</option>
                    <option value="quick">Quick Recommendations</option>
                    <option value="regulatory">Regulatory Compliance Focus</option>
                    <option value="innovation">Innovation Opportunities</option>
                    <option value="competitive">Competitive Analysis</option>
                </select>
            </div>
            
            <div class="d-grid">
                <button type="submit" class="btn btn-primary" id="generateInsightsBtn">
                    <i class="fas fa-brain me-2"></i> Generate AI Insights
                </button>
            </div>
        </form>

        <!-- Results Section (initially hidden) -->
        <div id="insightsResults" class="mt-4 d-none">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="border-bottom pb-2 mb-0">Generated Insights</h6>
                <div>
                    <button class="btn btn-sm btn-outline-success me-2" id="exportInsightsBtn">
                        <i class="fas fa-file-export me-1"></i> Export
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" id="resetInsightsBtn">
                        <i class="fas fa-redo me-1"></i> New
                    </button>
                </div>
            </div>
            
            <div id="loadingInsights" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Generating strategic insights with AI...</p>
                <p class="text-muted small">This may take a moment as we analyze your data against optimal strategies.</p>
            </div>
            
            <div id="insightsContent" class="d-none">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const aiStrategyForm = document.getElementById('aiStrategyForm');
    const generateInsightsBtn = document.getElementById('generateInsightsBtn');
    const insightsResults = document.getElementById('insightsResults');
    const loadingInsights = document.getElementById('loadingInsights');
    const insightsContent = document.getElementById('insightsContent');
    const exportInsightsBtn = document.getElementById('exportInsightsBtn');
    const resetInsightsBtn = document.getElementById('resetInsightsBtn');
    
    if (aiStrategyForm) {
        aiStrategyForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Collect form data
            const formData = {
                company_name: document.getElementById('companyName').value,
                industry: document.getElementById('industry').value,
                company_size: document.getElementById('companySize').value,
                current_challenges: document.getElementById('currentChallenges').value,
                strategic_goals: [],
                insight_type: document.getElementById('insightType').value
            };
            
            // Collect checked goals
            if (document.getElementById('goalEmissions').checked) formData.strategic_goals.push('emissions_reduction');
            if (document.getElementById('goalWaste').checked) formData.strategic_goals.push('waste_minimization');
            if (document.getElementById('goalWater').checked) formData.strategic_goals.push('water_efficiency');
            if (document.getElementById('goalEnergy').checked) formData.strategic_goals.push('energy_efficiency');
            if (document.getElementById('goalSupply').checked) formData.strategic_goals.push('sustainable_supply_chain');
            if (document.getElementById('goalReporting').checked) formData.strategic_goals.push('esg_reporting');
            
            // Show loading state
            generateInsightsBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Generating...';
            generateInsightsBtn.disabled = true;
            insightsResults.classList.remove('d-none');
            loadingInsights.classList.remove('d-none');
            insightsContent.classList.add('d-none');
            
            // Call API to generate insights
            fetch('/api/strategy-hub/generate-insights', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Display the results
                displayInsights(data);
                
                // Hide loading state
                loadingInsights.classList.add('d-none');
                insightsContent.classList.remove('d-none');
                
                // Reset button
                generateInsightsBtn.innerHTML = '<i class="fas fa-brain me-2"></i> Generate AI Insights';
                generateInsightsBtn.disabled = false;
            })
            .catch(error => {
                console.error('Error generating insights:', error);
                
                // Display error message
                insightsContent.innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i> Error Generating Insights</h6>
                        <p>We encountered an error while generating your strategy insights. Please try again later.</p>
                        <p class="text-muted small">Error details: ${error.message}</p>
                    </div>
                `;
                
                // Hide loading state
                loadingInsights.classList.add('d-none');
                insightsContent.classList.remove('d-none');
                
                // Reset button
                generateInsightsBtn.innerHTML = '<i class="fas fa-brain me-2"></i> Generate AI Insights';
                generateInsightsBtn.disabled = false;
            });
        });
    }
    
    // Export insights button
    if (exportInsightsBtn) {
        exportInsightsBtn.addEventListener('click', function() {
            exportToPDF();
        });
    }
    
    // Reset button
    if (resetInsightsBtn) {
        resetInsightsBtn.addEventListener('click', function() {
            // Reset form
            aiStrategyForm.reset();
            
            // Hide results section
            insightsResults.classList.add('d-none');
            
            // Scroll to form top
            aiStrategyForm.scrollIntoView({ behavior: 'smooth' });
        });
    }
    
    function displayInsights(data) {
        // Create insights content
        let html = '';
        
        // Add executive summary
        html += `
            <div class="mb-4">
                <h5 class="mb-3">Executive Summary</h5>
                <div class="card bg-dark-subtle border-0 p-3">
                    <p>${data.executive_summary}</p>
                </div>
            </div>
        `;
        
        // Add strategic recommendations
        html += `
            <div class="mb-4">
                <h5 class="mb-3">Strategic Recommendations</h5>
                <div class="list-group">
        `;
        
        data.recommendations.forEach((rec, index) => {
            let priorityBadge = '';
            if (rec.priority === 'high') {
                priorityBadge = '<span class="badge bg-danger ms-2">High Priority</span>';
            } else if (rec.priority === 'medium') {
                priorityBadge = '<span class="badge bg-warning ms-2">Medium Priority</span>';
            } else {
                priorityBadge = '<span class="badge bg-info ms-2">Standard Priority</span>';
            }
            
            html += `
                <div class="list-group-item bg-dark border-secondary">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${index + 1}. ${rec.title} ${priorityBadge}</h6>
                        <small class="text-muted">${rec.timeframe}</small>
                    </div>
                    <p class="mb-1">${rec.description}</p>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <small class="text-muted">Impact: ${rec.impact}</small>
                        <small class="text-muted">Implementation Complexity: ${rec.complexity}</small>
                    </div>
                </div>
            `;
        });
        
        html += `
                </div>
            </div>
        `;
        
        // Add KPIs and metrics
        html += `
            <div class="mb-4">
                <h5 class="mb-3">Key Performance Indicators</h5>
                <div class="row">
        `;
        
        data.kpis.forEach(kpi => {
            html += `
                <div class="col-md-6 mb-3">
                    <div class="card bg-dark border-secondary h-100">
                        <div class="card-body">
                            <h6 class="card-title">${kpi.name}</h6>
                            <p class="card-text">${kpi.description}</p>
                            <div class="text-muted small">
                                <div><strong>Measurement:</strong> ${kpi.measurement}</div>
                                <div><strong>Target:</strong> ${kpi.target}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += `
                </div>
            </div>
        `;
        
        // Add implementation roadmap
        html += `
            <div class="mb-4">
                <h5 class="mb-3">Implementation Roadmap</h5>
                <div class="card bg-dark border-secondary">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3 mb-md-0">
                                <h6 class="border-bottom pb-2">Short-term (0-6 months)</h6>
                                <ul class="list-unstyled">
        `;
        
        data.roadmap.short_term.forEach(item => {
            html += `<li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>${item}</li>`;
        });
        
        html += `
                                </ul>
                            </div>
                            <div class="col-md-4 mb-3 mb-md-0">
                                <h6 class="border-bottom pb-2">Medium-term (6-18 months)</h6>
                                <ul class="list-unstyled">
        `;
        
        data.roadmap.medium_term.forEach(item => {
            html += `<li class="mb-2"><i class="fas fa-circle text-warning me-2"></i>${item}</li>`;
        });
        
        html += `
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h6 class="border-bottom pb-2">Long-term (18+ months)</h6>
                                <ul class="list-unstyled">
        `;
        
        data.roadmap.long_term.forEach(item => {
            html += `<li class="mb-2"><i class="fas fa-circle text-info me-2"></i>${item}</li>`;
        });
        
        html += `
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Add risk assessment
        html += `
            <div class="mb-4">
                <h5 class="mb-3">Risk Assessment</h5>
                <div class="table-responsive">
                    <table class="table table-dark">
                        <thead>
                            <tr>
                                <th>Risk Factor</th>
                                <th>Likelihood</th>
                                <th>Impact</th>
                                <th>Mitigation Strategy</th>
                            </tr>
                        </thead>
                        <tbody>
        `;
        
        data.risks.forEach(risk => {
            let likelihoodClass = risk.likelihood === 'High' ? 'text-danger' : 
                               risk.likelihood === 'Medium' ? 'text-warning' : 'text-success';
            let impactClass = risk.impact === 'High' ? 'text-danger' : 
                           risk.impact === 'Medium' ? 'text-warning' : 'text-success';
            
            html += `
                <tr>
                    <td>${risk.factor}</td>
                    <td class="${likelihoodClass}">${risk.likelihood}</td>
                    <td class="${impactClass}">${risk.impact}</td>
                    <td>${risk.mitigation}</td>
                </tr>
            `;
        });
        
        html += `
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        
        // Set the HTML content
        insightsContent.innerHTML = html;
    }
    
    function exportToPDF() {
        // In a real implementation, this would generate a PDF
        // For now, we'll just show a message
        alert('Export feature would generate a PDF of the insights in a production environment.');
    }
});
</script>