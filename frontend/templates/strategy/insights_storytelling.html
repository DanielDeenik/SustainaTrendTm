<!-- Data-Driven Storytelling Component for the Strategy Hub -->
<div class="strategy-hub-section" id="insights-storytelling">
    <div class="dashboard-section-title d-flex justify-content-between align-items-center">
        <div>
            <i class="fas fa-chart-pie text-info"></i>
            <h3 class="mb-0">Data-Driven Insights</h3>
        </div>
        <div class="btn-group">
            <button class="btn btn-sm btn-outline-info rounded-start" id="createNewStoryBtn">
                <i class="fas fa-plus me-1"></i> New Story
            </button>
            <button class="btn btn-sm btn-outline-info rounded-end" id="viewAllStoriesBtn">
                <i class="fas fa-list me-1"></i> View All
            </button>
        </div>
    </div>
    
    <div class="card border-0 shadow-sm bg-dark">
        <div class="card-body p-4">
            <!-- Story Creation Form (Initially Hidden) -->
            <div id="storyCreationForm" style="display: none;">
                <h5 class="mb-3">Create Data Story</h5>
                <form id="newStoryForm">
                    <div class="mb-3">
                        <label for="storyTitle" class="form-label">Story Title</label>
                        <input type="text" class="form-control bg-darker border-0" id="storyTitle" placeholder="Enter a descriptive title for your data story">
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="dataSource" class="form-label">Primary Data Source</label>
                            <select class="form-select bg-darker border-0" id="dataSource">
                                <option value="" selected disabled>Select data source</option>
                                <option value="sustainability_metrics">Sustainability Metrics</option>
                                <option value="carbon_emissions">Carbon Emissions Data</option>
                                <option value="supply_chain">Supply Chain Analysis</option>
                                <option value="consumer_trends">Consumer Trends</option>
                                <option value="industry_benchmarks">Industry Benchmarks</option>
                                <option value="custom">Custom Data Upload</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="storyType" class="form-label">Story Type</label>
                            <select class="form-select bg-darker border-0" id="storyType">
                                <option value="" selected disabled>Select story type</option>
                                <option value="trend_analysis">Trend Analysis</option>
                                <option value="comparative">Comparative Analysis</option>
                                <option value="predictive">Predictive Analysis</option>
                                <option value="impact">Impact Assessment</option>
                                <option value="scenario">Scenario Planning</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="storyNarrative" class="form-label">Key Questions or Insights to Explore</label>
                        <textarea class="form-control bg-darker border-0" id="storyNarrative" rows="3" placeholder="Describe the key questions or insights you want to explore in this story"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Visualization Types</label>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lineChartCheck" checked>
                                    <label class="form-check-label" for="lineChartCheck">
                                        Line Charts
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="barChartCheck" checked>
                                    <label class="form-check-label" for="barChartCheck">
                                        Bar Charts
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="pieChartCheck">
                                    <label class="form-check-label" for="pieChartCheck">
                                        Pie/Donut Charts
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="scatterChartCheck">
                                    <label class="form-check-label" for="scatterChartCheck">
                                        Scatter Plots
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="heatmapCheck">
                                    <label class="form-check-label" for="heatmapCheck">
                                        Heatmaps
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="geoMapCheck">
                                    <label class="form-check-label" for="geoMapCheck">
                                        Geographic Maps
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Target Audience</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="audienceOptions" id="executiveAudience" autocomplete="off" checked>
                            <label class="btn btn-outline-primary" for="executiveAudience">Executives</label>
                            
                            <input type="radio" class="btn-check" name="audienceOptions" id="operationalAudience" autocomplete="off">
                            <label class="btn btn-outline-primary" for="operationalAudience">Operational Teams</label>
                            
                            <input type="radio" class="btn-check" name="audienceOptions" id="stakeholderAudience" autocomplete="off">
                            <label class="btn btn-outline-primary" for="stakeholderAudience">External Stakeholders</label>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button type="button" class="btn btn-outline-secondary" id="cancelStoryBtn">
                            <i class="fas fa-times me-1"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-info" id="generateStoryBtn">
                            <i class="fas fa-magic me-1"></i> Generate Story
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Story Generation Progress (Initially Hidden) -->
            <div id="storyGenerationProgress" style="display: none;">
                <div class="text-center py-4">
                    <div class="spinner-border text-info" role="status">
                        <span class="visually-hidden">Generating story...</span>
                    </div>
                    <h5 class="mt-3">Generating Your Data Story</h5>
                    <p class="text-muted">Our AI is analyzing data and creating visualizations for your story...</p>
                    
                    <div class="progress mt-3">
                        <div id="storyProgressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-info" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    
                    <div id="storyProgressSteps" class="text-start mt-3">
                        <p class="mb-1"><i class="fas fa-check-circle text-success me-2"></i>Analyzing data source</p>
                        <p class="mb-1"><i class="fas fa-spinner fa-spin me-2"></i>Identifying key insights</p>
                        <p class="mb-1 text-muted"><i class="fas fa-circle me-2"></i>Creating visualizations</p>
                        <p class="mb-1 text-muted"><i class="fas fa-circle me-2"></i>Generating narrative</p>
                    </div>
                </div>
            </div>
            
            <!-- Featured Data Story -->
            <div id="featuredStory">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Featured Story: Carbon Reduction Impact Analysis</h5>
                    <span class="badge rounded-pill bg-info">Trend Analysis</span>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-lg-7">
                        <div class="card bg-darker border-0 h-100">
                            <div class="card-body p-4">
                                <div class="d-flex justify-content-between mb-3">
                                    <h6 class="card-title">Carbon Emissions Reduction Progress</h6>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-download me-2"></i>Export Data</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-expand-alt me-2"></i>Full Screen</a></li>
                                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Configure</a></li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <!-- Carbon Emissions Chart -->
                                <div class="chart-container" style="height: 300px; position: relative;">
                                    <canvas id="carbonEmissionsChart"></canvas>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <div class="small text-muted">Data source: Corporate GHG Inventory</div>
                                    <div class="small text-muted">Last updated: Mar 12, 2025</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-5">
                        <div class="card bg-darker border-0 h-100">
                            <div class="card-body p-4">
                                <h6 class="card-title mb-3">Key Insights</h6>
                                
                                <div class="insight-item mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="insight-icon bg-success bg-opacity-10 text-success me-3">
                                            <i class="fas fa-arrow-trend-down"></i>
                                        </div>
                                        <h6 class="mb-0">20% Reduction in Scope 2 Emissions</h6>
                                    </div>
                                    <p class="text-muted small ms-5">Renewable energy procurement initiatives have delivered a 20% reduction in Scope 2 emissions since Q1 2024.</p>
                                </div>
                                
                                <div class="insight-item mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="insight-icon bg-warning bg-opacity-10 text-warning me-3">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <h6 class="mb-0">Scope 3 Emissions Challenge</h6>
                                    </div>
                                    <p class="text-muted small ms-5">Supply chain emissions (Scope 3) remain challenging with only 5% reduction against the 30% target by 2030.</p>
                                </div>
                                
                                <div class="insight-item">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="insight-icon bg-info bg-opacity-10 text-info me-3">
                                            <i class="fas fa-lightbulb"></i>
                                        </div>
                                        <h6 class="mb-0">Opportunity: Supplier Engagement</h6>
                                    </div>
                                    <p class="text-muted small ms-5">Implementing supplier emissions reduction program could accelerate progress toward overall targets by 15%.</p>
                                </div>
                                
                                <div class="d-grid mt-4">
                                    <button class="btn btn-outline-info btn-sm" id="viewFullStoryBtn">
                                        <i class="fas fa-book me-1"></i> View Full Story
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card bg-darker border-0 h-100">
                            <div class="card-body p-4">
                                <h6 class="card-title mb-3">Carbon Reduction by Business Unit</h6>
                                
                                <!-- Business Units Chart -->
                                <div class="chart-container" style="height: 250px; position: relative;">
                                    <canvas id="businessUnitsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card bg-darker border-0 h-100">
                            <div class="card-body p-4">
                                <h6 class="card-title mb-3">Projections vs. Targets</h6>
                                
                                <!-- Projections Chart -->
                                <div class="chart-container" style="height: 250px; position: relative;">
                                    <canvas id="projectionsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Stories -->
            <div class="mt-4">
                <h5 class="mb-3">Recent Stories</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="card bg-darker border-0 h-100 cursor-pointer story-card">
                            <div class="card-body">
                                <span class="badge rounded-pill bg-success mb-2">Comparative Analysis</span>
                                <h6 class="card-title">Renewable Energy ROI Analysis</h6>
                                <p class="card-text text-muted small">Comparing financial returns across different renewable energy investments and procurement strategies.</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <small class="text-muted">March 8, 2025</small>
                                    <span class="badge bg-light text-dark">Executive</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card bg-darker border-0 h-100 cursor-pointer story-card">
                            <div class="card-body">
                                <span class="badge rounded-pill bg-warning mb-2">Impact Assessment</span>
                                <h6 class="card-title">Supply Chain Emissions Mapping</h6>
                                <p class="card-text text-muted small">Geographic and supplier-level breakdown of Scope 3 emissions with hotspot identification.</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <small class="text-muted">March 2, 2025</small>
                                    <span class="badge bg-light text-dark">Operational</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card bg-darker border-0 h-100 cursor-pointer story-card">
                            <div class="card-body">
                                <span class="badge rounded-pill bg-info mb-2">Predictive Analysis</span>
                                <h6 class="card-title">Carbon Pricing Risk Scenarios</h6>
                                <p class="card-text text-muted small">Financial impact modeling of carbon pricing scenarios on profitability and competitiveness.</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <small class="text-muted">February 24, 2025</small>
                                    <span class="badge bg-light text-dark">Executive</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.insight-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.story-card {
    transition: transform 0.3s ease;
}

.story-card:hover {
    transform: translateY(-5px);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // New Story Button
    const createNewStoryBtn = document.getElementById('createNewStoryBtn');
    const storyCreationForm = document.getElementById('storyCreationForm');
    const featuredStory = document.getElementById('featuredStory');
    const cancelStoryBtn = document.getElementById('cancelStoryBtn');
    const newStoryForm = document.getElementById('newStoryForm');
    const storyGenerationProgress = document.getElementById('storyGenerationProgress');
    
    if (createNewStoryBtn && storyCreationForm && featuredStory) {
        createNewStoryBtn.addEventListener('click', function() {
            storyCreationForm.style.display = 'block';
            featuredStory.style.display = 'none';
        });
    }
    
    if (cancelStoryBtn && storyCreationForm && featuredStory) {
        cancelStoryBtn.addEventListener('click', function() {
            storyCreationForm.style.display = 'none';
            featuredStory.style.display = 'block';
        });
    }
    
    if (newStoryForm && storyCreationForm && storyGenerationProgress) {
        newStoryForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Hide form and show progress
            storyCreationForm.style.display = 'none';
            storyGenerationProgress.style.display = 'block';
            
            // Simulate progress
            simulateStoryGeneration();
        });
    }
    
    // View All Stories Button
    const viewAllStoriesBtn = document.getElementById('viewAllStoriesBtn');
    if (viewAllStoriesBtn) {
        viewAllStoriesBtn.addEventListener('click', function() {
            // In a real implementation, this would navigate to the stories page
            window.location.href = '/storytelling';
        });
    }
    
    // View Full Story Button
    const viewFullStoryBtn = document.getElementById('viewFullStoryBtn');
    if (viewFullStoryBtn) {
        viewFullStoryBtn.addEventListener('click', function() {
            // In a real implementation, this would navigate to the full story page
            window.location.href = '/storytelling/story/1';
        });
    }
    
    // Story Card Click
    const storyCards = document.querySelectorAll('.story-card');
    if (storyCards) {
        storyCards.forEach(card => {
            card.addEventListener('click', function() {
                // In a real implementation, this would navigate to the story page
                window.location.href = '/storytelling';
            });
        });
    }
    
    // Function to simulate story generation progress
    function simulateStoryGeneration() {
        const progressBar = document.getElementById('storyProgressBar');
        const progressSteps = document.getElementById('storyProgressSteps');
        let progress = 25;
        let step = 1;
        
        const progressInterval = setInterval(() => {
            progress += 25;
            step += 1;
            
            if (progress > 100) {
                clearInterval(progressInterval);
                
                // After completion, redirect to the new story
                setTimeout(() => {
                    // In a real implementation, this would redirect to the newly created story
                    storyGenerationProgress.style.display = 'none';
                    featuredStory.style.display = 'block';
                    
                    // Show success message
                    alert('Your data story has been successfully created!');
                }, 1000);
                
                return;
            }
            
            // Update progress bar
            progressBar.style.width = progress + '%';
            progressBar.setAttribute('aria-valuenow', progress);
            
            // Update steps
            const stepElements = progressSteps.querySelectorAll('p');
            if (step < stepElements.length) {
                stepElements[step].innerHTML = stepElements[step].innerHTML.replace(
                    '<i class="fas fa-circle me-2"></i>',
                    '<i class="fas fa-spinner fa-spin me-2"></i>'
                );
                
                if (step > 1) {
                    stepElements[step - 1].innerHTML = stepElements[step - 1].innerHTML.replace(
                        '<i class="fas fa-spinner fa-spin me-2"></i>',
                        '<i class="fas fa-check-circle text-success me-2"></i>'
                    );
                    
                    // Remove text-muted class
                    stepElements[step].classList.remove('text-muted');
                }
            }
        }, 1500);
    }
    
    // Initialize Charts
    initializeCharts();
});

function initializeCharts() {
    // Check if Chart.js is loaded
    if (typeof Chart === 'undefined') {
        // Load Chart.js from CDN if not available
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
        script.onload = createCharts;
        document.head.appendChild(script);
    } else {
        createCharts();
    }
}

function createCharts() {
    // Carbon Emissions Chart
    const carbonCtx = document.getElementById('carbonEmissionsChart');
    if (carbonCtx) {
        new Chart(carbonCtx, {
            type: 'line',
            data: {
                labels: ['Q1 2023', 'Q2 2023', 'Q3 2023', 'Q4 2023', 'Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024', 'Q1 2025'],
                datasets: [
                    {
                        label: 'Scope 1 Emissions',
                        data: [120, 115, 113, 110, 105, 100, 98, 95, 90],
                        borderColor: '#0dcaf0',
                        backgroundColor: 'rgba(13, 202, 240, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Scope 2 Emissions',
                        data: [200, 190, 185, 180, 170, 160, 150, 140, 135],
                        borderColor: '#20c997',
                        backgroundColor: 'rgba(32, 201, 151, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Scope 3 Emissions',
                        data: [450, 445, 440, 438, 435, 430, 428, 425, 420],
                        borderColor: '#fd7e14',
                        backgroundColor: 'rgba(253, 126, 20, 0.1)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#e9ecef'
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#e9ecef'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#e9ecef'
                        },
                        title: {
                            display: true,
                            text: 'Metric Tons CO2e',
                            color: '#e9ecef'
                        }
                    }
                }
            }
        });
    }
    
    // Business Units Chart
    const businessUnitsCtx = document.getElementById('businessUnitsChart');
    if (businessUnitsCtx) {
        new Chart(businessUnitsCtx, {
            type: 'bar',
            data: {
                labels: ['Manufacturing', 'Operations', 'Logistics', 'Office Facilities', 'Research & Development'],
                datasets: [
                    {
                        label: '2023 Emissions (tCO2e)',
                        data: [250, 180, 320, 90, 50],
                        backgroundColor: 'rgba(13, 110, 253, 0.7)'
                    },
                    {
                        label: '2024 Emissions (tCO2e)',
                        data: [220, 150, 300, 70, 45],
                        backgroundColor: 'rgba(25, 135, 84, 0.7)'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#e9ecef'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#e9ecef'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#e9ecef'
                        }
                    }
                }
            }
        });
    }
    
    // Projections Chart
    const projectionsCtx = document.getElementById('projectionsChart');
    if (projectionsCtx) {
        new Chart(projectionsCtx, {
            type: 'line',
            data: {
                labels: ['2023', '2024', '2025', '2026', '2027', '2028', '2029', '2030'],
                datasets: [
                    {
                        label: 'Current Trajectory',
                        data: [100, 93, 87, 82, 77, 73, 70, 68],
                        borderColor: '#0dcaf0',
                        backgroundColor: 'transparent',
                        tension: 0.3,
                        borderDash: []
                    },
                    {
                        label: 'Target Path',
                        data: [100, 90, 80, 70, 60, 50, 40, 30],
                        borderColor: '#20c997',
                        backgroundColor: 'transparent',
                        tension: 0,
                        borderDash: []
                    },
                    {
                        label: 'Enhanced Strategy',
                        data: [100, 93, 84, 74, 65, 55, 42, 32],
                        borderColor: '#fd7e14',
                        backgroundColor: 'transparent',
                        tension: 0.3,
                        borderDash: [5, 5]
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: '#e9ecef'
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#e9ecef'
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#e9ecef'
                        },
                        title: {
                            display: true,
                            text: 'Percent of 2023 Baseline',
                            color: '#e9ecef'
                        }
                    }
                }
            }
        });
    }
}</script>