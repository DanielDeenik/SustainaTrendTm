{% extends 'layouts/finchat_dark_layout.html' %}

{% block title %}Enhanced Strategy Hub | SustainaTrendâ„¢{% endblock %}

{% block head %}
<!-- Chart.js for interactive visualizations -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Additional CSS for the enhanced Strategy Hub -->
<style>
  :root {
    --primary-color: #36b37e;
    --primary-light: #4eca94;
    --primary-dark: #2d9669;
    --secondary-color: #0052cc;
    --secondary-light: #2684ff;
    --secondary-dark: #0747a6;
    --accent-color: #ff5630;
    --accent-light: #ff7452;
    --accent-dark: #de350b;
    --dark-bg: #172b4d;
    --darker-bg: #101e35;
    --light-text: #f4f5f7;
    --medium-text: #c1c7d0;
    --light-bg: #f4f5f7;
    --card-bg: #1e3357;
    --card-highlight: #264473;
    --border-radius: 12px;
    --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    --transition-speed: 0.2s;
    --ai-primary: #36b37e;
    --ai-secondary: #00b8d9;
    --ai-tertiary: #6554c0;
    --ai-quaternary: #ff8b00;
  }

  .strategy-hub-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  .strategy-header {
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .strategy-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    background: linear-gradient(45deg, var(--primary-light), var(--primary-color));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    text-fill-color: transparent;
  }
  
  .strategy-subtitle {
    font-size: 1.1rem;
    color: var(--medium-text);
    margin-bottom: 1rem;
  }

  .hub-tabs {
    display: flex;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 2rem;
    overflow-x: auto;
  }

  .hub-tab {
    padding: 12px 20px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    color: var(--medium-text);
    font-weight: 500;
    transition: all var(--transition-speed) ease;
    white-space: nowrap;
  }

  .hub-tab:hover {
    color: var(--light-text);
    border-bottom-color: var(--primary-light);
  }

  .hub-tab.active {
    color: var(--primary-light);
    border-bottom-color: var(--primary-color);
  }

  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }
  
  /* Monetization Tab Styles */
  .monetization-categories {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .monetization-category {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 1rem;
    transition: all var(--transition-speed) ease;
  }
  
  .monetization-category:hover {
    background-color: var(--card-highlight);
    transform: translateY(-2px);
  }
  
  .monetization-header {
    display: flex;
    align-items: flex-start;
    margin-bottom: 0.75rem;
  }
  
  .strategy-icon {
    background-color: var(--primary-color);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    flex-shrink: 0;
  }
  
  .strategy-icon i {
    color: white;
    font-size: 1.2rem;
  }
  
  .strategy-header-text {
    flex: 1;
  }
  
  .strategy-name {
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 0.25rem;
    color: var(--light-text);
  }
  
  .strategy-desc {
    font-size: 0.9rem;
    color: var(--medium-text);
  }
  
  .strategy-metrics {
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: var(--border-radius);
    padding: 0.75rem;
  }
  
  .strategy-metrics-title {
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: var(--light-text);
  }
  
  .strategy-metrics-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .strategy-metric {
    background-color: var(--primary-dark);
    color: white;
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }
  
  .strategic-plan-form {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 1.5rem;
  }
  
  .form-group {
    margin-bottom: 1rem;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--light-text);
  }
  
  .form-group input[type="text"],
  .form-group select {
    width: 100%;
    padding: 0.75rem;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background-color: rgba(0, 0, 0, 0.15);
    color: var(--light-text);
  }
  
  .checkbox-list {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
  }
  
  .checkbox-item {
    display: flex;
    align-items: center;
  }
  
  .checkbox-item input[type="checkbox"] {
    margin-right: 0.5rem;
  }
  
  .strategic-plan-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 1rem;
  }
  
  .plan-company {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--light-text);
  }
  
  .plan-industry {
    color: var(--medium-text);
  }
  
  .strategic-plan-content {
    line-height: 1.6;
  }
  
  .strategic-plan-content h3 {
    color: var(--primary-light);
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    font-size: 1.1rem;
  }
  
  .strategic-plan-content ul {
    padding-left: 1.5rem;
    margin-bottom: 1rem;
  }
  
  .strategic-plan-content li {
    margin-bottom: 0.5rem;
  }
  
  @media (min-width: 768px) {
    .monetization-categories {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .hub-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--card-shadow);
    transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
  }
  
  .hub-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
  }
  
  .hub-card-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    color: var(--light-text);
    display: flex;
    align-items: center;
  }
  
  .hub-card-title i {
    margin-right: 10px;
    color: var(--primary-color);
  }

  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .card-grid-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }
  
  @media (max-width: 768px) {
    .card-grid, .card-grid-2 {
      grid-template-columns: 1fr;
    }
  }

  .trend-tag {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 50px;
    font-size: 0.8rem;
    margin-right: 6px;
    margin-bottom: 6px;
    background-color: rgba(54, 179, 126, 0.15);
    color: var(--primary-light);
    border: 1px solid rgba(54, 179, 126, 0.3);
    cursor: pointer;
    transition: all var(--transition-speed) ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  .trend-tag:hover {
    background-color: rgba(54, 179, 126, 0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }
  
  .pdf-dropzone {
    border: 2px dashed rgba(255, 255, 255, 0.2);
    border-radius: var(--border-radius);
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
  }
  
  .pdf-dropzone:hover {
    border-color: var(--primary-color);
    background-color: rgba(54, 179, 126, 0.05);
  }
  
  .pdf-icon {
    font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
  }

  .analysis-options {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .analysis-option {
    display: flex;
    align-items: center;
  }
  
  .analysis-option input {
    margin-right: 8px;
  }

  .document-card {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    padding: 1rem;
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
  }
  
  .document-card:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
  
  .document-icon {
    font-size: 1.5rem;
    margin-right: 1rem;
    color: var(--secondary-light);
  }
  
  .document-info {
    flex: 1;
  }
  
  .document-title {
    font-weight: 500;
    margin-bottom: 4px;
  }
  
  .document-meta {
    font-size: 0.8rem;
    color: var(--medium-text);
  }
  
  .document-category {
    background-color: rgba(38, 132, 255, 0.15);
    color: var(--secondary-light);
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    margin-left: 0.5rem;
  }

  .chart-container {
    height: 300px;
    width: 100%;
    margin-top: 1rem;
  }
  
  .trend-score {
    font-size: 3rem;
    font-weight: 700;
    color: var(--primary-color);
    text-align: center;
    margin: 1rem 0;
  }
  
  .score-label {
    font-size: 0.9rem;
    color: var(--medium-text);
    text-align: center;
    margin-bottom: 1rem;
  }
  
  .stepps-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin: 1.5rem 0;
  }
  
  @media (max-width: 768px) {
    .stepps-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (max-width: 480px) {
    .stepps-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .stepps-item {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    padding: 1rem;
    text-align: center;
  }
  
  .stepps-score {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  
  .stepps-name {
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
  }
  
  .stepps-desc {
    font-size: 0.8rem;
    color: var(--medium-text);
  }
  
  /* Chart container styling */
  .chart-container {
    width: 100%;
    height: 300px;
    margin: 1.5rem 0;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  /* AI Framework Selection Styling */
  .assessment-sliders {
    margin-top: 1rem;
  }
  
  .assessment-slider {
    margin-bottom: 1rem;
  }
  
  .slider-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  
  .slider-value {
    font-weight: 600;
    color: var(--primary-light);
  }
  
  input[type="range"] {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background-color: rgba(255, 255, 255, 0.1);
    outline: none;
    -webkit-appearance: none;
  }
  
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
  }
  
  .auto-select-container {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0.75rem;
    background-color: rgba(54, 179, 126, 0.1);
    border-radius: var(--border-radius);
  }
  
  .auto-select-container input[type="checkbox"] {
    margin-right: 0.5rem;
  }
  
  .framework-selection-title {
    margin: 1rem 0 0.5rem 0;
    color: var(--medium-text);
    font-size: 0.9rem;
  }
  
  .framework-options-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
  }
  
  @media (max-width: 768px) {
    .framework-options-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .framework-option {
    display: flex;
    align-items: center;
    padding: 0.5rem;
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
  }
  
  .framework-option input[type="radio"] {
    margin-right: 0.5rem;
  }
  
  .form-actions {
    margin-top: 1.5rem;
    text-align: center;
  }
  
  .card-description {
    margin-bottom: 1.5rem;
    color: var(--medium-text);
    font-size: 0.95rem;
    line-height: 1.5;
  }
  
  .framework-results {
    margin-top: 2rem;
  }
  
  .loading-spinner {
    text-align: center;
    padding: 2rem;
    color: var(--light-text);
    font-size: 1.1rem;
  }
  
  .loading-spinner i {
    margin-right: 0.5rem;
    color: var(--primary-color);
  }
  
  .framework-badge {
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    font-size: 0.9rem;
    font-weight: 500;
    background-color: rgba(54, 179, 126, 0.15);
    color: var(--primary-light);
  }
  
  .confidence-meter {
    margin: 1rem 0;
  }
  
  .confidence-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  
  .confidence-bar {
    height: 8px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    overflow: hidden;
  }
  
  .confidence-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
    border-radius: 4px;
  }
  
  .alternatives {
    margin-top: 1rem;
  }
  
  .alternatives-label {
    color: var(--medium-text);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }
  
  .alternatives-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .alternative-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.8rem;
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--light-text);
  }
  
  .porters-grid, .swot-grid, .bcg-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin: 1.5rem 0;
  }
  
  @media (min-width: 768px) {
    .porters-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .swot-grid, .bcg-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  .porters-dimension, .swot-quadrant, .bcg-quadrant {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    padding: 1rem;
  }
  
  .dimension-header, .quadrant-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.75rem;
  }
  
  .dimension-name, .quadrant-header {
    font-weight: 500;
  }
  
  .dimension-score {
    font-weight: 600;
    color: var(--primary-light);
  }
  
  .dimension-bar {
    height: 6px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-bottom: 0.75rem;
    overflow: hidden;
  }
  
  .dimension-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
    border-radius: 3px;
  }
  
  .dimension-insights {
    font-size: 0.9rem;
    color: var(--medium-text);
    line-height: 1.5;
  }
  
  .porters-summary {
    display: flex;
    justify-content: space-between;
    margin-top: 1.5rem;
  }
  
  .summary-item {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    padding: 1rem;
    text-align: center;
    flex: 1;
    margin: 0 0.5rem;
  }
  
  .summary-label {
    font-size: 0.9rem;
    color: var(--medium-text);
    margin-bottom: 0.5rem;
  }
  
  .summary-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-light);
  }
  
  .quadrant-list {
    padding-left: 1.5rem;
    margin-bottom: 0;
  }
  
  .quadrant-list li {
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  
  .recommendations-list {
    padding-left: 1.5rem;
    margin-bottom: 0;
  }
  
  .recommendations-list li {
    margin-bottom: 0.75rem;
    font-size: 0.95rem;
    line-height: 1.5;
  }
  
  .ai-selection-explanation {
    margin-bottom: 1.5rem;
  }
  
  .industry-impact {
    margin: 1.5rem 0;
  }
  
  .impact-bar {
    height: 10px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    margin-top: 4px;
    overflow: hidden;
  }
  
  .impact-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
    border-radius: 5px;
  }
  
  .impact-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
  }
  
  /* Storytelling Tab Styles */
  .template-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
  }
  
  .template-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 1.25rem;
    transition: all var(--transition-speed) ease;
    border: 1px solid rgba(255, 255, 255, 0.05);
    cursor: pointer;
  }
  
  .template-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--card-shadow);
    border-color: var(--primary-color);
    background-color: var(--card-highlight);
  }
  
  .template-icon {
    font-size: 2rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
  }
  
  .template-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--light-text);
  }
  
  .template-desc {
    font-size: 0.9rem;
    color: var(--medium-text);
    margin-bottom: 1rem;
  }
  
  .template-footer {
    margin-top: auto;
  }
  
  .story-list {
    margin-top: 1rem;
  }
  
  .story-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 1.25rem;
    margin-bottom: 1rem;
    transition: all var(--transition-speed) ease;
    border-left: 4px solid var(--primary-color);
  }
  
  .story-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--card-shadow);
    background-color: var(--card-highlight);
  }
  
  .story-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.75rem;
  }
  
  .story-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--light-text);
  }
  
  .story-date {
    font-size: 0.85rem;
    color: var(--medium-text);
  }
  
  .story-excerpt {
    font-size: 0.95rem;
    color: var(--medium-text);
    margin-bottom: 1rem;
    line-height: 1.5;
  }
  
  .story-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }
  
  .story-tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 50px;
    background-color: rgba(255, 255, 255, 0.07);
    color: var(--medium-text);
  }
  
  .story-actions {
    display: flex;
    gap: 0.75rem;
  }
  
  .small-action-btn {
    padding: 0.4rem 0.75rem;
    border-radius: var(--border-radius);
    font-size: 0.85rem;
    cursor: pointer;
    background-color: var(--primary-color);
    color: white;
    border: none;
    transition: all var(--transition-speed) ease;
  }
  
  .small-action-btn:hover {
    background-color: var(--primary-light);
    transform: translateY(-2px);
  }
  
  .insight-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: all var(--transition-speed) ease;
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .insight-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--card-shadow);
    background-color: var(--card-highlight);
  }
  
  .insight-header {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--light-text);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .insight-header i {
    color: var(--primary-color);
  }
  
  .insight-body {
    font-size: 0.95rem;
    color: var(--medium-text);
    margin-bottom: 1.5rem;
    line-height: 1.5;
    flex-grow: 1;
  }
  
  .insight-footer {
    margin-top: auto;
  }
  
  .impact-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    margin-bottom: 4px;
  }
  
  .strategic-item {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    padding: 1rem;
    margin-bottom: 1rem;
  }
  
  .strategic-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    align-items: center;
  }
  
  .strategic-area {
    font-weight: 500;
  }
  
  .strategic-potential {
    padding: 4px 10px;
    border-radius: 50px;
    font-size: 0.8rem;
  }
  
  .potential-high {
    background-color: rgba(54, 179, 126, 0.15);
    color: var(--primary-light);
  }
  
  .potential-medium {
    background-color: rgba(255, 171, 0, 0.15);
    color: #ffab00;
  }
  
  .potential-low {
    background-color: rgba(255, 86, 48, 0.15);
    color: var(--accent-light);
  }
  
  .strategic-timeframe {
    font-size: 0.8rem;
    color: var(--medium-text);
    margin-bottom: 0.5rem;
  }
  
  .strategic-response {
    font-size: 0.9rem;
  }
  
  .insight-card {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    position: relative;
    overflow: hidden;
  }
  
  .insight-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
  }
  
  .insight-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }
  
  .insight-body {
    font-size: 0.95rem;
    color: var(--medium-text);
    line-height: 1.5;
  }
  
  .insight-meta {
    display: flex;
    justify-content: space-between;
    margin-top: 1rem;
    font-size: 0.8rem;
    color: var(--medium-text);
  }
  
  .insight-source {
    text-decoration: underline;
    cursor: pointer;
  }
  
  .insight-metrics {
    margin-top: 1rem;
    display: flex;
    gap: 1rem;
  }
  
  .insight-metric {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    padding: 0.5rem 1rem;
    text-align: center;
    flex: 1;
  }
  
  .metric-value {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
  
  .metric-label {
    font-size: 0.8rem;
    color: var(--medium-text);
  }
  
  /* Metrics Dashboard Styling */
  .metrics-dashboard {
    margin-top: 1.5rem;
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--card-shadow);
  }
  
  .metrics-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.25rem;
    margin-bottom: 1.5rem;
  }
  
  .metric-box {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 1.25rem;
    text-align: center;
    position: relative;
    border-left: 4px solid var(--primary-color);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .metric-box:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }
  
  .metric-box .metric-label {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--medium-text);
    margin-bottom: 0.5rem;
  }
  
  .metric-box .metric-value {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--light-text);
  }
  
  .metric-unit {
    font-size: 0.9rem;
    color: var(--medium-text);
    margin-bottom: 0.75rem;
  }
  
  .metric-trend {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
  }
  
  .metric-trend.up {
    background-color: rgba(54, 179, 126, 0.15);
    color: var(--primary-light);
  }
  
  .metric-trend.down {
    background-color: rgba(255, 86, 48, 0.15);
    color: var(--accent-light);
  }
  
  /* Chart Legend Styling */
  .chart-legend-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1rem;
    justify-content: center;
  }
  
  .chart-legend-item {
    display: flex;
    align-items: center;
    margin-right: 1.5rem;
  }
  
  .legend-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
    margin-right: 0.5rem;
  }
  
  .legend-text {
    font-size: 0.9rem;
    color: var(--medium-text);
  }
  
  /* Framework Visualization Styling */
  .framework-dashboard {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }
  
  @media (min-width: 768px) {
    .framework-dashboard {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  .framework-box {
    background-color: rgba(54, 179, 126, 0.1);
    border-radius: var(--border-radius);
    padding: 1.25rem;
    transition: all 0.3s ease;
    border-left: 4px solid var(--primary-color);
  }
  
  .framework-box:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }
  
  .framework-box-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }
  
  .framework-box-title {
    font-weight: 600;
    color: var(--light-text);
  }
  
  .framework-box-score {
    font-weight: 700;
    color: var(--primary-light);
    background: rgba(54, 179, 126, 0.2);
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.9rem;
  }
  
  .framework-box-description {
    color: var(--medium-text);
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
  }
  
  .action-btn {
    display: inline-block;
    padding: 8px 16px;
    background-color: var(--primary-color);
    color: white;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all var(--transition-speed) ease;
    border: none;
    font-weight: 500;
    text-align: center;
  }
  
  .action-btn:hover {
    background-color: var(--primary-light);
  }
  
  .action-btn.secondary {
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--light-text);
  }
  
  .action-btn.secondary:hover {
    background-color: rgba(255, 255, 255, 0.2);
  }
  
  .trend-search {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  
  .trend-search input {
    flex: 1;
    background-color: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--light-text);
    padding: 10px 16px;
    border-radius: var(--border-radius);
    font-size: 0.95rem;
  }
  
  .trend-search input:focus {
    border-color: var(--primary-color);
    outline: none;
  }
  
  .resource-card {
    display: flex;
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    overflow: hidden;
    margin-bottom: 1rem;
    transition: all var(--transition-speed) ease;
  }
  
  .resource-card:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
  
  .resource-icon {
    width: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(54, 179, 126, 0.1);
    color: var(--primary-color);
    font-size: 1.5rem;
  }
  
  .resource-content {
    padding: 1rem;
    flex: 1;
  }
  
  .resource-title {
    font-weight: 500;
    margin-bottom: 0.5rem;
  }
  
  .resource-desc {
    font-size: 0.9rem;
    color: var(--medium-text);
  }
  
  .progress-bar {
    height: 4px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    margin-top: 0.5rem;
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
    border-radius: 2px;
  }

  /* AI Agent Card Styles */
  .ai-agent-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    position: relative;
    overflow: hidden;
  }

  .ai-agent-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(to bottom, var(--ai-primary), var(--ai-secondary));
  }

  .badge-new {
    background-color: var(--ai-primary);
    color: white;
    font-size: 0.7rem;
    font-weight: 500;
    padding: 3px 8px;
    border-radius: 12px;
    margin-left: 8px;
    vertical-align: middle;
  }

  .ai-agent-interface {
    margin-top: 1rem;
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: var(--border-radius);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 380px;
  }

  .agent-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
  }

  .agent-message {
    display: flex;
    margin-bottom: 1rem;
  }

  .agent-avatar {
    width: 36px;
    height: 36px;
    background-color: var(--ai-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    flex-shrink: 0;
  }

  .agent-avatar i {
    color: white;
    font-size: 1rem;
  }

  .message-content {
    background-color: rgba(255, 255, 255, 0.05);
    padding: 0.75rem 1rem;
    border-radius: 12px;
    border-top-left-radius: 4px;
    max-width: 85%;
  }

  .message-content p {
    margin: 0 0 0.5rem 0;
    color: var(--light-text);
    line-height: 1.5;
  }

  .message-content p:last-child {
    margin-bottom: 0;
  }

  .user-message {
    flex-direction: row-reverse;
  }

  .user-message .agent-avatar {
    margin-right: 0;
    margin-left: 12px;
    background-color: var(--ai-secondary);
  }

  .user-message .message-content {
    border-radius: 12px;
    border-top-right-radius: 4px;
    background-color: rgba(0, 184, 217, 0.15);
  }

  .agent-input-container {
    display: flex;
    padding: 0.75rem;
    background-color: rgba(0, 0, 0, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.05);
  }

  .agent-input {
    flex: 1;
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--light-text);
    padding: 10px 16px;
    border-radius: var(--border-radius);
    font-size: 0.95rem;
  }

  .agent-input:focus {
    border-color: var(--ai-primary);
    outline: none;
  }

  .send-button {
    background-color: var(--ai-primary);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    width: 40px;
    margin-left: 8px;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
  }

  .send-button:hover {
    background-color: #2d9669;
  }

  .agent-capabilities {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0.75rem;
    background-color: rgba(0, 0, 0, 0.15);
  }

  .capability {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    font-size: 0.8rem;
    color: var(--medium-text);
  }

  .capability i {
    margin-bottom: 4px;
    color: var(--light-text);
  }

  /* Framework Selector Styles */
  .framework-selector {
    margin-top: 1rem;
  }

  .framework-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    gap: 0.5rem;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.1);
    transition: .4s;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
  }

  input:checked + .slider {
    background-color: var(--ai-primary);
  }

  input:checked + .slider:before {
    transform: translateX(26px);
  }

  .slider.round {
    border-radius: 34px;
  }

  .slider.round:before {
    border-radius: 50%;
  }

  .framework-options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .framework-option {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius);
    overflow: hidden;
  }

  .framework-option input[type="radio"] {
    display: none;
  }

  .framework-option label {
    display: flex;
    padding: 0.75rem;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
  }

  .framework-option:hover label {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .framework-option input[type="radio"]:checked + label {
    background-color: rgba(54, 179, 126, 0.15);
    border-left: 3px solid var(--ai-primary);
  }

  .framework-icon {
    background-color: rgba(54, 179, 126, 0.1);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    flex-shrink: 0;
  }

  .framework-icon i {
    color: var(--ai-primary);
  }

  .framework-info {
    flex: 1;
  }

  .framework-name {
    font-weight: 500;
    margin-bottom: 4px;
    font-size: 0.95rem;
  }

  .framework-desc {
    font-size: 0.8rem;
    color: var(--medium-text);
  }

  @media (min-width: 768px) {
    .framework-options {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}

{% block main_content %}
<div class="strategy-hub-container">
  <!-- Header Section - Dashboard-inspired Header with Metrics -->
  <div class="finchat-section">
    <div class="strategy-header">
      <div>
        <h1 class="strategy-title">Strategy Hub</h1>
        <p class="strategy-subtitle">AI-powered insights for sustainability strategy and intelligence</p>
      </div>
      <div>
        <span class="finchat-badge finchat-badge-primary">AI-Driven</span>
        <span class="finchat-badge finchat-badge-secondary">Real-time Data</span>
      </div>
    </div>
    
    <!-- Key Metrics Summary (Dashboard-style) -->
    <div class="metric-summary">
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">Analyzed Frameworks</div>
          <i class="fas fa-sitemap" style="color: var(--primary-color);"></i>
        </div>
        <div class="metric-value">15+</div>
        <div class="metric-change positive">
          <i class="fas fa-arrow-up"></i> Updated Recently
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">Strategic Insights</div>
          <i class="fas fa-lightbulb" style="color: var(--primary-color);"></i>
        </div>
        <div class="metric-value">150+</div>
        <div class="metric-change positive">
          <i class="fas fa-arrow-up"></i> AI-Generated
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">ESG Regulations</div>
          <i class="fas fa-balance-scale" style="color: var(--primary-color);"></i>
        </div>
        <div class="metric-value">25+</div>
        <div class="metric-change neutral">
          <i class="fas fa-sync"></i> Updated
        </div>
      </div>
      
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-title">Compliance Score</div>
          <i class="fas fa-check-circle" style="color: var(--primary-color);"></i>
        </div>
        <div class="metric-value">92%</div>
        <div class="metric-change positive">
          <i class="fas fa-arrow-up"></i> +5%
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Controls - Dashboard Style -->
  <div class="finchat-card" style="margin-bottom: var(--fc-spacing-md);">
    <div class="finchat-card-body" style="padding: var(--fc-spacing-md);">
      <div style="display: flex; gap: var(--fc-spacing-md); flex-wrap: wrap; align-items: center;">
        <div>
          <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Industry</label>
          <select class="finchat-select" id="industryFilter">
            <option value="all">All Industries</option>
            <option value="energy">Energy</option>
            <option value="manufacturing">Manufacturing</option>
            <option value="finance">Finance</option>
            <option value="retail">Retail</option>
            <option value="tech">Technology</option>
          </select>
        </div>
        <div>
          <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Framework Type</label>
          <select class="finchat-select" id="frameworkFilter">
            <option value="all">All Frameworks</option>
            <option value="strategic">Strategic</option>
            <option value="regulatory">Regulatory</option>
            <option value="reporting">Reporting</option>
            <option value="monetization">Monetization</option>
          </select>
        </div>
        <div>
          <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Sort By</label>
          <select class="finchat-select" id="sortFilter">
            <option value="relevance">Relevance</option>
            <option value="recent">Most Recent</option>
            <option value="compliance">Compliance Score</option>
          </select>
        </div>
        <button class="finchat-button primary" style="margin-top: 1.5rem;">
          <i class="fas fa-filter"></i> Apply Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs - Finchat.io Style with dashboard-inspired design -->
  <div class="hub-tabs">
    <div class="hub-tab active" data-tab="strategy-modeler">Strategy Modeler</div>
    <div class="hub-tab" data-tab="monetization">Monetization</div>
    <div class="hub-tab" data-tab="virality-trends">Virality Trends</div>
    <div class="hub-tab" data-tab="data-analysis">Data Analysis</div>
    <div class="hub-tab" data-tab="storytelling">AI Storytelling</div>
  </div>

  <!-- Strategy Modeler Tab -->
  <div class="tab-content active" id="strategy-modeler">
    <!-- AI-Driven Framework Selection -->
    <div class="strategy-hub-container">
      <div class="hub-card">
        <div class="hub-card-title"><i class="fas fa-brain"></i> AI-Driven Framework Selection</div>
        <p class="card-description">Our intelligent system will select the most appropriate strategic framework based on your company's profile and sustainability goals.</p>
        
        <form id="framework-form" class="strategic-plan-form">
          <div class="form-group">
            <label for="company-name">Company Name</label>
            <input type="text" id="company-name" name="company_name" placeholder="Enter your company name" required>
          </div>
          
          <div class="form-group">
            <label for="industry">Industry</label>
            <select id="industry" name="industry" required>
              <option value="">Select industry</option>
              <option value="real estate">Real Estate</option>
              <option value="energy">Energy</option>
              <option value="technology">Technology</option>
              <option value="manufacturing">Manufacturing</option>
              <option value="financial services">Financial Services</option>
              <option value="healthcare">Healthcare</option>
              <option value="retail">Retail</option>
              <option value="automotive">Automotive</option>
              <option value="agriculture">Agriculture</option>
              <option value="construction">Construction</option>
            </select>
          </div>
          
          <div class="form-group">
            <div class="auto-select-container">
              <input type="checkbox" id="auto-select-framework" name="auto_select" checked>
              <label for="auto-select-framework">Let AI select the best framework</label>
            </div>
            
            <div id="framework-options" style="opacity: 0.5; pointer-events: none;">
              <div class="framework-selection-title">Or select a framework manually:</div>
              <div class="framework-options-grid">
                <div class="framework-option">
                  <input type="radio" id="framework-porters" name="framework" value="porters">
                  <label for="framework-porters">Porter's Five Forces</label>
                </div>
                <div class="framework-option">
                  <input type="radio" id="framework-swot" name="framework" value="swot">
                  <label for="framework-swot">SWOT Analysis</label>
                </div>
                <div class="framework-option">
                  <input type="radio" id="framework-bcg" name="framework" value="bcg">
                  <label for="framework-bcg">BCG Matrix</label>
                </div>
                <div class="framework-option">
                  <input type="radio" id="framework-mckinsey" name="framework" value="mckinsey">
                  <label for="framework-mckinsey">McKinsey Matrix</label>
                </div>
                <div class="framework-option">
                  <input type="radio" id="framework-strategy-pyramid" name="framework" value="strategy_pyramid">
                  <label for="framework-strategy-pyramid">Strategy Pyramid</label>
                </div>
                <div class="framework-option">
                  <input type="radio" id="framework-blue-ocean" name="framework" value="blue_ocean">
                  <label for="framework-blue-ocean">Blue Ocean Strategy</label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Business Environment Assessment</label>
            <div class="assessment-sliders">
              <div class="assessment-slider">
                <div class="slider-label">
                  <span>Competitive Rivalry</span>
                  <span class="slider-value">50</span>
                </div>
                <input type="range" id="competitive-rivalry" min="0" max="100" value="50" 
                  oninput="this.previousElementSibling.querySelector('.slider-value').textContent = this.value">
              </div>
              
              <div class="assessment-slider">
                <div class="slider-label">
                  <span>Supplier Power</span>
                  <span class="slider-value">50</span>
                </div>
                <input type="range" id="supplier-power" min="0" max="100" value="50"
                  oninput="this.previousElementSibling.querySelector('.slider-value').textContent = this.value">
              </div>
              
              <div class="assessment-slider">
                <div class="slider-label">
                  <span>Buyer Power</span>
                  <span class="slider-value">50</span>
                </div>
                <input type="range" id="buyer-power" min="0" max="100" value="50"
                  oninput="this.previousElementSibling.querySelector('.slider-value').textContent = this.value">
              </div>
              
              <div class="assessment-slider">
                <div class="slider-label">
                  <span>Threat of Substitution</span>
                  <span class="slider-value">50</span>
                </div>
                <input type="range" id="substitution-threat" min="0" max="100" value="50"
                  oninput="this.previousElementSibling.querySelector('.slider-value').textContent = this.value">
              </div>
              
              <div class="assessment-slider">
                <div class="slider-label">
                  <span>Threat of New Entry</span>
                  <span class="slider-value">50</span>
                </div>
                <input type="range" id="new-entry-threat" min="0" max="100" value="50"
                  oninput="this.previousElementSibling.querySelector('.slider-value').textContent = this.value">
              </div>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="action-btn">Analyze with AI</button>
          </div>
        </form>
      </div>
      
      <div id="framework-results" class="framework-results">
        <!-- Results will be displayed here -->
      </div>
    </div>
    
    <div class="card-grid-2">
      <!-- AI Strategy Agent Card -->
      <div class="hub-card ai-agent-card">
        <div class="hub-card-title">
          <i class="fas fa-robot"></i> AI Strategy Agent <span class="badge-new">Agentic RAG</span>
        </div>
        <p>Our Agentic RAG Strategy Assistant uses AI planning, memory and retrieval to create personalized sustainability strategies.</p>
        
        <div class="ai-agent-interface">
          <div class="agent-messages" id="agent-messages">
            <div class="agent-message">
              <div class="agent-avatar">
                <i class="fas fa-robot"></i>
              </div>
              <div class="message-content">
                <p>Hello! I'm your AI Strategy Agent. I can help you develop sustainability strategies using memory, planning (Chain-of-Thought), and real-time data retrieval.</p>
                <p>What sustainability challenge would you like to tackle today?</p>
              </div>
            </div>
          </div>
          
          <div class="agent-input-container">
            <input type="text" id="agent-input" placeholder="Describe your sustainability challenge..." class="agent-input">
            <button id="send-message" class="send-button">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
          
          <div class="agent-capabilities">
            <div class="capability">
              <i class="fas fa-database"></i>
              <span>Retrieval</span>
            </div>
            <div class="capability">
              <i class="fas fa-brain"></i>
              <span>Planning</span>
            </div>
            <div class="capability">
              <i class="fas fa-memory"></i>
              <span>Memory</span>
            </div>
            <div class="capability">
              <i class="fas fa-tools"></i>
              <span>Tool Use</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Framework Selection Card -->
      <div class="hub-card">
        <div class="hub-card-title">
          <i class="fas fa-project-diagram"></i> Strategy Framework
        </div>
        <p>Select a strategic framework or let the AI automatically recommend the most suitable one.</p>
        
        <div class="framework-selector">
          <div class="framework-toggle">
            <span>Manual Selection</span>
            <label class="switch">
              <input type="checkbox" id="auto-framework">
              <span class="slider round"></span>
            </label>
            <span>AI Recommendation</span>
          </div>
          
          <div class="framework-options" id="framework-options">
            {% for framework_id, framework in frameworks.items() %}
            <div class="framework-option">
              <input type="radio" name="framework" id="framework-{{ framework_id }}" value="{{ framework_id }}" {% if framework_id == 'stepps' %}checked{% endif %}>
              <label for="framework-{{ framework_id }}">
                <div class="framework-icon">
                  <i class="{{ framework.icon }}"></i>
                </div>
                <div class="framework-info">
                  <span class="framework-name">{{ framework.name }}</span>
                  <span class="framework-desc">{{ framework.description }}</span>
                </div>
              </label>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      
      <!-- Document Upload Card -->
      <div class="hub-card">
        <div class="hub-card-title">
          <i class="fas fa-file-pdf"></i> Document Analysis
        </div>
        <p>Upload documents to analyze sustainability reporting, extract insights with our multimodal OCR+NLP technology.</p>
        
        <div class="pdf-dropzone" id="pdf-dropzone">
          <div class="pdf-icon">
            <i class="fas fa-file-upload"></i>
          </div>
          <p>Drag & drop a document or click to browse</p>
          <small>Supported formats: PDF, DOCX, XLSX, CSV</small>
          
          <div class="analysis-options">
            <div class="analysis-option">
              <input type="checkbox" id="extract-entities" checked>
              <label for="extract-entities">Extract Entities</label>
            </div>
            <div class="analysis-option">
              <input type="checkbox" id="benchmark" checked>
              <label for="benchmark">Industry Benchmark</label>
            </div>
            <div class="analysis-option">
              <input type="checkbox" id="regulatory-check" checked>
              <label for="regulatory-check">Regulatory Check</label>
            </div>
          </div>
        </div>
        
        <input type="file" id="pdf-upload" style="display: none;" accept=".pdf,.docx,.doc,.xlsx,.xls,.csv">
        
        <div style="margin-top: 1rem; text-align: center;">
          <button class="action-btn" id="upload-btn">Upload Document</button>
        </div>
      </div>
      
      <!-- Recent Documents -->
      <div class="hub-card">
        <div class="hub-card-title">
          <i class="fas fa-folder-open"></i> Recent Documents
        </div>
        <p>Access your recently analyzed documents and reports.</p>
        
        <div class="document-list">
          {% if recent_documents %}
            {% for doc in recent_documents %}
              <div class="document-card" data-id="{{ doc.id }}">
                <div class="document-icon">
                  {% if doc.id.endswith('.pdf') %}
                    <i class="fas fa-file-pdf"></i>
                  {% elif doc.id.endswith('.xlsx') or doc.id.endswith('.xls') %}
                    <i class="fas fa-file-excel"></i>
                  {% elif doc.id.endswith('.docx') or doc.id.endswith('.doc') %}
                    <i class="fas fa-file-word"></i>
                  {% elif doc.id.endswith('.csv') %}
                    <i class="fas fa-file-csv"></i>
                  {% else %}
                    <i class="fas fa-file-alt"></i>
                  {% endif %}
                </div>
                <div class="document-info">
                  <div class="document-title">{{ doc.title }}<span class="document-category">{{ doc.category }}</span></div>
                  <div class="document-meta">{{ doc.timestamp }} â€¢ {{ doc.page_count }} pages</div>
                </div>
                <div>
                  <i class="fas fa-chevron-right"></i>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="insight-card">
              <div class="insight-title">No documents found</div>
              <div class="insight-body">Upload your first document to get started with document intelligence.</div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Monetization Tab -->
  <div class="tab-content" id="monetization">
    <div class="card-grid-2">
      <!-- Monetization Strategies Overview -->
      <div class="hub-card">
        <div class="hub-card-title">
          <i class="fas fa-hand-holding-usd"></i> Monetization Strategies
        </div>
        <p>Explore various monetization strategies for sustainability intelligence to create new value streams.</p>
        
        <div class="monetization-categories">
          {% if monetization_strategies %}
            {% for strategy_id, strategy in monetization_strategies.items() %}
              <div class="monetization-category">
                <div class="monetization-header">
                  <div class="strategy-icon">
                    <i class="fas fa-chart-line"></i>
                  </div>
                  <div class="strategy-header-text">
                    <div class="strategy-name">{{ strategy.name }}</div>
                    <div class="strategy-desc">{{ strategy.description }}</div>
                  </div>
                </div>
                <div class="strategy-metrics">
                  <div class="strategy-metrics-title">Key Metrics:</div>
                  <div class="strategy-metrics-list">
                    {% for metric in strategy.key_metrics %}
                      <span class="strategy-metric">{{ metric }}</span>
                    {% endfor %}
                  </div>
                </div>
                <div style="margin-top: 0.5rem; text-align: right;">
                  <button class="small-action-btn analyze-strategy" data-strategy-id="{{ strategy_id }}">Analyze Opportunity</button>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="insight-card">
              <div class="insight-title">No monetization strategies found</div>
              <div class="insight-body">Connect to the monetization strategies module to explore opportunities.</div>
            </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Strategic Plan Generator -->
      <div class="hub-card">
        <div class="hub-card-title">
          <i class="fas fa-project-diagram"></i> Strategic Plan Generator
        </div>
        <p>Generate a comprehensive strategic plan for monetizing sustainability intelligence.</p>
        
        <div class="strategic-plan-form">
          <div class="form-group">
            <label for="company-name">Company Name</label>
            <input type="text" id="company-name" placeholder="Your company name">
          </div>
          
          <div class="form-group">
            <label for="industry">Industry</label>
            <select id="industry">
              <option value="technology">Technology</option>
              <option value="energy">Energy & Utilities</option>
              <option value="manufacturing">Manufacturing</option>
              <option value="financial">Financial Services</option>
              <option value="retail">Retail & Consumer Goods</option>
              <option value="healthcare">Healthcare & Life Sciences</option>
              <option value="transportation">Transportation & Logistics</option>
              <option value="construction">Construction & Real Estate</option>
              <option value="agriculture">Agriculture & Food</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="business-objectives">Business Objectives</label>
            <div class="checkbox-list">
              <div class="checkbox-item">
                <input type="checkbox" id="objective-revenue" checked>
                <label for="objective-revenue">Revenue Growth</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="objective-differentiation" checked>
                <label for="objective-differentiation">Market Differentiation</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="objective-innovation">
                <label for="objective-innovation">Product Innovation</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="objective-compliance">
                <label for="objective-compliance">Regulatory Compliance</label>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="sustainability-focus">Sustainability Focus Areas</label>
            <div class="checkbox-list">
              <div class="checkbox-item">
                <input type="checkbox" id="focus-climate" checked>
                <label for="focus-climate">Climate Action</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="focus-circular">
                <label for="focus-circular">Circular Economy</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="focus-social">
                <label for="focus-social">Social Impact</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="focus-biodiversity">
                <label for="focus-biodiversity">Biodiversity</label>
              </div>
            </div>
          </div>
          
          <div style="margin-top: 1rem; text-align: center;">
            <button class="action-btn" id="generate-plan-btn">Generate Strategic Plan</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Strategic Plan Results Section -->
    <div class="hub-card" id="strategic-plan-results" style="display: none; margin-top: 1.5rem;">
      <div class="hub-card-title">
        <i class="fas fa-lightbulb"></i> <span id="plan-title">Strategic Plan</span>
      </div>
      
      <div class="strategic-plan-header">
        <div class="plan-company"></div>
        <div class="plan-industry"></div>
      </div>
      
      <div class="strategic-plan-content">
        <!-- Content will be dynamically populated by JavaScript -->
        <div id="plan-content"></div>
      </div>
      
      <div style="margin-top: 1rem; text-align: center;">
        <button class="secondary-action-btn" id="export-plan-btn">Export Plan</button>
      </div>
    </div>
  </div>

  <!-- Virality Trends Tab -->
  <div class="tab-content" id="virality-trends">
    <!-- Dashboard-inspired Virality Trends Interface -->
    <div class="finchat-section">
      <div class="finchat-section-title">
        <i class="fas fa-chart-line"></i> Sustainability Trend Analysis
      </div>
      
      <!-- Filter Controls - Dashboard Style -->
      <div class="finchat-card" style="margin-bottom: var(--fc-spacing-md);">
        <div class="finchat-card-body" style="padding: var(--fc-spacing-md);">
          <div style="display: flex; gap: var(--fc-spacing-md); flex-wrap: wrap; align-items: center;">
            <div>
              <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Category</label>
              <select class="finchat-select" id="trendCategoryFilter">
                <option value="all" selected>All Categories</option>
                <option value="climate">Climate Action</option>
                <option value="resource">Resource Efficiency</option>
                <option value="governance">ESG Governance</option>
                <option value="finance">Sustainable Finance</option>
              </select>
            </div>
            <div>
              <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Sort By</label>
              <select class="finchat-select" id="trendSortFilter">
                <option value="virality" selected>Virality Score</option>
                <option value="mentions">Mentions</option>
                <option value="sentiment">Sentiment</option>
                <option value="recent">Most Recent</option>
              </select>
            </div>
            <button class="finchat-button primary" id="applyTrendFilters">
              <i class="fas fa-filter"></i> Apply Filters
            </button>
          </div>
        </div>
      </div>
      
      <!-- Trend Search Card - Dashboard Style -->
      <div class="finchat-card">
        <div class="market-chart-header">
          <div class="market-chart-title"><i class="fas fa-search"></i> Analyze Sustainability Trends</div>
        </div>
        <p>Search for emerging sustainability trends and get detailed intelligence on their strategic implications.</p>
        
        <div class="trend-search" style="display: flex; gap: var(--fc-spacing-xs); margin-top: var(--fc-spacing-sm);">
          <input type="text" class="finchat-input" id="trend-search-input" placeholder="Enter a sustainability trend (e.g., 'Carbon Offsetting')" style="flex: 1;">
          <button class="finchat-button primary" id="trend-search-btn">Analyze</button>
        </div>
        
        <div>
          <p>Popular trends:</p>
          <div style="margin-top: 0.5rem;">
            <span class="trend-tag" data-trend="Circular Economy">Circular Economy</span>
            <span class="trend-tag" data-trend="Sustainable Supply Chain">Sustainable Supply Chain</span>
            <span class="trend-tag" data-trend="Net Zero Transition">Net Zero Transition</span>
            <span class="trend-tag" data-trend="ESG Reporting">ESG Reporting</span>
            <span class="trend-tag" data-trend="Carbon Credits">Carbon Credits</span>
            <span class="trend-tag" data-trend="Renewable Energy">Renewable Energy</span>
          </div>
        </div>
      </div>
      
      <!-- Trend Results -->
      <div class="hub-card" id="trend-results" style="display: none;">
        <div class="hub-card-title">
          <i class="fas fa-chart-line"></i> <span id="trend-results-title">Trend Analysis</span>
        </div>
        
        <div class="trend-score" id="trend-virality-score">78</div>
        <div class="score-label">Virality Score</div>
        
        <!-- Interactive STEPPS Radar Chart -->
        <div class="chart-container">
          <canvas id="steppsRadarChart"></canvas>
        </div>
        
        <!-- STEPPS Grid Items -->
        <div class="stepps-grid">
          <div class="stepps-item">
            <div class="stepps-score" style="color: #36b37e;">82</div>
            <div class="stepps-name">Social Currency</div>
            <div class="stepps-desc">How sharing makes people look</div>
          </div>
          <div class="stepps-item">
            <div class="stepps-score" style="color: #00b8d9;">76</div>
            <div class="stepps-name">Triggers</div>
            <div class="stepps-desc">Environmental reminders</div>
          </div>
          <div class="stepps-item">
            <div class="stepps-score" style="color: #6554c0;">85</div>
            <div class="stepps-name">Emotion</div>
            <div class="stepps-desc">When we care, we share</div>
          </div>
          <div class="stepps-item">
            <div class="stepps-score" style="color: #ff5630;">65</div>
            <div class="stepps-name">Public</div>
            <div class="stepps-desc">Built to show, built to grow</div>
          </div>
          <div class="stepps-item">
            <div class="stepps-score" style="color: #ffab00;">80</div>
            <div class="stepps-name">Practical Value</div>
            <div class="stepps-desc">Useful gets shared</div>
          </div>
          <div class="stepps-item">
            <div class="stepps-score" style="color: #00875a;">78</div>
            <div class="stepps-name">Stories</div>
            <div class="stepps-desc">Information in narratives</div>
          </div>
        </div>
        
        <h3 style="margin-top: 2rem; margin-bottom: 1rem;">Industry Impact</h3>
        
        <div class="industry-impact">
          <div class="impact-label">
            <span>Technology</span>
            <span>85%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" style="width: 85%;"></div>
          </div>
        </div>
        
        <div class="industry-impact">
          <div class="impact-label">
            <span>Manufacturing</span>
            <span>75%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" style="width: 75%;"></div>
          </div>
        </div>
        
        <div class="industry-impact">
          <div class="impact-label">
            <span>Energy</span>
            <span>92%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" style="width: 92%;"></div>
          </div>
        </div>
        
        <div class="industry-impact">
          <div class="impact-label">
            <span>Retail</span>
            <span>65%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" style="width: 65%;"></div>
          </div>
        </div>
        
        <div class="industry-impact">
          <div class="impact-label">
            <span>Finance</span>
            <span>70%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" style="width: 70%;"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Strategic Implications -->
    <div class="hub-card" id="strategic-implications" style="display: none; margin-top: 1.5rem;">
      <div class="hub-card-title">
        <i class="fas fa-lightbulb"></i> Strategic Implications
      </div>
      
      <div class="strategic-item">
        <div class="strategic-header">
          <div class="strategic-area">Strategic Assessment</div>
          <div class="strategic-potential potential-high">High Potential</div>
        </div>
        <div class="strategic-timeframe">Short-term (3-6 months)</div>
        <div class="strategic-response">Conduct comprehensive assessment of this trend's impact on organization's value chain</div>
      </div>
      
      <div class="strategic-item">
        <div class="strategic-header">
          <div class="strategic-area">Capability Development</div>
          <div class="strategic-potential potential-medium">Medium Potential</div>
        </div>
        <div class="strategic-timeframe">Medium-term (1-2 years)</div>
        <div class="strategic-response">Build organizational capabilities to leverage this trend for competitive advantage</div>
      </div>
      
      <div class="strategic-item">
        <div class="strategic-header">
          <div class="strategic-area">Innovation Pipeline</div>
          <div class="strategic-potential potential-high">High Potential</div>
        </div>
        <div class="strategic-timeframe">Long-term (2-4 years)</div>
        <div class="strategic-response">Integrate this trend into product development and innovation pipeline</div>
      </div>
    </div>
  </div>

  <!-- Data Analysis Tab - Dashboard Style -->
  <div class="tab-content" id="data-analysis">
    <div class="finchat-section">
      <div class="finchat-section-title">
        <i class="fas fa-chart-bar"></i> Data Analysis & Insights
      </div>
      
      <!-- Dashboard-style Metrics Summary -->
      <div class="metric-summary">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Carbon Emissions</div>
            <i class="fas fa-smog" style="color: var(--fc-negative);"></i>
          </div>
          <div class="metric-value">42.8 tCOâ‚‚e</div>
          <div class="metric-change positive">
            <i class="fas fa-arrow-down"></i> -12.5%
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Energy Usage</div>
            <i class="fas fa-bolt" style="color: #ffab00;"></i>
          </div>
          <div class="metric-value">238 MWh</div>
          <div class="metric-change positive">
            <i class="fas fa-arrow-down"></i> -8.3%
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Waste Diversion</div>
            <i class="fas fa-recycle" style="color: var(--fc-primary);"></i>
          </div>
          <div class="metric-value">76.2%</div>
          <div class="metric-change positive">
            <i class="fas fa-arrow-up"></i> +5.1%
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Water Usage</div>
            <i class="fas fa-tint" style="color: var(--fc-info);"></i>
          </div>
          <div class="metric-value">1,432 mÂ³</div>
          <div class="metric-change neutral">
            <i class="fas fa-minus"></i> 0.2%
          </div>
        </div>
      </div>
      
      <!-- Two-column layout -->
      <div class="two-col-grid">
        <!-- Main content -->
        <div>
          <!-- Performance Chart -->
          <div class="finchat-card">
            <div class="market-chart-header">
              <div class="market-chart-title">Sustainability Performance</div>
              <div class="chart-controls">
                <div class="chart-period active" data-period="quarter">Q</div>
                <div class="chart-period" data-period="ytd">YTD</div>
                <div class="chart-period" data-period="year">1Y</div>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="sustainabilityPerformanceChart"></canvas>
            </div>
          </div>
          
          <!-- Data Sources - Dashboard Style -->
          <div class="finchat-card" style="margin-top: var(--fc-spacing-md);">
            <div class="market-chart-header">
              <div class="market-chart-title">Data Sources</div>
            </div>
            <p>Connect to your sustainability data sources for comprehensive analysis and insights.</p>
        
        <div class="data-source-grid">
          <div class="data-source-item">
            <div class="data-source-icon">
              <i class="fas fa-cloud"></i>
            </div>
            <div class="data-source-info">
              <div class="data-source-name">API Connection</div>
              <div class="data-source-desc">Connect to external sustainability APIs</div>
              <button class="small-action-btn">Connect</button>
            </div>
          </div>
          
          <div class="data-source-item">
            <div class="data-source-icon">
              <i class="fas fa-hdd"></i>
            </div>
            <div class="data-source-info">
              <div class="data-source-name">Data Lake</div>
              <div class="data-source-desc">Import from your organization's data lake</div>
              <button class="small-action-btn">Connect</button>
            </div>
          </div>
          
          <div class="data-source-item">
            <div class="data-source-icon">
              <i class="fas fa-file-csv"></i>
            </div>
            <div class="data-source-info">
              <div class="data-source-name">CSV/Excel Import</div>
              <div class="data-source-desc">Upload structured data files</div>
              <button class="small-action-btn">Upload</button>
            </div>
          </div>
          
          <div class="data-source-item">
            <div class="data-source-icon">
              <i class="fas fa-file-pdf"></i>
            </div>
            <div class="data-source-info">
              <div class="data-source-name">PDF Analysis</div>
              <div class="data-source-desc">Extract data from reports and documents</div>
              <button class="small-action-btn">Upload</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Data Analysis Dashboard -->
      <div class="hub-card">
        <div class="hub-card-title">
          <i class="fas fa-chart-line"></i> Sustainability Metrics
        </div>
        <p>Key sustainability performance indicators and metrics analysis.</p>
        
        <div class="metrics-dashboard">
          <div class="metrics-row">
            <div class="metric-box">
              <div class="metric-label">Carbon Footprint</div>
              <div class="metric-value">42.8</div>
              <div class="metric-unit">tCO2e</div>
              <div class="metric-trend down">â†“ 12.5%</div>
            </div>
            
            <div class="metric-box">
              <div class="metric-label">Energy Usage</div>
              <div class="metric-value">238</div>
              <div class="metric-unit">MWh</div>
              <div class="metric-trend down">â†“ 8.3%</div>
            </div>
            
            <div class="metric-box">
              <div class="metric-label">Waste Diverted</div>
              <div class="metric-value">76.2</div>
              <div class="metric-unit">%</div>
              <div class="metric-trend up">â†‘ 5.1%</div>
            </div>
          </div>
          
          <div class="chart-container">
            <canvas id="sustainabilityPerformanceChart"></canvas>
          </div>
          
          <div class="chart-legend-container">
            <div class="chart-legend-item">
              <div class="legend-color" style="background-color: #36b37e;"></div>
              <div class="legend-text">Carbon Emissions</div>
            </div>
            <div class="chart-legend-item">
              <div class="legend-color" style="background-color: #00b8d9;"></div>
              <div class="legend-text">Energy Consumption</div>
            </div>
            <div class="chart-legend-item">
              <div class="legend-color" style="background-color: #6554c0;"></div>
              <div class="legend-text">Waste Metrics</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Advanced Analytics Card -->
    <div class="hub-card" style="margin-top: 1.5rem;">
      <div class="hub-card-title">
        <i class="fas fa-brain"></i> Advanced Analytics
      </div>
      <p>AI-powered data analysis to identify strategic patterns and opportunities.</p>
      
      <div class="analytics-options">
        <div class="analytics-option-card">
          <div class="analytics-icon">
            <i class="fas fa-project-diagram"></i>
          </div>
          <div class="analytics-title">Correlation Analysis</div>
          <div class="analytics-desc">Identify relationships between sustainability metrics and business outcomes.</div>
          <button class="secondary-action-btn">Run Analysis</button>
        </div>
        
        <div class="analytics-option-card">
          <div class="analytics-icon">
            <i class="fas fa-chart-area"></i>
          </div>
          <div class="analytics-title">Forecasting</div>
          <div class="analytics-desc">Predict future sustainability performance based on historical data.</div>
          <button class="secondary-action-btn">Generate Forecast</button>
        </div>
        
        <div class="analytics-option-card">
          <div class="analytics-icon">
            <i class="fas fa-sitemap"></i>
          </div>
          <div class="analytics-title">Scenario Modeling</div>
          <div class="analytics-desc">Model different scenarios to optimize sustainability strategy.</div>
          <button class="secondary-action-btn">Build Scenarios</button>
        </div>
        
        <div class="analytics-option-card">
          <div class="analytics-icon">
            <i class="fas fa-comments"></i>
          </div>
          <div class="analytics-title">Sentiment Analysis</div>
          <div class="analytics-desc">Analyze stakeholder sentiment on sustainability initiatives.</div>
          <button class="secondary-action-btn">Run Analysis</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Strategy Consultant Tab - Dashboard Style -->
  <!-- Storytelling Tab -->
  <div class="tab-content" id="storytelling">
    <div class="strategy-hub-container">
      <div class="hub-card">
        <div class="hub-card-title"><i class="fas fa-book-open"></i> AI-Powered Sustainability Storytelling</div>
        <p class="card-description">Transform your sustainability data into compelling, stakeholder-ready narratives with intelligent storytelling capabilities.</p>
        
        <div class="card-grid-2">
          <!-- Create Story Card -->
          <div class="insight-card">
            <div class="insight-header">
              <i class="fas fa-plus-circle"></i> Create New Story
            </div>
            <div class="insight-body">
              Create a new sustainability story using AI assistance. Choose from various templates or start with a custom narrative.
            </div>
            <div class="insight-footer">
              <a href="/stories/create" class="action-btn">Create Story</a>
            </div>
          </div>
          
          <!-- Story Library Card -->
          <div class="insight-card">
            <div class="insight-header">
              <i class="fas fa-book"></i> Story Library
            </div>
            <div class="insight-body">
              Browse and manage your existing sustainability stories, filter by audience, category, or date.
            </div>
            <div class="insight-footer">
              <a href="/stories" class="action-btn">View Library</a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Recent Stories -->
      <div class="hub-card">
        <div class="hub-card-title"><i class="fas fa-history"></i> Recent Stories</div>
        <p class="card-description">Your recently created sustainability stories.</p>
        
        <div class="story-list" id="recent-stories">
          <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i> Loading recent stories...
          </div>
        </div>
      </div>
      
      <!-- Story Templates -->
      <div class="hub-card">
        <div class="hub-card-title"><i class="fas fa-file-alt"></i> Story Templates</div>
        <p class="card-description">Choose from pre-designed templates to accelerate your storytelling process.</p>
        
        <div class="template-grid">
          <!-- Template 1 -->
          <div class="template-card" data-template="climate-action">
            <div class="template-icon"><i class="fas fa-leaf"></i></div>
            <div class="template-title">Climate Action Narrative</div>
            <div class="template-desc">Tell your climate action story, highlighting emissions reductions and progress toward targets.</div>
            <div class="template-footer">
              <a href="/stories/create?template=climate-action" class="small-action-btn">Use Template</a>
            </div>
          </div>
          
          <!-- Template 2 -->
          <div class="template-card" data-template="esg-report">
            <div class="template-icon"><i class="fas fa-chart-line"></i></div>
            <div class="template-title">ESG Performance Summary</div>
            <div class="template-desc">Summarize your environmental, social, and governance performance with key metrics.</div>
            <div class="template-footer">
              <a href="/stories/create?template=esg-report" class="small-action-btn">Use Template</a>
            </div>
          </div>
          
          <!-- Template 3 -->
          <div class="template-card" data-template="regulatory">
            <div class="template-icon"><i class="fas fa-clipboard-check"></i></div>
            <div class="template-title">Regulatory Compliance Story</div>
            <div class="template-desc">Showcase your compliance with sustainability regulations like CSRD or ISSB standards.</div>
            <div class="template-footer">
              <a href="/stories/create?template=regulatory" class="small-action-btn">Use Template</a>
            </div>
          </div>
          
          <!-- Template 4 -->
          <div class="template-card" data-template="stakeholder">
            <div class="template-icon"><i class="fas fa-users"></i></div>
            <div class="template-title">Stakeholder Engagement</div>
            <div class="template-desc">Craft a narrative focusing on how you engage with various stakeholders on sustainability.</div>
            <div class="template-footer">
              <a href="/stories/create?template=stakeholder" class="small-action-btn">Use Template</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-content" id="ai-consultant">
    <div class="finchat-section">
      <div class="finchat-section-title">
        <i class="fas fa-robot"></i> AI Strategy Consultant
      </div>
      
      <!-- Dashboard-style Metrics Summary -->
      <div class="metric-summary">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Framework Matches</div>
            <i class="fas fa-sitemap" style="color: var(--fc-info);"></i>
          </div>
          <div class="metric-value">12</div>
          <div class="metric-change positive">
            <i class="fas fa-check"></i> Available
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Strategy Models</div>
            <i class="fas fa-brain" style="color: var(--fc-primary);"></i>
          </div>
          <div class="metric-value">8</div>
          <div class="metric-change positive">
            <i class="fas fa-check"></i> Ready
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Document Analysis</div>
            <i class="fas fa-file-alt" style="color: #ffab00;"></i>
          </div>
          <div class="metric-value">Active</div>
          <div class="metric-change positive">
            <i class="fas fa-check"></i> Ready
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">AI Insights</div>
            <i class="fas fa-lightbulb" style="color: var(--fc-success);"></i>
          </div>
          <div class="metric-value">Ready</div>
          <div class="metric-change positive">
            <i class="fas fa-bolt"></i> Real-time
          </div>
        </div>
      </div>
      
      <!-- Two-column layout -->
      <div class="two-col-grid">
        <!-- Main content -->
        <div>
          <div class="finchat-card">
            <div class="market-chart-header">
              <div class="market-chart-title">Strategy Consultation</div>
            </div>
            
            <div style="padding: 1.5rem 0; text-align: center;">
              <div style="font-size: 4rem; color: var(--fc-primary); margin-bottom: 1rem;">
                <i class="fas fa-comment-dots"></i>
              </div>
              <h3 style="margin-bottom: 0.75rem;">Start a Strategy Consultation</h3>
              <p style="color: var(--fc-text-medium); margin-bottom: 1.5rem;">Our AI consultant will analyze your data and provide personalized strategic recommendations</p>
              
              <button class="fc-button primary" id="start-consultation-btn">Begin Consultation</button>
            </div>
          </div>
          
          <div class="finchat-card" style="margin-top: var(--fc-spacing-md);">
            <div class="market-chart-header">
              <div class="market-chart-title">Framework Advisor</div>
            </div>
            
            <div class="framework-advisor-content">
              <p style="margin-bottom: 1rem;">Get personalized recommendations on which sustainability frameworks best match your organization's needs:</p>
              
              <div class="framework-categories">
                <div class="framework-category">
                  <div class="framework-category-name">Environmental</div>
                  <div class="framework-category-bar">
                    <div class="framework-category-progress" style="width: 85%;"></div>
                  </div>
                  <div class="framework-category-stat">85%</div>
                </div>
                
                <div class="framework-category">
                  <div class="framework-category-name">Social</div>
                  <div class="framework-category-bar">
                    <div class="framework-category-progress" style="width: 72%;"></div>
                  </div>
                  <div class="framework-category-stat">72%</div>
                </div>
                
                <div class="framework-category">
                  <div class="framework-category-name">Governance</div>
                  <div class="framework-category-bar">
                    <div class="framework-category-progress" style="width: 93%;"></div>
                  </div>
                  <div class="framework-category-stat">93%</div>
                </div>
              </div>
              
              <!-- Framework Dashboard - Enhanced Visualization with Dashboard Style -->
              <div class="framework-dashboard">
                <div class="framework-box">
                  <div class="framework-box-header">
                    <div class="framework-box-title">Global Reporting Initiative</div>
                    <div class="framework-box-score">92%</div>
                  </div>
                  <div class="framework-box-description">
                    The GRI Standards help organizations understand and communicate their sustainability impact with standardized metrics.
                  </div>
                  <div class="framework-categories">
                    <div class="framework-category">
                      <div class="framework-category-name">Match</div>
                      <div class="framework-category-bar">
                        <div class="framework-category-progress" style="width: 92%;"></div>
                      </div>
                      <div class="framework-category-stat">92%</div>
                    </div>
                  </div>
                </div>
                
                <div class="framework-box">
                  <div class="framework-box-header">
                    <div class="framework-box-title">TCFD</div>
                    <div class="framework-box-score">88%</div>
                  </div>
                  <div class="framework-box-description">
                    Task Force on Climate-related Financial Disclosures helps organizations report climate-related risks.
                  </div>
                  <div class="framework-categories">
                    <div class="framework-category">
                      <div class="framework-category-name">Match</div>
                      <div class="framework-category-bar">
                        <div class="framework-category-progress" style="width: 88%;"></div>
                      </div>
                      <div class="framework-category-stat">88%</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div style="margin-top: 1.5rem; text-align: center;">
                <a href="{{ url_for('enhanced_strategy.framework_selection_guide') }}" class="fc-button outline">View Framework Selection Guide</a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Side content -->
        <div>
          <div class="finchat-card">
            <div class="market-chart-header">
              <div class="market-chart-title">Strategy Resources</div>
            </div>
            
            <div class="resource-list">
              <div class="resource-item">
                <div class="resource-icon">
                  <i class="fas fa-leaf"></i>
                </div>
                <div class="resource-content">
                  <div class="resource-title">Sustainability Strategy Template</div>
                  <div class="resource-desc">A comprehensive template to develop your sustainability strategy</div>
                  <a href="#" class="resource-link">Download Template</a>
                </div>
              </div>
              
              <div class="resource-item">
                <div class="resource-icon">
                  <i class="fas fa-chart-bar"></i>
                </div>
                <div class="resource-content">
                  <div class="resource-title">Materiality Assessment Guide</div>
                  <div class="resource-desc">Step-by-step guide to conducting a materiality assessment</div>
                  <a href="#" class="resource-link">Access Guide</a>
                </div>
              </div>
              
              <div class="resource-item">
                <div class="resource-icon">
                  <i class="fas fa-bullseye"></i>
                </div>
                <div class="resource-content">
                  <div class="resource-title">Science-Based Targets Toolkit</div>
                  <div class="resource-desc">Tools and resources for setting science-based climate targets</div>
                  <a href="#" class="resource-link">Access Toolkit</a>
                </div>
              </div>
              
              <div class="resource-item">
                <div class="resource-icon">
                  <i class="fas fa-compass"></i>
                </div>
                <div class="resource-content">
                  <div class="resource-title">Framework Selection Guide</div>
                  <div class="resource-desc">Interactive tool to find the perfect sustainability reporting framework</div>
                  <a href="{{ url_for('enhanced_strategy.framework_selection_guide') }}" class="resource-link">Open Guide</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- JavaScript for interactive features -->
<script>
  // Helper function for Agentic RAG Agent
  function createMessageElement(text, isUser = false) {
    const messageDiv = document.createElement('div');
    messageDiv.className = isUser ? 'agent-message user-message' : 'agent-message';
    
    const avatarDiv = document.createElement('div');
    avatarDiv.className = 'agent-avatar';
    
    const icon = document.createElement('i');
    icon.className = isUser ? 'fas fa-user' : 'fas fa-robot';
    avatarDiv.appendChild(icon);
    
    const contentDiv = document.createElement('div');
    contentDiv.className = 'message-content';
    
    // Split text by paragraphs and create <p> elements
    const paragraphs = text.split('\n\n');
    for (const paragraph of paragraphs) {
      if (paragraph.trim()) {
        const p = document.createElement('p');
        p.textContent = paragraph.trim();
        contentDiv.appendChild(p);
      }
    }
    
    messageDiv.appendChild(avatarDiv);
    messageDiv.appendChild(contentDiv);
    
    return messageDiv;
  }
  
  // Function to generate AI response with streaming effect
  function simulateStreamingResponse(container, text, delay = 30, callback = null) {
    const messageElement = createMessageElement('', false);
    container.appendChild(messageElement);
    
    const contentDiv = messageElement.querySelector('.message-content');
    
    // Create initial paragraph
    let p = document.createElement('p');
    contentDiv.appendChild(p);
    
    let currentParagraph = 0;
    const paragraphs = text.split('\n\n');
    
    let charIndex = 0;
    let currentText = '';
    
    const interval = setInterval(() => {
      if (currentParagraph >= paragraphs.length) {
        clearInterval(interval);
        if (callback) callback();
        return;
      }
      
      if (charIndex >= paragraphs[currentParagraph].length) {
        // Move to next paragraph
        currentParagraph++;
        charIndex = 0;
        
        if (currentParagraph < paragraphs.length) {
          p = document.createElement('p');
          contentDiv.appendChild(p);
          currentText = '';
        } else {
          clearInterval(interval);
          if (callback) callback();
        }
        return;
      }
      
      currentText += paragraphs[currentParagraph][charIndex];
      p.textContent = currentText;
      charIndex++;
      
      // Scroll to bottom
      container.scrollTop = container.scrollHeight;
    }, delay);
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    // Tab navigation
    const tabs = document.querySelectorAll('.hub-tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    // Initialize charts for the active tab on page load
    const activeTabContent = document.querySelector('.tab-content.active');
    if (activeTabContent) {
      if (activeTabContent.id === 'data-analysis') {
        initSustainabilityPerformanceChart();
      } else if (activeTabContent.id === 'virality-trends') {
        // Initialize chart if trend results are displayed
        if (document.getElementById('trend-results').style.display !== 'none') {
          initSteppsRadarChart();
        }
      }
    }
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        
        // Update active tab
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding content
        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === tabId) {
            content.classList.add('active');
            
            // Initialize charts based on active tab
            if (tabId === 'data-analysis') {
              initSustainabilityPerformanceChart();
            }
          }
        });
      });
    });
    
    // PDF Uploader
    const dropzone = document.getElementById('pdf-dropzone');
    const fileInput = document.getElementById('pdf-upload');
    const uploadBtn = document.getElementById('upload-btn');
    
    // Setup dropzone
    if (dropzone && fileInput) {
      dropzone.addEventListener('click', () => {
        fileInput.click();
      });
      
      dropzone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropzone.style.borderColor = '#36b37e';
        dropzone.style.backgroundColor = 'rgba(54, 179, 126, 0.05)';
      });
      
      dropzone.addEventListener('dragleave', () => {
        dropzone.style.borderColor = 'rgba(255, 255, 255, 0.2)';
        dropzone.style.backgroundColor = 'transparent';
      });
      
      dropzone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropzone.style.borderColor = 'rgba(255, 255, 255, 0.2)';
        dropzone.style.backgroundColor = 'transparent';
        
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          handleFileUpload(e.dataTransfer.files[0]);
        }
      });
      
      fileInput.addEventListener('change', () => {
        if (fileInput.files.length) {
          handleFileUpload(fileInput.files[0]);
        }
      });
      
      if (uploadBtn) {
        uploadBtn.addEventListener('click', () => {
          fileInput.click();
        });
      }
    }
    
    // Trend Search
    const trendSearchBtn = document.getElementById('trend-search-btn');
    const trendSearchInput = document.getElementById('trend-search-input');
    const trendTags = document.querySelectorAll('.trend-tag');
    const trendResults = document.getElementById('trend-results');
    const trendResultsTitle = document.getElementById('trend-results-title');
    const strategicImplications = document.getElementById('strategic-implications');
    
    if (trendSearchBtn && trendSearchInput) {
      trendSearchBtn.addEventListener('click', () => {
        const trend = trendSearchInput.value.trim();
        if (trend) {
          analyzeTrend(trend);
        }
      });
      
      trendSearchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const trend = trendSearchInput.value.trim();
          if (trend) {
            analyzeTrend(trend);
          }
        }
      });
    }
    
    if (trendTags) {
      trendTags.forEach(tag => {
        tag.addEventListener('click', () => {
          const trend = tag.getAttribute('data-trend');
          if (trendSearchInput) {
            trendSearchInput.value = trend;
          }
          analyzeTrend(trend);
        });
      });
    }
    
    // Document cards
    const documentCards = document.querySelectorAll('.document-card');
    if (documentCards) {
      documentCards.forEach(card => {
        card.addEventListener('click', () => {
          const documentId = card.getAttribute('data-id');
          if (documentId) {
            window.location.href = `/strategy/document/${documentId}`;
          }
        });
      });
    }
    
    // Create Story Button
    const createStoryBtn = document.getElementById('create-story-btn');
    if (createStoryBtn) {
      createStoryBtn.addEventListener('click', () => {
        window.location.href = '/storytelling/create';
      });
    }
    
    // Start Consultation Button
    const startConsultationBtn = document.getElementById('start-consultation-btn');
    if (startConsultationBtn) {
      startConsultationBtn.addEventListener('click', () => {
        window.location.href = '/strategy/ai-consultant';
      });
    }
    
    // Function to handle file upload
    function handleFileUpload(file) {
      const allowedTypes = [
        'application/pdf', 
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/msword',
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'application/vnd.ms-excel',
        'text/csv'
      ];
      
      if (!allowedTypes.includes(file.type)) {
        alert('Please select a valid document file (PDF, DOCX, XLSX, or CSV)');
        return;
      }
      
      // In a real implementation, you would upload the file to the server
      // For now, just show the filename
      dropzone.innerHTML = `
        <div class="pdf-icon">
          <i class="fas fa-file-${getFileIcon(file.type)}"></i>
        </div>
        <p>${file.name}</p>
        <small>${Math.round(file.size / 1024)} KB</small>
      `;
      
      uploadBtn.textContent = 'Analyze Document';
      uploadBtn.addEventListener('click', () => {
        // Create FormData
        const formData = new FormData();
        formData.append('file', file);
        
        // Get analysis options
        const extractEntities = document.getElementById('extract-entities')?.checked || false;
        const benchmark = document.getElementById('benchmark')?.checked || false;
        const regulatoryCheck = document.getElementById('regulatory-check')?.checked || false;
        
        formData.append('extract_entities', extractEntities);
        formData.append('benchmark', benchmark);
        formData.append('regulatory_check', regulatoryCheck);
        
        // In a real implementation, you would send this to the server
        uploadBtn.textContent = 'Analyzing...';
        uploadBtn.disabled = true;
        
        // Simulate uploading
        setTimeout(() => {
          alert(`Analysis started for ${file.name}. You will be notified when it's complete.`);
          uploadBtn.textContent = 'Upload Document';
          uploadBtn.disabled = false;
          
          // Reset the dropzone
          dropzone.innerHTML = `
            <div class="pdf-icon">
              <i class="fas fa-file-upload"></i>
            </div>
            <p>Drag & drop a document or click to browse</p>
            <small>Supported formats: PDF, DOCX, XLSX, CSV</small>
            
            <div class="analysis-options">
              <div class="analysis-option">
                <input type="checkbox" id="extract-entities" checked>
                <label for="extract-entities">Extract Entities</label>
              </div>
              <div class="analysis-option">
                <input type="checkbox" id="benchmark" checked>
                <label for="benchmark">Industry Benchmark</label>
              </div>
              <div class="analysis-option">
                <input type="checkbox" id="regulatory-check" checked>
                <label for="regulatory-check">Regulatory Check</label>
              </div>
            </div>
          `;
        }, 2000);
      }, { once: true });
    }
    
    // Function to analyze trends
    function analyzeTrend(trend) {
      if (!trend) return;
      
      // In a real implementation, you would fetch the analysis from the server
      // For now, just update the UI with the trend name
      if (trendResultsTitle) {
        trendResultsTitle.textContent = trend + ' Analysis';
      }
      
      if (trendResults) {
        trendResults.style.display = 'block';
      }
      
      if (strategicImplications) {
        strategicImplications.style.display = 'block';
      }
      
      // Update strategic responses with the trend name
      const strategicResponses = document.querySelectorAll('.strategic-response');
      if (strategicResponses) {
        strategicResponses.forEach(response => {
          const text = response.textContent;
          response.textContent = text.replace('this trend', trend);
        });
      }
      
      // Initialize the STEPPS radar chart
      initSteppsRadarChart();
    }
    
    // Initialize STEPPS Radar Chart
    function initSteppsRadarChart() {
      const ctx = document.getElementById('steppsRadarChart');
      
      if (!ctx) return;
      
      // Get values from STEPPS grid items
      const steppsScores = Array.from(document.querySelectorAll('.stepps-score')).map(el => parseInt(el.textContent));
      const steppsNames = Array.from(document.querySelectorAll('.stepps-name')).map(el => el.textContent);
      
      // Create a Chart.js radar chart
      new Chart(ctx, {
        type: 'radar',
        data: {
          labels: steppsNames,
          datasets: [{
            label: 'STEPPS Framework Analysis',
            data: steppsScores,
            fill: true,
            backgroundColor: 'rgba(54, 179, 126, 0.2)',
            borderColor: '#36b37e',
            pointBackgroundColor: '#36b37e',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: '#36b37e'
          }]
        },
        options: {
          elements: {
            line: {
              borderWidth: 3
            }
          },
          scales: {
            r: {
              angleLines: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              pointLabels: {
                color: '#f4f5f7',
                font: {
                  size: 12
                }
              },
              ticks: {
                backdropColor: 'transparent',
                color: '#c1c7d0'
              },
              suggestedMin: 0,
              suggestedMax: 100
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(23, 43, 77, 0.9)',
              titleColor: '#f4f5f7',
              bodyColor: '#f4f5f7',
              borderColor: 'rgba(54, 179, 126, 0.3)',
              borderWidth: 1
            }
          }
        }
      });
    }
    
    // Initialize Sustainability Performance Chart
    function initSustainabilityPerformanceChart() {
      const ctx = document.getElementById('sustainabilityPerformanceChart');
      
      if (!ctx) return;
      
      // Sample data for sustainability performance chart
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      // Create a Chart.js line chart
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: months,
          datasets: [
            {
              label: 'Carbon Emissions',
              data: [48, 46, 45, 43, 44, 42, 41, 40, 42, 43, 41, 38],
              borderColor: '#36b37e',
              backgroundColor: 'rgba(54, 179, 126, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Energy Consumption',
              data: [250, 245, 248, 240, 235, 230, 232, 235, 230, 228, 225, 220],
              borderColor: '#00b8d9',
              backgroundColor: 'rgba(0, 184, 217, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Waste Diversion',
              data: [68, 69, 71, 72, 74, 73, 75, 77, 74, 76, 78, 80],
              borderColor: '#6554c0',
              backgroundColor: 'rgba(101, 84, 192, 0.1)',
              tension: 0.4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          elements: {
            line: {
              borderWidth: 2
            },
            point: {
              radius: 3,
              hoverRadius: 5
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: '#c1c7d0'
              }
            },
            y: {
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: '#c1c7d0'
              }
            }
          },
          plugins: {
            tooltip: {
              backgroundColor: 'rgba(23, 43, 77, 0.9)',
              titleColor: '#f4f5f7',
              bodyColor: '#f4f5f7',
              borderColor: 'rgba(255, 255, 255, 0.1)',
              borderWidth: 1
            },
            legend: {
              display: false
            }
          }
        }
      });
    }
    
    // Helper function to get file icon based on file type
    function getFileIcon(fileType) {
      switch (fileType) {
        case 'application/pdf':
          return 'pdf';
        case 'application/vnd.openxmlformats-officedocument.wordprocessingml.document':
        case 'application/msword':
          return 'word';
        case 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':
        case 'application/vnd.ms-excel':
          return 'excel';
        case 'text/csv':
          return 'csv';
        default:
          return 'alt';
      }
    }
    // Monetization Tab Functionality
    function initMonetizationTab() {
      // Analyze Strategy button functionality
      const analyzeStrategyButtons = document.querySelectorAll('.analyze-strategy');
      
      analyzeStrategyButtons.forEach(button => {
        button.addEventListener('click', () => {
          const strategyId = button.getAttribute('data-strategy-id');
          
          // API call to analyze strategy
          fetch(`/api/monetization/analyze?strategy_id=${strategyId}`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
            // Display results
            alert(`Strategy ${strategyId} analyzed: ${data.potential_score}% potential`);
          } else {
            console.error('Strategy analysis failed:', data.message);
          }
        })
        .catch(error => {
          console.error('Error analyzing strategy:', error);
        });
      });
    });
    
    // Generate Strategic Plan functionality
    const generatePlanBtn = document.getElementById('generate-plan-btn');
    const strategicPlanResults = document.getElementById('strategic-plan-results');
    
    if (generatePlanBtn) {
      generatePlanBtn.addEventListener('click', () => {
        // Get form values
        const companyName = document.getElementById('company-name').value || 'Your Company';
        const industry = document.getElementById('industry').value;
        
        // Get selected objectives
        const objectives = [];
        if (document.getElementById('objective-revenue').checked) objectives.push('Revenue Growth');
        if (document.getElementById('objective-differentiation').checked) objectives.push('Market Differentiation');
        if (document.getElementById('objective-innovation').checked) objectives.push('Product Innovation');
        if (document.getElementById('objective-compliance').checked) objectives.push('Regulatory Compliance');
        
        // Get selected focus areas
        const focusAreas = [];
        if (document.getElementById('focus-climate').checked) focusAreas.push('Climate Action');
        if (document.getElementById('focus-circular').checked) focusAreas.push('Circular Economy');
        if (document.getElementById('focus-social').checked) focusAreas.push('Social Impact');
        if (document.getElementById('focus-biodiversity').checked) focusAreas.push('Biodiversity');
        
        // If no selections, set defaults
        if (objectives.length === 0) objectives.push('Revenue Growth');
        if (focusAreas.length === 0) focusAreas.push('Climate Action');
        
        // Make API request
        fetch('/api/monetization/strategic-plan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            company_name: companyName,
            industry: industry,
            objectives: objectives,
            focus_areas: focusAreas
          })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Update UI with plan
            document.getElementById('plan-title').textContent = `Strategic Plan for ${companyName}`;
            document.querySelector('.plan-company').textContent = companyName;
            document.querySelector('.plan-industry').textContent = industry;
            
            // Format and display plan content
            const planContent = document.getElementById('plan-content');
            planContent.innerHTML = formatStrategicPlan(data.plan);
            
            // Show results section
            strategicPlanResults.style.display = 'block';
            
            // Scroll to results
            strategicPlanResults.scrollIntoView({ behavior: 'smooth' });
          } else {
            console.error('Plan generation failed:', data.message);
            alert('Failed to generate strategic plan. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error generating plan:', error);
          alert('An error occurred while generating the plan. Please try again.');
        });
      });
    }
    
    // Export Plan button functionality
    const exportPlanBtn = document.getElementById('export-plan-btn');
    if (exportPlanBtn) {
      exportPlanBtn.addEventListener('click', () => {
        const companyName = document.querySelector('.plan-company').textContent;
        const planContent = document.getElementById('plan-content').innerHTML;
        
        // Prepare data for export
        const exportData = {
          company_name: companyName,
          plan_html: planContent
        };
        
        // Make API request to export
        fetch('/api/monetization/export-plan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(exportData)
        })
        .then(response => response.blob())
        .then(blob => {
          // Create a download link
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.style.display = 'none';
          a.href = url;
          a.download = `${companyName.replace(/\s+/g, '_')}_Strategic_Plan.pdf`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
        })
        .catch(error => {
          console.error('Error exporting plan:', error);
          alert('Failed to export the strategic plan. Please try again.');
        });
      });
    }
  }
  
    function formatStrategicPlan(plan) {
      if (!plan || !plan.sections) {
        return '<p>No plan data available</p>';
      }
      
      let html = '';
      
      plan.sections.forEach(section => {
        html += `<h3>${section.title}</h3>`;
        html += `<p>${section.content}</p>`;
        
        if (section.items && section.items.length > 0) {
          html += '<ul>';
          section.items.forEach(item => {
            html += `<li>${item}</li>`;
          });
          html += '</ul>';
        }
      });
      
      return html;
    }
    
    // Initialize the monetization tab when it becomes active
    tabs.forEach(tab => {
      if (tab.getAttribute('data-tab') === 'monetization') {
        tab.addEventListener('click', () => {
          // Initialize monetization tab when it's clicked
          initMonetizationTab();
        });
      }
    });

    // Initialize monetization tab if it's the active tab on page load
    if (document.querySelector('.hub-tab.active').getAttribute('data-tab') === 'monetization') {
      initMonetizationTab();
    }
    
    // Framework Selection Form Implementation
  function initFrameworkSelection() {
    const frameworkForm = document.getElementById('framework-form');
    const autoSelectCheckbox = document.getElementById('auto-select-framework');
    const frameworkOptions = document.getElementById('framework-options');
    
    // Toggle manual framework selection based on auto-select checkbox
    if (autoSelectCheckbox) {
      autoSelectCheckbox.addEventListener('change', function() {
        if (this.checked) {
          frameworkOptions.style.opacity = '0.5';
          frameworkOptions.style.pointerEvents = 'none';
        } else {
          frameworkOptions.style.opacity = '1';
          frameworkOptions.style.pointerEvents = 'auto';
        }
      });
    }
    
    // Handle form submission
    if (frameworkForm) {
      frameworkForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Show loading state
        const resultsContainer = document.getElementById('framework-results');
        resultsContainer.innerHTML = `
          <div class="loading-spinner">
            <i class="fas fa-circle-notch fa-spin"></i> Analyzing with AI...
          </div>
        `;
        
        // Gather form data
        const formData = new FormData(frameworkForm);
        const companyName = formData.get('company_name');
        const industry = formData.get('industry');
        const autoSelect = formData.get('auto_select') === 'on';
        const framework = formData.get('framework') || '';
        
        // Get slider values
        const competitiveRivalry = document.getElementById('competitive-rivalry').value;
        const supplierPower = document.getElementById('supplier-power').value;
        const buyerPower = document.getElementById('buyer-power').value;
        const substitutionThreat = document.getElementById('substitution-threat').value;
        const newEntryThreat = document.getElementById('new-entry-threat').value;
        
        // Prepare data payload
        const payload = {
          company_name: companyName,
          industry: industry,
          auto_select: autoSelect,
          framework: framework,
          business_assessment: {
            competitive_rivalry: parseInt(competitiveRivalry),
            supplier_power: parseInt(supplierPower),
            buyer_power: parseInt(buyerPower),
            substitution_threat: parseInt(substitutionThreat),
            new_entry_threat: parseInt(newEntryThreat)
          }
        };
        
        // Send request to API
        fetch('/api/strategy/select-framework', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Display the results
            displayFrameworkResults(data, resultsContainer);
          } else {
            console.error('Framework selection failed:', data.message);
            resultsContainer.innerHTML = `
              <div class="error-message">
                <i class="fas fa-exclamation-circle"></i> 
                Failed to analyze. ${data.message || 'Please try again.'}
              </div>
            `;
          }
        })
        .catch(error => {
          console.error('Error selecting framework:', error);
          resultsContainer.innerHTML = `
            <div class="error-message">
              <i class="fas fa-exclamation-circle"></i> 
              An error occurred. Please try again.
            </div>
          `;
        });
      });
    }
  }
  
  function displayFrameworkResults(data, container) {
    // Determine the framework type and render the appropriate template
    const framework = data.selected_framework;
    let resultsHTML = '';
    
    // Common header section
    resultsHTML += `
      <div class="framework-result-header">
        <h3>Strategy Framework Analysis for ${data.company_name}</h3>
        <div class="framework-badge">
          <i class="fas fa-check-circle"></i> ${framework.name}
        </div>
        
        <div class="ai-selection-explanation">
          <p>${data.selection_explanation}</p>
        </div>
        
        <div class="confidence-meter">
          <div class="confidence-label">
            <span>AI Confidence</span>
            <span>${data.confidence_score}%</span>
          </div>
          <div class="confidence-bar">
            <div class="confidence-fill" style="width: ${data.confidence_score}%"></div>
          </div>
        </div>
        
        <div class="alternatives">
          <div class="alternatives-label">Alternative Frameworks:</div>
          <div class="alternatives-list">
            ${data.alternative_frameworks.map(alt => 
              `<span class="alternative-tag">${alt}</span>`
            ).join('')}
          </div>
        </div>
      </div>
    `;
    
    // Framework-specific visualization
    if (framework.id === 'porters') {
      resultsHTML += renderPortersFramework(data);
    } else if (framework.id === 'swot') {
      resultsHTML += renderSwotFramework(data);
    } else if (framework.id === 'bcg') {
      resultsHTML += renderBcgMatrix(data);
    } else {
      // Generic framework display
      resultsHTML += renderGenericFramework(data);
    }
    
    // Recommendations section
    resultsHTML += `
      <div class="framework-recommendations">
        <h4>Strategic Recommendations</h4>
        <ol class="recommendations-list">
          ${data.recommendations.map(rec => 
            `<li>${rec}</li>`
          ).join('')}
        </ol>
      </div>
      
      <div class="form-actions">
        <button type="button" class="action-btn" id="implement-framework">
          Implement Framework
        </button>
        <button type="button" class="action-btn secondary" id="export-analysis">
          Export Analysis
        </button>
      </div>
    `;
    
    // Update the container with the results
    container.innerHTML = resultsHTML;
    
    // Add event listeners to the new buttons
    const implementBtn = document.getElementById('implement-framework');
    if (implementBtn) {
      implementBtn.addEventListener('click', function() {
        alert('Implementation feature coming soon!');
      });
    }
    
    const exportBtn = document.getElementById('export-analysis');
    if (exportBtn) {
      exportBtn.addEventListener('click', function() {
        alert('Export feature coming soon!');
      });
    }
  }
  
  function renderPortersFramework(data) {
    const portersData = data.framework_data;
    
    return `
      <div class="porters-grid">
        ${Object.entries(portersData.forces).map(([key, force]) => `
          <div class="porters-dimension">
            <div class="dimension-header">
              <div class="dimension-name">${force.name}</div>
              <div class="dimension-score">${force.score}/100</div>
            </div>
            <div class="dimension-bar">
              <div class="dimension-fill" style="width: ${force.score}%"></div>
            </div>
            <div class="dimension-insights">${force.insights}</div>
          </div>
        `).join('')}
      </div>
      
      <div class="porters-summary">
        <div class="summary-item">
          <div class="summary-label">Overall Threat Level</div>
          <div class="summary-value">${portersData.overall_threat_level}/100</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Bargaining Position</div>
          <div class="summary-value">${portersData.bargaining_position}/100</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Industry Attractiveness</div>
          <div class="summary-value">${portersData.industry_attractiveness}/100</div>
        </div>
      </div>
    `;
  }
  
  function renderSwotFramework(data) {
    const swotData = data.framework_data;
    
    return `
      <div class="swot-grid">
        <div class="swot-quadrant">
          <div class="quadrant-header">Strengths</div>
          <ul class="quadrant-list">
            ${swotData.strengths.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        <div class="swot-quadrant">
          <div class="quadrant-header">Weaknesses</div>
          <ul class="quadrant-list">
            ${swotData.weaknesses.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        <div class="swot-quadrant">
          <div class="quadrant-header">Opportunities</div>
          <ul class="quadrant-list">
            ${swotData.opportunities.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        <div class="swot-quadrant">
          <div class="quadrant-header">Threats</div>
          <ul class="quadrant-list">
            ${swotData.threats.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
      </div>
    `;
  }
  
  function renderBcgMatrix(data) {
    const bcgData = data.framework_data;
    
    return `
      <div class="bcg-grid">
        <div class="bcg-quadrant">
          <div class="quadrant-header">Stars</div>
          <ul class="quadrant-list">
            ${bcgData.stars.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        <div class="bcg-quadrant">
          <div class="quadrant-header">Question Marks</div>
          <ul class="quadrant-list">
            ${bcgData.question_marks.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        <div class="bcg-quadrant">
          <div class="quadrant-header">Cash Cows</div>
          <ul class="quadrant-list">
            ${bcgData.cash_cows.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
        <div class="bcg-quadrant">
          <div class="quadrant-header">Dogs</div>
          <ul class="quadrant-list">
            ${bcgData.dogs.map(item => `<li>${item}</li>`).join('')}
          </ul>
        </div>
      </div>
    `;
  }
  
  function renderGenericFramework(data) {
    return `
      <div class="generic-framework">
        <div class="framework-description">
          <p>${data.framework_description}</p>
        </div>
        
        <div class="industry-impact">
          <h4>Industry Impact Assessment</h4>
          ${Object.entries(data.industry_impact || {}).map(([factor, value]) => `
            <div class="impact-factor">
              <div class="impact-label">
                <span>${factor}</span>
                <span>${value}/100</span>
              </div>
              <div class="impact-bar">
                <div class="impact-fill" style="width: ${value}%"></div>
              </div>
            </div>
          `).join('')}
        </div>
        
        <div class="strategic-items">
          <h4>Strategic Focus Areas</h4>
          ${data.strategic_items.map(item => `
            <div class="strategic-item">
              <div class="strategic-header">
                <div class="strategic-area">${item.area}</div>
                <div class="strategic-potential ${item.potential_class}">${item.potential}</div>
              </div>
              <div class="strategic-timeframe">${item.timeframe}</div>
              <div class="strategic-response">${item.response}</div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }
  
  // Call initFrameworkSelection when the page loads
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize the framework selection form
    initFrameworkSelection();
  });
  
  // AI Strategy Agent Implementation
  const agentInput = document.getElementById('agent-input');
    const sendMessageBtn = document.getElementById('send-message');
    const messagesContainer = document.getElementById('agent-messages');
    const autoFrameworkToggle = document.getElementById('auto-framework');
    
    if (agentInput && sendMessageBtn && messagesContainer) {
      // Helper function for Agentic RAG Agent
      function createMessageElement(text, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = isUser ? 'agent-message user-message' : 'agent-message';
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'agent-avatar';
        
        const icon = document.createElement('i');
        icon.className = isUser ? 'fas fa-user' : 'fas fa-robot';
        avatarDiv.appendChild(icon);
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        // Split text by paragraphs and create <p> elements
        const paragraphs = text.split('\n\n');
        for (const paragraph of paragraphs) {
          if (paragraph.trim()) {
            const p = document.createElement('p');
            p.textContent = paragraph.trim();
            contentDiv.appendChild(p);
          }
        }
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }
      
      // Function to generate AI response with streaming effect
      function simulateStreamingResponse(container, text, delay = 30, callback = null) {
        const messageElement = createMessageElement('', false);
        container.appendChild(messageElement);
        
        const contentDiv = messageElement.querySelector('.message-content');
        
        // Create initial paragraph
        let p = document.createElement('p');
        contentDiv.appendChild(p);
        
        let currentParagraph = 0;
        const paragraphs = text.split('\n\n');
        
        let charIndex = 0;
        let currentText = '';
        
        const interval = setInterval(() => {
          if (currentParagraph >= paragraphs.length) {
            clearInterval(interval);
            if (callback) callback();
            return;
          }
          
          if (charIndex >= paragraphs[currentParagraph].length) {
            // Move to next paragraph
            currentParagraph++;
            charIndex = 0;
            
            if (currentParagraph < paragraphs.length) {
              p = document.createElement('p');
              contentDiv.appendChild(p);
              currentText = '';
            } else {
              clearInterval(interval);
              if (callback) callback();
            }
            return;
          }
          
          currentText += paragraphs[currentParagraph][charIndex];
          p.textContent = currentText;
          charIndex++;
          
          // Scroll to bottom
          container.scrollTop = container.scrollHeight;
        }, delay);
      }
      
      // Handle sending messages
      function sendMessage() {
        const message = agentInput.value.trim();
        if (!message) return;
        
        // Add user message to the chat
        messagesContainer.appendChild(createMessageElement(message, true));
        
        // Clear input
        agentInput.value = '';
        
        // Scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        // Disable input while "processing"
        agentInput.disabled = true;
        sendMessageBtn.disabled = true;
        
        // Process the message (in a real implementation, this would call the backend API)
        setTimeout(() => {
          processUserMessage(message);
        }, 1000);
      }
      
      // Process user message and generate AI response
      function processUserMessage(message) {
        // In a real implementation, this would call the backend API
        // For now, generate a response based on the message content
        let response;
        
        // Check if message contains keywords and generate appropriate response
        if (message.toLowerCase().includes('carbon') || message.toLowerCase().includes('emission')) {
          response = "I'm analyzing your carbon emissions challenge using my retrieval system...\n\nBased on real-time data and industry benchmarks, I can recommend three strategic approaches:\n\n1. ð—¦ð˜‚ð—½ð—½ð—¹ð˜† ð—–ð—µð—®ð—¶ð—» ð——ð—²ð—°ð—®ð—¿ð—¯ð—¼ð—»ð—¶ð˜‡ð—®ð˜ð—¶ð—¼ð—»: Data shows that 60-80% of carbon footprint lies in Scope 3 emissions. I recommend implementing supplier carbon disclosure requirements and incentives.\n\n2. ð—˜ð—»ð—²ð—¿ð—´ð˜† ð—˜ð—³ð—³ð—¶ð—°ð—¶ð—²ð—»ð—°ð˜† + ð—¥ð—²ð—»ð—²ð˜„ð—®ð—¯ð—¹ð—²ð˜€: The latest IPCC report highlights combining energy efficiency with renewable energy procurement can reduce emissions by 40-60%.\n\n3. ð—–ð—¶ð—¿ð—°ð˜‚ð—¹ð—®ð—¿ ð—˜ð—°ð—¼ð—»ð—¼ð—ºð˜† ð—œð—»ð—¶ð˜ð—¶ð—®ð˜ð—¶ð˜ƒð—²ð˜€: I've analyzed several case studies where product redesign and waste reduction led to 15-30% carbon footprint reduction.\n\nWould you like me to expand on any of these strategies or suggest specific implementation steps?";
          
          // Auto-select SWOT framework
          if (autoFrameworkToggle && autoFrameworkToggle.checked) {
            const swotRadio = document.getElementById('framework-swot');
            if (swotRadio) swotRadio.checked = true;
          }
        } 
        else if (message.toLowerCase().includes('water') || message.toLowerCase().includes('conservation')) {
          response = "I've analyzed your water conservation challenge using my retrieval and reasoning systems...\n\nMy analysis, based on current water stress indices and industry benchmarks, suggests these three evidence-based approaches:\n\n1. ð—ªð—®ð˜ð—²ð—¿ ð—™ð—¼ð—¼ð˜ð—½ð—¿ð—¶ð—»ð˜ ð— ð—®ð—½ð—½ð—¶ð—»ð—´: The latest research from the Water Footprint Network shows that comprehensive mapping can identify 25-40% reduction opportunities that weren't previously visible.\n\n2. ð—–ð—¹ð—¼ð˜€ð—²ð—±-ð—Ÿð—¼ð—¼ð—½ ð—ªð—®ð˜ð—²ð—¿ ð—¦ð˜†ð˜€ð˜ð—²ð—ºð˜€: I've analyzed several case studies where implementing closed-loop systems achieved 60-80% reduction in freshwater withdrawal.\n\n3. ð—¦ð˜‚ð—½ð—½ð—¹ð—¶ð—²ð—¿ ð—˜ð—»ð—´ð—®ð—´ð—²ð—ºð—²ð—»ð˜: The data shows that for most industries, 80%+ of water impact lies in the supply chain. Implementing supplier water stewardship programs has shown 30-50% reduction potential.\n\nI can provide detailed implementation steps for any of these strategies. Would you like me to elaborate on a specific approach?";
          
          // Auto-select PESTEL framework
          if (autoFrameworkToggle && autoFrameworkToggle.checked) {
            const pestelRadio = document.getElementById('framework-pestel');
            if (pestelRadio) pestelRadio.checked = true;
          }
        }
        else if (message.toLowerCase().includes('waste') || message.toLowerCase().includes('recycling')) {
          response = "I'm analyzing your waste management challenge using my knowledge base and retrieval system...\n\nBased on current waste management best practices and circular economy principles, here are three strategic approaches:\n\n1. ð—ªð—®ð˜€ð˜ð—² ð—¦ð˜ð—¿ð—²ð—®ð—º ð— ð—®ð—½ð—½ð—¶ð—»ð—´ & ð——ð—¶ð˜ƒð—²ð—¿ð˜€ð—¶ð—¼ð—»: I've analyzed companies that have achieved 80%+ landfill diversion through comprehensive waste auditing and stream separation.\n\n2. ð—–ð—¶ð—¿ð—°ð˜‚ð—¹ð—®ð—¿ ð—£ð—¿ð—¼ð—±ð˜‚ð—°ð˜ ð——ð—²ð˜€ð—¶ð—´ð—»: Research shows that 80% of environmental impacts are determined at the design phase. Implementing circular design principles has shown 40-60% waste reduction potential.\n\n3. ð—©ð—®ð—¹ð˜‚ð—² ð—¥ð—²ð—°ð—¼ð˜ƒð—²ð—¿ð˜†: I've identified several case studies where waste-to-resource programs have created new revenue streams while reducing disposal costs by 30-50%.\n\nI'm also seeing that the new EU CSRD regulation will require detailed waste reporting starting next year. Would you like me to help prepare for these requirements?";
          
          // Auto-select Circular Economy framework
          if (autoFrameworkToggle && autoFrameworkToggle.checked) {
            const circularRadio = document.getElementById('framework-circular');
            if (circularRadio) circularRadio.checked = true;
          }
        }
        else if (message.toLowerCase().includes('esrs') || message.toLowerCase().includes('regulation') || message.toLowerCase().includes('compliance')) {
          response = "I'm analyzing your regulatory compliance question using my knowledge graph and regulatory database...\n\nBased on the latest ESRS (European Sustainability Reporting Standards) requirements and implementation timelines, here's what you need to know:\n\n1. ð—§ð—¶ð—ºð—²ð—¹ð—¶ð—»ð—²: Large companies need to report under ESRS for fiscal years starting on or after January 1, 2024, with reports published in 2025. SMEs have until 2026.\n\n2. ð——ð—¶ð˜€ð—°ð—¹ð—¼ð˜€ð˜‚ð—¿ð—² ð—¥ð—²ð—¾ð˜‚ð—¶ð—¿ð—²ð—ºð—²ð—»ð˜ð˜€: ESRS requires reporting across E (Environmental), S (Social), and G (Governance) dimensions with specific data points for each. I've detected that climate reporting (E1) and social standards (S1-S4) will be most challenging based on current reporting gaps.\n\n3. ð— ð—®ð˜ð—²ð—¿ð—¶ð—®ð—¹ð—¶ð˜ð˜† ð—”ð˜€ð˜€ð—²ð˜€ð˜€ð—ºð—²ð—»ð˜: A key requirement is conducting a double materiality assessment looking at both impact materiality and financial materiality.\n\nWould you like me to help with a gap analysis between your current reporting and ESRS requirements, or suggest a step-by-step implementation plan?";
          
          // Auto-select Regulatory framework 
          if (autoFrameworkToggle && autoFrameworkToggle.checked) {
            const regulatoryRadio = document.getElementById('framework-regulatory');
            if (regulatoryRadio) regulatoryRadio.checked = true;
          }
        }
        else {
          response = "I understand you're interested in developing a sustainability strategy. As your Agentic RAG assistant, I can help with:\n\n1. Creating custom sustainability strategies based on industry benchmarks\n2. Analyzing regulatory requirements and compliance pathways\n3. Developing environmental performance improvement plans\n4. Crafting stakeholder communication strategies\n\nCould you tell me more about your specific sustainability challenge? For example, are you focused on carbon emissions reduction, water conservation, waste management, or regulatory compliance?";
          
          // Keep current framework selection
        }
        
        // Use streaming effect for AI response
        simulateStreamingResponse(messagesContainer, response, 10, function() {
          // Re-enable input after response is complete
          agentInput.disabled = false;
          sendMessageBtn.disabled = false;
          agentInput.focus();
        });
      }
      
      // Event listeners
      sendMessageBtn.addEventListener('click', sendMessage);
      agentInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      // Framework toggle functionality
      if (autoFrameworkToggle) {
        autoFrameworkToggle.addEventListener('change', function() {
          const frameworkOptions = document.getElementById('framework-options');
          if (frameworkOptions) {
            frameworkOptions.style.opacity = this.checked ? '0.5' : '1';
            frameworkOptions.style.pointerEvents = this.checked ? 'none' : 'auto';
          }
        });
      }
      
      // Storytelling tab functionality
      function loadRecentStories() {
        const storiesList = document.getElementById('recent-stories');
        if (!storiesList) return;
        
        // Show loading state
        storiesList.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Loading recent stories...</div>';
        
        // Fetch recent stories
        fetch('/stories/api/stories?limit=5')
          .then(response => response.json())
          .then(data => {
            if (data.success && data.stories && data.stories.length > 0) {
              let storiesHTML = '';
              
              data.stories.forEach(story => {
                // Format the date
                const date = new Date(story.created_at);
                const formattedDate = date.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric'
                });
                
                // Generate tags HTML
                let tagsHTML = '';
                if (story.tags && story.tags.length > 0) {
                  story.tags.forEach(tag => {
                    tagsHTML += `<span class="story-tag">${tag}</span>`;
                  });
                }
                
                // Generate excerpt (first 150 characters)
                const excerpt = story.content.length > 150 
                  ? story.content.substring(0, 150) + '...' 
                  : story.content;
                
                // Generate story card HTML
                storiesHTML += `
                  <div class="story-card">
                    <div class="story-header">
                      <div class="story-title">${story.title}</div>
                      <div class="story-date">${formattedDate}</div>
                    </div>
                    <div class="story-excerpt">${excerpt}</div>
                    <div class="story-meta">
                      ${tagsHTML}
                    </div>
                    <div class="story-actions">
                      <a href="/stories/view/${story.id}" class="small-action-btn">View Story</a>
                    </div>
                  </div>
                `;
              });
              
              storiesList.innerHTML = storiesHTML;
            } else {
              // No stories or error
              storiesList.innerHTML = `
                <div class="insight-card">
                  <div class="insight-title">No recent stories</div>
                  <div class="insight-body">You haven't created any sustainability stories yet. Click "Create Story" to get started.</div>
                </div>
              `;
            }
          })
          .catch(error => {
            console.error('Error fetching stories:', error);
            storiesList.innerHTML = `
              <div class="insight-card">
                <div class="insight-title">Error loading stories</div>
                <div class="insight-body">There was an error loading your recent stories. Please try again later.</div>
              </div>
            `;
          });
      }
      
      // Load stories when the storytelling tab is activated
      const storytellingTab = document.querySelector('.hub-tab[data-tab="storytelling"]');
      if (storytellingTab) {
        storytellingTab.addEventListener('click', function() {
          setTimeout(loadRecentStories, 100); // Slight delay to ensure DOM is updated
        });
      }
      
      // Load stories on initial page load if storytelling tab is active
      if (document.querySelector('.hub-tab[data-tab="storytelling"].active')) {
        loadRecentStories();
      }
    }
  });
</script>
{% endblock %}