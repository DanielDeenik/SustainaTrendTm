{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}SustainaTrend™ - {{ framework.name }} Data Requirements{% endblock %}

{% block styles %}
<style>
  .data-card {
    border-radius: 8px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    height: 100%;
  }
  
  .data-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  }
  
  .framework-header {
    background: linear-gradient(145deg, rgba(35, 45, 60, 0.8), rgba(25, 35, 50, 0.8));
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
  }
  
  .framework-icon {
    font-size: 3rem;
    color: var(--bs-primary);
    margin-bottom: 1rem;
  }
  
  .data-group {
    margin-bottom: 1.5rem;
  }
  
  .data-item {
    border-radius: 8px;
    background-color: rgba(35, 45, 60, 0.5);
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.2s ease;
    border-left: 5px solid transparent;
  }
  
  .data-item:hover {
    background-color: rgba(35, 45, 60, 0.8);
  }
  
  .data-item.environmental {
    border-left-color: #20c997;
  }
  
  .data-item.social {
    border-left-color: #0dcaf0;
  }
  
  .data-item.governance {
    border-left-color: #ffc107;
  }
  
  .data-item.economic {
    border-left-color: #0d6efd;
  }
  
  .data-item.risk {
    border-left-color: #fd7e14;
  }
  
  .data-source-card {
    border-radius: 8px;
    background-color: rgba(35, 45, 60, 0.5);
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.2s ease;
  }
  
  .data-source-card:hover {
    background-color: rgba(35, 45, 60, 0.8);
  }
  
  .source-logo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--bs-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">Framework Data Requirements</h1>
        <div>
          <a href="{{ url_for('benchmarking.index') }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i>Back to Benchmarking
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Framework Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="framework-header">
        <div class="row align-items-center">
          <div class="col-md-2 text-center">
            <div class="framework-icon">
              {% if framework.id == "CSRD" %}
              <i class="fas fa-building"></i>
              {% elif framework.id == "TCFD" %}
              <i class="fas fa-temperature-high"></i>
              {% elif framework.id == "SDG" %}
              <i class="fas fa-globe-americas"></i>
              {% elif framework.id == "VC_METRICS" %}
              <i class="fas fa-chart-pie"></i>
              {% else %}
              <i class="fas fa-clipboard-check"></i>
              {% endif %}
            </div>
          </div>
          <div class="col-md-10">
            <h3>{{ framework.name }}</h3>
            <p class="text-muted mb-2">{{ framework.description }}</p>
            <div class="d-flex align-items-center mt-3">
              <span class="badge bg-secondary me-2">{{ framework.region }}</span>
              <span class="badge bg-primary">
                {% for type in framework.company_types %}
                  {{ type }}{% if not loop.last %}, {% endif %}
                {% endfor %}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Data Requirements Section -->
  <div class="row mb-4">
    <div class="col-md-7">
      <div class="card shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-4">Required Data Points</h4>
          
          <!-- Group data points by category -->
          {% set categories = data_points|groupby('category') %}
          
          {% for category in categories %}
            <div class="data-group">
              <h5>{{ category.grouper }} Metrics</h5>
              
              {% for data_point in category.list %}
                <div class="data-item {{ category.grouper|lower }}">
                  <div class="row">
                    <div class="col-md-6">
                      <h6 class="mb-1">{{ data_point.name }}</h6>
                      <p class="small text-muted mb-0">Required for complete framework assessment</p>
                    </div>
                    <div class="col-md-3 text-md-center">
                      <span class="badge bg-secondary">{{ data_point.unit }}</span>
                    </div>
                    <div class="col-md-3 text-md-end">
                      <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#dataModal" 
                              data-metric="{{ data_point.name }}" data-unit="{{ data_point.unit }}">
                        <i class="fas fa-info-circle me-1"></i> Details
                      </button>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endfor %}
          
          <div class="mt-4">
            <a href="{{ url_for('benchmarking.document_upload') }}" class="btn btn-primary">
              <i class="fas fa-file-upload me-2"></i>Upload Documents for Data Analysis
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-5">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h4 class="card-title mb-3">Data Sources</h4>
          <p class="card-text text-muted mb-4">
            The following data sources can be used to fulfill the requirements of the {{ framework.name }} framework:
          </p>
          
          <div class="data-source-card d-flex align-items-center">
            <div class="source-logo me-3 bg-success">
              <i class="fas fa-file-alt"></i>
            </div>
            <div>
              <h6 class="mb-1">Sustainability Reports</h6>
              <p class="small text-muted mb-0">Annual sustainability or ESG reports in PDF format</p>
            </div>
          </div>
          
          <div class="data-source-card d-flex align-items-center">
            <div class="source-logo me-3 bg-primary">
              <i class="fas fa-database"></i>
            </div>
            <div>
              <h6 class="mb-1">Emissions Management System</h6>
              <p class="small text-muted mb-0">Internal carbon accounting and GHG emissions data</p>
            </div>
          </div>
          
          <div class="data-source-card d-flex align-items-center">
            <div class="source-logo me-3 bg-info">
              <i class="fas fa-chart-line"></i>
            </div>
            <div>
              <h6 class="mb-1">ESG Rating Providers</h6>
              <p class="small text-muted mb-0">MSCI, Sustainalytics, S&P Global, etc.</p>
            </div>
          </div>
          
          <div class="data-source-card d-flex align-items-center">
            <div class="source-logo me-3 bg-warning">
              <i class="fas fa-building"></i>
            </div>
            <div>
              <h6 class="mb-1">Corporate Registry</h6>
              <p class="small text-muted mb-0">Board composition and governance structure data</p>
            </div>
          </div>
          
          <div class="data-source-card d-flex align-items-center">
            <div class="source-logo me-3" style="background-color: #9c27b0;">
              <i class="fas fa-users"></i>
            </div>
            <div>
              <h6 class="mb-1">HR Management System</h6>
              <p class="small text-muted mb-0">Diversity, employee turnover, and workforce data</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-3">Data Collection Tips</h4>
          
          <div class="alert alert-info" role="alert">
            <div class="d-flex">
              <div class="me-3">
                <i class="fas fa-lightbulb fa-2x"></i>
              </div>
              <div>
                <h6 class="alert-heading">AI-Powered Data Extraction</h6>
                <p class="mb-0">Our system can automatically extract required data points from your sustainability reports and other documents using OCR and machine learning.</p>
              </div>
            </div>
          </div>
          
          <ul class="list-group list-group-flush">
            <li class="list-group-item bg-transparent">
              <i class="fas fa-check-circle text-success me-2"></i>
              Prioritize gathering data for the most material metrics for your industry
            </li>
            <li class="list-group-item bg-transparent">
              <i class="fas fa-check-circle text-success me-2"></i>
              Include 3 years of historical data when available for trend analysis
            </li>
            <li class="list-group-item bg-transparent">
              <i class="fas fa-check-circle text-success me-2"></i>
              Document methodology and calculation approaches for transparency
            </li>
            <li class="list-group-item bg-transparent">
              <i class="fas fa-check-circle text-success me-2"></i>
              Include data quality notes and confidence levels when reporting
            </li>
            <li class="list-group-item bg-transparent">
              <i class="fas fa-check-circle text-success me-2"></i>
              Consider third-party verification for critical metrics
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Data Point Modal -->
<div class="modal fade" id="dataModal" tabindex="-1" aria-labelledby="dataModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="dataModalLabel">Metric Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-4" id="metricDetails">
          <!-- Modal content will be dynamically inserted here -->
        </div>
        
        <div class="card bg-light text-dark mb-3">
          <div class="card-header">Calculation Methodology</div>
          <div class="card-body" id="metricMethodology">
            <!-- Methodology content will be dynamically inserted here -->
          </div>
        </div>
        
        <div class="card bg-light text-dark">
          <div class="card-header">Data Sources</div>
          <div class="card-body">
            <ul class="list-group list-group-flush bg-transparent" id="metricSources">
              <!-- Sources content will be dynamically inserted here -->
            </ul>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Metric information database (for demo purposes)
    const metricInfo = {
      'Scope 1 Emissions': {
        description: 'Direct greenhouse gas emissions from sources owned or controlled by the company, such as combustion of fuel in boilers, furnaces, and vehicles.',
        methodology: 'Calculate by collecting data on fuel consumption by fuel type, then applying appropriate emission factors. Include all GHGs (CO2, CH4, N2O, etc.) expressed as CO2 equivalent.',
        sources: [
          'Fuel purchase records',
          'Energy bills',
          'Fleet management systems',
          'Facility management records'
        ],
        unit: 'tCO2e'
      },
      'Scope 2 Emissions': {
        description: 'Indirect greenhouse gas emissions from the generation of purchased electricity, steam, heating, and cooling consumed by the company.',
        methodology: 'Calculate using either location-based method (grid average emission factors) or market-based method (supplier-specific emission factors). Collect data on purchased energy consumption and apply appropriate emission factors.',
        sources: [
          'Electricity bills',
          'Energy purchase records',
          'Building management systems',
          'Utility providers'
        ],
        unit: 'tCO2e'
      },
      'Scope 3 Emissions': {
        description: 'All other indirect emissions that occur in a company's value chain, including both upstream and downstream emissions.',
        methodology: 'Identify relevant Scope 3 categories (15 categories as defined by the GHG Protocol), collect activity data for each, and apply appropriate emission factors. Prioritize based on relevance and magnitude.',
        sources: [
          'Procurement data',
          'Supplier reports',
          'Travel booking systems',
          'Logistics and transportation data',
          'Product lifecycle assessments'
        ],
        unit: 'tCO2e'
      },
      'Total Energy Consumption': {
        description: 'Total energy consumed by the organization, including electricity, heating, cooling, and fuel for transport and operations.',
        methodology: 'Sum all energy consumption from all sources (electricity, fuels, steam, etc.) converted to a common unit (MWh). Include energy consumed within the organization only.',
        sources: [
          'Energy bills',
          'Building management systems',
          'Fleet management records',
          'Facility operations data'
        ],
        unit: 'MWh'
      },
      'Renewable Energy Percentage': {
        description: 'Percentage of total energy consumption that comes from renewable sources such as solar, wind, hydro, geothermal, and biomass.',
        methodology: 'Divide the total renewable energy consumed by the total energy consumption and multiply by 100. Include both purchased renewable energy and on-site generation.',
        sources: [
          'Energy bills with source breakdown',
          'Renewable energy certificates (RECs)',
          'Power purchase agreements (PPAs)',
          'On-site renewable generation meters'
        ],
        unit: '%'
      },
      'Water Consumption': {
        description: 'Total volume of water withdrawn from all sources for use in operations.',
        methodology: 'Sum all water withdrawals from various sources (surface water, groundwater, third-party water, etc.). Track separately by source if possible.',
        sources: [
          'Water utility bills',
          'Water meters',
          'Facility management records',
          'Production records with water usage'
        ],
        unit: 'm³'
      },
      'Workforce Diversity': {
        description: 'Measure of the diversity of the organization\'s workforce across various dimensions such as gender, ethnicity, age, and other relevant categories.',
        methodology: 'Calculate percentages of employees in different diversity categories. Report breakdowns by management level, department, or other relevant classifications.',
        sources: [
          'HR information systems',
          'Employee self-identification surveys',
          'Payroll systems',
          'Recruitment records'
        ],
        unit: 'Score'
      },
      'Board Diversity': {
        description: 'Measure of the diversity of the organization\'s board of directors across various dimensions such as gender, ethnicity, age, and professional background.',
        methodology: 'Calculate the percentage of board members from underrepresented groups. For a comprehensive assessment, consider both demographic diversity and cognitive diversity (experience, expertise, perspective).',
        sources: [
          'Board records',
          'Corporate governance documents',
          'Annual reports',
          'Corporate registry filings'
        ],
        unit: '%'
      },
      'ESG Risk Rating': {
        description: 'Comprehensive assessment of the organization\'s exposure to environmental, social, and governance risks and how well these risks are managed.',
        methodology: 'Typically calculated by ESG rating agencies using proprietary methodologies that assess multiple ESG factors and their materiality to the company\'s industry and operations.',
        sources: [
          'Sustainalytics',
          'MSCI ESG Research',
          'S&P Global ESG Scores',
          'ISS ESG',
          'Internal risk assessments'
        ],
        unit: 'Score'
      }
    };
    
    // Data modal event handler
    $('#dataModal').on('show.bs.modal', function (event) {
      const button = $(event.relatedTarget);
      const metric = button.data('metric');
      const unit = button.data('unit');
      
      const modal = $(this);
      modal.find('.modal-title').text(`${metric} (${unit})`);
      
      // Get metric information from our database (or use defaults if not found)
      const info = metricInfo[metric] || {
        description: 'Details about this metric are being compiled.',
        methodology: 'Standard industry methodology applies.',
        sources: ['Sustainability reports', 'Corporate disclosures', 'Internal data systems'],
        unit: unit
      };
      
      // Populate modal content
      const metricDetails = document.getElementById('metricDetails');
      metricDetails.innerHTML = `<p>${info.description}</p>`;
      
      const metricMethodology = document.getElementById('metricMethodology');
      metricMethodology.innerHTML = `<p>${info.methodology}</p>`;
      
      const metricSources = document.getElementById('metricSources');
      metricSources.innerHTML = info.sources.map(source => `<li class="list-group-item bg-transparent">${source}</li>`).join('');
    });
  });
</script>
{% endblock %}