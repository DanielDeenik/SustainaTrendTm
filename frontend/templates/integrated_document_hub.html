{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}Documents Hub - SustainaTrendâ„¢ Intelligence Platform{% endblock %}

{% block header_title %}Document & Regulatory Intelligence{% endblock %}

{% block additional_head %}
<style>
    /* Tab Content Styling */
    .finchat-tab-content {
        position: relative;
    }
    
    /* Document Upload Styling */
    .upload-container {
        background: var(--finchat-card-bg);
        border: 2px dashed var(--finchat-border);
        border-radius: 12px;
        padding: 2.5rem;
        text-align: center;
        position: relative;
        transition: all 0.3s ease;
    }
    
    .upload-container.drag-over {
        border-color: var(--finchat-primary);
        background: var(--finchat-primary-soft);
    }
    
    .upload-icon {
        font-size: 3rem;
        color: var(--finchat-primary);
        margin-bottom: 1rem;
    }
    
    .upload-title {
        font-weight: 600;
        margin-bottom: 0.75rem;
    }
    
    .upload-description {
        color: var(--finchat-text-secondary);
        margin-bottom: 1.5rem;
    }
    
    .upload-btn {
        background: var(--finchat-primary);
        color: white;
        border: none;
        padding: 0.75rem 1.25rem;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s ease;
    }
    
    .upload-btn:hover {
        background: var(--finchat-primary-dark);
    }
    
    .upload-input {
        display: none;
    }
    
    .drag-message {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--finchat-primary-soft);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        font-weight: 500;
        color: var(--finchat-primary);
        font-size: 1.25rem;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
    }
    
    .upload-container.drag-over .drag-message {
        opacity: 1;
    }
    
    .file-info {
        background: var(--finchat-card-bg);
        border-radius: 10px;
        padding: 1.25rem;
        margin-top: 1.5rem;
        border: 1px solid var(--finchat-border);
        display: none;
    }
    
    .file-info.show {
        display: block;
    }
    
    .file-name {
        display: flex;
        align-items: center;
        font-weight: 500;
        margin-bottom: 0.5rem;
    }
    
    .file-name i {
        color: var(--finchat-accent);
        margin-right: 0.75rem;
        font-size: 1.25rem;
    }
    
    .file-detail {
        color: var(--finchat-text-secondary);
        font-size: 0.875rem;
        margin-bottom: 1rem;
    }
    
    .file-progress {
        height: 6px;
        background: var(--finchat-border);
        border-radius: 3px;
        margin-bottom: 1rem;
        overflow: hidden;
    }
    
    .file-progress-bar {
        height: 100%;
        background: var(--finchat-primary);
        width: 0%;
        transition: width 0.3s ease;
    }
    
    .file-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
    }
    
    /* Processing Steps Styling */
    .processing-steps {
        margin-top: 2rem;
        display: none;
    }
    
    .steps-container {
        position: relative;
        margin-top: 1.5rem;
        padding: 0 1rem;
    }
    
    .step-connector {
        position: absolute;
        top: 25px;
        left: 35px;
        width: calc(100% - 70px);
        height: 2px;
        background: var(--finchat-border);
        z-index: 1;
    }
    
    .step-progress {
        position: absolute;
        top: 25px;
        left: 35px;
        width: 0%;
        height: 2px;
        background: var(--finchat-primary);
        z-index: 2;
        transition: width 0.5s ease;
    }
    
    .steps-container {
        display: flex;
        justify-content: space-between;
    }
    
    .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 3;
        flex: 1;
    }
    
    .step-icon {
        width: 50px;
        height: 50px;
        background: var(--finchat-card-bg);
        border: 2px solid var(--finchat-border);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: var(--finchat-text-secondary);
        margin-bottom: 0.75rem;
        transition: all 0.3s ease;
    }
    
    .step.active .step-icon {
        border-color: var(--finchat-primary);
        background: var(--finchat-primary-soft);
        color: var(--finchat-primary);
    }
    
    .step.completed .step-icon {
        border-color: var(--finchat-success);
        background: var(--finchat-success);
        color: white;
    }
    
    .step-label {
        font-weight: 500;
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
    }
    
    .step.active .step-label {
        color: var(--finchat-primary);
    }
    
    .step.completed .step-label {
        color: var(--finchat-success);
    }
    
    .step-description {
        font-size: 0.75rem;
        color: var(--finchat-text-secondary);
        text-align: center;
        max-width: 120px;
    }
    
    /* Compliance Summary Styling */
    .compliance-summary {
        margin-top: 2rem;
        display: none;
    }
    
    .compliance-summary.show {
        display: block;
    }
    
    .compliance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .compliance-card {
        background: var(--finchat-card-bg);
        border-radius: 10px;
        padding: 1.25rem;
        border: 1px solid var(--finchat-border);
    }
    
    .compliance-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .compliance-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: var(--finchat-primary-soft);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: var(--finchat-primary);
        margin-right: 0.75rem;
    }
    
    .compliance-title {
        font-weight: 600;
    }
    
    .compliance-score {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .compliance-score.high {
        color: var(--finchat-success);
    }
    
    .compliance-score.medium {
        color: var(--finchat-warning);
    }
    
    .compliance-score.low {
        color: var(--finchat-danger);
    }
    
    .compliance-level {
        font-size: 0.875rem;
        color: var(--finchat-text-secondary);
        margin-bottom: 0.75rem;
    }
    
    .compliance-chart {
        height: 8px;
        background: var(--finchat-border);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .compliance-chart-fill {
        height: 100%;
        background: var(--finchat-primary);
        transition: width 1s ease;
    }
    
    .compliance-actions {
        margin-top: 1.5rem;
        display: flex;
        justify-content: center;
    }
    
    /* Recent Documents Styling */
    .recent-documents {
        margin-top: 2rem;
    }
    
    .document-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .document-card {
        background: var(--finchat-card-bg);
        border-radius: 10px;
        padding: 1.25rem;
        border: 1px solid var(--finchat-border);
    }
    
    .document-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.75rem;
    }
    
    .document-type {
        display: flex;
        align-items: center;
    }
    
    .document-icon {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        background: var(--finchat-primary-soft);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        color: var(--finchat-primary);
        margin-right: 0.5rem;
    }
    
    .document-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
    }
    
    .document-meta {
        display: flex;
        justify-content: space-between;
        color: var(--finchat-text-secondary);
        font-size: 0.8125rem;
        margin-bottom: 0.75rem;
    }
    
    .document-frameworks {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .document-framework {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        background: var(--finchat-primary-soft);
        color: var(--finchat-primary);
        border-radius: 4px;
    }
    
    .document-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
    }

    /* Document Analysis Tab Panel Styling */
    .finchat-tab-panel {
        display: none;
        padding: 1rem 0;
    }
    
    .finchat-tab-panel.active {
        display: block;
    }
    
    .finchat-document-info {
        margin-bottom: 1.5rem;
    }
    
    .finchat-document-meta {
        color: var(--finchat-text-secondary);
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .finchat-document-preview {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 6px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .finchat-document-text {
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 0.875rem;
        margin: 0;
    }
    
    .finchat-document-structure {
        border-top: 1px solid var(--finchat-border);
        padding-top: 1rem;
    }
    
    .finchat-document-toc {
        list-style-type: none;
        padding: 0;
        margin: 0;
    }
    
    /* Chat Styling */
    .finchat-chat-container {
        display: flex;
        flex-direction: column;
        height: 350px;
        border: 1px solid var(--finchat-border);
        border-radius: 8px;
        overflow: hidden;
        margin-top: 1rem;
    }
    
    .finchat-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
    }
    
    .finchat-chat-message {
        margin-bottom: 1rem;
        max-width: 85%;
    }
    
    .finchat-chat-message-user {
        margin-left: auto;
    }
    
    .finchat-chat-message-ai {
        margin-right: auto;
    }
    
    .finchat-chat-message-content {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        font-size: 0.9375rem;
    }
    
    .finchat-chat-message-user .finchat-chat-message-content {
        background: var(--finchat-primary);
        color: white;
    }
    
    .finchat-chat-message-ai .finchat-chat-message-content {
        background: var(--finchat-card-bg);
        border: 1px solid var(--finchat-border);
    }
    
    .finchat-chat-input {
        display: flex;
        padding: 0.75rem;
        border-top: 1px solid var(--finchat-border);
        background: var(--finchat-card-bg);
    }
    
    .finchat-chat-input input {
        flex: 1;
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--finchat-border);
        border-radius: 4px;
        background: var(--finchat-body-bg);
        color: var(--finchat-text);
        margin-right: 0.5rem;
    }
    
    .finchat-loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem 0;
    }
    
    .finchat-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--finchat-border);
        border-top-color: var(--finchat-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .finchat-loading-text {
        color: var(--finchat-text-secondary);
    }
    
    /* Utility Classes */
    .mt-4 {
        margin-top: 1rem;
    }
    
    /* News Items Styling */
    .news-item {
        display: flex;
        padding: 12px 0;
        border-bottom: 1px solid var(--finchat-border);
    }
    
    .news-item:last-child {
        border-bottom: none;
    }
    
    .company-icon {
        width: 40px;
        height: 40px;
        background-color: var(--finchat-primary-soft);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        flex-shrink: 0;
    }
    
    .company-icon i {
        color: var(--finchat-primary);
        font-size: 1.25rem;
    }
    
    .news-meta {
        display: flex;
        font-size: 0.8125rem;
        color: var(--finchat-text-secondary);
        margin-top: 4px;
    }
    
    .news-source {
        margin-right: 10px;
        font-weight: 500;
    }
    
    .news-time {
        opacity: 0.7;
    }
    
    /* Horizontal Timeline Styling */
    .horizontal-timeline {
        position: relative;
        display: flex;
        justify-content: space-between;
        padding: 20px 10px;
    }
    
    .timeline-connector {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 3px;
        background-color: var(--finchat-border);
        transform: translateY(-50%);
        z-index: 1;
    }
    
    .timeline-item {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        z-index: 2;
        width: 33.33%;
    }
    
    .timeline-point {
        width: 16px;
        height: 16px;
        background-color: var(--finchat-primary);
        border-radius: 50%;
        margin-bottom: 15px;
        border: 3px solid var(--finchat-card-bg);
    }
    
    .timeline-card {
        display: flex;
        flex-direction: column;
        background-color: var(--finchat-card-bg);
        border: 1px solid var(--finchat-border);
        border-radius: 8px;
        padding: 15px;
        width: 90%;
        max-width: 280px;
    }
    
    .timeline-card .company-icon {
        margin-bottom: 10px;
        align-self: center;
    }
    
    .timeline-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .timeline-title {
        font-weight: 600;
        margin-bottom: 5px;
    }
</style>
{% endblock %}

{% block main_content %}
<!-- Regulatory Timeline -->
<div class="finchat-card">
    <div class="finchat-card-header">
        <h3 class="finchat-card-title">
            <i class="fas fa-calendar-alt"></i> Regulatory Timeline
        </h3>
    </div>
    <div class="finchat-card-body">
        <div class="horizontal-timeline">
            <div class="timeline-connector"></div>
            
            <div class="timeline-item">
                <div class="timeline-point"></div>
                <div class="timeline-card">
                    <div class="company-icon">
                        <i class="fas fa-exclamation"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">CSRD first reporting deadline</div>
                        <div class="news-meta">
                            <span class="news-source">EU</span>
                            <span class="news-time">January 2025</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-point"></div>
                <div class="timeline-card">
                    <div class="company-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">SEC Climate disclosure rules effective</div>
                        <div class="news-meta">
                            <span class="news-source">US</span>
                            <span class="news-time">Q2 2025</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-point"></div>
                <div class="timeline-card">
                    <div class="company-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-title">ISSB Standards implementation deadline</div>
                        <div class="news-meta">
                            <span class="news-source">Global</span>
                            <span class="news-time">January 2026</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="finchat-section">
    <!-- Main section tabs -->
    <div class="finchat-widget-group">
        <div class="finchat-tabgroup" role="tablist">
            <button class="finchat-tab active" id="uploadTab" role="tab" aria-selected="true">
                <i class="fas fa-file-upload"></i> Document Upload
            </button>
            <button class="finchat-tab" id="regulatoryTab" role="tab" aria-selected="false">
                <i class="fas fa-clipboard-check"></i> Regulatory AI
            </button>
            <button class="finchat-tab" id="analysisTab" role="tab" aria-selected="false">
                <i class="fas fa-chart-bar"></i> Document Analysis
            </button>
        </div>
    </div>

    <!-- Document Upload Section -->
    <div id="uploadSection" class="finchat-tab-content active">
        <!-- Main upload card -->
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h2>Document Upload & Analysis</h2>
                <div class="finchat-card-actions">
                    <button class="finchat-button-secondary">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                    <button class="finchat-button-primary">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
            </div>
            
            <div class="finchat-card-content">
                <!-- Upload option selector -->
                <div class="finchat-widget-group">
                    <div class="finchat-tabgroup" role="tablist">
                        <button class="finchat-tab active" id="fileUploadTab" role="tab" aria-selected="true">
                            <i class="fas fa-file-upload"></i> Upload File
                        </button>
                        <button class="finchat-tab" id="textUploadTab" role="tab" aria-selected="false">
                            <i class="fas fa-file-alt"></i> Paste Text
                        </button>
                    </div>
                </div>

                <!-- File Upload Section -->
                <div id="fileUploadSection">
                    <div class="upload-container" id="uploadContainer">
                        <div class="upload-icon">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <h2 class="upload-title">Upload Sustainability Documents</h2>
                        <p class="upload-description">
                            Upload your sustainability reports, ESG disclosures, or regulatory compliance documents for AI-powered analysis and insights.
                        </p>
                        <button class="upload-btn" id="uploadBtn">Choose File</button>
                        <input type="file" class="upload-input" id="fileInput" accept=".pdf,.docx,.doc,.txt">
                        <div class="drag-message">
                            <div>Drop your file here</div>
                        </div>
                    </div>

                    <div class="file-info" id="fileInfo">
                        <div class="file-name">
                            <i class="fas fa-file-pdf"></i>
                            <span id="fileName">document.pdf</span>
                        </div>
                        <div class="file-detail">
                            <span id="fileSize">4.2 MB</span> â€¢ <span id="filePages">32 pages</span>
                        </div>
                        <div class="file-progress">
                            <div class="file-progress-bar" id="fileProgressBar"></div>
                        </div>
                        <div class="file-actions">
                            <button class="finchat-button" id="cancelUploadBtn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button class="finchat-button-primary" id="startAnalysisBtn">
                                <i class="fas fa-chart-bar"></i> Start Analysis
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text Upload Section -->
        <div id="textUploadSection" style="display: none;">
            <div class="finchat-card">
                <div class="finchat-card-header">
                    <h2>Document Text Analysis</h2>
                    <div class="finchat-card-actions">
                        <button class="finchat-button-secondary">
                            <i class="fas fa-question-circle"></i> Help
                        </button>
                        <button class="finchat-button-primary">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                    </div>
                </div>
                
                <div class="finchat-card-content">
                    <p class="finchat-text-muted mb-3">
                        Paste text from your sustainability report, ESG disclosure, or regulatory document for AI-powered analysis.
                    </p>
                    <div class="finchat-form-group">
                        <label for="documentText" class="finchat-label">Document Text</label>
                        <textarea id="documentText" class="finchat-textarea" rows="12" placeholder="Paste your document text here..."></textarea>
                    </div>
                    <div class="finchat-form-group">
                        <label for="industrySelect" class="finchat-label">Industry</label>
                        <select id="industrySelect" class="finchat-select">
                            <option value="general">General</option>
                            <option value="energy">Energy</option>
                            <option value="technology">Technology</option>
                            <option value="financial">Financial Services</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="retail">Retail</option>
                            <option value="agriculture">Agriculture</option>
                            <option value="transportation">Transportation</option>
                            <option value="construction">Construction</option>
                            <option value="hospitality">Hospitality</option>
                        </select>
                    </div>
                    <div class="finchat-form-actions">
                        <button class="finchat-button-primary" id="analyzeTextBtn">
                            <i class="fas fa-chart-bar"></i> Analyze Text
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="processing-steps" id="processingSteps" style="display: none;">
            <h3 class="finchat-section-title">
                <i class="fas fa-tasks"></i> Processing Document
            </h3>
            
            <div class="steps-container">
                <div class="step-connector"></div>
                <div class="step-progress" id="stepsProgress"></div>
                
                <div class="step active" data-step="1">
                    <div class="step-icon">
                        <i class="fas fa-file-import"></i>
                    </div>
                    <div class="step-label">Extract Text</div>
                    <div class="step-description">Extracting content from document</div>
                </div>
                
                <div class="step" data-step="2">
                    <div class="step-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="step-label">Analyze Content</div>
                    <div class="step-description">Identifying key metrics and topics</div>
                </div>
                
                <div class="step" data-step="3">
                    <div class="step-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="step-label">Assess Compliance</div>
                    <div class="step-description">Evaluating framework alignment</div>
                </div>
                
                <div class="step" data-step="4">
                    <div class="step-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="step-label">Generate Insights</div>
                    <div class="step-description">Creating actionable recommendations</div>
                </div>
            </div>
        </div>
        
        <div class="compliance-summary" id="complianceSummary">
            <h3 class="finchat-section-title">
                <i class="fas fa-clipboard-check"></i> Compliance Assessment
            </h3>
            
            <div class="compliance-grid">
                <div class="compliance-card">
                    <div class="compliance-header">
                        <div class="compliance-icon">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <div class="compliance-title">ESRS</div>
                    </div>
                    <div class="compliance-score">78%</div>
                    <div class="compliance-level">Strong Compliance</div>
                    <div class="compliance-chart">
                        <div class="compliance-chart-fill" style="width: 78%;"></div>
                    </div>
                </div>
                
                <div class="compliance-card">
                    <div class="compliance-header">
                        <div class="compliance-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="compliance-title">GRI</div>
                    </div>
                    <div class="compliance-score">85%</div>
                    <div class="compliance-level">Excellent Compliance</div>
                    <div class="compliance-chart">
                        <div class="compliance-chart-fill" style="width: 85%;"></div>
                    </div>
                </div>
                
                <div class="compliance-card">
                    <div class="compliance-header">
                        <div class="compliance-icon">
                            <i class="fas fa-temperature-high"></i>
                        </div>
                        <div class="compliance-title">TCFD</div>
                    </div>
                    <div class="compliance-score">63%</div>
                    <div class="compliance-level">Moderate Compliance</div>
                    <div class="compliance-chart">
                        <div class="compliance-chart-fill" style="width: 63%;"></div>
                    </div>
                </div>
                
                <div class="compliance-card">
                    <div class="compliance-header">
                        <div class="compliance-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <div class="compliance-title">SFDR</div>
                    </div>
                    <div class="compliance-score">72%</div>
                    <div class="compliance-level">Strong Compliance</div>
                    <div class="compliance-chart">
                        <div class="compliance-chart-fill" style="width: 72%;"></div>
                    </div>
                </div>
            </div>
            
            <div class="compliance-actions">
                <button id="downloadReportBtn" class="finchat-button finchat-button-primary">
                    <i class="fas fa-file-pdf"></i> Download Compliance Report
                </button>
            </div>
        </div>
        
        <div class="recent-documents">
            <h3 class="finchat-section-title">
                <i class="fas fa-history"></i> Recent Documents
            </h3>
            
            <div class="document-grid">
                <div class="document-card">
                    <div class="document-header">
                        <div class="document-type">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <span>Sustainability Report</span>
                        </div>
                        <span class="finchat-badge finchat-badge-primary">New</span>
                    </div>
                    <div class="document-title">Annual Sustainability Report 2024</div>
                    <div class="document-meta">
                        <div>32 pages</div>
                        <div>Uploaded: 2 days ago</div>
                    </div>
                    <div class="document-frameworks">
                        <div class="document-framework">ESRS</div>
                        <div class="document-framework">GRI</div>
                        <div class="document-framework">TCFD</div>
                    </div>
                    <div class="document-actions">
                        <button class="finchat-button-icon" title="Download">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="finchat-button-icon" title="View Analysis">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="finchat-button-icon" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="document-card">
                    <div class="document-header">
                        <div class="document-type">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <span>ESG Disclosure</span>
                        </div>
                    </div>
                    <div class="document-title">Quarterly ESG Performance Report</div>
                    <div class="document-meta">
                        <div>15 pages</div>
                        <div>Uploaded: 1 week ago</div>
                    </div>
                    <div class="document-frameworks">
                        <div class="document-framework">SFDR</div>
                        <div class="document-framework">ESRS</div>
                    </div>
                    <div class="document-actions">
                        <button class="finchat-button-icon" title="Download">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="finchat-button-icon" title="View Analysis">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="finchat-button-icon" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="document-card">
                    <div class="document-header">
                        <div class="document-type">
                            <div class="document-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <span>Climate Report</span>
                        </div>
                    </div>
                    <div class="document-title">Climate Risk Assessment 2024</div>
                    <div class="document-meta">
                        <div>28 pages</div>
                        <div>Uploaded: 2 weeks ago</div>
                    </div>
                    <div class="document-frameworks">
                        <div class="document-framework">TCFD</div>
                        <div class="document-framework">CDP</div>
                    </div>
                    <div class="document-actions">
                        <button class="finchat-button-icon" title="Download">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="finchat-button-icon" title="View Analysis">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button class="finchat-button-icon" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Regulatory AI Section -->
    <div id="regulatorySection" class="finchat-tab-content" style="display: none;">
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h2>Regulatory AI Analysis</h2>
                <div class="finchat-card-actions">
                    <button class="finchat-button-secondary">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                    <button class="finchat-button-primary">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
            </div>
            
            <div class="finchat-card-content">
                <div class="finchat-alert finchat-alert-info">
                    <div class="finchat-alert-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="finchat-alert-content">
                        <h4 class="finchat-alert-title">AI-Powered Regulatory Assessment</h4>
                        <p class="finchat-alert-message">
                            Upload your sustainability report or ESG disclosure to analyze compliance with key regulatory frameworks. 
                            Receive AI-generated assessments, gap analysis, and implementation recommendations.
                        </p>
                    </div>
                </div>
                
                <!-- Regulatory Framework Selection -->
                <div class="finchat-form-group">
                    <label for="frameworkSelect" class="finchat-label">Regulatory Framework</label>
                    <select class="finchat-select" id="frameworkSelect">
                        <option value="CSRD">Corporate Sustainability Reporting Directive (CSRD)</option>
                        <option value="ESRS">European Sustainability Reporting Standards (ESRS)</option>
                        <option value="TCFD">Task Force on Climate-related Financial Disclosures (TCFD)</option>
                        <option value="GRI">Global Reporting Initiative (GRI)</option>
                        <option value="SASB">Sustainability Accounting Standards Board (SASB)</option>
                    </select>
                </div>
                
                <!-- Document Text Area -->
                <div class="finchat-form-group">
                    <label for="regulatoryDocumentText" class="finchat-label">Document Text</label>
                    <textarea class="finchat-textarea" id="regulatoryDocumentText" rows="8" 
                        placeholder="Paste the text content of your sustainability report or ESG disclosure here..."></textarea>
                    <div class="finchat-form-text">You can also upload a file below.</div>
                </div>
                
                <!-- Document Upload -->
                <div class="finchat-form-group">
                    <label for="regulatoryDocumentFile" class="finchat-label">Or Upload Document</label>
                    <input type="file" class="finchat-file-input" id="regulatoryDocumentFile" accept=".txt,.pdf,.docx,.doc">
                    <div class="finchat-form-text">Supported formats: TXT, PDF, DOCX, DOC (text extraction from PDFs is limited)</div>
                </div>
                
                <!-- Assessment Button -->
                <div class="finchat-form-actions">
                    <button type="button" class="finchat-button-primary" id="assessComplianceBtn">
                        <i class="fas fa-clipboard-check"></i> Assess Compliance
                    </button>
                </div>
                
                <!-- RAG AI Query Section -->
                <div class="finchat-form-group mt-4">
                    <label for="ragQueryInput" class="finchat-label">Ask the RAG Agent</label>
                    <textarea class="finchat-textarea" id="ragQueryInput" rows="3" 
                        placeholder="Ask a specific question about regulatory compliance, e.g., 'What are the main gaps in our climate reporting according to ESRS E1?'"></textarea>
                    <div class="finchat-form-text">Be specific in your query for better results. The RAG agent will use both the document and regulatory framework knowledge to provide in-depth answers.</div>
                </div>
                
                <div class="finchat-form-actions">
                    <button type="button" class="finchat-button-success" id="ragQueryBtn">
                        <i class="fas fa-robot"></i> Ask RAG Agent
                    </button>
                </div>
                
                <!-- RAG Results Section -->
                <div id="ragResults" class="mt-4" style="display: none;">
                    <div class="finchat-card finchat-card-dark">
                        <div class="finchat-card-body">
                            <div id="ragLoading" class="finchat-loading">
                                <div class="finchat-spinner"></div>
                                <div class="finchat-loading-text">Processing with RAG AI Agent...</div>
                            </div>
                            <div id="ragResponseContent" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Document Analysis Section -->
    <div id="analysisSection" class="finchat-tab-content" style="display: none;">
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h2>Document Analysis</h2>
                <div class="finchat-card-actions">
                    <button class="finchat-button-secondary">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="finchat-button-primary">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="finchat-card-content">
                <div id="noDocumentMessage" class="finchat-alert finchat-alert-warning">
                    <div class="finchat-alert-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="finchat-alert-content">
                        <h4 class="finchat-alert-title">No Document Available</h4>
                        <p class="finchat-alert-message">
                            Please upload a document first in the Document Upload tab to see analysis results.
                        </p>
                    </div>
                </div>
                
                <div id="documentAnalysisContent" style="display: none;">
                    <!-- Document Analysis Tabs -->
                    <div class="finchat-widget-group">
                        <div class="finchat-tabgroup" role="tablist">
                            <button class="finchat-tab active" id="previewTab" role="tab" aria-selected="true">
                                <i class="fas fa-file-alt"></i> Document Preview
                            </button>
                            <button class="finchat-tab" id="metricsTab" role="tab" aria-selected="false">
                                <i class="fas fa-chart-line"></i> ESG Metrics
                            </button>
                            <button class="finchat-tab" id="complianceTab" role="tab" aria-selected="false">
                                <i class="fas fa-clipboard-check"></i> Compliance
                            </button>
                            <button class="finchat-tab" id="figuresTab" role="tab" aria-selected="false">
                                <i class="fas fa-table"></i> Figures & Tables
                            </button>
                        </div>
                    </div>
                    
                    <!-- Document Preview Tab Content -->
                    <div id="previewTabContent" class="finchat-tab-panel active">
                        <div class="finchat-card">
                            <div class="finchat-card-body">
                                <div class="finchat-document-info">
                                    <h4 id="documentName">Document Name</h4>
                                    <div class="finchat-document-meta">
                                        <span id="documentPageCount">0 pages</span> â€¢ 
                                        <span id="documentWordCount">0 words</span> â€¢ 
                                        <span id="documentFileSize">0 KB</span>
                                    </div>
                                </div>
                                
                                <div class="finchat-document-preview">
                                    <pre id="documentPreview" class="finchat-document-text"></pre>
                                </div>
                                
                                <div class="finchat-document-structure">
                                    <h5>Document Structure</h5>
                                    <ul id="documentStructure" class="finchat-document-toc"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ESG Metrics Tab Content -->
                    <div id="metricsTabContent" class="finchat-tab-panel">
                        <div class="finchat-card">
                            <div class="finchat-card-header">
                                <h3>ESG Metrics Identified</h3>
                            </div>
                            <div class="finchat-card-body">
                                <div id="esgMetricsContainer"></div>
                                
                                <h4 class="mt-4">Numerical KPIs</h4>
                                <div id="kpiContainer"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compliance Tab Content -->
                    <div id="complianceTabContent" class="finchat-tab-panel">
                        <div class="finchat-card">
                            <div class="finchat-card-header">
                                <h3>Regulatory Compliance Assessment</h3>
                            </div>
                            <div class="finchat-card-body">
                                <div id="overallComplianceContainer"></div>
                                
                                <h4 class="mt-4">Framework Compliance</h4>
                                <div id="frameworkComplianceContainer"></div>
                                
                                <h4 class="mt-4">Key Recommendations</h4>
                                <div id="recommendationsContainer"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Figures & Tables Tab Content -->
                    <div id="figuresTabContent" class="finchat-tab-panel">
                        <div class="finchat-card">
                            <div class="finchat-card-header">
                                <h3>Figures & Tables Referenced</h3>
                            </div>
                            <div class="finchat-card-body">
                                <h4>Figures</h4>
                                <div id="figuresContainer"></div>
                                
                                <h4 class="mt-4">Tables</h4>
                                <div id="tablesContainer"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI-Powered Document Query -->
                    <div class="finchat-card mt-4">
                        <div class="finchat-card-header">
                            <h3>AI-Powered Document Query</h3>
                        </div>
                        <div class="finchat-card-body">
                            <p>Ask questions about this document to get AI-generated responses with data traceability.</p>
                            
                            <div class="finchat-chat-container">
                                <div class="finchat-chat-messages" id="chatMessages">
                                    <div class="finchat-chat-message finchat-chat-message-ai">
                                        <div class="finchat-chat-message-content">
                                            <p>Hello! I'm your sustainability report assistant. You can ask me questions about this document, such as:</p>
                                            <ul>
                                                <li>"Explain Figure 4.1 on page 16"</li>
                                                <li>"What is the underlying data for carbon emissions reported in table 5.2?"</li>
                                                <li>"What assumption was used for Scope 3 emissions?"</li>
                                                <li>"How does this report comply with CSRD requirements?"</li>
                                            </ul>
                                            <p>I'll provide answers with references to the document and access to underlying data where available.</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="finchat-chat-input">
                                    <input type="text" id="chatInput" placeholder="Ask a question about this document...">
                                    <button id="chatSendBtn" class="finchat-button-primary">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block insights_panel %}
<div class="finchat-insights-header">
    <h3>Document Analysis Insights</h3>
</div>
<div class="finchat-insights-content">
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-lightbulb"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Most Recent Upload</h4>
            <p>Your Annual Sustainability Report 2024 has strong ESRS compliance (78%) but could be improved in the biodiversity disclosures section.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Carbon Metrics Trend</h4>
            <p>Your Scope 1 & 2 emissions have decreased by 15% since your last report, showing strong progress toward your 2030 targets.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>CSRD Readiness Alert</h4>
            <p>Your current reporting is missing key CSRD requirements in social metrics and governance disclosures needed for the 2025 deadline.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-award"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Industry Benchmark</h4>
            <p>Your sustainability reporting is in the top 25% of your industry peers, with particularly strong climate-related financial disclosures.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Main section tabs
        const mainTabs = document.querySelectorAll('#uploadTab, #regulatoryTab, #analysisTab');
        const mainSections = document.querySelectorAll('#uploadSection, #regulatorySection, #analysisSection');
        
        mainTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and hide all sections
                mainTabs.forEach(t => t.classList.remove('active'));
                mainSections.forEach(s => s.style.display = 'none');
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.id.replace('Tab', 'Section');
                document.getElementById(sectionId).style.display = 'block';
            });
        });
        
        // File upload and text upload tabs
        const uploadTabs = document.querySelectorAll('#fileUploadTab, #textUploadTab');
        const uploadSections = document.querySelectorAll('#fileUploadSection, #textUploadSection');
        
        uploadTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                uploadTabs.forEach(t => t.classList.remove('active'));
                uploadSections.forEach(s => s.style.display = 'none');
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.id.replace('Tab', 'Section');
                document.getElementById(sectionId).style.display = 'block';
            });
        });
        
        // Document analysis tabs
        const analysisTabs = document.querySelectorAll('#previewTab, #metricsTab, #complianceTab, #figuresTab');
        const analysisContents = document.querySelectorAll('#previewTabContent, #metricsTabContent, #complianceTabContent, #figuresTabContent');
        
        analysisTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and hide all contents
                analysisTabs.forEach(t => t.classList.remove('active'));
                analysisContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Show corresponding content
                const contentId = this.id.replace('Tab', 'TabContent');
                document.getElementById(contentId).classList.add('active');
            });
        });
        
        // File upload functionality
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const uploadContainer = document.getElementById('uploadContainer');
        
        if (uploadBtn && fileInput) {
            uploadBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    handleFileSelection(this.files[0]);
                }
            });
            
            // Drag and drop
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            uploadContainer.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            uploadContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFileSelection(e.dataTransfer.files[0]);
                }
            });
        }
        
        // Handle file selection
        function handleFileSelection(file) {
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const fileInfo = document.getElementById('fileInfo');
            
            if (fileName && fileSize && fileInfo) {
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                fileInfo.style.display = 'block';
            }
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Cancel upload
        const cancelUploadBtn = document.getElementById('cancelUploadBtn');
        
        if (cancelUploadBtn) {
            cancelUploadBtn.addEventListener('click', function() {
                const fileInfo = document.getElementById('fileInfo');
                const fileInput = document.getElementById('fileInput');
                
                if (fileInfo && fileInput) {
                    fileInfo.style.display = 'none';
                    fileInput.value = '';
                }
            });
        }
        
        // Start analysis
        const startAnalysisBtn = document.getElementById('startAnalysisBtn');
        
        if (startAnalysisBtn) {
            startAnalysisBtn.addEventListener('click', function() {
                const processingSteps = document.getElementById('processingSteps');
                
                if (processingSteps) {
                    processingSteps.style.display = 'block';
                    simulateProcessing();
                }
            });
        }
        
        // Analyze text
        const analyzeTextBtn = document.getElementById('analyzeTextBtn');
        
        if (analyzeTextBtn) {
            analyzeTextBtn.addEventListener('click', function() {
                const processingSteps = document.getElementById('processingSteps');
                
                if (processingSteps) {
                    processingSteps.style.display = 'block';
                    simulateProcessing();
                }
            });
        }
        
        // Simulate processing
        function simulateProcessing() {
            const steps = document.querySelectorAll('.step');
            const stepsProgress = document.getElementById('stepsProgress');
            
            let currentStep = 0;
            const totalSteps = steps.length;
            
            steps.forEach(step => step.classList.remove('active', 'completed'));
            steps[0].classList.add('active');
            
            const interval = setInterval(() => {
                if (currentStep < totalSteps - 1) {
                    steps[currentStep].classList.remove('active');
                    steps[currentStep].classList.add('completed');
                    currentStep++;
                    steps[currentStep].classList.add('active');
                    
                    const progress = (currentStep / (totalSteps - 1)) * 100;
                    stepsProgress.style.width = `${progress}%`;
                } else {
                    clearInterval(interval);
                    steps[currentStep].classList.remove('active');
                    steps[currentStep].classList.add('completed');
                    stepsProgress.style.width = '100%';
                    
                    setTimeout(() => {
                        const complianceSummary = document.getElementById('complianceSummary');
                        if (complianceSummary) {
                            complianceSummary.style.display = 'block';
                        }
                        
                        // Also simulate document analysis content being ready
                        const documentAnalysisContent = document.getElementById('documentAnalysisContent');
                        const noDocumentMessage = document.getElementById('noDocumentMessage');
                        
                        if (documentAnalysisContent && noDocumentMessage) {
                            documentAnalysisContent.style.display = 'block';
                            noDocumentMessage.style.display = 'none';
                        }
                    }, 500);
                }
            }, 1000);
        }
        
        // Regulatory AI functionality
        const assessComplianceBtn = document.getElementById('assessComplianceBtn');
        
        if (assessComplianceBtn) {
            assessComplianceBtn.addEventListener('click', function() {
                // Simulate processing
                alert('This would analyze the document against the selected framework in a real implementation.');
            });
        }
        
        const ragQueryBtn = document.getElementById('ragQueryBtn');
        const ragResults = document.getElementById('ragResults');
        const ragLoading = document.getElementById('ragLoading');
        const ragResponseContent = document.getElementById('ragResponseContent');
        
        if (ragQueryBtn && ragResults && ragLoading && ragResponseContent) {
            ragQueryBtn.addEventListener('click', function() {
                const queryInput = document.getElementById('ragQueryInput');
                
                if (queryInput && queryInput.value.trim()) {
                    // Show loading state
                    ragResults.style.display = 'block';
                    ragLoading.style.display = 'block';
                    ragResponseContent.style.display = 'none';
                    
                    // Simulate processing
                    setTimeout(() => {
                        ragLoading.style.display = 'none';
                        ragResponseContent.style.display = 'block';
                        ragResponseContent.innerHTML = `
                            <h4>Response to: ${queryInput.value.trim()}</h4>
                            <p>This is a simulated AI response from the RAG agent. In a real implementation, this would retrieve relevant context from the regulatory framework knowledge base and provide a detailed, contextual answer.</p>
                        `;
                    }, 2000);
                }
            });
        }
        
        // Chat functionality
        const chatInput = document.getElementById('chatInput');
        const chatSendBtn = document.getElementById('chatSendBtn');
        const chatMessages = document.getElementById('chatMessages');
        
        if (chatInput && chatSendBtn && chatMessages) {
            chatSendBtn.addEventListener('click', function() {
                const message = chatInput.value.trim();
                
                if (message) {
                    // Add user message
                    const userMessageDiv = document.createElement('div');
                    userMessageDiv.className = 'finchat-chat-message finchat-chat-message-user';
                    userMessageDiv.innerHTML = `
                        <div class="finchat-chat-message-content">
                            <p>${message}</p>
                        </div>
                    `;
                    chatMessages.appendChild(userMessageDiv);
                    
                    // Clear input
                    chatInput.value = '';
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Simulate AI response (in real implementation, this would call an API)
                    setTimeout(() => {
                        const aiMessageDiv = document.createElement('div');
                        aiMessageDiv.className = 'finchat-chat-message finchat-chat-message-ai';
                        aiMessageDiv.innerHTML = `
                            <div class="finchat-chat-message-content">
                                <p>I've analyzed your question: "${message}"</p>
                                <p>Based on the document, I can provide the following information:</p>
                                <p>This is a simulated AI response that would normally contain relevant information from the document based on your query. In a real implementation, this would use RAG technology to find and present the most relevant information from the document.</p>
                            </div>
                        `;
                        chatMessages.appendChild(aiMessageDiv);
                        
                        // Scroll to bottom
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 1000);
                }
            });
            
            // Handle Enter key in chat input
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    chatSendBtn.click();
                }
            });
        }
    });
</script>
{% endblock %}