{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}Startup Sustainability Assessment - VC-Lens™{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-5">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-1">Startup Sustainability Assessment</h1>
            <p class="text-muted">Comprehensive ESG assessment for startups and portfolio companies</p>
        </div>
        <div>
            <a href="/vc-lens" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to VC-Lens™
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Assessment Modules -->
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-primary p-2 me-3">
                            <i class="fas fa-clipboard-check text-white"></i>
                        </div>
                        <h4 class="card-title mb-0">Foundational Readiness</h4>
                    </div>
                    <p class="card-text">Assess startup's alignment with reporting frameworks, disclosure requirements, and baseline ESG metrics.</p>
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2"><i class="fas fa-check text-primary me-2"></i>Framework readiness scoring</li>
                        <li class="mb-2"><i class="fas fa-check text-primary me-2"></i>CSRD/ESRS alignment</li>
                        <li class="mb-2"><i class="fas fa-check text-primary me-2"></i>Gap analysis & recommendations</li>
                        <li><i class="fas fa-check text-primary me-2"></i>Regulatory readiness assessment</li>
                    </ul>
                    <a href="/vc-lens/startup-assessment/foundational" class="btn btn-primary">
                        Start Assessment
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-success p-2 me-3">
                            <i class="fas fa-chart-line text-white"></i>
                        </div>
                        <h4 class="card-title mb-0">Forward-Looking Metrics</h4>
                    </div>
                    <p class="card-text">Project future sustainability performance using predictive modeling and peer benchmarking.</p>
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>5-year emissions forecast</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Resource efficiency modeling</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Peer group comparison</li>
                        <li><i class="fas fa-check text-success me-2"></i>Industry-specific benchmarks</li>
                    </ul>
                    <a href="/vc-lens/startup-assessment/forward-metrics" class="btn btn-success">
                        Start Assessment
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-info p-2 me-3">
                            <i class="fas fa-comments text-white"></i>
                        </div>
                        <h4 class="card-title mb-0">Narrative Building</h4>
                    </div>
                    <p class="card-text">Construct an investor-ready sustainability narrative aligned with your thesis and frameworks.</p>
                    <ul class="list-unstyled mb-4">
                        <li class="mb-2"><i class="fas fa-check text-info me-2"></i>SDG mapping & impact metrics</li>
                        <li class="mb-2"><i class="fas fa-check text-info me-2"></i>EU Taxonomy alignment</li>
                        <li class="mb-2"><i class="fas fa-check text-info me-2"></i>Key message generation</li>
                        <li><i class="fas fa-check text-info me-2"></i>Investor-ready storytelling</li>
                    </ul>
                    <a href="/vc-lens/startup-assessment/narrative" class="btn btn-info">
                        Start Assessment
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Full Assessment Section -->
    <div class="row mt-3">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4>Generate Comprehensive Assessment</h4>
                            <p class="mb-md-0">Create a complete sustainability assessment across all three modules with a single report.</p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#comprehensiveModal">
                                <i class="fas fa-file-alt me-2"></i>Full Assessment
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Framework Guide Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-4">Sustainability Framework Guide</h3>
        </div>
        
        {% for framework in csrd_frameworks %}
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-transparent">
                    <h5 class="card-title mb-0">{{ framework.name }}</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ framework.description }}</p>
                    <div class="d-grid">
                        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#frameworkModal{{ framework.id }}">
                            Learn More
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Comprehensive Assessment Modal -->
<div class="modal fade" id="comprehensiveModal" tabindex="-1" aria-labelledby="comprehensiveModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title" id="comprehensiveModalLabel">Comprehensive Sustainability Assessment</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="comprehensive-assessment-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="company_name" class="form-label">Company Name</label>
                                <input type="text" class="form-control" id="company_name" name="company_name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="sector" class="form-label">Industry Sector</label>
                                <select class="form-select" id="sector" name="sector" required>
                                    <option value="" selected disabled>Select sector</option>
                                    <option value="Technology">Technology</option>
                                    <option value="Energy">Energy</option>
                                    <option value="Manufacturing">Manufacturing</option>
                                    <option value="Consumer Goods">Consumer Goods</option>
                                    <option value="Healthcare">Healthcare</option>
                                    <option value="Financial Services">Financial Services</option>
                                    <option value="Food & Agriculture">Food & Agriculture</option>
                                    <option value="Transportation">Transportation</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="size" class="form-label">Company Size</label>
                                <select class="form-select" id="size" name="size" required>
                                    <option value="" selected disabled>Select size</option>
                                    <option value="Startup (1-50)">Startup (1-50)</option>
                                    <option value="Small (51-250)">Small (51-250)</option>
                                    <option value="Medium (251-1000)">Medium (251-1000)</option>
                                    <option value="Large (1001-5000)">Large (1001-5000)</option>
                                    <option value="Enterprise (5000+)">Enterprise (5000+)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="base_year" class="form-label">Base Year</label>
                                <input type="number" class="form-control" id="base_year" name="base_year" value="2025">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label d-block">Assessment Modules</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="module_foundational" name="modules" value="foundational" checked>
                            <label class="form-check-label" for="module_foundational">Foundational Readiness</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="module_forward" name="modules" value="forward" checked>
                            <label class="form-check-label" for="module_forward">Forward-Looking Metrics</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="module_narrative" name="modules" value="narrative" checked>
                            <label class="form-check-label" for="module_narrative">Narrative Building</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="generate-comprehensive-btn">
                    Generate Assessment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Framework Modals -->
{% for framework in csrd_frameworks %}
<div class="modal fade" id="frameworkModal{{ framework.id }}" tabindex="-1" aria-labelledby="frameworkModal{{ framework.id }}Label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title" id="frameworkModal{{ framework.id }}Label">{{ framework.name }}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>{{ framework.description }}</strong></p>
                
                {% if framework.id == 'gri' %}
                <p>The Global Reporting Initiative (GRI) Standards are the world's most widely used sustainability reporting standards. They are designed to help organizations understand and communicate their impacts on the economy, environment, and society.</p>
                <p>Key components include:</p>
                <ul>
                    <li>Universal Standards (GRI 1, 2, 3)</li>
                    <li>Topic Standards (200 Economic, 300 Environmental, 400 Social)</li>
                    <li>Sector Standards</li>
                </ul>
                <p>Startups typically begin with a materiality assessment to identify which topics are most relevant to their business model and stakeholders.</p>
                
                {% elif framework.id == 'sasb' %}
                <p>The Sustainability Accounting Standards Board (SASB) Standards identify the subset of environmental, social, and governance issues most relevant to financial performance in each of 77 industries.</p>
                <p>SASB focuses on:</p>
                <ul>
                    <li>Industry-specific metrics</li>
                    <li>Financial materiality</li>
                    <li>Decision-useful information for investors</li>
                </ul>
                <p>SASB is now part of the IFRS Foundation alongside the International Sustainability Standards Board (ISSB).</p>
                
                {% elif framework.id == 'tcfd' %}
                <p>The Task Force on Climate-related Financial Disclosures (TCFD) provides recommendations for more effective climate-related disclosures that could promote more informed investment, credit, and insurance underwriting decisions.</p>
                <p>TCFD's core elements:</p>
                <ul>
                    <li>Governance</li>
                    <li>Strategy (including scenario analysis)</li>
                    <li>Risk Management</li>
                    <li>Metrics and Targets</li>
                </ul>
                <p>Many jurisdictions are now mandating TCFD-aligned reporting, including the UK, Switzerland, and New Zealand.</p>
                
                {% elif framework.id == 'esrs' %}
                <p>The European Sustainability Reporting Standards (ESRS) are the reporting standards for the EU's Corporate Sustainability Reporting Directive (CSRD).</p>
                <p>ESRS includes:</p>
                <ul>
                    <li>Cross-cutting standards</li>
                    <li>Environmental standards (E1-E5)</li>
                    <li>Social standards (S1-S4)</li>
                    <li>Governance standards (G1-G2)</li>
                </ul>
                <p>CSRD will apply to all large companies and listed SMEs in the EU, as well as non-EU companies with significant EU operations.</p>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Comprehensive Assessment Button
    const generateComprehensiveBtn = document.getElementById('generate-comprehensive-btn');
    
    generateComprehensiveBtn.addEventListener('click', function() {
        const form = document.getElementById('comprehensive-assessment-form');
        const formData = new FormData(form);
        
        // Validate form
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        // Get selected modules
        const modules = formData.getAll('modules');
        if (modules.length === 0) {
            alert('Please select at least one assessment module.');
            return;
        }
        
        // Prepare data for API
        const requestData = {
            company_name: formData.get('company_name'),
            sector: formData.get('sector'),
            size: formData.get('size'),
            base_year: formData.get('base_year'),
            modules: modules
        };
        
        // Show loading
        generateComprehensiveBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Generating...';
        generateComprehensiveBtn.disabled = true;
        
        // Call API endpoint
        fetch('/vc-lens/api/sustainability-assessment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
        .then(response => response.json())
        .then(data => {
            // Success - redirect to assessment result page
            // In a real implementation, this would go to a comprehensive report page
            alert('Comprehensive assessment generated! (In development)');
            console.log('Assessment data:', data);
            
            // Reset button
            generateComprehensiveBtn.innerHTML = 'Generate Assessment';
            generateComprehensiveBtn.disabled = false;
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('comprehensiveModal'));
            modal.hide();
        })
        .catch(error => {
            console.error('Error generating assessment:', error);
            generateComprehensiveBtn.innerHTML = 'Generate Assessment';
            generateComprehensiveBtn.disabled = false;
            alert('Error generating assessment. Please try again later.');
        });
    });
});
</script>
{% endblock %}