{% extends "finchat_base.html" %}

{% block title %}Strategy Hub{% endblock %}

{% block content %}
<div class="container-fluid dark-theme px-4 py-3">
    <div class="row">
        <div class="col-12">
            <h1 class="display-5 mb-4">Strategy Hub</h1>
            <p class="lead text-muted">Comprehensive strategic frameworks, monetization analysis, and sustainability planning tools.</p>
        </div>
    </div>
    
    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="strategyTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="frameworks-tab" data-bs-toggle="tab" data-bs-target="#frameworks-content" type="button" role="tab" aria-controls="frameworks-content" aria-selected="true">
                <i class="fas fa-sitemap"></i> Strategic Frameworks
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="monetization-tab" data-bs-toggle="tab" data-bs-target="#monetization-content" type="button" role="tab" aria-controls="monetization-content" aria-selected="false">
                <i class="fas fa-coins"></i> Monetization
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="planning-tab" data-bs-toggle="tab" data-bs-target="#planning-content" type="button" role="tab" aria-controls="planning-content" aria-selected="false">
                <i class="fas fa-chart-line"></i> Strategic Planning
            </button>
        </li>
    </ul>
    
    <!-- Tab Content -->
    <div class="tab-content" id="strategyTabsContent">
        <!-- FRAMEWORKS TAB -->
        <div class="tab-pane fade show active" id="frameworks-content" role="tabpanel">
            <!-- Framework Cards Row -->
            <div class="row mb-4">
                {% for framework_id, framework in frameworks.items() %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100 bg-dark-card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">
                                {% if framework_id == 'porters' %}
                                <i class="fas fa-project-diagram text-danger"></i>
                                {% elif framework_id == 'swot' %}
                                <i class="fas fa-table text-success"></i>
                                {% elif framework_id == 'bcg' %}
                                <i class="fas fa-th-large text-primary"></i>
                                {% elif framework_id == 'mckinsey' %}
                                <i class="fas fa-chart-pie text-info"></i>
                                {% elif framework_id == 'blue_ocean' %}
                                <i class="fas fa-water text-primary"></i>
                                {% else %}
                                <i class="fas fa-chess text-warning"></i>
                                {% endif %}
                                {{ framework.name }}
                            </h5>
                            <p class="card-text">{{ framework.description }}</p>
                        </div>
                        <div class="card-footer bg-dark-card-footer d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                {% if framework.difficulty == 'Easy' %}
                                <span class="badge bg-success">Easy</span>
                                {% elif framework.difficulty == 'Medium' %}
                                <span class="badge bg-warning">Medium</span>
                                {% else %}
                                <span class="badge bg-danger">Advanced</span>
                                {% endif %}
                            </small>
                            <a href="{{ url_for('strategy.strategy_framework', framework_id=framework_id) }}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-external-link-alt"></i> Use Framework
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Framework Analysis Form -->
            <div class="row">
                <div class="col-12">
                    <div class="card bg-dark-card shadow-sm">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                Framework Analysis
                                <button type="button" class="btn btn-sm btn-outline-info float-end" data-bs-toggle="modal" data-bs-target="#frameworkModal">
                                    <i class="fas fa-info-circle"></i> View All Frameworks
                                </button>
                            </h5>
                        </div>
                        <div class="card-body">
                            <form id="frameworkForm">
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="frameworkSelect" class="form-label">Select Framework</label>
                                        <select class="form-select bg-darker" id="frameworkSelect">
                                            {% for framework_id, framework in frameworks.items() %}
                                            <option value="{{ framework_id }}">{{ framework.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="analysisCompanyName" class="form-label">Company Name</label>
                                        <input type="text" class="form-control bg-darker" id="analysisCompanyName" placeholder="Enter company name">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="analysisIndustry" class="form-label">Industry</label>
                                        <select class="form-select bg-darker" id="analysisIndustry">
                                            <option value="Real Estate">Real Estate</option>
                                            <option value="Energy">Energy</option>
                                            <option value="Manufacturing">Manufacturing</option>
                                            <option value="Technology">Technology</option>
                                            <option value="Finance">Finance</option>
                                            <option value="Healthcare">Healthcare</option>
                                            <option value="Retail">Retail</option>
                                            <option value="Agriculture">Agriculture</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div id="frameworkFormFields" class="mb-3">
                                    <!-- Dynamic form fields will be inserted here based on selected framework -->
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i> Select a framework to see the required inputs
                                    </div>
                                </div>
                                
                                <button type="button" id="analyzeFrameworkBtn" class="btn btn-primary">
                                    <i class="fas fa-analytics"></i> Analyze
                                </button>
                            </form>
                            
                            <!-- Framework Results (Hidden by default) -->
                            <div id="frameworkResults" class="mt-4" style="display: none;"></div>
                            
                            <!-- Loading Indicator -->
                            <div id="frameworkLoading" class="text-center my-4" style="display: none;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Analyzing with framework...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MONETIZATION TAB -->
        <div class="tab-pane fade" id="monetization-content" role="tabpanel">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card bg-dark-card shadow-sm">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Monetization Strategies</h5>
                            <button type="button" class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#monetizationModal">
                                <i class="fas fa-info-circle"></i> View All Strategies
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% if monetization_strategies is mapping %}
                                    {% for strategy_id, strategy in monetization_strategies.items() %}
                                        {% if loop.index <= 6 %}
                                        <div class="col-md-4 mb-3">
                                            <div class="card h-100 bg-darker">
                                                <div class="card-body">
                                                    <h5 class="card-title">
                                                        <i class="fas fa-{{ strategy.icon if strategy.icon else 'chart-line' }}"></i> 
                                                        {{ strategy.name }}
                                                    </h5>
                                                    <p class="card-text small text-muted">{{ strategy.short_description }}</p>
                                                    <div class="progress mt-2" style="height: 6px;">
                                                        <div class="progress-bar 
                                                            {% if strategy.default_potential >= 75 %}bg-success
                                                            {% elif strategy.default_potential >= 50 %}bg-info
                                                            {% else %}bg-warning{% endif %}" 
                                                            role="progressbar" 
                                                            style="width: {{ strategy.default_potential }}%" 
                                                            aria-valuenow="{{ strategy.default_potential }}" 
                                                            aria-valuemin="0" 
                                                            aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                    <small class="d-block text-end text-muted mt-1">
                                                        Potential: {{ strategy.default_potential }}%
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <div class="col-12">
                                        <div class="alert alert-warning">
                                            <i class="fas fa-exclamation-triangle"></i> 
                                            Monetization strategies data is not in the expected format. Please try refreshing.
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Monetization Analysis Form -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card bg-darker">
                                        <div class="card-header">
                                            <h6 class="card-title mb-0">Monetization Opportunity Analysis</h6>
                                        </div>
                                        <div class="card-body">
                                            <form id="monetizationAnalysisForm">
                                                <div class="mb-3">
                                                    <label for="monetizationCompanyName" class="form-label">Company Name</label>
                                                    <input type="text" class="form-control bg-black-50" id="monetizationCompanyName" placeholder="Enter your company name">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="monetizationDocumentText" class="form-label">Business Description</label>
                                                    <textarea class="form-control bg-black-50" id="monetizationDocumentText" rows="3" placeholder="Describe your business model and sustainability initiatives"></textarea>
                                                </div>
                                                <button type="button" id="analyzeMonetizationBtn" class="btn btn-success">
                                                    <i class="fas fa-search-dollar"></i> Analyze Opportunities
                                                </button>
                                            </form>
                                            
                                            <!-- Analysis Results (hidden by default) -->
                                            <div id="monetizationResults" class="mt-4" style="display: none;"></div>
                                            
                                            <!-- Loading Indicator -->
                                            <div id="monetizationLoading" class="text-center my-4" style="display: none;">
                                                <div class="spinner-border text-success" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2">Analyzing monetization opportunities...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- STRATEGIC PLANNING TAB -->
        <div class="tab-pane fade" id="planning-content" role="tabpanel">
            <!-- Strategy Modeling Tool Callout -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card bg-gradient-primary shadow-sm text-white border-0">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-lg-9">
                                    <h4 class="mb-2">New: Interactive Strategy Modeling Tool</h4>
                                    <p class="mb-0">
                                        Model sustainability strategies with adjustable variables and real-time visualizations. 
                                        Make data-driven decisions with AI-powered recommendations tailored to your industry and goals.
                                    </p>
                                </div>
                                <div class="col-lg-3 text-lg-end mt-3 mt-lg-0">
                                    <a href="{{ url_for('strategy.strategy_modeling_tool') }}" class="btn btn-light">
                                        <i class="fas fa-chart-line me-2"></i>Launch Modeling Tool
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Strategic Planning -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card bg-dark-card shadow-sm">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Integrated Strategic Planning</h5>
                        </div>
                        <div class="card-body">
                            <form id="strategicPlanForm">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="companyName" class="form-label">Company Name</label>
                                        <input type="text" class="form-control bg-darker" id="companyName" placeholder="Enter your company name">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="industrySelect" class="form-label">Industry</label>
                                        <select class="form-select bg-darker" id="industrySelect">
                                            <option value="Real Estate">Real Estate</option>
                                            <option value="Energy">Energy</option>
                                            <option value="Manufacturing">Manufacturing</option>
                                            <option value="Technology">Technology</option>
                                            <option value="Finance">Finance</option>
                                            <option value="Healthcare">Healthcare</option>
                                            <option value="Retail">Retail</option>
                                            <option value="Agriculture">Agriculture</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="documentText" class="form-label">Business Description (Optional)</label>
                                    <textarea class="form-control bg-darker" id="documentText" rows="3" placeholder="Enter a brief description of your business, goals, and sustainability initiatives"></textarea>
                                </div>
                                <button type="button" id="generatePlanBtn" class="btn btn-primary">
                                    <i class="fas fa-chart-line"></i> Generate Strategic Plan
                                </button>
                            </form>
                            
                            <!-- Results Area (Hidden by default) -->
                            <div id="planResults" class="mt-4" style="display: none;">
                                <hr>
                                <h5 id="planTitle">Strategic Plan for <span id="resultCompanyName"></span></h5>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> 
                                    <span id="planSummary"></span>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card bg-darker mb-3">
                                            <div class="card-header">
                                                <h6 class="card-title mb-0">Recommended Strategies</h6>
                                            </div>
                                            <div class="card-body p-0">
                                                <ul class="list-group list-group-flush" id="recommendedStrategies">
                                                    <!-- Dynamically populated -->
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-darker mb-3">
                                            <div class="card-header">
                                                <h6 class="card-title mb-0">Implementation Roadmap</h6>
                                            </div>
                                            <div class="card-body p-0">
                                                <ul class="list-group list-group-flush" id="implementationSteps">
                                                    <!-- Dynamically populated -->
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Loading Indicator (Hidden by default) -->
                            <div id="planLoading" class="text-center my-4" style="display: none;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Generating your strategic plan...</p>
                            </div>
                            
                            <!-- Error Message (Hidden by default) -->
                            <div id="planError" class="alert alert-danger mt-4" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> 
                                <span id="errorMessage">An error occurred while generating your plan.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Frameworks Modal -->
<div class="modal fade" id="frameworkModal" tabindex="-1" aria-labelledby="frameworkModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark-card">
            <div class="modal-header">
                <h5 class="modal-title" id="frameworkModalLabel">Strategic Frameworks</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Framework</th>
                                <th>Description</th>
                                <th>Best For</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for framework_id, framework in frameworks.items() %}
                            <tr>
                                <td><strong>{{ framework.name }}</strong></td>
                                <td>{{ framework.description }}</td>
                                <td>
                                    {% if framework_id == 'porters' %}
                                    Industry competition analysis
                                    {% elif framework_id == 'swot' %}
                                    Internal/external evaluation
                                    {% elif framework_id == 'bcg' %}
                                    Product portfolio analysis
                                    {% elif framework_id == 'mckinsey' %}
                                    Portfolio ranking
                                    {% elif framework_id == 'blue_ocean' %}
                                    Market differentiation
                                    {% else %}
                                    Strategic planning
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Monetization Modal -->
<div class="modal fade" id="monetizationModal" tabindex="-1" aria-labelledby="monetizationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark-card">
            <div class="modal-header">
                <h5 class="modal-title" id="monetizationModalLabel">Monetization Strategies</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Strategy</th>
                                <th>Description</th>
                                <th>Potential</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if monetization_strategies is mapping %}
                                {% for strategy_id, strategy in monetization_strategies.items() %}
                                <tr>
                                    <td><strong>{{ strategy.name }}</strong></td>
                                    <td>{{ strategy.short_description }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="progress flex-grow-1 me-2" style="height: 6px;">
                                                <div class="progress-bar 
                                                    {% if strategy.default_potential >= 75 %}bg-success
                                                    {% elif strategy.default_potential >= 50 %}bg-info
                                                    {% else %}bg-warning{% endif %}" 
                                                    role="progressbar" 
                                                    style="width: {{ strategy.default_potential }}%" 
                                                    aria-valuenow="{{ strategy.default_potential }}" 
                                                    aria-valuemin="0" 
                                                    aria-valuemax="100">
                                                </div>
                                            </div>
                                            <span class="text-nowrap">{{ strategy.default_potential }}%</span>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="3" class="text-center">
                                        <div class="alert alert-warning mb-0">
                                            <i class="fas fa-exclamation-triangle"></i> 
                                            Monetization strategies data is not in the expected format. Please try refreshing.
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Framework Analysis 
        const frameworkSelect = document.getElementById('frameworkSelect');
        const frameworkFormFields = document.getElementById('frameworkFormFields');
        const analyzeFrameworkBtn = document.getElementById('analyzeFrameworkBtn');
        const frameworkResults = document.getElementById('frameworkResults');
        const frameworkLoading = document.getElementById('frameworkLoading');
        
        // Monetization Analysis
        const analyzeMonetizationBtn = document.getElementById('analyzeMonetizationBtn');
        const monetizationResults = document.getElementById('monetizationResults');
        const monetizationLoading = document.getElementById('monetizationLoading');
        
        // Strategic Plan
        const generatePlanBtn = document.getElementById('generatePlanBtn');
        const planResults = document.getElementById('planResults');
        const planLoading = document.getElementById('planLoading');
        const planError = document.getElementById('planError');
        
        // Add framework-specific fields
        if (frameworkSelect) {
            frameworkSelect.addEventListener('change', function() {
                const framework = frameworkSelect.value;
                
                // Clear previous fields
                frameworkFormFields.innerHTML = '';
                
                // Add framework-specific fields
                if (framework === 'porters') {
                    frameworkFormFields.innerHTML = `
                        <div class="alert alert-info mb-3">
                            <i class="fas fa-info-circle"></i> 
                            Rate each of Porter's Five Forces on a scale of 1-10 (1 = very low, 10 = very high)
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6 col-lg-4">
                                <label class="form-label">Supplier Power</label>
                                <input type="range" class="form-range" min="1" max="10" value="5" id="supplierPower">
                                <div class="d-flex justify-content-between">
                                    <small>Low</small>
                                    <small>High</small>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-4">
                                <label class="form-label">Buyer Power</label>
                                <input type="range" class="form-range" min="1" max="10" value="5" id="buyerPower">
                                <div class="d-flex justify-content-between">
                                    <small>Low</small>
                                    <small>High</small>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-4">
                                <label class="form-label">Competitive Rivalry</label>
                                <input type="range" class="form-range" min="1" max="10" value="5" id="competitiveRivalry">
                                <div class="d-flex justify-content-between">
                                    <small>Low</small>
                                    <small>High</small>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-4">
                                <label class="form-label">Threat of Substitution</label>
                                <input type="range" class="form-range" min="1" max="10" value="5" id="threatSubstitution">
                                <div class="d-flex justify-content-between">
                                    <small>Low</small>
                                    <small>High</small>
                                </div>
                            </div>
                            <div class="col-md-6 col-lg-4">
                                <label class="form-label">Threat of New Entry</label>
                                <input type="range" class="form-range" min="1" max="10" value="5" id="threatNewEntry">
                                <div class="d-flex justify-content-between">
                                    <small>Low</small>
                                    <small>High</small>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (framework === 'swot') {
                    frameworkFormFields.innerHTML = `
                        <div class="alert alert-info mb-3">
                            <i class="fas fa-info-circle"></i> 
                            Enter at least one item for each SWOT quadrant
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Strengths</label>
                                <textarea class="form-control bg-darker" id="swotStrengths" rows="3" placeholder="Enter business strengths"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Weaknesses</label>
                                <textarea class="form-control bg-darker" id="swotWeaknesses" rows="3" placeholder="Enter business weaknesses"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Opportunities</label>
                                <textarea class="form-control bg-darker" id="swotOpportunities" rows="3" placeholder="Enter business opportunities"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Threats</label>
                                <textarea class="form-control bg-darker" id="swotThreats" rows="3" placeholder="Enter business threats"></textarea>
                            </div>
                        </div>
                    `;
                } else if (framework === 'bcg') {
                    frameworkFormFields.innerHTML = `
                        <div class="alert alert-info mb-3">
                            <i class="fas fa-info-circle"></i> 
                            Enter up to 4 products or business units for BCG Matrix analysis
                        </div>
                        <div id="bcgProducts">
                            <div class="row g-3 mb-3">
                                <div class="col-md-4">
                                    <label class="form-label">Product/Business Unit Name</label>
                                    <input type="text" class="form-control bg-darker" placeholder="Product name">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Market Growth Rate (1-10)</label>
                                    <input type="range" class="form-range" min="1" max="10" value="5">
                                    <div class="d-flex justify-content-between">
                                        <small>Low</small>
                                        <small>High</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Relative Market Share (1-10)</label>
                                    <input type="range" class="form-range" min="1" max="10" value="5">
                                    <div class="d-flex justify-content-between">
                                        <small>Low</small>
                                        <small>High</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-secondary" id="addBcgProduct">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    `;
                    
                    // Add product button functionality
                    document.getElementById('addBcgProduct').addEventListener('click', function() {
                        const productsContainer = document.getElementById('bcgProducts');
                        const productCount = productsContainer.children.length;
                        
                        if (productCount < 4) {
                            const newProduct = document.createElement('div');
                            newProduct.className = 'row g-3 mb-3';
                            newProduct.innerHTML = `
                                <div class="col-md-4">
                                    <label class="form-label">Product/Business Unit Name</label>
                                    <input type="text" class="form-control bg-darker" placeholder="Product name">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Market Growth Rate (1-10)</label>
                                    <input type="range" class="form-range" min="1" max="10" value="5">
                                    <div class="d-flex justify-content-between">
                                        <small>Low</small>
                                        <small>High</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Relative Market Share (1-10)</label>
                                    <input type="range" class="form-range" min="1" max="10" value="5">
                                    <div class="d-flex justify-content-between">
                                        <small>Low</small>
                                        <small>High</small>
                                    </div>
                                </div>
                            `;
                            productsContainer.appendChild(newProduct);
                        }
                        
                        if (productsContainer.children.length >= 4) {
                            this.disabled = true;
                        }
                    });
                } else {
                    // Generic fields for other frameworks
                    frameworkFormFields.innerHTML = `
                        <div class="mb-3">
                            <label class="form-label">Business Description</label>
                            <textarea class="form-control bg-darker" id="frameworkDescription" rows="3" placeholder="Describe your business and current strategic challenges"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Strategic Goals</label>
                            <textarea class="form-control bg-darker" id="frameworkGoals" rows="2" placeholder="What are your main strategic goals?"></textarea>
                        </div>
                    `;
                }
            });
            
            // Trigger change to populate initial framework fields
            frameworkSelect.dispatchEvent(new Event('change'));
        }
        
        // Framework Analysis Handler
        if (analyzeFrameworkBtn) {
            analyzeFrameworkBtn.addEventListener('click', function() {
                const framework = frameworkSelect.value;
                const companyName = document.getElementById('analysisCompanyName').value || 'Sample Company';
                const industry = document.getElementById('analysisIndustry').value || 'Technology';
                
                // Show loading indicator
                frameworkLoading.style.display = 'block';
                frameworkResults.style.display = 'none';
                
                // Prepare data based on selected framework
                let data = {
                    framework_id: framework,
                    company_name: companyName,
                    industry: industry,
                    data: {}
                };
                
                if (framework === 'porters') {
                    data.data = {
                        supplier_power: parseInt(document.getElementById('supplierPower').value),
                        buyer_power: parseInt(document.getElementById('buyerPower').value),
                        competitive_rivalry: parseInt(document.getElementById('competitiveRivalry').value),
                        threat_substitution: parseInt(document.getElementById('threatSubstitution').value),
                        threat_new_entry: parseInt(document.getElementById('threatNewEntry').value)
                    };
                } else if (framework === 'swot') {
                    data.data = {
                        strengths: document.getElementById('swotStrengths').value.split('\n'),
                        weaknesses: document.getElementById('swotWeaknesses').value.split('\n'),
                        opportunities: document.getElementById('swotOpportunities').value.split('\n'),
                        threats: document.getElementById('swotThreats').value.split('\n')
                    };
                } else if (framework === 'bcg') {
                    // Extract BCG product data
                    const productRows = document.querySelectorAll('#bcgProducts .row');
                    const products = [];
                    
                    productRows.forEach(row => {
                        const inputs = row.querySelectorAll('input');
                        if (inputs[0].value.trim()) {
                            products.push({
                                name: inputs[0].value,
                                growth_rate: parseInt(inputs[1].value),
                                market_share: parseInt(inputs[2].value)
                            });
                        }
                    });
                    
                    data.data.products = products;
                } else {
                    // Generic data for other frameworks
                    data.data = {
                        description: document.getElementById('frameworkDescription')?.value || '',
                        goals: document.getElementById('frameworkGoals')?.value || ''
                    };
                }
                
                // Make API request
                fetch('/api/strategy/framework-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                    // Hide loading indicator
                    frameworkLoading.style.display = 'none';
                    
                    // Show results
                    frameworkResults.innerHTML = generateFrameworkResultsHTML(result, framework);
                    frameworkResults.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                    frameworkLoading.style.display = 'none';
                    frameworkResults.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> 
                            Error performing analysis: ${error.message || 'Unknown error'}
                        </div>
                    `;
                    frameworkResults.style.display = 'block';
                });
            });
        }
        
        // Monetization Analysis Handler
        if (analyzeMonetizationBtn) {
            analyzeMonetizationBtn.addEventListener('click', function() {
                const companyName = document.getElementById('monetizationCompanyName').value || 'Sample Company';
                const documentText = document.getElementById('monetizationDocumentText').value || '';
                
                // Show loading indicator
                monetizationLoading.style.display = 'block';
                monetizationResults.style.display = 'none';
                
                // Make API request
                fetch('/api/strategy/monetization', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        company_name: companyName,
                        document_text: documentText
                    })
                })
                .then(response => response.json())
                .then(result => {
                    // Hide loading indicator
                    monetizationLoading.style.display = 'none';
                    
                    if (result.success) {
                        // Show results
                        monetizationResults.innerHTML = generateMonetizationResultsHTML(result.opportunities, companyName);
                        monetizationResults.style.display = 'block';
                    } else {
                        monetizationResults.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle"></i> 
                                Error analyzing monetization opportunities: ${result.error || 'Unknown error'}
                            </div>
                        `;
                        monetizationResults.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    monetizationLoading.style.display = 'none';
                    monetizationResults.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> 
                            Error analyzing monetization opportunities: ${error.message || 'Unknown error'}
                        </div>
                    `;
                    monetizationResults.style.display = 'block';
                });
            });
        }
        
        // Strategic Plan Generator Handler
        if (generatePlanBtn) {
            generatePlanBtn.addEventListener('click', function() {
                const companyName = document.getElementById('companyName').value || 'Sample Company';
                const industry = document.getElementById('industrySelect').value;
                const documentText = document.getElementById('documentText').value || '';
                
                // Show loading indicator
                planLoading.style.display = 'block';
                planResults.style.display = 'none';
                planError.style.display = 'none';
                
                // Make API request
                fetch('/api/strategy/strategic-plan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        company_name: companyName,
                        industry: industry,
                        document_text: documentText
                    })
                })
                .then(response => response.json())
                .then(result => {
                    // Hide loading indicator
                    planLoading.style.display = 'none';
                    
                    if (result.success) {
                        // Update company name in results
                        document.getElementById('resultCompanyName').textContent = companyName;
                        
                        // Update plan summary
                        document.getElementById('planSummary').textContent = result.plan.summary;
                        
                        // Update recommended strategies
                        const recommendedStrategiesEl = document.getElementById('recommendedStrategies');
                        recommendedStrategiesEl.innerHTML = '';
                        
                        result.plan.recommended_strategies.forEach(strategy => {
                            const li = document.createElement('li');
                            li.className = 'list-group-item bg-darker border-0';
                            li.innerHTML = `
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        <span class="badge bg-success rounded-pill">${strategy.priority}</span>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">${strategy.name}</h6>
                                        <small class="text-muted">${strategy.description}</small>
                                    </div>
                                </div>
                            `;
                            recommendedStrategiesEl.appendChild(li);
                        });
                        
                        // Update implementation steps
                        const implementationStepsEl = document.getElementById('implementationSteps');
                        implementationStepsEl.innerHTML = '';
                        
                        result.plan.implementation_steps.forEach((step, index) => {
                            const li = document.createElement('li');
                            li.className = 'list-group-item bg-darker border-0';
                            li.innerHTML = `
                                <div class="d-flex">
                                    <div class="me-3">
                                        <span class="badge bg-primary rounded-circle">${index + 1}</span>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">${step.name}</h6>
                                        <small class="text-muted">${step.description}</small>
                                        <div><small class="text-success">Timeframe: ${step.timeframe}</small></div>
                                    </div>
                                </div>
                            `;
                            implementationStepsEl.appendChild(li);
                        });
                        
                        // Show results
                        planResults.style.display = 'block';
                    } else {
                        // Show error
                        document.getElementById('errorMessage').textContent = result.error || 'Failed to generate strategic plan';
                        planError.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    planLoading.style.display = 'none';
                    document.getElementById('errorMessage').textContent = error.message || 'Failed to generate strategic plan';
                    planError.style.display = 'block';
                });
            });
        }
        
        // Helper function to generate framework results HTML
        function generateFrameworkResultsHTML(result, framework) {
            if (!result || !result.analysis) {
                return `<div class="alert alert-warning">No analysis data available</div>`;
            }
            
            let html = `
                <h5 class="mb-3">${result.title || 'Framework Analysis'}</h5>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> 
                    ${result.summary || 'Analysis complete'}
                </div>
            `;
            
            if (framework === 'porters') {
                // Porter's Five Forces analysis visualization
                html += `
                    <div class="card bg-darker mb-3">
                        <div class="card-header">
                            <h6 class="card-title mb-0">Porter's Five Forces Analysis</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <canvas id="portersRadarChart" width="400" height="300"></canvas>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush">
                `;
                
                const forces = result.analysis.forces || {};
                
                for (const [force, value] of Object.entries(forces)) {
                    const forceLabel = force
                        .replace(/_/g, ' ')
                        .replace(/\b\w/g, l => l.toUpperCase());
                    
                    let badgeClass = 'bg-success';
                    if (value.score > 7) {
                        badgeClass = 'bg-danger';
                    } else if (value.score > 4) {
                        badgeClass = 'bg-warning';
                    }
                    
                    html += `
                        <li class="list-group-item bg-darker border-0 d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${forceLabel}</strong>
                                <p class="small text-muted mb-0">${value.description || ''}</p>
                            </div>
                            <span class="badge ${badgeClass} rounded-pill">${value.score}/10</span>
                        </li>
                    `;
                }
                
                html += `
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card bg-darker">
                        <div class="card-header">
                            <h6 class="card-title mb-0">Strategic Recommendations</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                `;
                
                const recommendations = result.recommendations || [];
                
                recommendations.forEach(rec => {
                    html += `
                        <li class="list-group-item bg-darker border-0">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            ${rec}
                        </li>
                    `;
                });
                
                html += `
                            </ul>
                        </div>
                    </div>
                    
                    <script>
                        // Create Porter's Five Forces radar chart
                        document.addEventListener('DOMContentLoaded', function() {
                            const ctx = document.getElementById('portersRadarChart');
                            const forces = ${JSON.stringify(forces)};
                            
                            const data = {
                                labels: Object.keys(forces).map(force => 
                                    force.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())
                                ),
                                datasets: [{
                                    label: 'Force Strength',
                                    data: Object.values(forces).map(force => force.score),
                                    fill: true,
                                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                    borderColor: 'rgb(54, 162, 235)',
                                    pointBackgroundColor: 'rgb(54, 162, 235)',
                                    pointBorderColor: '#fff',
                                    pointHoverBackgroundColor: '#fff',
                                    pointHoverBorderColor: 'rgb(54, 162, 235)'
                                }]
                            };
                            
                            new Chart(ctx, {
                                type: 'radar',
                                data: data,
                                options: {
                                    elements: {
                                        line: {
                                            borderWidth: 3
                                        }
                                    },
                                    scales: {
                                        r: {
                                            angleLines: {
                                                display: true
                                            },
                                            suggestedMin: 0,
                                            suggestedMax: 10
                                        }
                                    }
                                }
                            });
                        });
                    </script>
                `;
            } else if (framework === 'swot') {
                // SWOT analysis visualization
                const swot = result.analysis.swot || {};
                
                html += `
                    <div class="card bg-darker mb-3">
                        <div class="card-header">
                            <h6 class="card-title mb-0">SWOT Analysis</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="row g-0">
                                <div class="col-md-6 p-3 border-end border-bottom">
                                    <h6 class="text-success">Strengths</h6>
                                    <ul class="list-unstyled mb-0">
                `;
                
                (swot.strengths || []).forEach(strength => {
                    html += `<li><i class="fas fa-plus-circle text-success me-2"></i>${strength}</li>`;
                });
                
                html += `
                                    </ul>
                                </div>
                                <div class="col-md-6 p-3 border-bottom">
                                    <h6 class="text-danger">Weaknesses</h6>
                                    <ul class="list-unstyled mb-0">
                `;
                
                (swot.weaknesses || []).forEach(weakness => {
                    html += `<li><i class="fas fa-minus-circle text-danger me-2"></i>${weakness}</li>`;
                });
                
                html += `
                                    </ul>
                                </div>
                                <div class="col-md-6 p-3 border-end">
                                    <h6 class="text-info">Opportunities</h6>
                                    <ul class="list-unstyled mb-0">
                `;
                
                (swot.opportunities || []).forEach(opportunity => {
                    html += `<li><i class="fas fa-lightbulb text-info me-2"></i>${opportunity}</li>`;
                });
                
                html += `
                                    </ul>
                                </div>
                                <div class="col-md-6 p-3">
                                    <h6 class="text-warning">Threats</h6>
                                    <ul class="list-unstyled mb-0">
                `;
                
                (swot.threats || []).forEach(threat => {
                    html += `<li><i class="fas fa-exclamation-triangle text-warning me-2"></i>${threat}</li>`;
                });
                
                html += `
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card bg-darker">
                        <div class="card-header">
                            <h6 class="card-title mb-0">Strategy Matrix</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-bordered mb-0">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Strengths</th>
                                            <th>Weaknesses</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th>Opportunities</th>
                                            <td>
                                                <h6>SO Strategies</h6>
                                                <ul class="mb-0">
                `;
                
                (result.strategies?.so || []).forEach(strategy => {
                    html += `<li>${strategy}</li>`;
                });
                
                html += `
                                                </ul>
                                            </td>
                                            <td>
                                                <h6>WO Strategies</h6>
                                                <ul class="mb-0">
                `;
                
                (result.strategies?.wo || []).forEach(strategy => {
                    html += `<li>${strategy}</li>`;
                });
                
                html += `
                                                </ul>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Threats</th>
                                            <td>
                                                <h6>ST Strategies</h6>
                                                <ul class="mb-0">
                `;
                
                (result.strategies?.st || []).forEach(strategy => {
                    html += `<li>${strategy}</li>`;
                });
                
                html += `
                                                </ul>
                                            </td>
                                            <td>
                                                <h6>WT Strategies</h6>
                                                <ul class="mb-0">
                `;
                
                (result.strategies?.wt || []).forEach(strategy => {
                    html += `<li>${strategy}</li>`;
                });
                
                html += `
                                                </ul>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Generic result display for other frameworks
                html += `
                    <div class="card bg-darker mb-3">
                        <div class="card-header">
                            <h6 class="card-title mb-0">Analysis Results</h6>
                        </div>
                        <div class="card-body">
                            <p>${result.analysis.description || 'No detailed analysis available'}</p>
                        </div>
                    </div>
                    
                    <div class="card bg-darker">
                        <div class="card-header">
                            <h6 class="card-title mb-0">Strategic Recommendations</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                `;
                
                const recommendations = result.recommendations || [];
                
                recommendations.forEach(rec => {
                    html += `
                        <li class="list-group-item bg-darker border-0">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            ${rec}
                        </li>
                    `;
                });
                
                html += `
                            </ul>
                        </div>
                    </div>
                `;
            }
            
            return html;
        }
        
        // Helper function to generate monetization results HTML
        function generateMonetizationResultsHTML(opportunities, companyName) {
            if (!opportunities) {
                return `<div class="alert alert-warning">No monetization data available</div>`;
            }
            
            let html = `
                <h5 class="mb-3">Monetization Analysis for ${companyName}</h5>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> 
                    ${opportunities.summary || 'Analysis complete. Below are the monetization opportunities identified.'}
                </div>
                
                <div class="card bg-darker mb-3">
                    <div class="card-header">
                        <h6 class="card-title mb-0">Opportunity Scores</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <canvas id="monetizationChart" width="400" height="300"></canvas>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-group list-group-flush">
            `;
            
            const categories = opportunities.categories || {};
            
            for (const [categoryId, category] of Object.entries(categories)) {
                let badgeClass = 'bg-success';
                if (category.score < 40) {
                    badgeClass = 'bg-danger';
                } else if (category.score < 70) {
                    badgeClass = 'bg-warning';
                }
                
                html += `
                    <li class="list-group-item bg-darker border-0 d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${category.name}</strong>
                            <p class="small text-muted mb-0">${category.description || ''}</p>
                        </div>
                        <span class="badge ${badgeClass} rounded-pill">${category.score}/100</span>
                    </li>
                `;
            }
            
            html += `
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card bg-darker">
                    <div class="card-header">
                        <h6 class="card-title mb-0">Top Recommendations</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
            `;
            
            const recommendations = opportunities.recommendations || [];
            
            recommendations.forEach(rec => {
                html += `
                    <li class="list-group-item bg-darker border-0">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-lightbulb text-warning fa-lg"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">${rec.title}</h6>
                                <p class="mb-1">${rec.description}</p>
                                <div>
                                    <span class="badge ${rec.priority === 'High' ? 'bg-danger' : rec.priority === 'Medium' ? 'bg-warning' : 'bg-info'}">
                                        ${rec.priority} Priority
                                    </span>
                                    <span class="badge bg-secondary ms-1">ROI: ${rec.roi}</span>
                                </div>
                            </div>
                        </div>
                    </li>
                `;
            });
            
            html += `
                        </ul>
                    </div>
                </div>
                
                <script>
                    // Create monetization opportunities chart
                    document.addEventListener('DOMContentLoaded', function() {
                        const ctx = document.getElementById('monetizationChart');
                        const categories = ${JSON.stringify(categories)};
                        
                        const data = {
                            labels: Object.values(categories).map(category => category.name),
                            datasets: [{
                                label: 'Opportunity Score',
                                data: Object.values(categories).map(category => category.score),
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.5)',
                                    'rgba(54, 162, 235, 0.5)',
                                    'rgba(255, 206, 86, 0.5)',
                                    'rgba(75, 192, 192, 0.5)',
                                    'rgba(153, 102, 255, 0.5)',
                                    'rgba(255, 159, 64, 0.5)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 1
                            }]
                        };
                        
                        new Chart(ctx, {
                            type: 'bar',
                            data: data,
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 100
                                    }
                                }
                            }
                        });
                    });
                </script>
            `;
            
            return html;
        }
    });
</script>
{% endblock %}