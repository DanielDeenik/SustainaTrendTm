{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}Dashboard - SustainaTrend™{% endblock %}

{% block header_title %}Sustainability Dashboard{% endblock %}

{% block header_actions %}
<span class="finchat-badge finchat-badge-primary">Real-time</span>
{% endblock %}

{% block additional_styles %}
<style>
    /* Common Components */
    .metric-summary {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-lg);
    }
    
    .metric-card {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        transition: all 0.2s;
    }
    
    .metric-card:hover {
        border-color: var(--fc-primary);
        box-shadow: var(--fc-shadow);
    }
    
    .metric-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--fc-spacing-sm);
    }
    
    .metric-title {
        font-size: 0.85rem;
        color: var(--fc-text-secondary);
        font-weight: 500;
    }
    
    .metric-value {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: var(--fc-spacing-xs);
    }
    
    .metric-change {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.8rem;
    }
    
    .market-chart {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: var(--fc-spacing-md);
        margin-bottom: var(--fc-spacing-lg);
    }
    
    .market-chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--fc-spacing-md);
    }
    
    .market-chart-title {
        font-size: 0.95rem;
        font-weight: 600;
    }
    
    .chart-controls {
        display: flex;
        gap: var(--fc-spacing-xs);
    }
    
    .chart-period {
        background-color: var(--fc-bg-hover);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: 2px 8px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .chart-period.active {
        background-color: rgba(var(--primary-rgb), 0.15);
        color: var(--fc-primary);
        border-color: var(--fc-primary);
    }
    
    .chart-container {
        height: 280px;
        position: relative;
    }
    
    .positions-table {
        margin-top: var(--fc-spacing-lg);
    }
    
    .position-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 6px;
    }
    
    .position-indicator.positive {
        background-color: var(--fc-positive);
    }
    
    .position-indicator.negative {
        background-color: var(--fc-negative);
    }
    
    .position-sector {
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
    }
    
    .company-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .company-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--fc-bg-hover);
        border-radius: 4px;
        color: var(--fc-text-secondary);
    }
    
    .two-col-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: var(--fc-spacing-lg);
    }
    
    @media (max-width: 1200px) {
        .two-col-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .news-item {
        display: flex;
        gap: var(--fc-spacing-md);
        padding: var(--fc-spacing-md);
        border-bottom: 1px solid var(--fc-border);
    }
    
    .news-item:last-child {
        border-bottom: none;
    }
    
    .news-source {
        background-color: var(--fc-bg-hover);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.7rem;
        color: var(--fc-text-secondary);
    }
    
    .news-meta {
        display: flex;
        justify-content: space-between;
        margin-top: 4px;
    }
    
    .news-time {
        font-size: 0.75rem;
        color: var(--fc-text-secondary);
    }
    
    .esg-score {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .esg-letter {
        font-weight: 700;
        font-size: 1.1rem;
    }
    
    .esg-letter.a {
        color: #26de81;
    }
    
    .esg-letter.b {
        color: #45aaf2;
    }
    
    .esg-letter.c {
        color: #fed330;
    }
    
    .esg-letter.d {
        color: #fc5c65;
    }
    
    .progress-bar {
        height: 4px;
        background-color: var(--fc-bg-hover);
        border-radius: 2px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background-color: var(--fc-primary);
    }
    
    /* Trend Analysis Styles */
    .trend-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--fc-spacing-md);
    }
    
    .trend-card {
        background-color: var(--fc-bg-card);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        overflow: hidden;
        transition: all 0.2s;
    }
    
    .trend-card:hover {
        border-color: var(--fc-primary);
        box-shadow: var(--fc-shadow);
    }
    
    .trend-card-header {
        background-color: var(--fc-bg-tertiary);
        padding: var(--fc-spacing-sm) var(--fc-spacing-md);
        border-bottom: 1px solid var(--fc-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .trend-category {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--fc-primary);
    }
    
    .trend-virality {
        background-color: var(--fc-primary-light);
        color: var(--fc-primary);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .trend-card-content {
        padding: var(--fc-spacing-md);
    }
    
    .trend-title {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: var(--fc-spacing-xs);
    }
    
    .trend-description {
        color: var(--fc-text-secondary);
        font-size: 0.85rem;
        margin-bottom: var(--fc-spacing-md);
    }
    
    .trend-metrics {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--fc-spacing-md);
        border-bottom: 1px solid var(--fc-border);
        padding-bottom: var(--fc-spacing-md);
    }
    
    .trend-metric {
        text-align: center;
    }
    
    .trend-metric-title {
        font-size: 0.75rem;
        color: var(--fc-text-secondary);
        margin-bottom: 4px;
    }
    
    .trend-metric-value {
        font-size: 0.95rem;
        font-weight: 600;
    }
    
    .trend-impact {
        background-color: var(--fc-bg-tertiary);
        padding: var(--fc-spacing-sm);
        border-radius: var(--fc-radius);
        font-size: 0.85rem;
        margin-bottom: var(--fc-spacing-md);
    }
    
    .trend-sources-title {
        font-size: 0.75rem;
        color: var(--fc-text-secondary);
        margin-bottom: 4px;
    }
    
    .trend-sources-list {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
    }
    
    .trend-source {
        background-color: var(--fc-bg-hover);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.7rem;
    }
    
    /* Real Estate Dashboard Components */
    .certification-progress {
        margin-top: var(--fc-spacing-xs);
    }
    
    .certification-header {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        margin-bottom: 4px;
    }
    
    .recommendation-item {
        display: flex;
        gap: var(--fc-spacing-md);
        padding: var(--fc-spacing-md);
        border-bottom: 1px solid var(--fc-border);
    }
    
    .recommendation-item:last-child {
        border-bottom: none;
    }
    
    .recommendation-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .recommendation-icon.green {
        background-color: rgba(38, 222, 129, 0.15);
        color: #26de81;
    }
    
    .recommendation-icon.blue {
        background-color: rgba(52, 195, 255, 0.15);
        color: #34c3ff;
    }
    
    .recommendation-icon.purple {
        background-color: rgba(143, 113, 255, 0.15);
        color: #8f71ff;
    }
    
    .recommendation-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 4px;
    }
    
    .recommendation-description {
        font-size: 0.85rem;
        color: var(--fc-text-secondary);
        margin-bottom: 8px;
    }
    
    .recommendation-metrics {
        display: flex;
        gap: var(--fc-spacing-md);
    }
    
    .recommendation-metric {
        font-size: 0.75rem;
        color: var(--fc-text-muted);
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    /* API Status Components */
    .status-badge {
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .status-badge.online {
        background-color: rgba(38, 222, 129, 0.15);
        color: #26de81;
    }
    
    .status-badge.degraded {
        background-color: rgba(255, 173, 99, 0.15);
        color: #ffad63;
    }
    
    .status-badge.offline {
        background-color: rgba(252, 92, 101, 0.15);
        color: #fc5c65;
    }
    
    /* Debug Information Components */
    .debug-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: var(--fc-spacing-md);
    }
    
    .debug-info-item {
        padding: var(--fc-spacing-sm);
        background-color: var(--fc-bg-tertiary);
        border-radius: var(--fc-radius);
    }
    
    .debug-info-label {
        font-size: 0.75rem;
        color: var(--fc-text-secondary);
        margin-bottom: 4px;
    }
    
    .debug-info-value {
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .route-list {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .route-item {
        padding: var(--fc-spacing-sm);
        background-color: var(--fc-bg-tertiary);
        border-radius: var(--fc-radius);
        font-family: monospace;
        font-size: 0.85rem;
    }
    
    /* Select and Form Elements */
    .finchat-select {
        background-color: var(--fc-bg-tertiary);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        color: var(--fc-text-primary);
        padding: 6px 10px;
        font-size: 0.85rem;
        min-width: 150px;
    }
    
    .finchat-select:focus {
        outline: none;
        border-color: var(--fc-primary);
    }
</style>
{% endblock %}

{% block main_content %}
{% if template_type == "trends" %}
<!-- Trend Analysis Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-chart-line"></i> Sustainability Trend Analysis
    </div>
    
    <!-- Filter Controls -->
    <div class="finchat-card" style="margin-bottom: var(--fc-spacing-md);">
        <div class="finchat-card-body" style="padding: var(--fc-spacing-md);">
            <div style="display: flex; gap: var(--fc-spacing-md); flex-wrap: wrap; align-items: center;">
                <div>
                    <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Category</label>
                    <select class="finchat-select" id="categoryFilter">
                        <option value="all" {% if category == 'all' %}selected{% endif %}>All Categories</option>
                        <option value="climate" {% if category == 'climate' %}selected{% endif %}>Climate Action</option>
                        <option value="resource" {% if category == 'resource' %}selected{% endif %}>Resource Efficiency</option>
                        <option value="governance" {% if category == 'governance' %}selected{% endif %}>ESG Governance</option>
                        <option value="finance" {% if category == 'finance' %}selected{% endif %}>Sustainable Finance</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Sort By</label>
                    <select class="finchat-select" id="sortFilter">
                        <option value="virality" {% if sort == 'virality' %}selected{% endif %}>Virality Score</option>
                        <option value="mentions" {% if sort == 'mentions' %}selected{% endif %}>Mentions</option>
                        <option value="sentiment" {% if sort == 'sentiment' %}selected{% endif %}>Sentiment</option>
                        <option value="recent" {% if sort == 'recent' %}selected{% endif %}>Most Recent</option>
                    </select>
                </div>
                <div style="margin-top: 24px;">
                    <button class="finchat-button" id="applyFilters">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Trend Grid -->
    <div class="trend-grid">
        {% for trend in trends %}
        <div class="trend-card">
            <div class="trend-card-header">
                <div class="trend-category">{{ trend.category_display }}</div>
                <div class="trend-virality">
                    <i class="fas fa-bolt"></i> {{ trend.virality_score }}
                </div>
            </div>
            <div class="trend-card-content">
                <div class="trend-title">{{ trend.name }}</div>
                <div class="trend-description">{{ trend.description }}</div>
                <div class="trend-metrics">
                    <div class="trend-metric">
                        <div class="trend-metric-title">Sentiment</div>
                        <div class="trend-metric-value">{{ "%.2f"|format(trend.sentiment) }}</div>
                    </div>
                    <div class="trend-metric">
                        <div class="trend-metric-title">Mentions</div>
                        <div class="trend-metric-value">{{ trend.mentions }}</div>
                    </div>
                    <div class="trend-metric">
                        <div class="trend-metric-title">Momentum</div>
                        <div class="trend-metric-value">{{ trend.momentum }}</div>
                    </div>
                </div>
                <div class="trend-impact">{{ trend.impact_statement }}</div>
                <div class="trend-sources">
                    <div class="trend-sources-title">Sources</div>
                    <div class="trend-sources-list">
                        {% for source in trend.sources %}
                        <span class="trend-source">{{ source }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if template_type == "realestate" %}
<!-- Real Estate Sustainability Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-building"></i> Real Estate Sustainability Intelligence
    </div>
    
    <!-- Property Metrics Summary -->
    <div class="metric-summary">
        {% for metric in metrics[:4] %}
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">{{ metric.name }}</div>
                <i class="fas {% if 'Energy' in metric.category %}fa-bolt{% elif 'Water' in metric.category %}fa-tint{% elif 'Waste' in metric.category %}fa-trash{% elif 'Building' in metric.category %}fa-building{% elif 'Tenant' in metric.category %}fa-users{% else %}fa-leaf{% endif %}"></i>
            </div>
            <div class="metric-value">{{ metric.value }}{{ metric.unit }}</div>
            <div class="metric-change {% if metric.change_type == 'positive' %}finchat-value-positive{% else %}finchat-value-negative{% endif %}">
                <i class="fas {% if metric.change_type == 'positive' %}fa-arrow-{% if 'Carbon' in metric.category or 'Water' in metric.category or 'Waste' in metric.category %}down{% else %}up{% endif %}{% else %}fa-arrow-{% if 'Carbon' in metric.category or 'Water' in metric.category or 'Waste' in metric.category %}up{% else %}down{% endif %}{% endif %}"></i> 
                {% if metric.change_type == 'positive' %}
                    {% if 'Carbon' in metric.category or 'Water' in metric.category or 'Waste' in metric.category %}-{% else %}+{% endif %}
                {% else %}
                    {% if 'Carbon' in metric.category or 'Water' in metric.category or 'Waste' in metric.category %}+{% else %}-{% endif %}
                {% endif %}
                {{ metric.change|abs }}%
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Main Charts Area -->
    <div class="two-col-grid">
        <div>
            <!-- Energy Performance Chart -->
            <div class="market-chart">
                <div class="market-chart-header">
                    <div class="market-chart-title">Energy Performance Trend</div>
                    <div class="chart-controls">
                        <button class="chart-period">1M</button>
                        <button class="chart-period active">3M</button>
                        <button class="chart-period">6M</button>
                        <button class="chart-period">1Y</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="energyPerformanceChart"></canvas>
                </div>
            </div>
            
            <!-- Property Comparison Table -->
            <div class="finchat-card">
                <div class="finchat-card-header">
                    <h3 class="finchat-card-title">Property Portfolio Performance</h3>
                </div>
                <div class="finchat-card-body">
                    <table class="finchat-table">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th>Energy Rating</th>
                                <th>Water Usage</th>
                                <th>Waste Diversion</th>
                                <th>Tenant Satisfaction</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Green Tower</td>
                                <td class="finchat-value-positive">A+</td>
                                <td class="finchat-value-positive">Low</td>
                                <td>75%</td>
                                <td>4.8/5</td>
                            </tr>
                            <tr>
                                <td>Blue Heights</td>
                                <td>B</td>
                                <td>Medium</td>
                                <td>68%</td>
                                <td>4.2/5</td>
                            </tr>
                            <tr>
                                <td>Parkside Offices</td>
                                <td class="finchat-value-negative">C</td>
                                <td class="finchat-value-negative">High</td>
                                <td>42%</td>
                                <td>3.9/5</td>
                            </tr>
                            <tr>
                                <td>Riverside Complex</td>
                                <td>B+</td>
                                <td>Medium-Low</td>
                                <td>72%</td>
                                <td>4.5/5</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div>
            <!-- Certifications Overview -->
            <div class="finchat-card">
                <div class="finchat-card-header">
                    <h3 class="finchat-card-title">Green Building Certifications</h3>
                </div>
                <div class="finchat-card-body">
                    <div class="certification-progress">
                        <div class="certification-header">
                            <span>LEED Certification</span>
                            <span>75%</span>
                        </div>
                        <div class="progress-bar" style="margin-bottom: 12px;">
                            <div class="progress-fill" style="width: 75%;"></div>
                        </div>
                        
                        <div class="certification-header">
                            <span>BREEAM Excellent</span>
                            <span>60%</span>
                        </div>
                        <div class="progress-bar" style="margin-bottom: 12px;">
                            <div class="progress-fill" style="width: 60%;"></div>
                        </div>
                        
                        <div class="certification-header">
                            <span>Energy Star</span>
                            <span>90%</span>
                        </div>
                        <div class="progress-bar" style="margin-bottom: 12px;">
                            <div class="progress-fill" style="width: 90%;"></div>
                        </div>
                        
                        <div class="certification-header">
                            <span>WELL Building Standard</span>
                            <span>45%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 45%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sustainability Recommendations -->
            <div class="finchat-card">
                <div class="finchat-card-header">
                    <h3 class="finchat-card-title">Improvement Recommendations</h3>
                </div>
                <div class="finchat-card-body" style="padding: 0;">
                    <div class="recommendation-item">
                        <div class="recommendation-icon green">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">LED Lighting Retrofit</div>
                            <div class="recommendation-description">Replace all common area lighting with LED fixtures to reduce energy consumption by up to 60%.</div>
                            <div class="recommendation-metrics">
                                <span class="recommendation-metric">
                                    <i class="fas fa-dollar-sign"></i> Cost: Medium
                                </span>
                                <span class="recommendation-metric">
                                    <i class="fas fa-chart-line"></i> ROI: 24 months
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendation-item">
                        <div class="recommendation-icon blue">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">Water Conservation System</div>
                            <div class="recommendation-description">Install low-flow fixtures and smart irrigation to reduce water consumption by up to 40%.</div>
                            <div class="recommendation-metrics">
                                <span class="recommendation-metric">
                                    <i class="fas fa-dollar-sign"></i> Cost: Low-Medium
                                </span>
                                <span class="recommendation-metric">
                                    <i class="fas fa-chart-line"></i> ROI: 18 months
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendation-item">
                        <div class="recommendation-icon purple">
                            <i class="fas fa-temperature-low"></i>
                        </div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">HVAC Optimization</div>
                            <div class="recommendation-description">Implement smart HVAC controls and zoning to reduce energy use while improving tenant comfort.</div>
                            <div class="recommendation-metrics">
                                <span class="recommendation-metric">
                                    <i class="fas fa-dollar-sign"></i> Cost: High
                                </span>
                                <span class="recommendation-metric">
                                    <i class="fas fa-chart-line"></i> ROI: 36 months
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endif %}

{% if template_type == "api-status" %}
<!-- API Status Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-server"></i> API Status Dashboard
    </div>
    
    <!-- API Status Overview -->
    <div class="metric-summary">
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">Available APIs</div>
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="metric-value">{{ api_status.available_count }}</div>
            <div class="metric-change finchat-value-positive">
                <i class="fas fa-arrow-up"></i> {{ api_status.available_percentage }}%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">Response Time</div>
                <i class="fas fa-tachometer-alt"></i>
            </div>
            <div class="metric-value">{{ api_status.avg_response_time }}ms</div>
            <div class="metric-change {% if api_status.response_time_trend < 0 %}finchat-value-positive{% else %}finchat-value-negative{% endif %}">
                <i class="fas {% if api_status.response_time_trend < 0 %}fa-arrow-down{% else %}fa-arrow-up{% endif %}"></i> {{ api_status.response_time_trend|abs }}%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">Error Rate</div>
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="metric-value">{{ api_status.error_rate }}%</div>
            <div class="metric-change {% if api_status.error_rate_trend < 0 %}finchat-value-positive{% else %}finchat-value-negative{% endif %}">
                <i class="fas {% if api_status.error_rate_trend < 0 %}fa-arrow-down{% else %}fa-arrow-up{% endif %}"></i> {{ api_status.error_rate_trend|abs }}%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">Total Requests</div>
                <i class="fas fa-exchange-alt"></i>
            </div>
            <div class="metric-value">{{ api_status.total_requests }}</div>
            <div class="metric-change finchat-value-positive">
                <i class="fas fa-arrow-up"></i> {{ api_status.request_trend }}%
            </div>
        </div>
    </div>
    
    <!-- API Service Status Table -->
    <div class="finchat-card">
        <div class="finchat-card-header">
            <h3 class="finchat-card-title">API Service Status</h3>
        </div>
        <div class="finchat-card-body">
            <table class="finchat-table">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Status</th>
                        <th>Response Time</th>
                        <th>Uptime</th>
                        <th>Last Updated</th>
                    </tr>
                </thead>
                <tbody>
                    {% for service in api_status.services %}
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i class="fas {{ service.icon }}"></i>
                                <div>{{ service.name }}</div>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge {{ service.status_class }}">
                                {{ service.status }}
                            </span>
                        </td>
                        <td>{{ service.response_time }}</td>
                        <td>{{ service.uptime }}</td>
                        <td>{{ service.last_checked }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endif %}

{% if template_type == "debug" %}
<!-- Debug Information Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-bug"></i> Debug Information
    </div>
    
    <!-- System Information -->
    <div class="finchat-card">
        <div class="finchat-card-header">
            <h3 class="finchat-card-title">System Information</h3>
        </div>
        <div class="finchat-card-body">
            <div class="debug-info-grid">
                <div class="debug-info-item">
                    <div class="debug-info-label">Python Version</div>
                    <div class="debug-info-value">{{ python_version|default('Not available') }}</div>
                </div>
                <div class="debug-info-item">
                    <div class="debug-info-label">Flask Version</div>
                    <div class="debug-info-value">{{ flask_version|default('Not available') }}</div>
                </div>
                <div class="debug-info-item">
                    <div class="debug-info-label">Environment</div>
                    <div class="debug-info-value">{{ environment|default('Development') }}</div>
                </div>
                <div class="debug-info-item">
                    <div class="debug-info-label">Debug Mode</div>
                    <div class="debug-info-value">{{ 'Enabled' if debug_mode|default(True) else 'Disabled' }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Available Routes -->
    <div class="finchat-card">
        <div class="finchat-card-header">
            <h3 class="finchat-card-title">Available Routes</h3>
        </div>
        <div class="finchat-card-body">
            <div class="route-list">
                {% for route in app_routes %}
                <div class="route-item">
                    <div class="route-name">{{ route }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% else %}
<!-- Default Dashboard (Top Metrics Summary) -->
<div class="finchat-section">
    <div class="metric-summary">
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">Carbon Intensity</div>
                <i class="fas fa-leaf"></i>
            </div>
            <div class="metric-value">12.4</div>
            <div class="metric-change finchat-value-positive">
                <i class="fas fa-arrow-down"></i> -15.3%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">ESG Score</div>
                <i class="fas fa-chart-bar"></i>
            </div>
            <div class="metric-value">73.8</div>
            <div class="metric-change finchat-value-positive">
                <i class="fas fa-arrow-up"></i> +2.5%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">Renewable Energy</div>
                <i class="fas fa-solar-panel"></i>
            </div>
            <div class="metric-value">38%</div>
            <div class="metric-change finchat-value-positive">
                <i class="fas fa-arrow-up"></i> +8%
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">Water Intensity</div>
                <i class="fas fa-tint"></i>
            </div>
            <div class="metric-value">2.3</div>
            <div class="metric-change finchat-value-positive">
                <i class="fas fa-arrow-down"></i> -12.2%
            </div>
        </div>
    </div>
</div>

{% endif %}


{% if template_type == "home" %}
<!-- Home Page Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-tachometer-alt"></i> SustainaTrend™ Intelligence Platform
    </div>
    
    <!-- KPI Summary Dashboard -->
    <div class="finchat-card">
        <div class="finchat-card-header">
            <h3 class="finchat-card-title">Sustainability Performance Overview</h3>
            <span class="finchat-badge finchat-badge-primary">Real-time</span>
        </div>
        <div class="finchat-card-body">
            <!-- Metrics Summary -->
            <div class="metric-summary">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Carbon Emissions</div>
                        <i class="fas fa-smog"></i>
                    </div>
                    <div class="metric-value">12.4t</div>
                    <div class="metric-change finchat-value-positive">
                        <i class="fas fa-arrow-down"></i> -3.7%
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">ESG Score</div>
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="metric-value">73.8</div>
                    <div class="metric-change finchat-value-positive">
                        <i class="fas fa-arrow-up"></i> +2.5%
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Renewable Energy</div>
                        <i class="fas fa-solar-panel"></i>
                    </div>
                    <div class="metric-value">38%</div>
                    <div class="metric-change finchat-value-positive">
                        <i class="fas fa-arrow-up"></i> +8%
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-title">Water Intensity</div>
                        <i class="fas fa-tint"></i>
                    </div>
                    <div class="metric-value">2.3</div>
                    <div class="metric-change finchat-value-positive">
                        <i class="fas fa-arrow-down"></i> -12.2%
                    </div>
                </div>
            </div>
            
            <!-- Main Chart -->
            <div class="market-chart">
                <div class="market-chart-header">
                    <div class="market-chart-title">Sustainability Performance Trend</div>
                    <div class="chart-controls">
                        <div class="chart-period" data-period="1w">1W</div>
                        <div class="chart-period active" data-period="1m">1M</div>
                        <div class="chart-period" data-period="3m">3M</div>
                        <div class="chart-period" data-period="1y">1Y</div>
                    </div>
                </div>
                <div class="chart-container" id="performanceChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Key Sections Grid -->
    <div class="finchat-section-title" style="margin-top: var(--fc-spacing-lg);">
        <i class="fas fa-sitemap"></i> Platform Features
    </div>
    <div class="finchat-grid" style="margin-top: var(--fc-spacing-md);">
        <div class="finchat-grid-item">
            <div class="finchat-card">
                <div class="finchat-card-body" style="text-align: center;">
                    <i class="fas fa-chart-line" style="font-size: 2rem; color: var(--fc-primary); margin-bottom: var(--fc-spacing-sm);"></i>
                    <h3 style="margin-bottom: var(--fc-spacing-xs);">Trend Analysis</h3>
                    <p style="margin-bottom: var(--fc-spacing-sm);">Live data with AI insights and dynamic KPI dashboards</p>
                    <a href="/trend-analysis" class="finchat-button">Explore Trends</a>
                </div>
            </div>
        </div>
        <div class="finchat-grid-item">
            <div class="finchat-card">
                <div class="finchat-card-body" style="text-align: center;">
                    <i class="fas fa-lightbulb" style="font-size: 2rem; color: var(--fc-primary); margin-bottom: var(--fc-spacing-sm);"></i>
                    <h3 style="margin-bottom: var(--fc-spacing-xs);">Strategy Hub</h3>
                    <p style="margin-bottom: var(--fc-spacing-sm);">AI-powered strategic storytelling and frameworks</p>
                    <a href="/strategy-hub" class="finchat-button">View Strategies</a>
                </div>
            </div>
        </div>
        <div class="finchat-grid-item">
            <div class="finchat-card">
                <div class="finchat-card-body" style="text-align: center;">
                    <i class="fas fa-file-alt" style="font-size: 2rem; color: var(--fc-primary); margin-bottom: var(--fc-spacing-sm);"></i>
                    <h3 style="margin-bottom: var(--fc-spacing-xs);">Documents</h3>
                    <p style="margin-bottom: var(--fc-spacing-sm);">Regulatory AI document analysis and compliance</p>
                    <a href="/documents/document-hub" class="finchat-button">Go to Documents</a>
                </div>
            </div>
        </div>
        <div class="finchat-grid-item">
            <div class="finchat-card">
                <div class="finchat-card-body" style="text-align: center;">
                    <i class="fas fa-search" style="font-size: 2rem; color: var(--fc-primary); margin-bottom: var(--fc-spacing-sm);"></i>
                    <h3 style="margin-bottom: var(--fc-spacing-xs);">Search</h3>
                    <p style="margin-bottom: var(--fc-spacing-sm);">Semantic ESG intelligence engine</p>
                    <a href="/search" class="finchat-button">Start Searching</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- System Status -->
    <div class="finchat-card" style="margin-top: var(--fc-spacing-lg);">
        <div class="finchat-card-header">
            <h3 class="finchat-card-title">System Status</h3>
        </div>
        <div class="finchat-card-body">
            <div class="debug-info-grid">
                {% for service, status in api_status.items() %}
                <div class="debug-info-item">
                    <div class="debug-info-label">{{ service }}</div>
                    <div class="debug-info-value {% if status %}status-ok{% else %}status-error{% endif %}">
                        {% if status %}
                        <i class="fas fa-check-circle"></i> Online
                        {% else %}
                        <i class="fas fa-exclamation-triangle"></i> Offline
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endif %}{% if template_type == "dashboard" %}
<!-- Main Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-chart-pie"></i> Sustainability Intelligence Dashboard
    </div>
    
    <!-- Metrics Summary -->
    <div class="metric-summary">
        {% for metric in metrics[:4] %}
        <div class="metric-card">
            <div class="metric-header">
                <div class="metric-title">{{ metric.name }}</div>
                <i class="fas fa-circle-info" title="{{ metric.description }}"></i>
            </div>
            <div class="metric-value">{{ metric.value }}</div>
            <div class="metric-change {% if metric.change > 0 %}positive{% else %}negative{% endif %}">
                <i class="fas {% if metric.change > 0 %}fa-arrow-up{% else %}fa-arrow-down{% endif %}"></i>
                {{ metric.change }}%
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Main Chart -->
    <div class="market-chart">
        <div class="market-chart-header">
            <div class="market-chart-title">Sustainability Performance Trend</div>
            <div class="chart-controls">
                <div class="chart-period" data-period="1w">1W</div>
                <div class="chart-period active" data-period="1m">1M</div>
                <div class="chart-period" data-period="3m">3M</div>
                <div class="chart-period" data-period="1y">1Y</div>
                <div class="chart-period" data-period="all">All</div>
            </div>
        </div>
        <div class="chart-container" id="performanceChart"></div>
    </div>
    
    <!-- Two-column layout -->
    <div class="two-col-grid">
        <!-- Left column: Top categories -->
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h3 class="finchat-card-title">Top Sustainability Categories</h3>
            </div>
            <div class="finchat-card-body">
                <div class="positions-table">
                    <table class="finchat-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Score</th>
                                <th>Change</th>
                                <th>Rating</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for metric in metrics[4:10] %}
                            <tr>
                                <td>
                                    <div class="company-info">
                                        <div class="company-icon">
                                            <i class="fas fa-leaf"></i>
                                        </div>
                                        <div>
                                            {{ metric.name }}
                                            <div class="position-sector">{{ metric.category }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ metric.value }}</td>
                                <td class="{% if metric.change > 0 %}positive{% else %}negative{% endif %}">
                                    <i class="fas {% if metric.change > 0 %}fa-arrow-up{% else %}fa-arrow-down{% endif %}"></i>
                                    {{ metric.change }}%
                                </td>
                                <td>
                                    <div class="esg-score">
                                        <div class="esg-letter {{ metric.rating|lower }}">{{ metric.rating }}</div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Right column: Recent updates -->
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h3 class="finchat-card-title">Recent Updates</h3>
            </div>
            <div class="finchat-card-body">
                {% for i in range(3) %}
                <div class="news-item">
                    <div>
                        <div>
                            <span class="news-source">Update</span>
                        </div>
                        <div style="font-weight: 500; margin: 4px 0;">
                            {{ metrics[i].name }} has {{ 'increased' if metrics[i].change > 0 else 'decreased' }} by {{ metrics[i].change }}%
                        </div>
                        <div class="news-meta">
                            <div class="news-time">{{ metrics[i].timestamp }}</div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endif %}

{% if template_type == "monetization" %}
<!-- Monetization Strategies Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-coins"></i> Monetization Strategies Framework
    </div>
    
    <div class="finchat-card">
        <div class="finchat-card-header">
            <h3 class="finchat-card-title">Revenue Opportunities</h3>
        </div>
        <div class="finchat-card-body">
            <div class="recommendation-item">
                <div class="recommendation-icon green">
                    <i class="fas fa-database"></i>
                </div>
                <div>
                    <div class="recommendation-title">ESG Data Subscription</div>
                    <div class="recommendation-description">Subscription-based access to premium ESG data and metrics with tiered pricing model.</div>
                    <div class="recommendation-metrics">
                        <div class="recommendation-metric">
                            <i class="fas fa-calendar"></i> 3-6 months
                        </div>
                        <div class="recommendation-metric">
                            <i class="fas fa-chart-line"></i> 25-35% ROI
                        </div>
                        <div class="recommendation-metric">
                            <i class="fas fa-signal"></i> High Potential
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="recommendation-item">
                <div class="recommendation-icon blue">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div>
                    <div class="recommendation-title">Sustainability Reporting as a Service</div>
                    <div class="recommendation-description">Automated generation of compliance-ready sustainability reports for regulatory frameworks.</div>
                    <div class="recommendation-metrics">
                        <div class="recommendation-metric">
                            <i class="fas fa-calendar"></i> 6-12 months
                        </div>
                        <div class="recommendation-metric">
                            <i class="fas fa-chart-line"></i> 20-30% ROI
                        </div>
                        <div class="recommendation-metric">
                            <i class="fas fa-signal"></i> Medium-High Potential
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="recommendation-item">
                <div class="recommendation-icon purple">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <div class="recommendation-title">AI-Powered ESG Consulting</div>
                    <div class="recommendation-description">Premium consulting services backed by AI analytics for sustainability strategy development.</div>
                    <div class="recommendation-metrics">
                        <div class="recommendation-metric">
                            <i class="fas fa-calendar"></i> Immediate
                        </div>
                        <div class="recommendation-metric">
                            <i class="fas fa-chart-line"></i> 40-50% ROI
                        </div>
                        <div class="recommendation-metric">
                            <i class="fas fa-signal"></i> High Potential
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="finchat-card" style="margin-top: var(--fc-spacing-md);">
        <div class="finchat-card-header">
            <h3 class="finchat-card-title">Implementation Roadmap</h3>
        </div>
        <div class="finchat-card-body">
            <div class="finchat-tabs">
                <div class="finchat-tabs-header">
                    <div class="finchat-tab active" data-tab="immediate">Immediate (0-3m)</div>
                    <div class="finchat-tab" data-tab="short">Short-Term (3-6m)</div>
                    <div class="finchat-tab" data-tab="medium">Medium-Term (6-12m)</div>
                </div>
                <div class="finchat-tabs-body">
                    <div class="finchat-tab-content active" id="immediate">
                        <ul class="finchat-list">
                            <li>Launch AI-powered consulting services with current platform capabilities</li>
                            <li>Implement freemium model for basic ESG data access</li>
                            <li>Develop premium feature marketing strategy</li>
                            <li>Create pricing tiers and subscription framework</li>
                        </ul>
                    </div>
                    <div class="finchat-tab-content" id="short">
                        <ul class="finchat-list">
                            <li>Develop data subscription API and access controls</li>
                            <li>Implement billing and subscription management system</li>
                            <li>Create premium dashboard experiences</li>
                            <li>Launch beta for sustainability reporting service</li>
                        </ul>
                    </div>
                    <div class="finchat-tab-content" id="medium">
                        <ul class="finchat-list">
                            <li>Fully automate sustainability reporting for all major frameworks</li>
                            <li>Implement customization options for enterprise clients</li>
                            <li>Launch partner ecosystem with revenue sharing model</li>
                            <li>Develop white-label platform offerings</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endif %}

{% if template_type == "stories" %}
<!-- Story Cards Dashboard -->
<div class="finchat-section">
    <div class="finchat-section-title">
        <i class="fas fa-book-open"></i> Sustainability Story Cards
    </div>
    
    <div class="finchat-card" style="margin-bottom: var(--fc-spacing-md);">
        <div class="finchat-card-body" style="padding: var(--fc-spacing-md);">
            <div style="display: flex; gap: var(--fc-spacing-md); flex-wrap: wrap; align-items: center;">
                <div>
                    <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Category</label>
                    <select class="finchat-select" id="storyFilter">
                        <option value="all">All Categories</option>
                        <option value="climate">Climate Action</option>
                        <option value="resource">Resource Efficiency</option>
                        <option value="social">Social Impact</option>
                        <option value="governance">ESG Governance</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--fc-text-secondary);">Sort By</label>
                    <select class="finchat-select" id="storySortFilter">
                        <option value="recent">Most Recent</option>
                        <option value="relevance">Relevance</option>
                        <option value="impact">Impact Score</option>
                    </select>
                </div>
                <div style="margin-top: 24px;">
                    <button class="finchat-button" id="applyStoryFilters">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="finchat-grid">
        {% for story in stories %}
        <div class="finchat-grid-item">
            <div class="finchat-card story-card">
                <div class="finchat-card-header" style="background-color: rgba(var(--primary-rgb), 0.1);">
                    <h3 class="finchat-card-title">{{ story.title }}</h3>
                </div>
                <div class="finchat-card-body">
                    <div class="story-meta" style="display: flex; gap: var(--fc-spacing-xs); margin-bottom: var(--fc-spacing-xs);">
                        <span class="finchat-badge">{{ story.category }}</span>
                        <span class="finchat-badge finchat-badge-secondary">Impact: {{ story.impact_score }}/10</span>
                    </div>
                    
                    <p style="margin-bottom: var(--fc-spacing-md); color: var(--fc-text-secondary);">{{ story.summary }}</p>
                    
                    <div class="story-metrics" style="margin-bottom: var(--fc-spacing-md); border-bottom: 1px solid var(--fc-border); padding-bottom: var(--fc-spacing-md);">
                        {% for metric in story.key_metrics %}
                        <div class="story-metric">
                            <div class="trend-metric-title">{{ metric.name }}</div>
                            <div class="trend-metric-value">{{ metric.value }} {{ metric.unit }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="story-actions" style="display: flex; justify-content: space-between;">
                        <button class="finchat-button finchat-button-sm">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="finchat-button finchat-button-sm finchat-button-secondary">
                            <i class="fas fa-share"></i> Share
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="two-col-grid">
    <div>
        <!-- Emissions Chart -->
        <div class="market-chart">
            <div class="market-chart-header">
                <div class="market-chart-title">Carbon Emissions Trend</div>
                <div class="chart-controls">
                    <button class="chart-period">1M</button>
                    <button class="chart-period active">3M</button>
                    <button class="chart-period">6M</button>
                    <button class="chart-period">1Y</button>
                    <button class="chart-period">ALL</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="emissionsChart"></canvas>
            </div>
        </div>
        
        <!-- Positions Table -->
        <div class="finchat-card positions-table">
            <div class="finchat-card-header">
                <h3 class="finchat-card-title">Sustainability Investments</h3>
                <span class="finchat-badge">12</span>
            </div>
            <div class="finchat-card-body">
                <table class="finchat-table">
                    <thead>
                        <tr>
                            <th>Asset</th>
                            <th>ESG Rating</th>
                            <th>Value</th>
                            <th>Change</th>
                            <th>P/L</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="company-info">
                                    <span class="position-indicator positive"></span>
                                    <div>
                                        <div>Renewable Energy ETF</div>
                                        <div class="position-sector">Clean Energy</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="esg-score">
                                    <span class="esg-letter a">A</span>
                                    <div class="progress-bar" style="width: 50px;">
                                        <div class="progress-fill" style="width: 90%;"></div>
                                    </div>
                                </div>
                            </td>
                            <td>$12,375.98</td>
                            <td class="finchat-value-positive">+0.65%</td>
                            <td class="finchat-value-positive">+$787.50</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="company-info">
                                    <span class="position-indicator positive"></span>
                                    <div>
                                        <div>Green Bond Fund</div>
                                        <div class="position-sector">Fixed Income</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="esg-score">
                                    <span class="esg-letter a">A</span>
                                    <div class="progress-bar" style="width: 50px;">
                                        <div class="progress-fill" style="width: 85%;"></div>
                                    </div>
                                </div>
                            </td>
                            <td>$28,542.30</td>
                            <td class="finchat-value-positive">+0.25%</td>
                            <td class="finchat-value-positive">+$532.18</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="company-info">
                                    <span class="position-indicator negative"></span>
                                    <div>
                                        <div>Water Technology Fund</div>
                                        <div class="position-sector">Utilities</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="esg-score">
                                    <span class="esg-letter b">B</span>
                                    <div class="progress-bar" style="width: 50px;">
                                        <div class="progress-fill" style="width: 75%;"></div>
                                    </div>
                                </div>
                            </td>
                            <td>$15,987.45</td>
                            <td class="finchat-value-negative">-0.42%</td>
                            <td class="finchat-value-negative">-$68.23</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="company-info">
                                    <span class="position-indicator positive"></span>
                                    <div>
                                        <div>EV Manufacturers Index</div>
                                        <div class="position-sector">Automotive</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="esg-score">
                                    <span class="esg-letter b">B</span>
                                    <div class="progress-bar" style="width: 50px;">
                                        <div class="progress-fill" style="width: 70%;"></div>
                                    </div>
                                </div>
                            </td>
                            <td>$9,342.87</td>
                            <td class="finchat-value-positive">+1.38%</td>
                            <td class="finchat-value-positive">+$127.34</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div>
        <!-- Sustainability News -->
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h3 class="finchat-card-title">
                    <i class="fas fa-newspaper"></i> Sustainability News
                </h3>
                <button class="finchat-button-icon" title="Refresh">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="finchat-card-body" style="padding: 0;">
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <div>
                        <div>EU adopts more stringent Scope 3 emissions reporting requirements for CSRD</div>
                        <div class="news-meta">
                            <span class="news-source">Regulatory</span>
                            <span class="news-time">2h ago</span>
                        </div>
                    </div>
                </div>
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <div>
                        <div>Water scarcity risks grow for semiconductor industry, investors warn</div>
                        <div class="news-meta">
                            <span class="news-source">Industry</span>
                            <span class="news-time">4h ago</span>
                        </div>
                    </div>
                </div>
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div>
                        <div>ESG-focused funds see record inflows as climate concerns mount</div>
                        <div class="news-meta">
                            <span class="news-source">Finance</span>
                            <span class="news-time">6h ago</span>
                        </div>
                    </div>
                </div>
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-solar-panel"></i>
                    </div>
                    <div>
                        <div>Renewable energy capacity additions outpace fossil fuels for third consecutive year</div>
                        <div class="news-meta">
                            <span class="news-source">Energy</span>
                            <span class="news-time">12h ago</span>
                        </div>
                    </div>
                </div>
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div>
                        <div>Green building certifications become standard in commercial real estate transactions</div>
                        <div class="news-meta">
                            <span class="news-source">Real Estate</span>
                            <span class="news-time">1d ago</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Regulatory Calendar -->
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h3 class="finchat-card-title">
                    <i class="fas fa-calendar-alt"></i> Regulatory Timeline
                </h3>
            </div>
            <div class="finchat-card-body">
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-exclamation"></i>
                    </div>
                    <div>
                        <div>CSRD first reporting deadline</div>
                        <div class="news-meta">
                            <span class="news-source">EU</span>
                            <span class="news-time">January 2025</span>
                        </div>
                    </div>
                </div>
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div>
                        <div>SEC Climate disclosure rules effective</div>
                        <div class="news-meta">
                            <span class="news-source">US</span>
                            <span class="news-time">Q2 2025</span>
                        </div>
                    </div>
                </div>
                <div class="news-item">
                    <div class="company-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div>
                        <div>ISSB Standards implementation deadline</div>
                        <div class="news-meta">
                            <span class="news-source">Global</span>
                            <span class="news-time">January 2026</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block insights_panel %}
<div class="finchat-insights-header">
    <h3>Sustainability Insights</h3>
</div>
<div class="finchat-insights-content">
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Emissions Trend Analysis</h4>
            <p>Your emissions reduction is outpacing industry benchmarks by 6.2%. Key contributors: Renewable energy adoption and facility upgrades.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-balance-scale"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Regulatory Readiness</h4>
            <p>CSRD preparation is at 75% completion, with data collection systems fully implemented. Focus areas: scope 3 emissions and biodiversity impacts.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Water Risk Alert</h4>
            <p>Three manufacturing facilities are in high water stress regions. Consider implementing enhanced water recycling systems.</p>
        </div>
    </div>
    <div class="finchat-insight-item">
        <div class="finchat-insight-icon">
            <i class="fas fa-lightbulb"></i>
        </div>
        <div class="finchat-insight-content">
            <h4>Investment Opportunity</h4>
            <p>Companies with strong biodiversity strategies are showing 12% better stock performance. Consider expanding portfolio in this area.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Configure emissions chart
        const emissionsCtx = document.getElementById('emissionsChart').getContext('2d');
        
        // Chart.js configuration with dark theme
        Chart.defaults.color = '#a0a0a0';
        Chart.defaults.borderColor = '#333333';
        
        const emissionsChart = new Chart(emissionsCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                datasets: [{
                    label: 'Scope 1 & 2 Emissions (tCO2e)',
                    data: [58, 55, 52, 49, 47, 45, 42, 38, 34],
                    borderColor: '#3dd598',
                    backgroundColor: 'rgba(61, 213, 152, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#3dd598',
                    pointBorderColor: '#121212',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#1d1d1d',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff',
                        borderColor: '#333333',
                        borderWidth: 1,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return `${context.parsed.y} tCO2e`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: false,
                        grid: {
                            color: 'rgba(51, 51, 51, 0.5)',
                            drawBorder: false
                        },
                        ticks: {
                            callback: function(value) {
                                return value;
                            }
                        }
                    }
                }
            }
        });
        
        // Chart period toggles
        const chartPeriods = document.querySelectorAll('.chart-period');
        chartPeriods.forEach(period => {
            period.addEventListener('click', function() {
                chartPeriods.forEach(p => p.classList.remove('active'));
                this.classList.add('active');
                
                // Update chart data based on selected period
                // This would fetch new data in a real implementation
                const periodText = this.textContent;
                let newData;
                
                switch(periodText) {
                    case '1M':
                        newData = [42, 40, 38, 34];
                        break;
                    case '3M':
                        newData = [47, 45, 42, 38, 34];
                        break;
                    case '6M':
                        newData = [52, 49, 47, 45, 42, 38, 34];
                        break;
                    case '1Y':
                        newData = [62, 60, 58, 55, 52, 49, 47, 45, 42, 38, 34];
                        break;
                    case 'ALL':
                        newData = [85, 78, 72, 68, 65, 62, 60, 58, 55, 52, 49, 47, 45, 42, 38, 34];
                        break;
                }
                
                // Update chart data
                emissionsChart.data.datasets[0].data = newData;
                emissionsChart.update();
            });
        });
        
        // AI Chat functionality
        const chatInput = document.getElementById('chatInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const chatMessages = document.getElementById('chatMessages');
        const suggestedPrompts = document.querySelectorAll('.finchat-suggested-prompt');
        
        sendMessageBtn.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        suggestedPrompts.forEach(prompt => {
            prompt.addEventListener('click', function() {
                chatInput.value = this.textContent;
                sendMessage();
            });
        });
        
        function sendMessage() {
            const message = chatInput.value.trim();
            if (message === '') return;
            
            // Add user message
            addUserMessage(message);
            
            // Clear input
            chatInput.value = '';
            
            // Simulate AI response (in a real app, this would be an API call)
            setTimeout(() => {
                let aiResponse = '';
                
                if (message.toLowerCase().includes('esg metrics')) {
                    aiResponse = 'Your ESG metrics are showing strong progress overall. Emissions have decreased 15.3% year-over-year, outpacing your industry benchmark of 9%. Water intensity has improved by 12.2%, and renewable energy usage is up 8%. The main area for improvement is in your supply chain, where Scope 3 emissions reporting is only at 65% coverage.';
                } else if (message.toLowerCase().includes('csrd')) {
                    aiResponse = 'CSRD (Corporate Sustainability Reporting Directive) requires detailed sustainability reporting starting January 2025. Key requirements include:<ul><li>Double materiality assessment</li><li>Detailed emissions reporting (Scope 1, 2, and 3)</li><li>Biodiversity impacts</li><li>Water and circular economy metrics</li><li>Social and governance indicators</li></ul>Your current readiness is at 75%, with data systems implemented but gaps in value chain reporting.';
                } else if (message.toLowerCase().includes('climate')) {
                    aiResponse = 'Based on your emissions data, I can generate a climate narrative focusing on your 15.3% reduction in carbon intensity. This narrative can highlight your renewable energy transition, facility efficiency improvements, and progress toward your 2030 net-zero commitment. Would you like me to prepare this for your sustainability report or investor communications?';
                } else {
                    aiResponse = 'I can help you analyze your sustainability metrics, prepare for reporting requirements, or generate narratives for stakeholders. What specific sustainability topic would you like insights on?';
                }
                
                addAiMessage(aiResponse);
            }, 1000);
        }
        
        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'finchat-chat-message finchat-chat-message-user';
            messageElement.innerHTML = `
                <div class="finchat-chat-bubble">
                    ${message}
                </div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function addAiMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'finchat-chat-message finchat-chat-message-ai';
            messageElement.innerHTML = `
                <div class="finchat-chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="finchat-chat-bubble">
                    ${message}
                </div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    });
</script>
{% endblock %}