{% extends "base.html" %}

{% block title %}Document Upload - Regulatory AI{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Regulatory AI Document Upload</h1>
    
    <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-6 mb-8">
        <h2 class="text-2xl font-semibold mb-4">Upload Sustainability Report</h2>
        
        <form id="document-upload-form" action="/regulatory-ai-refactored/api/file-assessment" method="POST" enctype="multipart/form-data" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="file" class="block text-sm font-medium mb-2">Document File</label>
                    <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-primary transition cursor-pointer" id="dropzone">
                        <input type="file" id="file" name="file" class="hidden" accept=".pdf,.docx,.doc,.txt,.csv,.xlsx">
                        <i class="fas fa-file-upload text-3xl mb-2"></i>
                        <p>Drag and drop a file here, or click to select</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Supported formats: PDF, DOCX, TXT, CSV, XLSX (Max 50MB)</p>
                    </div>
                    <div id="file-preview" class="mt-3 hidden">
                        <div class="flex items-center p-3 bg-gray-100 dark:bg-gray-700 rounded">
                            <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                            <span id="file-name" class="flex-1 truncate"></span>
                            <button type="button" id="remove-file" class="text-gray-500 hover:text-red-500">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="mb-4">
                        <label for="framework" class="block text-sm font-medium mb-2">Regulatory Framework</label>
                        <select id="framework" name="framework" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded">
                            <option value="ESRS">ESRS - European Sustainability Reporting Standards</option>
                            <option value="CSRD">CSRD - Corporate Sustainability Reporting Directive</option>
                            <option value="TCFD">TCFD - Task Force on Climate-related Financial Disclosures</option>
                            <option value="SFDR">SFDR - Sustainable Finance Disclosure Regulation</option>
                            <option value="EU_TAXONOMY">EU Taxonomy</option>
                            <option value="GRI">GRI - Global Reporting Initiative</option>
                            <option value="SASB">SASB - Sustainability Accounting Standards Board</option>
                            <option value="ISSB">ISSB - International Sustainability Standards Board</option>
                            <option value="CDP">CDP - Carbon Disclosure Project</option>
                            <option value="SDG">SDGs - Sustainable Development Goals</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="analysis_type" class="block text-sm font-medium mb-2">Analysis Type</label>
                        <select id="analysis_type" name="analysis_type" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded">
                            <option value="compliance">Compliance Assessment</option>
                            <option value="gap">Gap Analysis</option>
                            <option value="metrics">Metrics Extraction</option>
                            <option value="comprehensive">Comprehensive Analysis</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="company_name" class="block text-sm font-medium mb-2">Company Name (Optional)</label>
                        <input type="text" id="company_name" name="company_name" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded" placeholder="Enter company name">
                    </div>
                    
                    <div class="mb-4">
                        <label for="industry" class="block text-sm font-medium mb-2">Industry Sector (Optional)</label>
                        <select id="industry" name="industry" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded">
                            <option value="">Select industry sector</option>
                            <option value="energy">Energy</option>
                            <option value="materials">Materials</option>
                            <option value="industrials">Industrials</option>
                            <option value="consumer_discretionary">Consumer Discretionary</option>
                            <option value="consumer_staples">Consumer Staples</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="financials">Financials</option>
                            <option value="information_technology">Information Technology</option>
                            <option value="communication_services">Communication Services</option>
                            <option value="utilities">Utilities</option>
                            <option value="real_estate">Real Estate</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="mt-6">
                <button type="submit" id="submit-button" class="px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 transition w-full md:w-auto" disabled>
                    <i class="fas fa-upload mr-2"></i> Upload and Analyze
                </button>
                <div id="loading" class="hidden mt-4">
                    <div class="flex items-center space-x-3">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                        <span>Processing document. This may take a minute...</span>
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-6">
        <h2 class="text-2xl font-semibold mb-4">How It Works</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-center">
                <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-file-upload text-blue-600 dark:text-blue-400 text-xl"></i>
                </div>
                <h3 class="text-lg font-medium mb-2">Upload Document</h3>
                <p class="text-gray-600 dark:text-gray-400">Upload any sustainability report or ESG disclosure document in supported formats.</p>
            </div>
            
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-center">
                <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-robot text-blue-600 dark:text-blue-400 text-xl"></i>
                </div>
                <h3 class="text-lg font-medium mb-2">AI Analysis</h3>
                <p class="text-gray-600 dark:text-gray-400">Our AI system analyzes the document against the selected regulatory framework.</p>
            </div>
            
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 text-center">
                <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-chart-line text-blue-600 dark:text-blue-400 text-xl"></i>
                </div>
                <h3 class="text-lg font-medium mb-2">Get Insights</h3>
                <p class="text-gray-600 dark:text-gray-400">Receive detailed compliance assessment, gap analysis, and recommended actions.</p>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for file upload interaction -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('file');
        const filePreview = document.getElementById('file-preview');
        const fileName = document.getElementById('file-name');
        const removeFile = document.getElementById('remove-file');
        const submitButton = document.getElementById('submit-button');
        const form = document.getElementById('document-upload-form');
        const loading = document.getElementById('loading');
        
        // Handle drag and drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropzone.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropzone.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropzone.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropzone.classList.add('border-blue-500');
        }
        
        function unhighlight() {
            dropzone.classList.remove('border-blue-500');
        }
        
        // Handle file drop
        dropzone.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length) {
                fileInput.files = files;
                updateFilePreview();
            }
        }
        
        // Handle file selection via click
        dropzone.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', updateFilePreview);
        
        function updateFilePreview() {
            if (fileInput.files.length) {
                const file = fileInput.files[0];
                fileName.textContent = file.name;
                filePreview.classList.remove('hidden');
                submitButton.disabled = false;
                
                // Display appropriate icon based on file type
                const fileIcon = filePreview.querySelector('i');
                const extension = file.name.split('.').pop().toLowerCase();
                
                if (extension === 'pdf') {
                    fileIcon.className = 'fas fa-file-pdf text-red-500 mr-2';
                } else if (['doc', 'docx'].includes(extension)) {
                    fileIcon.className = 'fas fa-file-word text-blue-500 mr-2';
                } else if (['xls', 'xlsx'].includes(extension)) {
                    fileIcon.className = 'fas fa-file-excel text-green-500 mr-2';
                } else {
                    fileIcon.className = 'fas fa-file-alt text-gray-500 mr-2';
                }
            } else {
                filePreview.classList.add('hidden');
                submitButton.disabled = true;
            }
        }
        
        // Handle file removal
        removeFile.addEventListener('click', () => {
            fileInput.value = '';
            filePreview.classList.add('hidden');
            submitButton.disabled = true;
        });
        
        // Show loading on form submission
        form.addEventListener('submit', () => {
            loading.classList.remove('hidden');
            submitButton.disabled = true;
        });
    });
</script>
{% endblock %}