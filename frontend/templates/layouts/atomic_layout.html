<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="{% block meta_description %}SustainaTrend™ Intelligence Platform - Advanced sustainability insights and trend analysis{% endblock %}">
  <title>{% block title %}SustainaTrend™ Intelligence Platform{% endblock %}</title>
  
  <!-- Base Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/normalize.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/sustainatrend-design-system.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/atomic-layout.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/atomic-navigation.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/atomic-trend-analysis.css') }}">
  
  <!-- Include any additional CSS and JS files -->
  {% block head_extras %}{% endblock %}
</head>
<body>
  <div class="st-app-container">
    <!-- Quick Navigation -->
    <nav class="st-quick-nav">
      <!-- Will be populated by JavaScript -->
    </nav>
    
    <!-- Sidebar Navigation -->
    <aside class="st-sidebar">
      <div class="st-sidebar__header">
        <a href="/atomic-home" class="st-logo">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 13c.3 4.1-3.2 7.3-7.3 7-3.6-.3-6.3-3.1-6.7-6.7-.4-4.1 2.8-7.6 6.9-7.3 1.1.1 2.1.4 3.1 1"/><path d="m16 6 2 2 4-4"/><path d="M9 17a2 2 0 0 1-2-2v-2h7"/></svg>
          <span>SustainaTrend™</span>
        </a>
        <button class="st-sidebar-toggle">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
        </button>
      </div>
      
      <div class="st-sidebar__content">
        <nav class="st-nav">
          {% if nav_sections %}
            {% for section in nav_sections %}
              <div class="st-nav__section">
                <div class="st-nav__heading">{{ section['title'] }}</div>
                <ul class="st-nav__items">
                  {% if section['items'] %}
                    {% for item in section['items'] %}
                      <li class="st-nav__item">
                        <a href="{{ item['url'] }}" class="st-nav__link {% if active_nav and item['id'] == active_nav %}active{% endif %}">
                          {{ item['icon']|safe }}
                          <span>{{ item['title'] }}</span>
                        </a>
                      </li>
                    {% endfor %}
                  {% endif %}
                </ul>
              </div>
            {% endfor %}
          {% else %}
            <!-- Fallback navigation if navigation context is not provided -->
            <div class="st-nav__section">
              <div class="st-nav__heading">Core</div>
              <ul class="st-nav__items">
                <li class="st-nav__item">
                  <a href="/atomic-home" class="st-nav__link {% block nav_home_active %}{% endblock %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    <span>Home</span>
                  </a>
                </li>
                <li class="st-nav__item">
                  <a href="/trend-analysis-atomic" class="st-nav__link {% block nav_trends_active %}{% endblock %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    <span>Trend Analysis</span>
                  </a>
                </li>
              </ul>
            </div>
          {% endif %}
        </nav>
      </div>
      
      <div class="st-sidebar__footer">
        <button class="st-theme-toggle">
          <svg class="st-theme-icon-light" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/><path d="M12 8V4"/><path d="M12 20v-4"/><path d="M4 12H2"/><path d="M10 2 8.6 3.4"/><path d="m16 6 1.4-1.4"/><path d="M4 20l2-2"/><path d="M18 20l-2-2"/><path d="M16 4l2 2"/><path d="M22 12h-4"/></svg>
          <svg class="st-theme-icon-dark" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
        </button>
        
        <div class="st-user-dropdown">
          <button class="st-user-menu-toggle">
            <div class="st-user-avatar">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </div>
            <span>User</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
          </button>
          
          {% if user_menu %}
          <div class="st-user-dropdown-menu">
            <ul class="st-user-menu-items">
              {% for item in user_menu %}
              <li class="st-user-menu-item">
                <a href="{{ item['url'] }}" class="st-user-menu-link">
                  {{ item['icon']|safe }}
                  <span>{{ item['title'] }}</span>
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
        </div>
      </div>
    </aside>
    
    <!-- Main Content Area -->
    <main class="st-main">
      <!-- Top Bar -->
      <div class="st-topbar">
        <div class="st-topbar__left">
          <div class="st-navigation-controls">
            <button class="st-navigation-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            </button>
            <button class="st-navigation-button">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </button>
          </div>
          
          <nav class="st-breadcrumb" aria-label="Breadcrumb">
            <ol class="st-breadcrumb__items">
              {% block breadcrumbs %}
              <li class="st-breadcrumb__item">
                <a href="/atomic-home" class="st-breadcrumb__link">Home</a>
              </li>
              <li class="st-breadcrumb__item">
                <span class="st-breadcrumb__divider">/</span>
                <span class="st-breadcrumb__text">{% block breadcrumb_current %}Dashboard{% endblock %}</span>
              </li>
              {% endblock %}
            </ol>
          </nav>
        </div>
        
        <div class="st-topbar__center">
          <div class="st-search-container">
            <form class="st-search-form" action="/search" method="GET">
              <div class="st-search-input-wrapper">
                <div class="st-search-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                </div>
                <input type="text" class="st-search-input" name="q" placeholder="Search for sustainability metrics, stories, insights..." aria-label="Search">
                <button type="button" class="st-voice-search-button" aria-label="Search by voice">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>
                </button>
              </div>
            </form>
          </div>
        </div>
        
        <div class="st-topbar__right">
          <div class="st-actions">
            <button class="st-action-button" aria-label="Notifications">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
              <span class="st-notifications-badge">3</span>
            </button>
            <button class="st-action-button" aria-label="Settings">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
            <button class="st-action-button" aria-label="Help">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Page Header -->
      <header class="st-page-header">
        <div>
          <h1 class="st-page-title">{% block page_title %}Dashboard{% endblock %}</h1>
          <p class="st-page-description">{% block page_description %}View your sustainability metrics and analytics{% endblock %}</p>
        </div>
        <div class="st-page-actions">
          {% block page_actions %}{% endblock %}
        </div>
      </header>
      
      <!-- Tabs Navigation -->
      {% block tabs_navigation %}{% endblock %}
      
      <!-- Content Area -->
      <div class="st-content">
        <aside class="st-content__left">
          {% block left_column %}{% endblock %}
        </aside>
        
        <div class="st-content__center">
          {% block center_column %}{% endblock %}
        </div>
        
        <aside class="st-content__right">
          {% block right_column %}{% endblock %}
        </aside>
      </div>
    </main>
  </div>
  
  <!-- Core Scripts -->
  <script src="{{ url_for('static', filename='js/atomic-core.js') }}"></script>
  <script>
    // Additional inline JavaScript if needed
    document.addEventListener('DOMContentLoaded', function() {
      // Theme toggle functionality
      const themeToggle = document.querySelector('.st-theme-toggle');
      const htmlElement = document.documentElement;
      
      // Check for saved theme preference or system preference
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        htmlElement.setAttribute('data-theme', savedTheme);
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        htmlElement.setAttribute('data-theme', 'dark');
      }
      
      // Toggle theme
      themeToggle.addEventListener('click', function() {
        const currentTheme = htmlElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        htmlElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });
      
      // Sidebar toggle functionality
      const sidebarToggle = document.querySelector('.st-sidebar-toggle');
      const appContainer = document.querySelector('.st-app-container');
      
      // Check for saved sidebar state
      const sidebarCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
      if (sidebarCollapsed) {
        appContainer.classList.add('st-sidebar-collapsed');
      }
      
      // Toggle sidebar
      sidebarToggle.addEventListener('click', function() {
        appContainer.classList.toggle('st-sidebar-collapsed');
        localStorage.setItem('sidebar-collapsed', appContainer.classList.contains('st-sidebar-collapsed'));
      });
      
      // User dropdown functionality
      const userMenuToggle = document.querySelector('.st-user-menu-toggle');
      const userDropdownMenu = document.querySelector('.st-user-dropdown-menu');
      
      if (userMenuToggle && userDropdownMenu) {
        userMenuToggle.addEventListener('click', function(event) {
          event.stopPropagation();
          userDropdownMenu.classList.toggle('active');
          
          // Update CSS to show dropdown
          if (userDropdownMenu.classList.contains('active')) {
            userDropdownMenu.style.opacity = '1';
            userDropdownMenu.style.visibility = 'visible';
            userDropdownMenu.style.transform = 'translateY(0)';
          } else {
            userDropdownMenu.style.opacity = '0';
            userDropdownMenu.style.visibility = 'hidden';
            userDropdownMenu.style.transform = 'translateY(-10px)';
          }
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
          if (userDropdownMenu.classList.contains('active') && 
              !userDropdownMenu.contains(event.target) &&
              !userMenuToggle.contains(event.target)) {
            userDropdownMenu.classList.remove('active');
            userDropdownMenu.style.opacity = '0';
            userDropdownMenu.style.visibility = 'hidden';
            userDropdownMenu.style.transform = 'translateY(-10px)';
          }
        });
      }
      
      // Mobile menu toggle
      const mobileMenuButton = document.createElement('button');
      mobileMenuButton.className = 'st-mobile-menu-toggle';
      mobileMenuButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="18" x2="20" y2="18"/></svg>';
      
      const topbar = document.querySelector('.st-topbar');
      topbar.insertBefore(mobileMenuButton, topbar.firstChild);
      
      const sidebar = document.querySelector('.st-sidebar');
      
      mobileMenuButton.addEventListener('click', function() {
        sidebar.classList.toggle('open');
      });
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(event) {
        if (window.innerWidth <= 768 && 
            sidebar.classList.contains('open') && 
            !sidebar.contains(event.target) && 
            !mobileMenuButton.contains(event.target)) {
          sidebar.classList.remove('open');
        }
      });
    });
  </script>
  
  <!-- Additional Scripts -->
  {% block scripts %}{% endblock %}
</body>
</html>