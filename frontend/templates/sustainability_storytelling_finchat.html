{% extends "layouts/finchat_dark_layout.html" %}

{% block title %}Sustainability Storytelling - SustainaTrend™{% endblock %}

{% block header_title %}Sustainability Storytelling{% endblock %}

{% block header_actions %}
<span class="finchat-badge finchat-badge-primary">AI-Powered</span>
{% endblock %}

{% block additional_styles %}
<style>
    .finchat-story-template {
        background-color: var(--fc-bg);
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .finchat-story-template:hover,
    .finchat-story-template.selected {
        border-color: var(--fc-primary);
        background-color: rgba(var(--primary-rgb), 0.05);
        transform: translateY(-2px);
        box-shadow: var(--fc-shadow);
    }
    
    .finchat-story-template.selected {
        border-width: 2px;
    }
    
    .finchat-template-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .finchat-template-title {
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--fc-text);
    }
    
    .finchat-template-icon {
        color: var(--fc-primary);
        font-size: 1.5rem;
    }
    
    .finchat-template-desc {
        color: var(--fc-text-secondary);
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
    
    .finchat-template-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .finchat-template-tag {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 1rem;
        background-color: rgba(var(--primary-rgb), 0.1);
        color: var(--fc-primary);
    }
    
    .finchat-form-section {
        margin-top: 1.5rem;
    }
    
    .finchat-form-field {
        margin-bottom: 1.25rem;
    }
    
    .finchat-form-field label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
    
    .finchat-form-field input[type="text"],
    .finchat-form-field textarea,
    .finchat-form-field select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        background-color: var(--fc-bg);
        font-family: inherit;
        font-size: inherit;
        color: var(--fc-text);
        transition: border-color 0.2s;
    }
    
    .finchat-form-field input[type="text"]:focus,
    .finchat-form-field textarea:focus,
    .finchat-form-field select:focus {
        outline: none;
        border-color: var(--fc-primary);
    }
    
    .finchat-form-field textarea {
        min-height: 120px;
        resize: vertical;
    }
    
    .finchat-form-field select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 1rem;
        padding-right: 2.5rem;
    }
    
    .finchat-form-help {
        font-size: 0.8rem;
        color: var(--fc-text-secondary);
        margin-top: 0.25rem;
    }
    
    .finchat-metrics-selector {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 0.75rem;
        margin-top: 0.5rem;
    }
    
    .finchat-metric-option {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .finchat-metric-option:hover,
    .finchat-metric-option.selected {
        border-color: var(--fc-primary);
        background-color: rgba(var(--primary-rgb), 0.05);
    }
    
    .finchat-metric-option.selected {
        border-width: 2px;
    }
    
    .finchat-metric-checkbox {
        margin-right: 0.5rem;
    }
    
    .finchat-metric-checkbox-hidden {
        position: absolute;
        opacity: 0;
    }
    
    .finchat-metric-label {
        font-size: 0.9rem;
    }
    
    .finchat-result-story {
        padding: 1.5rem;
        border: 1px solid var(--fc-border);
        border-radius: var(--fc-radius);
        background-color: white;
        margin-top: 1.5rem;
    }
    
    .finchat-result-story-header {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--fc-border);
    }
    
    .finchat-result-story-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .finchat-result-story-meta {
        font-size: 0.85rem;
        color: var(--fc-text-secondary);
    }
    
    .finchat-result-story-content {
        font-size: 1rem;
        line-height: 1.6;
    }
    
    .finchat-result-story-content p {
        margin-bottom: 1rem;
    }
    
    .finchat-result-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-top: 1.5rem;
    }
    
    .finchat-story-action {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border-radius: var(--fc-radius);
        font-weight: 500;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .finchat-story-action-primary {
        background-color: var(--fc-primary);
        color: white;
    }
    
    .finchat-story-action-secondary {
        background-color: var(--fc-bg);
        color: var(--fc-text);
        border: 1px solid var(--fc-border);
    }
    
    .finchat-story-action:hover {
        transform: translateY(-2px);
        box-shadow: var(--fc-shadow);
    }
    
    .finchat-story-action-primary:hover {
        background-color: var(--fc-primary-darker);
    }
    
    .finchat-story-action-secondary:hover {
        border-color: var(--fc-primary);
    }
    
    .finchat-tabs {
        display: flex;
        border-bottom: 1px solid var(--fc-border);
        margin-bottom: 1.5rem;
    }
    
    .finchat-tab {
        padding: 0.75rem 1.25rem;
        cursor: pointer;
        font-weight: 500;
        color: var(--fc-text-secondary);
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
    }
    
    .finchat-tab:hover {
        color: var(--fc-text);
    }
    
    .finchat-tab.active {
        color: var(--fc-primary);
        border-bottom-color: var(--fc-primary);
    }
    
    .finchat-tab-content {
        display: none;
    }
    
    .finchat-tab-content.active {
        display: block;
    }
</style>
{% endblock %}

{% block main_content %}
<div class="finchat-section">
    <h2 class="finchat-section-title">
        <i class="fas fa-book-open"></i> Create Sustainability Story
    </h2>
    <p class="finchat-section-desc">Transform your sustainability data into compelling, stakeholder-ready narratives with AI-powered storytelling.</p>
    
    <!-- Template Selection -->
    <div class="finchat-tabs">
        <div class="finchat-tab active" data-tab="templates">Story Templates</div>
        <div class="finchat-tab" data-tab="custom">Custom Story</div>
        <div class="finchat-tab" data-tab="history">Story History</div>
    </div>
    
    <div class="finchat-tab-content active" id="templates-tab">
        <div class="finchat-grid">
            <!-- Template 1: Executive Summary -->
            <div class="finchat-story-template" data-template="executive-summary">
                <div class="finchat-template-header">
                    <div class="finchat-template-title">Executive Summary</div>
                    <div class="finchat-template-icon">
                        <i class="fas fa-briefcase"></i>
                    </div>
                </div>
                <div class="finchat-template-desc">
                    Concise overview of sustainability performance for executives and board members.
                </div>
                <div class="finchat-template-tags">
                    <span class="finchat-template-tag">Board-Ready</span>
                    <span class="finchat-template-tag">KPI-Focused</span>
                    <span class="finchat-template-tag">Strategic</span>
                </div>
            </div>
            
            <!-- Template 2: Investor Relations -->
            <div class="finchat-story-template" data-template="investor-relations">
                <div class="finchat-template-header">
                    <div class="finchat-template-title">Investor Relations</div>
                    <div class="finchat-template-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="finchat-template-desc">
                    ESG performance narrative highlighting financial materiality and long-term value creation.
                </div>
                <div class="finchat-template-tags">
                    <span class="finchat-template-tag">Financial</span>
                    <span class="finchat-template-tag">Value-Driven</span>
                    <span class="finchat-template-tag">Risk-Focused</span>
                </div>
            </div>
            
            <!-- Template 3: Employee Engagement -->
            <div class="finchat-story-template" data-template="employee-engagement">
                <div class="finchat-template-header">
                    <div class="finchat-template-title">Employee Engagement</div>
                    <div class="finchat-template-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
                <div class="finchat-template-desc">
                    Engaging storytelling that connects sustainability initiatives to corporate culture and purpose.
                </div>
                <div class="finchat-template-tags">
                    <span class="finchat-template-tag">Culture</span>
                    <span class="finchat-template-tag">Purpose</span>
                    <span class="finchat-template-tag">Engagement</span>
                </div>
            </div>
            
            <!-- Template 4: Marketing & PR -->
            <div class="finchat-story-template" data-template="marketing-pr">
                <div class="finchat-template-header">
                    <div class="finchat-template-title">Marketing & PR</div>
                    <div class="finchat-template-icon">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                </div>
                <div class="finchat-template-desc">
                    Public-facing narrative highlighting sustainability achievements and commitments.
                </div>
                <div class="finchat-template-tags">
                    <span class="finchat-template-tag">Public</span>
                    <span class="finchat-template-tag">Brand</span>
                    <span class="finchat-template-tag">Campaign</span>
                </div>
            </div>
            
            <!-- Template 5: Regulatory Compliance -->
            <div class="finchat-story-template" data-template="regulatory-compliance">
                <div class="finchat-template-header">
                    <div class="finchat-template-title">Regulatory Compliance</div>
                    <div class="finchat-template-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                </div>
                <div class="finchat-template-desc">
                    Detailed compliance narrative aligned with specific regulatory frameworks (CSRD, SFDR, SEC).
                </div>
                <div class="finchat-template-tags">
                    <span class="finchat-template-tag">Compliance</span>
                    <span class="finchat-template-tag">Regulatory</span>
                    <span class="finchat-template-tag">Disclosure</span>
                </div>
            </div>
            
            <!-- Template 6: Climate Action -->
            <div class="finchat-story-template" data-template="climate-action">
                <div class="finchat-template-header">
                    <div class="finchat-template-title">Climate Action</div>
                    <div class="finchat-template-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                </div>
                <div class="finchat-template-desc">
                    Focused narrative on climate initiatives, emissions reductions, and transition plans.
                </div>
                <div class="finchat-template-tags">
                    <span class="finchat-template-tag">Climate</span>
                    <span class="finchat-template-tag">Net-Zero</span>
                    <span class="finchat-template-tag">Transition</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="finchat-tab-content" id="custom-tab">
        <!-- Custom Story Form -->
        <div class="finchat-form-section">
            <div class="finchat-form-field">
                <label for="storyTitle">Story Title</label>
                <input type="text" id="storyTitle" placeholder="Enter a title for your sustainability story">
            </div>
            
            <div class="finchat-form-field">
                <label for="storyAudience">Primary Audience</label>
                <select id="storyAudience">
                    <option value="">Select an audience</option>
                    <option value="executives">Executive Leadership</option>
                    <option value="investors">Investors & Shareholders</option>
                    <option value="employees">Employees</option>
                    <option value="customers">Customers</option>
                    <option value="regulators">Regulators</option>
                    <option value="general-public">General Public</option>
                </select>
            </div>
            
            <div class="finchat-form-field">
                <label for="storyGoal">Story Goal</label>
                <select id="storyGoal">
                    <option value="">Select primary goal</option>
                    <option value="inform">Inform & Educate</option>
                    <option value="persuade">Persuade & Convince</option>
                    <option value="inspire">Inspire & Motivate</option>
                    <option value="compliance">Demonstrate Compliance</option>
                    <option value="reporting">Formal Reporting</option>
                </select>
            </div>
            
            <div class="finchat-form-field">
                <label for="storyContext">Context & Background</label>
                <textarea id="storyContext" placeholder="Provide background information and context for your sustainability story..."></textarea>
                <div class="finchat-form-help">Include any specific details, challenges, or achievements you want to highlight.</div>
            </div>
            
            <div class="finchat-form-field">
                <label>Key Metrics to Include</label>
                <div class="finchat-metrics-selector">
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric1" class="finchat-metric-checkbox-hidden">
                        <label for="metric1" class="finchat-metric-label">Carbon Emissions</label>
                    </div>
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric2" class="finchat-metric-checkbox-hidden">
                        <label for="metric2" class="finchat-metric-label">Energy Consumption</label>
                    </div>
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric3" class="finchat-metric-checkbox-hidden">
                        <label for="metric3" class="finchat-metric-label">Water Usage</label>
                    </div>
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric4" class="finchat-metric-checkbox-hidden">
                        <label for="metric4" class="finchat-metric-label">Waste Management</label>
                    </div>
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric5" class="finchat-metric-checkbox-hidden">
                        <label for="metric5" class="finchat-metric-label">Diversity & Inclusion</label>
                    </div>
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric6" class="finchat-metric-checkbox-hidden">
                        <label for="metric6" class="finchat-metric-label">Supply Chain</label>
                    </div>
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric7" class="finchat-metric-checkbox-hidden">
                        <label for="metric7" class="finchat-metric-label">ESG Ratings</label>
                    </div>
                    <div class="finchat-metric-option">
                        <input type="checkbox" id="metric8" class="finchat-metric-checkbox-hidden">
                        <label for="metric8" class="finchat-metric-label">Community Impact</label>
                    </div>
                </div>
            </div>
            
            <div class="finchat-form-field">
                <label for="storyStyle">Narrative Style</label>
                <select id="storyStyle">
                    <option value="">Select a style</option>
                    <option value="formal">Formal & Professional</option>
                    <option value="conversational">Conversational & Engaging</option>
                    <option value="inspiring">Inspiring & Motivational</option>
                    <option value="analytical">Analytical & Data-Driven</option>
                    <option value="journalistic">Journalistic & Objective</option>
                </select>
            </div>
            
            <div class="finchat-button-container">
                <button class="finchat-button finchat-button-primary" id="generateCustomStory">
                    <i class="fas fa-magic"></i> Generate Custom Story
                </button>
            </div>
        </div>
    </div>
    
    <div class="finchat-tab-content" id="history-tab">
        <!-- Story History -->
        <div class="finchat-card">
            <div class="finchat-card-header">
                <h3 class="finchat-card-title">Recent Stories</h3>
                <span class="finchat-badge">3</span>
            </div>
            <div class="finchat-card-body">
                <div class="finchat-story-list">
                    <div class="finchat-story-item">
                        <div class="finchat-story-item-header">
                            <div class="finchat-story-item-title">Q1 2024 Climate Progress Update</div>
                            <div class="finchat-story-item-meta">Executive Summary • March 10, 2024</div>
                        </div>
                        <div class="finchat-story-item-actions">
                            <button class="finchat-button-icon" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="finchat-button-icon" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="finchat-button-icon" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="finchat-story-item">
                        <div class="finchat-story-item-header">
                            <div class="finchat-story-item-title">Employee Sustainability Initiative</div>
                            <div class="finchat-story-item-meta">Employee Engagement • February 28, 2024</div>
                        </div>
                        <div class="finchat-story-item-actions">
                            <button class="finchat-button-icon" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="finchat-button-icon" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="finchat-button-icon" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="finchat-story-item">
                        <div class="finchat-story-item-header">
                            <div class="finchat-story-item-title">CSRD Compliance Narrative</div>
                            <div class="finchat-story-item-meta">Regulatory Compliance • February 15, 2024</div>
                        </div>
                        <div class="finchat-story-item-actions">
                            <button class="finchat-button-icon" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="finchat-button-icon" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="finchat-button-icon" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Generated Story Result (Initially Hidden) -->
    <div class="finchat-result-story" id="storyResult" style="display: none;">
        <div class="finchat-result-story-header">
            <h3 class="finchat-result-story-title" id="resultTitle">Our Climate Action Journey: Progress & Commitment</h3>
            <div class="finchat-result-story-meta">
                Generated on March 12, 2025 • Climate Action Template • 2 min read
            </div>
        </div>
        <div class="finchat-result-story-content" id="resultContent">
            <p>In our ongoing commitment to combat climate change, we're pleased to share significant progress in our sustainability journey. Over the past year, our organization has achieved a <strong>15% reduction in absolute carbon emissions</strong> across our global operations, exceeding our annual target of 12%.</p>
            
            <p>This achievement marks an important milestone in our path to net-zero emissions by 2040. Key initiatives driving this progress include:</p>
            
            <ul>
                <li>Expanding renewable energy sourcing to 38% of our total energy consumption, up from 26% last year</li>
                <li>Implementing energy efficiency measures across 75% of our facilities, resulting in a 9.3% decrease in energy intensity</li>
                <li>Electrifying 35% of our vehicle fleet, with plans to reach 60% by 2027</li>
                <li>Engaging with suppliers representing 82% of our Scope 3 emissions to set science-based targets</li>
            </ul>
            
            <p>Looking ahead, we're accelerating investments in climate solutions, with €25 million allocated to renewable energy projects and low-carbon technologies in the coming fiscal year. Our climate strategy continues to be aligned with the Paris Agreement's 1.5°C pathway and has received validation from the Science Based Targets initiative.</p>
            
            <p>"While we're encouraged by our progress, we recognize the urgency of the climate challenge and remain committed to ambitious action," said our Chief Sustainability Officer. "We're focused not only on reducing our own footprint but also on developing products and services that enable our customers to achieve their climate goals."</p>
            
            <p>Our climate initiatives have also yielded significant business benefits, including €4.2 million in energy cost savings and strengthened relationships with sustainability-focused customers and investors.</p>
        </div>
        <div class="finchat-result-actions">
            <button class="finchat-story-action finchat-story-action-primary">
                <i class="fas fa-download"></i> Export as PDF
            </button>
            <button class="finchat-story-action finchat-story-action-primary">
                <i class="fas fa-file-word"></i> Export as DOCX
            </button>
            <button class="finchat-story-action finchat-story-action-secondary">
                <i class="fas fa-edit"></i> Edit Story
            </button>
            <button class="finchat-story-action finchat-story-action-secondary">
                <i class="fas fa-redo"></i> Regenerate
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block insights_panel %}
<div class="finchat-insights-panel">
    <div class="finchat-insights-header">
        <h3>Storytelling Insights</h3>
    </div>
    <div class="finchat-insights-content">
        <div class="finchat-insight-item">
            <div class="finchat-insight-icon">
                <i class="fas fa-bullseye"></i>
            </div>
            <div class="finchat-insight-content">
                <h4>Audience Targeting</h4>
                <p>Different stakeholders need different narratives. Investors focus on risk and financial materiality, while employees connect with purpose and impact.</p>
            </div>
        </div>
        <div class="finchat-insight-item">
            <div class="finchat-insight-icon">
                <i class="fas fa-balance-scale"></i>
            </div>
            <div class="finchat-insight-content">
                <h4>Balancing Data & Narrative</h4>
                <p>Effective sustainability stories combine data-driven credibility with engaging storytelling that connects to your organization's purpose.</p>
            </div>
        </div>
        <div class="finchat-insight-item">
            <div class="finchat-insight-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="finchat-insight-content">
                <h4>Avoiding Greenwashing</h4>
                <p>Maintain credibility by ensuring all claims are supported by data, acknowledging challenges, and focusing on material impacts.</p>
            </div>
        </div>
        <div class="finchat-insight-item">
            <div class="finchat-insight-icon">
                <i class="fas fa-chart-pie"></i>
            </div>
            <div class="finchat-insight-content">
                <h4>Materiality Matters</h4>
                <p>Focus your story on the sustainability issues most relevant to your industry and stakeholders for maximum impact and credibility.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block chat_interface %}
<div class="finchat-chat">
    <div class="finchat-chat-header">
        <div class="finchat-chat-title">
            <i class="fas fa-robot"></i> Storytelling Co-Pilot
        </div>
    </div>
    <div class="finchat-chat-messages" id="chatMessages">
        <div class="finchat-chat-message finchat-chat-message-ai">
            <div class="finchat-chat-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="finchat-chat-bubble">
                <p>Hello! I'm your Storytelling Co-Pilot. I can help you create compelling sustainability narratives for different stakeholders. I can:</p>
                <ul>
                    <li>Suggest audience-specific messaging strategies</li>
                    <li>Help refine your sustainability narrative</li>
                    <li>Offer guidance on balancing data with storytelling</li>
                    <li>Provide feedback on avoiding greenwashing</li>
                </ul>
                <p>What kind of sustainability story would you like to create today?</p>
            </div>
        </div>
    </div>
    <div class="finchat-chat-input">
        <input type="text" class="finchat-chat-input-field" id="chatInput" placeholder="Ask me about sustainability storytelling..." />
        <button class="finchat-chat-send-btn" id="sendMessageBtn">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
    <div class="finchat-chat-suggested-prompts">
        <button class="finchat-suggested-prompt">How do I make my climate story engaging?</button>
        <button class="finchat-suggested-prompt">Tips for investor-focused ESG narratives?</button>
        <button class="finchat-suggested-prompt">How to avoid greenwashing?</button>
    </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching
        const tabs = document.querySelectorAll('.finchat-tab');
        const tabContents = document.querySelectorAll('.finchat-tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                this.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Template selection
        const templates = document.querySelectorAll('.finchat-story-template');
        let selectedTemplate = null;
        
        templates.forEach(template => {
            template.addEventListener('click', function() {
                // Remove selected class from all templates
                templates.forEach(t => t.classList.remove('selected'));
                
                // Add selected class to clicked template
                this.classList.add('selected');
                selectedTemplate = this.getAttribute('data-template');
                
                // Show the result after a short delay to simulate generation
                setTimeout(() => {
                    document.getElementById('storyResult').style.display = 'block';
                    
                    // Scroll to result
                    document.getElementById('storyResult').scrollIntoView({ behavior: 'smooth' });
                    
                    // Add AI message about the generated story
                    addAiMessage(`I've generated a ${this.querySelector('.finchat-template-title').textContent} story based on your sustainability data. This story is optimized for ${getAudienceForTemplate(selectedTemplate)}. You can now download, edit, or regenerate it with different parameters.`);
                }, 1500);
            });
        });
        
        // Metric selection in custom story form
        const metricOptions = document.querySelectorAll('.finchat-metric-option');
        
        metricOptions.forEach(option => {
            option.addEventListener('click', function() {
                const checkbox = this.querySelector('input[type="checkbox"]');
                checkbox.checked = !checkbox.checked;
                this.classList.toggle('selected', checkbox.checked);
            });
        });
        
        // Generate custom story button
        const generateCustomBtn = document.getElementById('generateCustomStory');
        
        generateCustomBtn.addEventListener('click', function() {
            const storyTitle = document.getElementById('storyTitle').value;
            const storyAudience = document.getElementById('storyAudience').value;
            
            // Basic validation
            if (!storyTitle) {
                alert('Please enter a story title');
                return;
            }
            
            if (!storyAudience) {
                alert('Please select a primary audience');
                return;
            }
            
            // Show the result after a short delay to simulate generation
            setTimeout(() => {
                document.getElementById('resultTitle').textContent = storyTitle;
                document.getElementById('storyResult').style.display = 'block';
                
                // Scroll to result
                document.getElementById('storyResult').scrollIntoView({ behavior: 'smooth' });
                
                // Add AI message about the generated story
                addAiMessage(`I've generated your custom sustainability story titled "${storyTitle}". This story is tailored for ${getAudienceLabel(storyAudience)} based on the parameters you provided. You can now download, edit, or regenerate it.`);
            }, 2000);
        });
        
        // Chat functionality
        const chatInput = document.getElementById('chatInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const chatMessages = document.getElementById('chatMessages');
        const suggestedPrompts = document.querySelectorAll('.finchat-suggested-prompt');
        
        sendMessageBtn.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        suggestedPrompts.forEach(prompt => {
            prompt.addEventListener('click', function() {
                chatInput.value = this.textContent;
                sendMessage();
            });
        });
        
        function sendMessage() {
            const message = chatInput.value.trim();
            if (message === '') return;
            
            // Add user message
            addUserMessage(message);
            
            // Clear input
            chatInput.value = '';
            
            // Simulate AI response (in a real app, this would be an API call)
            setTimeout(() => {
                let aiResponse = '';
                
                if (message.toLowerCase().includes('engaging') && message.toLowerCase().includes('climate')) {
                    aiResponse = 'To make your climate story more engaging:<ul><li><strong>Use concrete examples</strong> - Specific projects and their impacts are more compelling than general statements</li><li><strong>Include human stories</strong> - Feature employees or community members directly involved in climate initiatives</li><li><strong>Connect to shared values</strong> - Link climate action to broader values your audience cares about</li><li><strong>Use visual metaphors</strong> - Make abstract concepts like carbon emissions more tangible through comparison</li><li><strong>Show progress over time</strong> - Present your climate journey with clear milestones and achievements</li></ul>';
                } else if (message.toLowerCase().includes('investor') || message.toLowerCase().includes('esg narrative')) {
                    aiResponse = 'For investor-focused ESG narratives:<ul><li><strong>Focus on financial materiality</strong> - Clearly link sustainability performance to business outcomes and risk mitigation</li><li><strong>Use credible metrics</strong> - Include industry-standard ESG metrics and third-party validations</li><li><strong>Address risks directly</strong> - Be transparent about climate and sustainability risks and your mitigation strategies</li><li><strong>Highlight governance</strong> - Detail board oversight and management accountability for ESG issues</li><li><strong>Connect to long-term strategy</strong> - Show how sustainability initiatives support your long-term business strategy</li></ul>';
                } else if (message.toLowerCase().includes('greenwashing')) {
                    aiResponse = 'To avoid greenwashing in your sustainability storytelling:<ul><li><strong>Be specific with claims</strong> - Use precise, quantitative metrics rather than vague statements</li><li><strong>Ensure proportionality</strong> - Make sure the emphasis placed on initiatives is proportional to their actual impact</li><li><strong>Acknowledge challenges</strong> - Be honest about areas where progress has been slower or challenges remain</li><li><strong>Provide context</strong> - Present data with appropriate industry benchmarks and historical trends</li><li><strong>Verify claims</strong> - Include third-party verification or assurance for key claims</li><li><strong>Focus on material issues</strong> - Prioritize reporting on the sustainability issues most relevant to your business and stakeholders</li></ul>';
                } else {
                    aiResponse = 'I\'d be happy to help with your sustainability storytelling. To create impactful narratives, consider your specific audience needs, the balance between data and emotion, and how your story aligns with your organization\'s broader purpose. What specific element of sustainability storytelling would you like guidance on?';
                }
                
                addAiMessage(aiResponse);
            }, 1000);
        }
        
        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'finchat-chat-message finchat-chat-message-user';
            messageElement.innerHTML = `
                <div class="finchat-chat-bubble">
                    ${message}
                </div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function addAiMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'finchat-chat-message finchat-chat-message-ai';
            messageElement.innerHTML = `
                <div class="finchat-chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="finchat-chat-bubble">
                    ${message}
                </div>
            `;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Helper functions
        function getAudienceForTemplate(template) {
            const audienceMap = {
                'executive-summary': 'executive leadership and board members',
                'investor-relations': 'investors and financial stakeholders',
                'employee-engagement': 'employees across your organization',
                'marketing-pr': 'customers and the general public',
                'regulatory-compliance': 'regulators and compliance teams',
                'climate-action': 'climate-focused stakeholders'
            };
            
            return audienceMap[template] || 'your selected audience';
        }
        
        function getAudienceLabel(audienceValue) {
            const audienceMap = {
                'executives': 'executive leadership',
                'investors': 'investors and shareholders',
                'employees': 'employees',
                'customers': 'customers',
                'regulators': 'regulators',
                'general-public': 'the general public'
            };
            
            return audienceMap[audienceValue] || 'your selected audience';
        }
    });
</script>
{% endblock %}