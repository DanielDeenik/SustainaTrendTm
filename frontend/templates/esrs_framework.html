{% extends "base.html" %}

{% block title %}ESRS Framework Compliance{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block styles %}
<style>
    .esrs-category-card {
        border-radius: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
        height: 100%;
        border-left: 4px solid var(--primary-color);
    }
    
    .esrs-category-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }
    
    .esrs-category-E1 { border-left-color: #2ecc71; }  /* Climate Change */
    .esrs-category-E2 { border-left-color: #f39c12; }  /* Pollution */
    .esrs-category-E3 { border-left-color: #3498db; }  /* Water and Marine Resources */
    .esrs-category-E4 { border-left-color: #27ae60; }  /* Biodiversity and Ecosystems */
    .esrs-category-E5 { border-left-color: #16a085; }  /* Resource Use and Circular Economy */
    .esrs-category-S1 { border-left-color: #9b59b6; }  /* Own Workforce */
    .esrs-category-S2 { border-left-color: #8e44ad; }  /* Workers in the Value Chain */
    .esrs-category-S3 { border-left-color: #e74c3c; }  /* Affected Communities */
    .esrs-category-S4 { border-left-color: #c0392b; }  /* Consumers and End-users */
    .esrs-category-G1 { border-left-color: #34495e; }  /* Business Conduct */
    .esrs-category-G2 { border-left-color: #2c3e50; }  /* Corporate Governance */
    
    .esrs-category-icon {
        font-size: 2rem;
        margin-bottom: 10px;
    }
    
    .compliance-level {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .compliance-comprehensive { background-color: rgba(46, 204, 113, 0.2); color: #27ae60; }
    .compliance-substantial { background-color: rgba(52, 152, 219, 0.2); color: #2980b9; }
    .compliance-moderate { background-color: rgba(241, 196, 15, 0.2); color: #f39c12; }
    .compliance-limited { background-color: rgba(230, 126, 34, 0.2); color: #d35400; }
    .compliance-minimal { background-color: rgba(231, 76, 60, 0.2); color: #c0392b; }
    
    .upload-container {
        background-color: var(--card-bg);
        border: 2px dashed var(--border-color);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        margin-bottom: 20px;
        transition: all var(--transition-speed);
    }
    
    .upload-container:hover, .upload-container.drag-active {
        border-color: var(--primary-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .upload-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 15px;
    }
    
    .gap-analysis-card {
        background-color: var(--card-bg);
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        overflow: hidden;
    }
    
    .gap-header {
        background-color: rgba(231, 76, 60, 0.1);
        padding: 15px;
        border-left: 4px solid #e74c3c;
    }
    
    .gap-content {
        padding: 15px;
    }
    
    .action-item {
        padding: 10px;
        margin-bottom: 8px;
        background-color: rgba(52, 152, 219, 0.05);
        border-radius: 5px;
        transition: all 0.2s;
    }
    
    .action-item:hover {
        background-color: rgba(52, 152, 219, 0.1);
        transform: translateX(3px);
    }
    
    #complianceRadarChart {
        max-height: 400px;
    }
    
    .section-header {
        border-bottom: 2px solid var(--primary-light);
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    .missing-metrics-list {
        list-style-type: none;
        padding-left: 0;
    }
    
    .missing-metrics-list li {
        padding: 6px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .missing-metrics-list li:last-child {
        border-bottom: none;
    }
    
    .missing-metrics-list li::before {
        content: "â€¢";
        color: var(--primary-color);
        font-weight: bold;
        display: inline-block;
        width: 1em;
        margin-left: -1em;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="row">
        <div class="col-lg-10 offset-lg-1">
            <h1 class="mb-2">ESRS Framework Compliance</h1>
            <p class="lead">Analyze sustainability documents against European Sustainability Reporting Standards</p>
            
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ESRS Compliance Analysis</h5>
                            <p class="text-muted">Upload a sustainability document to analyze its compliance with ESRS requirements</p>
                            
                            <div class="upload-container" id="esrs-drop-area">
                                <i class="bi bi-file-earmark-text upload-icon"></i>
                                <h3>Drag & Drop Documents</h3>
                                <p>or</p>
                                <input type="file" id="esrsFileInput" class="d-none" accept=".pdf,.txt,.doc,.docx">
                                <button class="btn btn-primary" onclick="document.getElementById('esrsFileInput').click()">
                                    <i class="bi bi-upload me-2"></i> Browse Files
                                </button>
                                <p class="mt-2 text-muted">PDF, Word, or text documents</p>
                            </div>
                            
                            <div class="form-check mt-3">
                                <input class="form-check-input" type="checkbox" id="textInputCheck">
                                <label class="form-check-label" for="textInputCheck">
                                    Use text input instead
                                </label>
                            </div>
                            
                            <div id="textInputContainer" class="mt-3" style="display:none;">
                                <label for="documentText" class="form-label">Document Text</label>
                                <textarea id="documentText" class="form-control" rows="8" placeholder="Paste document text here..."></textarea>
                                <button id="analyzeTextBtn" class="btn btn-primary mt-2">
                                    <i class="bi bi-search me-2"></i> Analyze Text
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-body">
                            <h5 class="card-title">About ESRS</h5>
                            <p>The European Sustainability Reporting Standards (ESRS) are mandatory reporting requirements under the Corporate Sustainability Reporting Directive (CSRD). They require detailed disclosure across environmental, social, and governance topics.</p>
                            
                            <div class="accordion" id="accordionESRS">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                            Environmental Standards (E1-E5)
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionESRS">
                                        <div class="accordion-body">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>E1: Climate Change</strong>
                                                        <p class="mb-0 text-muted small">Climate mitigation and adaptation</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>E2: Pollution</strong>
                                                        <p class="mb-0 text-muted small">Prevention and control measures</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>E3: Water and Marine Resources</strong>
                                                        <p class="mb-0 text-muted small">Sustainable use and protection</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>E4: Biodiversity and Ecosystems</strong>
                                                        <p class="mb-0 text-muted small">Protection and restoration</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>E5: Resource Use and Circular Economy</strong>
                                                        <p class="mb-0 text-muted small">Efficiency and circularity</p>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingTwo">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                            Social Standards (S1-S4)
                                        </button>
                                    </h2>
                                    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionESRS">
                                        <div class="accordion-body">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>S1: Own Workforce</strong>
                                                        <p class="mb-0 text-muted small">Working conditions and human rights</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>S2: Workers in the Value Chain</strong>
                                                        <p class="mb-0 text-muted small">Supplier and contractor conditions</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>S3: Affected Communities</strong>
                                                        <p class="mb-0 text-muted small">Community engagement and impacts</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>S4: Consumers and End-users</strong>
                                                        <p class="mb-0 text-muted small">Product safety and consumer protection</p>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingThree">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                            Governance Standards (G1-G2)
                                        </button>
                                    </h2>
                                    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionESRS">
                                        <div class="accordion-body">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>G1: Business Conduct</strong>
                                                        <p class="mb-0 text-muted small">Ethics, anti-corruption, lobbying</p>
                                                    </div>
                                                </li>
                                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <strong>G2: Corporate Governance</strong>
                                                        <p class="mb-0 text-muted small">Board oversight and stakeholder engagement</p>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div id="analysisResultsContainer" style="display:none;">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Compliance Analysis Results</h5>
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <div>
                                        <h3 class="mb-1">Overall Compliance</h3>
                                        <div class="progress" style="height: 25px;">
                                            <div id="overallComplianceBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <h6 class="mb-2">Coverage</h6>
                                        <div id="coverageValue" class="display-6">0%</div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <canvas id="complianceRadarChart"></canvas>
                                </div>
                                
                                <h6 class="section-header">Top Gap Areas</h6>
                                <div id="gapAreasContainer">
                                    <div class="text-center text-muted py-3">
                                        <i class="bi bi-search" style="font-size: 2rem;"></i>
                                        <p class="mt-2">No analysis results available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title">ESRS Category Breakdown</h5>
                                <div id="categoryBreakdownContainer">
                                    <div class="text-center text-muted py-3">
                                        <i class="bi bi-search" style="font-size: 2rem;"></i>
                                        <p class="mt-2">No category data available</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="analysisPlaceholder">
                        <div class="card">
                            <div class="card-body text-center p-5">
                                <i class="bi bi-shield-check" style="font-size: 4rem; color: var(--primary-color);"></i>
                                <h3 class="mt-3">ESRS Compliance Analysis</h3>
                                <p class="text-muted mt-3">Upload a document or enter text to see compliance analysis results. The system will evaluate your sustainability reporting against the European Sustainability Reporting Standards.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle text input vs file upload
    document.getElementById('textInputCheck').addEventListener('change', function() {
        const textInputContainer = document.getElementById('textInputContainer');
        const dropArea = document.getElementById('esrs-drop-area');
        
        if (this.checked) {
            textInputContainer.style.display = 'block';
            dropArea.style.display = 'none';
        } else {
            textInputContainer.style.display = 'none';
            dropArea.style.display = 'block';
        }
    });
    
    // Handle file selection
    document.getElementById('esrsFileInput').addEventListener('change', function(e) {
        if (this.files.length > 0) {
            const file = this.files[0];
            handleFileUpload(file);
        }
    });
    
    // Handle text analysis
    document.getElementById('analyzeTextBtn').addEventListener('click', function() {
        const text = document.getElementById('documentText').value;
        if (text.trim().length === 0) {
            alert('Please enter document text to analyze');
            return;
        }
        
        analyzeDocumentText(text);
    });
    
    // Function to handle file upload
    function handleFileUpload(file) {
        // Show loading indicator
        // In a real implementation, this would extract text from the file and send it for analysis
        // For now, we'll just simulate a delay and then show mock results
        
        setTimeout(() => {
            // For demonstration, generate mock text based on file name
            const mockText = `This is a sustainability report covering various ESRS topics including climate change targets, pollution prevention measures, and workforce diversity initiatives. The company has committed to reducing carbon emissions by 30% by 2030 from a 2020 baseline. Water consumption has been reduced by 15% through efficiency measures. The report includes comprehensive diversity metrics and supply chain labor assessments.`;
            
            analyzeDocumentText(mockText);
        }, 1500);
    }
    
    // Function to analyze document text
    function analyzeDocumentText(text) {
        // Show loading indicator
        // In a real implementation, this would send the text to the backend for analysis
        // For now, we'll just simulate a delay and then show mock results
        
        // API call to analyze text against ESRS
        fetch('/api/esrs/match-document', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                document_text: text
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Display the results
                displayAnalysisResults(data.results);
            } else {
                alert('Error analyzing document: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error analyzing document. Please try again.');
            
            // For demonstration, display mock results
            const mockResults = getMockResults();
            displayAnalysisResults(mockResults);
        });
    }
    
    // Function to display analysis results
    function displayAnalysisResults(results) {
        // Show results container, hide placeholder
        document.getElementById('analysisResultsContainer').style.display = 'block';
        document.getElementById('analysisPlaceholder').style.display = 'none';
        
        // Set overall compliance score
        const overallScore = results.overall_score * 100;
        const complianceBar = document.getElementById('overallComplianceBar');
        complianceBar.style.width = `${overallScore}%`;
        complianceBar.textContent = `${overallScore.toFixed(0)}%`;
        
        // Set color based on score
        if (overallScore >= 80) {
            complianceBar.className = 'progress-bar bg-success';
        } else if (overallScore >= 60) {
            complianceBar.className = 'progress-bar bg-info';
        } else if (overallScore >= 40) {
            complianceBar.className = 'progress-bar bg-warning';
        } else {
            complianceBar.className = 'progress-bar bg-danger';
        }
        
        // Set coverage value
        document.getElementById('coverageValue').textContent = `${results.coverage}%`;
        
        // Render radar chart
        renderComplianceRadarChart(results.categories);
        
        // Display gap areas
        displayGapAreas(results.gap_areas);
        
        // Display category breakdown
        displayCategoryBreakdown(results.categories);
    }
    
    // Function to render compliance radar chart
    function renderComplianceRadarChart(categories) {
        const ctx = document.getElementById('complianceRadarChart').getContext('2d');
        
        // Extract category data
        const labels = [];
        const scores = [];
        
        for (const [categoryId, categoryData] of Object.entries(categories)) {
            labels.push(categoryId);
            scores.push(categoryData.score * 100);
        }
        
        // Destroy existing chart if it exists
        if (window.complianceRadarChart) {
            window.complianceRadarChart.destroy();
        }
        
        // Create new chart
        window.complianceRadarChart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ESRS Compliance',
                    data: scores,
                    backgroundColor: 'rgba(45, 152, 218, 0.2)',
                    borderColor: 'rgba(45, 152, 218, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(45, 152, 218, 1)'
                }]
            },
            options: {
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 100
                    }
                }
            }
        });
    }
    
    // Function to display gap areas
    function displayGapAreas(gapAreas) {
        const container = document.getElementById('gapAreasContainer');
        container.innerHTML = '';
        
        if (gapAreas.length === 0) {
            container.innerHTML = `
                <div class="alert alert-success">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    No significant gaps detected in ESRS coverage.
                </div>
            `;
            return;
        }
        
        // Show top 3 gap areas
        const topGaps = gapAreas.slice(0, 3);
        
        for (const gap of topGaps) {
            container.innerHTML += `
                <div class="gap-analysis-card">
                    <div class="gap-header">
                        <strong>${gap}</strong>
                    </div>
                    <div class="gap-content">
                        <p>Prioritize disclosures in this area to improve ESRS compliance. Consider these actions:</p>
                        <div class="action-item">
                            <i class="bi bi-clipboard-data me-2"></i>
                            Develop metrics and KPIs specific to this category
                        </div>
                        <div class="action-item">
                            <i class="bi bi-shield-check me-2"></i>
                            Ensure alignment with ESRS disclosure requirements
                        </div>
                        <div class="action-item">
                            <i class="bi bi-graph-up me-2"></i>
                            Include trend data and forward-looking targets
                        </div>
                    </div>
                </div>
            `;
        }
    }
    
    // Function to display category breakdown
    function displayCategoryBreakdown(categories) {
        const container = document.getElementById('categoryBreakdownContainer');
        container.innerHTML = '';
        
        // Create category cards
        for (const [categoryId, categoryData] of Object.entries(categories)) {
            const score = categoryData.score * 100;
            const complianceLevel = categoryData.compliance_level;
            const termCoverage = categoryData.term_coverage;
            const metricCoverage = categoryData.metric_coverage;
            
            // Determine compliance level class
            let complianceClass = '';
            if (complianceLevel === 'Comprehensive') {
                complianceClass = 'compliance-comprehensive';
            } else if (complianceLevel === 'Substantial') {
                complianceClass = 'compliance-substantial';
            } else if (complianceLevel === 'Moderate') {
                complianceClass = 'compliance-moderate';
            } else if (complianceLevel === 'Limited') {
                complianceClass = 'compliance-limited';
            } else {
                complianceClass = 'compliance-minimal';
            }
            
            // Get category icon
            let categoryIcon = '';
            if (categoryId.startsWith('E')) {
                categoryIcon = 'bi-tree';
            } else if (categoryId.startsWith('S')) {
                categoryIcon = 'bi-people';
            } else if (categoryId.startsWith('G')) {
                categoryIcon = 'bi-building';
            }
            
            // Create missing metrics list
            let missingMetricsHtml = '';
            if (categoryData.gap_metrics && categoryData.gap_metrics.length > 0) {
                const topMissingMetrics = categoryData.gap_metrics.slice(0, 3);
                missingMetricsHtml = `
                    <h6 class="mt-3">Top Missing Metrics:</h6>
                    <ul class="missing-metrics-list">
                        ${topMissingMetrics.map(metric => `<li>${metric}</li>`).join('')}
                    </ul>
                `;
            }
            
            container.innerHTML += `
                <div class="card mb-3 esrs-category-card esrs-category-${categoryId}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <i class="bi ${categoryIcon} esrs-category-icon"></i>
                                <h5>${categoryId}</h5>
                                <span class="compliance-level ${complianceClass}">${complianceLevel}</span>
                            </div>
                            <div class="text-center">
                                <div class="display-6">${score.toFixed(0)}%</div>
                                <div class="small text-muted">Compliance</div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <div class="d-flex justify-content-between small mb-1">
                                <span>Term Coverage</span>
                                <span>${termCoverage}%</span>
                            </div>
                            <div class="progress" style="height: 5px;">
                                <div class="progress-bar" role="progressbar" style="width: ${termCoverage}%;" aria-valuenow="${termCoverage}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <div class="mt-2">
                            <div class="d-flex justify-content-between small mb-1">
                                <span>Metric Coverage</span>
                                <span>${metricCoverage}%</span>
                            </div>
                            <div class="progress" style="height: 5px;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: ${metricCoverage}%;" aria-valuenow="${metricCoverage}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        ${missingMetricsHtml}
                    </div>
                </div>
            `;
        }
    }
    
    // Function to generate mock results (fallback if API fails)
    function getMockResults() {
        return {
            "overall_score": 0.57,
            "categories": {
                "E1": {
                    "score": 0.82,
                    "compliance_level": "Comprehensive",
                    "term_coverage": 85.0,
                    "metric_coverage": 78.0,
                    "terms_found": ["climate", "carbon", "emissions", "greenhouse gas", "GHG", "paris agreement"],
                    "metrics_found": ["Scope 1 GHG emissions", "Scope 2 GHG emissions", "Carbon reduction targets", "Climate transition plan"],
                    "gap_metrics": ["Scope 3 GHG emissions", "Climate-related physical risks", "Climate-related financial impacts"]
                },
                "E2": {
                    "score": 0.45,
                    "compliance_level": "Moderate",
                    "term_coverage": 40.0,
                    "metric_coverage": 50.0,
                    "terms_found": ["emissions", "discharge", "waste water"],
                    "metrics_found": ["Air pollutants emissions", "Water pollutants discharged"],
                    "gap_metrics": ["Soil contaminants", "Pollution prevention measures", "Pollution-related incidents"]
                },
                "E3": {
                    "score": 0.65,
                    "compliance_level": "Substantial",
                    "term_coverage": 70.0,
                    "metric_coverage": 60.0,
                    "terms_found": ["water", "water stress", "water consumption", "water quality"],
                    "metrics_found": ["Water consumption", "Water stress assessment", "Water management plan"],
                    "gap_metrics": ["Water recycled and reused", "Marine resource impacts"]
                },
                "E4": {
                    "score": 0.25,
                    "compliance_level": "Limited",
                    "term_coverage": 20.0,
                    "metric_coverage": 30.0,
                    "terms_found": ["biodiversity", "conservation"],
                    "metrics_found": ["Biodiversity action plan"],
                    "gap_metrics": ["Biodiversity impact assessment", "Protected areas impact", "Endangered species impact", "Deforestation measures"]
                },
                "E5": {
                    "score": 0.75,
                    "compliance_level": "Substantial",
                    "term_coverage": 80.0,
                    "metric_coverage": 70.0,
                    "terms_found": ["circular economy", "resource efficiency", "recycling", "waste management", "waste reduction"],
                    "metrics_found": ["Resource consumption", "Recycled input materials", "Waste generated", "Waste diverted from disposal"],
                    "gap_metrics": ["Circular economy initiatives"]
                },
                "S1": {
                    "score": 0.85,
                    "compliance_level": "Comprehensive",
                    "term_coverage": 90.0,
                    "metric_coverage": 80.0,
                    "terms_found": ["employee", "workforce", "diversity", "inclusion", "gender pay gap", "health and safety", "training"],
                    "metrics_found": ["Diversity indicators", "Gender pay gap", "Health and safety incidents", "Employee training hours"],
                    "gap_metrics": ["Collective bargaining coverage"]
                },
                "S2": {
                    "score": 0.35,
                    "compliance_level": "Limited",
                    "term_coverage": 30.0,
                    "metric_coverage": 40.0,
                    "terms_found": ["supply chain", "human rights"],
                    "metrics_found": ["Supplier code of conduct coverage", "Living wage assessment"],
                    "gap_metrics": ["Supply chain labor assessment", "Worker rights violations identified", "Child labor risk mitigation"]
                },
                "S3": {
                    "score": 0.55,
                    "compliance_level": "Moderate",
                    "term_coverage": 60.0,
                    "metric_coverage": 50.0,
                    "terms_found": ["community", "local community", "community engagement", "social impact"],
                    "metrics_found": ["Community engagement activities", "Community development investments", "Community impact assessments"],
                    "gap_metrics": ["Land rights considerations", "Indigenous peoples impact"]
                },
                "S4": {
                    "score": 0.60,
                    "compliance_level": "Substantial",
                    "term_coverage": 65.0,
                    "metric_coverage": 55.0,
                    "terms_found": ["consumer", "customer", "product safety", "data privacy"],
                    "metrics_found": ["Product safety incidents", "Consumer complaints", "Data privacy breaches"],
                    "gap_metrics": ["Consumer satisfaction metrics", "Responsible marketing policies"]
                },
                "G1": {
                    "score": 0.50,
                    "compliance_level": "Moderate",
                    "term_coverage": 45.0,
                    "metric_coverage": 55.0,
                    "terms_found": ["ethics", "corruption", "whistleblower"],
                    "metrics_found": ["Anti-corruption policies", "Corruption incidents", "Whistleblower protection"],
                    "gap_metrics": ["Political contributions", "Anti-competitive behavior cases"]
                },
                "G2": {
                    "score": 0.70,
                    "compliance_level": "Substantial",
                    "term_coverage": 75.0,
                    "metric_coverage": 65.0,
                    "terms_found": ["governance", "board", "directors", "transparency", "accountability", "stakeholder engagement"],
                    "metrics_found": ["Board diversity", "Board ESG oversight", "Executive ESG compensation"],
                    "gap_metrics": ["Stakeholder engagement", "Sustainability strategy integration"]
                }
            },
            "coverage": 72.7,
            "gap_areas": [
                "E4: Biodiversity and Ecosystems",
                "S2: Workers in the Value Chain",
                "E2: Pollution"
            ],
            "timestamp": "2023-07-10T14:30:00Z"
        };
    }
</script>
{% endblock %}